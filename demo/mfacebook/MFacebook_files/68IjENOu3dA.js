/*!CK:581875302!*//*1398377695,178158927*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZkG4Z"]); }

__d("MComposerNavigationPolicy",["MHistory","Stratcom","invariant","MComposerNavigationConstants"],function(a,b,c,d,e,f,g,h,i){var j=b('MComposerNavigationConstants').USE_PUSH_STATE,k='composer',l=0;function m(){return (k+"-"+(++l));}function n(p){p.forEach(function(q){return q.call();});}function o(p){"use strict";this.$MComposerNavigationPolicy0=true;this.$MComposerNavigationPolicy1=false;this.$MComposerNavigationPolicy2=false;this.$MComposerNavigationPolicy3=null;this.$MComposerNavigationPolicy4=[];this.$MComposerNavigationPolicy5=[];this.$MComposerNavigationPolicy6=[];this.$MComposerNavigationPolicy7=[];this.$MComposerNavigationPolicy8=[];this.$MComposerNavigationPolicy9=p||null;this.$MComposerNavigationPolicya=m();}o.prototype.$MComposerNavigationPolicyb=function(){"use strict";if(this.$MComposerNavigationPolicy3){this.$MComposerNavigationPolicy3.remove();this.$MComposerNavigationPolicy3=null;}};o.prototype.close=function(){"use strict";i(this.$MComposerNavigationPolicy1);i(!this.$MComposerNavigationPolicy2);this.$MComposerNavigationPolicy0=false;this.$MComposerNavigationPolicy2=true;if(j){if(this.$MComposerNavigationPolicy9){g.pushSoftState(this.$MComposerNavigationPolicy9.getSoftState());}else g.popSoftState(this.$MComposerNavigationPolicya);}else this.$MComposerNavigationPolicyc();return this;};o.prototype.$MComposerNavigationPolicyc=function(){"use strict";if(this.$MComposerNavigationPolicy0){n(this.$MComposerNavigationPolicy4);}else this.$MComposerNavigationPolicy0=true;n(this.$MComposerNavigationPolicy5);j&&this.$MComposerNavigationPolicyb();if(this.$MComposerNavigationPolicy9)this.$MComposerNavigationPolicyd.call(this.$MComposerNavigationPolicy9);return this;};o.prototype.$MComposerNavigationPolicye=function(){"use strict";if(this.$MComposerNavigationPolicy9)this.$MComposerNavigationPolicyf.call(this.$MComposerNavigationPolicy9);n(this.$MComposerNavigationPolicy7);return this;};o.prototype.$MComposerNavigationPolicyf=function(){"use strict";j&&this.$MComposerNavigationPolicyb();n(this.$MComposerNavigationPolicy8);return this;};o.prototype.$MComposerNavigationPolicyd=function(){"use strict";n(this.$MComposerNavigationPolicy6);if(j)this.$MComposerNavigationPolicy3=this.$MComposerNavigationPolicyg();return this;};o.prototype.$MComposerNavigationPolicyg=function(){"use strict";return h.listen('m:history:change',null,function(event){var p=event.getData().soft;if(!p&&this.$MComposerNavigationPolicy9){g.pushSoftState(this.$MComposerNavigationPolicy9.getSoftState());return;}if(this.getSoftState()===p){this.$MComposerNavigationPolicye();return;}if(this.$MComposerNavigationPolicy9&&this.$MComposerNavigationPolicy9.getSoftState()===p){this.$MComposerNavigationPolicyc();return;}if(!p&&!this.$MComposerNavigationPolicy9){this.$MComposerNavigationPolicyc();return;}}.bind(this));};o.prototype.getParent=function(){"use strict";return this.$MComposerNavigationPolicy9;};o.prototype.getSoftState=function(){"use strict";return this.$MComposerNavigationPolicya;};o.prototype.hasClosed=function(){"use strict";return this.$MComposerNavigationPolicy2;};o.prototype.hasOpened=function(){"use strict";return this.$MComposerNavigationPolicy1;};o.prototype.addOnClose=function(p){"use strict";this.$MComposerNavigationPolicy5.push(p);return this;};o.prototype.addOnCloseByBrowser=function(p){"use strict";this.$MComposerNavigationPolicy4.push(p);return this;};o.prototype.addOnOpen=function(p){"use strict";this.$MComposerNavigationPolicy7.push(p);return this;};o.prototype.addOnOpenChild=function(p){"use strict";this.$MComposerNavigationPolicy8.push(p);return this;};o.prototype.addOnReturnFromChild=function(p){"use strict";this.$MComposerNavigationPolicy6.push(p);return this;};o.prototype.open=function(){"use strict";i(!this.$MComposerNavigationPolicy1);this.$MComposerNavigationPolicy1=true;if(j){this.$MComposerNavigationPolicy3=this.$MComposerNavigationPolicyg();g.pushSoftState(this.$MComposerNavigationPolicya);}else this.$MComposerNavigationPolicye();return this;};e.exports=o;});
__d("MComposerNavigation",["MComposerNavigationPolicy","invariant"],function(a,b,c,d,e,f,g,h){function i(){h(!j||j.hasOpened());}var j=null,k={back:function(){if(!j)return;k.currentPolicy().close();},currentPolicy:function(){i();return j;},newPolicy:function(){i();var l=new g(j);j=l;l.addOnClose(function(){return j=l.getParent();});return l;}};e.exports=k;});
__d("MAlbumPicker",["CSS","DataStore","DOM","Stratcom","$","copyProperties","eventsMixinDeprecated"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){"use strict";this._root=o;this._albumList=i.scry(this._root,'div','album-list')[0];this._createAlbumRoot=i.scry(this._root,'div','create-album')[0];this._albumListInputs=i.scry(this._albumList,'input').filter(function(s){return s.type==='radio';});for(var p=0;p<this._albumListInputs.length;p++){var q=this._albumListInputs[p];if(q.checked){var r=h.get(q);this._currentSelectedAlbumID=r.album_id;break;}}this._listeners=[j.listen('click','cancel_album_picker',this._cancel.bind(this)),j.listen('click','album-input',this._onAlbumSelected.bind(this))];if(this._albumList&&this._createAlbumRoot){this._listeners.push(j.listen('click','create-album-item',this._openCreateAlbum.bind(this)));this._listeners.push(j.listen('click','cancel_create_album',this._cancelCreateAlbum.bind(this)));this._listeners.push(j.listen('MPhotosCreateAlbum:created',null,this._onCreateAlbum.bind(this)));}}n.prototype.hide=function(){"use strict";i.hide(this._root);};n.prototype.show=function(){"use strict";i.show(this._root);};n.prototype._openCreateAlbum=function(event){"use strict";j.invoke('MAlbumPicker:createalbum:open');i.hide(this._albumList);i.show(this._createAlbumRoot);};n.prototype._closeCreateAlbum=function(){"use strict";j.invoke('MAlbumPicker:createalbum:close');i.hide(this._createAlbumRoot);i.show(this._albumList);};n.prototype._cancelCreateAlbum=function(){"use strict";this._albumListInputs.forEach(function(o){var p=h.get(o);if(p.album_id===this._currentSelectedAlbumID)o.checked=true;}.bind(this));this._closeCreateAlbum();};n.prototype._onCreateAlbum=function(event){"use strict";var o=event.getData();this._closeCreateAlbum();this._chooseAlbum(false,o.album_id,o.privacy_id);};n.prototype._onAlbumSelected=function(event){"use strict";var o=event.getNode('album-input'),p=h.get(o),q=p.is_mobile_uploads_album,r=p.album_id,s=p.privacy_id;this._currentSelectedAlbumID=r;this._chooseAlbum(q,r,s);};n.prototype._chooseAlbum=function(o,p,q){"use strict";g.conditionClass(k('album-button'),'active',!o);this.hide();this.invoke('choose-album',{is_mobile_uploads_album:o,album_id:p,privacy_id:q});};n.prototype._cancel=function(){"use strict";this.hide();this.invoke('cancel');};n.fromID=function(o){"use strict";var p=k(o),q=h.get(p);if(!q._albumPicker)q._albumPicker=new n(p);return q._albumPicker;};m(n,['cancel','choose-album']);l(n.prototype,{_root:null,_listeners:null});e.exports=n;});
__d("XAsyncHashtagSuggestionControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/composer\/async\/hashtagSuggestions\/",{text:{type:"String",required:true},request_idx:{type:"Int",required:true}});});
__d("MHashtagTagger",["CSS","DataStore","DOM","MRequest","Stratcom","XAsyncHashtagSuggestionControllerURIBuilder","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=null;function o(p,q,r){"use strict";this.$MHashtagTagger0=p;this.$MHashtagTagger1=q;this.$MHashtagTagger2=i.find(q,'ul','hashtag-token-container');this.$MHashtagTagger3=i.find(q,'li','hashtag-token-prototype');this.$MHashtagTagger4=r;this.$MHashtagTagger5();this.$MHashtagTagger6={};this.$MHashtagTagger7=0;this.$MHashtagTagger8={};this.$MHashtagTagger9={};this.$MHashtagTaggera={add:{},remove:{}};n=this;var s=[k.listen('click','hashtag-tagger-item',function(t){t.prevent();var u=h.get(t.getNode('hashtag-tagger-item')).hashtag;if(this.$MHashtagTaggerb(u)){this.$MHashtagTaggerc(u);}else this.$MHashtagTaggerd(u);}.bind(this)),k.listen('click',['hashtag-token','remove-token'],function(t){t.kill();var u=h.get(t.getNode('hashtag-token'));i.remove(u);}.bind(this)),k.listen('MStructuredComposer:cleanup',null,function(){while(s.length)s.pop().remove();})];}o.prototype.$MHashtagTagger5=function(){"use strict";this.$MHashtagTaggere={};i.scry(this.$MHashtagTagger0,'label','hashtag-tagger-item').forEach(function(p){var q=h.get(p).hashtag;this.$MHashtagTaggere[q]=p;},this);};o.prototype.$MHashtagTaggerf=function(){"use strict";Object.keys(this.$MHashtagTaggere).forEach(function(p){this.$MHashtagTaggerg(p,this.$MHashtagTaggerb(p));},this);};o.prototype.initAndShow=function(p){"use strict";this.$MHashtagTagger8=p;this.$MHashtagTagger9=this.$MHashtagTaggerh();this.$MHashtagTaggera={add:{},remove:{}};this.$MHashtagTaggerf();i.show(this.$MHashtagTagger0);};o.prototype.commitChangesAndHide=function(p){"use strict";if(p)this.$MHashtagTaggeri();i.hide(this.$MHashtagTagger0);return this.$MHashtagTaggera;};o.prototype.updateSuggestionsForText=function(p){"use strict";var q=this.$MHashtagTagger7++,r=(new l()).setString('text',p).setInt('request_idx',q).getURI(),s=new j(r);this.$MHashtagTagger6[q]=s;s.send();};o.replaceTaggerView=function(p,q){"use strict";n.$MHashtagTaggerj(p,q);};o.prototype.$MHashtagTaggerj=function(p,q){"use strict";var r=i.find(this.$MHashtagTagger0,'div','hashtag-tagger-view');i.replace(r,p);this.$MHashtagTagger5();this.$MHashtagTaggerf();Object.keys(this.$MHashtagTagger6).forEach(function(s){if(s<q){this.$MHashtagTagger6[s].abort();delete this.$MHashtagTagger6[s];}if(s==q)delete this.$MHashtagTagger6[s];},this);};o.prototype.$MHashtagTaggerb=function(p){"use strict";if(this.$MHashtagTaggera.add[p])return true;if(this.$MHashtagTaggera.remove[p])return false;if(this.$MHashtagTagger8[p]||this.$MHashtagTagger9[p])return true;return false;};o.prototype.$MHashtagTaggerd=function(p){"use strict";if(this.$MHashtagTaggera.remove[p]){delete this.$MHashtagTaggera.remove[p];}else this.$MHashtagTaggera.add[p]=true;this.$MHashtagTaggerg(p,true);};o.prototype.$MHashtagTaggerc=function(p){"use strict";if(this.$MHashtagTaggera.add[p]){delete this.$MHashtagTaggera.add[p];}else this.$MHashtagTaggera.remove[p]=true;this.$MHashtagTaggerg(p,false);};o.prototype.$MHashtagTaggerh=function(){"use strict";var p=i.scry(this.$MHashtagTagger2,'li','hashtag-token'),q={};p.forEach(function(r){var s=h.get(r).hashtag;q[s]=true;});return q;};o.prototype.$MHashtagTaggeri=function(){"use strict";var p=this.$MHashtagTagger9;Object.keys(this.$MHashtagTaggera.remove).forEach(function(q){if(this.$MHashtagTagger9[q])delete this.$MHashtagTagger9[q];},this);Object.keys(this.$MHashtagTaggera.add).forEach(function(q){p[q]=true;},this);this.$MHashtagTaggera.add={};this.$MHashtagTaggerk(Object.keys(p));};o.prototype.$MHashtagTaggerk=function(p){"use strict";i.scry(this.$MHashtagTagger2,'li','hashtag-token').forEach(i.remove);for(var q=0;q<p.length;q++){var r=p[q],s=this.$MHashtagTagger3.cloneNode(true);h.get(s).hashtag=r;k.addSigil(s,'hashtag-token');var t=i.create('span',{className:"_5mf2"},String(r)),u=i.create('input',{type:'hidden',name:'tag_nar['+q+']',value:r});i.prependContent(s,[t,u]);i.appendContent(this.$MHashtagTagger2,s);i.show(s);}var v=!!p.length;(v?i.show:i.hide)(this.$MHashtagTagger1);g.conditionClass(this.$MHashtagTagger4,'active',v);};o.prototype.$MHashtagTaggerg=function(p,q){"use strict";var r=this.$MHashtagTaggere[p],s=i.find(r,'input','hashtag-tagger-item-input');s.checked=q;};e.exports=o;});
__d("MOpenGraphTagger",["CSS","DataStore","DOM","MarauderLogger","MRequest","OGComposerJSConstants","Stratcom","$","copyProperties","cx","eventsMixinDeprecated","fbt","mtx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(u){"use strict";this.setRoot(u);this._prompt=i.find(u,'span','og-composer-prompt');this._defaultPrompt=this._prompt.firstChild;this._defaultIconSelector=i.find(u,'div','og-icon-selector');this._iconSelector=this._defaultIconSelector;this._cancelButton=i.find(u,'button','cancel-og-tagger');this._defaultCancelButtonText=this._cancelButton.firstChild;this._isFromActivityLink=false;i.listen(this.getRoot(),'click',null,this._handleClick.bind(this));this._listeners=[m.listen('click','object_result',function(event){event.prevent();var v=h.get(event.getNode('object_result'));this._objectID=v.id;this._objectStr=v.name;this._icon=v.icon;this._iconSrc=v.icon_src;this._showAttachment=v.show_attachment;var w=i.scry(this.getRoot(),'div','og-location-search');if(w.length!==0&&v.needs_location&&!this._placeID){this._showLocationSearch();}else this._submit();}.bind(this)),m.listen('click','at_result',function(event){event.prevent();this._selectActionType(h.get(event.getNode('at_result')));j.log('og_composer_verb_selected',undefined,{at_id:this._actionType.id,place_id:this._placeID});}.bind(this)),m.listen('click','og_location_result',function(event){event.prevent();var v=h.get(event.getNode('og_location_result'));this._locationID=v.id;this._locationStr=v.str;this._submit();}.bind(this)),m.listen('click','quicksearch-input',function(event){if(event.getNode('og-object-search')){var v={at_id:this._actionType.id,place_id:this._placeID};j.log('og_composer_object_search_clicked',undefined,v);}}.bind(this)),m.listen('composerReset',null,function(event){this._reset();this._placeID=0;}.bind(this))];m.listen('MStructuredComposer:cleanup',null,function(event){for(var v=0;v<this._listeners.length;v++)this._listeners[v].remove();this._listeners=[];}.bind(this));}t.prototype.getRoot=function(){"use strict";return this.root;};t.prototype.setRoot=function(u){"use strict";this.root=u;};t.prototype.hide=function(){"use strict";i.hide(this.getRoot());this.toggleIncludedPlaceSelector(false);};t.prototype.show=function(){"use strict";i.show(this.getRoot());};t.prototype.updatePrompt=function(u){"use strict";i.setContent(this._prompt,u);};t.prototype.setPlaceID=function(u){"use strict";this._placeID=u;};t.prototype.setSuggestionMechanism=function(u){"use strict";this._suggestionMechanism=u;};t.prototype.toggleIncludedPlaceSelector=function(u){"use strict";var v=i.scry(this.getRoot(),'div','og_included_place');if(v.length){this._isFromActivityLink=u;if(u){i.show(v[0]);}else i.hide(v[0]);}};t.prototype._handleClick=function(event){"use strict";if(event.getNode('cancel-og-tagger'))this._cancel();};t.prototype._reset=function(){"use strict";var u=i.scry(this.getRoot(),'div','og-object-search');if(u.length!==0){i.hide(u[0]);this._showActionTypeSelector();}var v=i.scry(this.getRoot(),'div','og-location-search');if(v.length!==0)i.hide(v[0]);this._hideIconSelector();this._actionType=null;this._suggestionMechanism=null;this._locationID=null;this.updatePrompt(this._defaultPrompt);this.setCancelButtonText(this._defaultCancelButtonText);m.invoke('m:quicksearch:clear');};t.prototype._cancel=function(){"use strict";j.log('og_composer_cancel_tagger',undefined,{suggestion_mechanism:this._suggestionMechanism,place_id:this._placeID});var u=this._isFromActivityLink;this._reset();this.hide();this.invoke('cancel');if(u)this.invoke('cancelFromActivity');};t.prototype.setCancelButtonText=function(u){"use strict";i.setContent(this._cancelButton,u);};t.prototype._showObjectSearch=function(){"use strict";this._hideActionTypeSelector();i.show(i.find(this.getRoot(),'div','og-object-search'));var u=i.scry(this.getRoot(),'div','og-location-search');if(u.length!==0)i.hide(u[0]);};t.prototype._showLocationSearch=function(){"use strict";var u=i.scry(this.getRoot(),'div','og-location-search');if(u.length!==0){this._hideActionTypeSelector();i.hide(i.find(this.getRoot(),'div','og-object-search'));i.show(u[0]);}};t.prototype.selectActionTypeImplicitly=function(u){"use strict";var v=i.scry(this.getRoot(),'div','at_result'),w=false;for(var x=0;x<v.length;x++){var y=h.get(v[x]);if(y.id==u){w=true;break;}}if(!w)return false;this._selectActionType(y);return true;};t.prototype.showIconSelector=function(u,v,w,x){"use strict";this.show();this._hideActionTypeSelector();this.updatePrompt("Select an icon");var y='/platform/og/composer/icon_selector/',z=new k(y).setData({actionTypeID:u,objectID:v,objectStr:w,iconID:x});z.listen('postprocess',this._setUpIconSelector.bind(this));z.send();i.replace(this._iconSelector,this._defaultIconSelector);i.show(this._iconSelector);j.log('og_composer_show_icon_selector');};t.prototype._setUpIconSelector=function(){"use strict";this._iconSelector=i.find(this.getRoot(),'div','og-icon-selector');var u=i.find(this._iconSelector,'a','remove-token');i.listen(u,'click',null,this._cancelIconSelection.bind(this));i.listen(this._iconSelector,'click','og-icon-area',this._selectIcon.bind(this));};t.prototype._cancelIconSelection=function(){"use strict";this._reset();this.invoke('clear');};t.prototype._selectIcon=function(event){"use strict";var u=event.getNode('og-icon-area'),v=u.lastChild.cloneNode();i.show(v);var w=i.find(this.getRoot(),'i','token-icon');m.addSigil(v,'token-icon');i.replace(w,v);this._icon=v;this._iconSrc=h.get(v).icon_src;this._customIconID=this._icon.getAttribute('data-icon');this._reset();this.invoke('iconChanged',{icon:this._icon,icon_src:this._iconSrc,custom_icon_id:this._customIconID});};t.prototype._selectActionType=function(u){"use strict";this._actionType=u;var v={at_id:this._actionType.id,place_id:this._placeID};m.invoke('m:quicksearch:actionSelected',null,v);this._showObjectSearch();this.updatePrompt(this._actionType.prompt);};t.prototype._hideActionTypeSelector=function(){"use strict";var u=i.scry(this.getRoot(),'div','og_ats');if(u.length!==0)g.conditionClass(u[0],"_51xt",true);};t.prototype._showActionTypeSelector=function(){"use strict";var u=i.scry(this.getRoot(),'div','og_ats');if(u.length!==0)g.conditionClass(u[0],"_51xt",false);};t.prototype._hideIconSelector=function(event){"use strict";i.hide(this._iconSelector);this._showActionTypeSelector();};t.prototype._submit=function(){"use strict";var u={action_type:this._actionType.id,action_type_str:this._actionType.name,object:this._objectID,object_str:this._objectStr,show_attachment:this._showAttachment,icon:this._icon,icon_src:this._iconSrc,fbt_phrase:this._getTagPhrase(this._actionType.id,this._icon,this._objectStr,this._locationID?this._locationStr:null),suggestion_mechanism:this._suggestionMechanism,location_id:this._locationID};this._reset();this.invoke('submit',u);delete u.icon;delete u.fbt_phrase;j.log('og_composer_object_selected',undefined,u);};t.prototype._getTagPhrase=function(u,v,w,x){"use strict";var y='';if(x&&u==l.ActionTypeIDs.COMPOSER_LOOKS_FOR){y=r._("{icon}looking for {object} in {place}",[r.param("icon",v),r.param("object",w),r.param("place",x)]);}else switch(u){case l.ActionTypeIDs.COMPOSER_FEELS:y=r._("{icon}feeling {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_WATCHES:y=r._("{icon}watching {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_READS:y=r._("{icon}reading {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_LISTENS:y=r._("{icon}listening to {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_DRINKS:y=r._("{icon}drinking {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_EATS:y=r._("{icon}eating {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_PLAYS:y=r._("{icon}playing {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_TRAVELS:y=r._("{icon}traveling to {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_LOOKS_FOR:y=r._("{icon}looking for {object}",[r.param("icon",v),r.param("object",w)]);break;case l.ActionTypeIDs.COMPOSER_OTHER:y=r._("{icon}{object}",[r.param("icon",v),r.param("object",w)]);break;}return y;};t.fromID=function(u){"use strict";var v=n(u),w=h.get(v);if(!w._ogTagger)w._ogTagger=new t(v);return w._ogTagger;};q(t,['submit','cancel','clear','iconChanged','cancelFromActivity']);o(t.prototype,{root:null,_prompt:null,_defaultPrompt:null,_actionType:null,_objectID:null,_objectStr:null,_icon:null,_iconSelector:null,_defaultIconSelector:null,_showAttachment:null,_customIconID:null,_placeID:0,_listeners:null,_suggestionMechanism:null,_locationID:null,_locationStr:null});e.exports=t;});
__d("MPlacesTagger",["DataStore","DOM","MParent","MPlaces","MRequest","Stratcom","$","copyProperties","eventsMixinDeprecated","mtx","FWLoader"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('FWLoader').FW;function r(s){"use strict";this._root=s;this._addPlaceView=h.find(s,'div','add-place');this._disableFacewebHooks=false;this._errorMessage=h.find(s,'div','error-message');this._searchView=h.find(s,'div','places-search');this._throbber=h.find(s,'div','throbber');this._newPlaceName=h.scry(s,'div','new-place-name')[0];if(this._newPlaceName){this._newPlaceNameTextbox=h.find(this._newPlaceName,'input','');}else this._newPlaceNameTextbox=h.find(this._addPlaceView,'input','new-place-name');if(!window.FW_ENABLED)this._placeHeader=h.find(s,'div','place-header');this._listeners=[l.listen('click','cancel_at_tagger',this._cancel.bind(this)),l.listen('click','place_result',this._submit.bind(this)),l.listen('click','add_place_link',this._showAddPlace.bind(this)),l.listen('click','freeform_link',this._submitFreeformPlace.bind(this)),l.listen('m:places:addform:submit',null,this._submitAddPlace.bind(this))];}r.prototype.cleanup=function(){"use strict";for(var s=0;s<this._listeners.length;s++)this._listeners[s].remove();this._listeners=[];};r.prototype.getDisableFacewebHooks=function(){"use strict";return this._disableFacewebHooks;};r.prototype.hide=function(){"use strict";if(window.FW_ENABLED)q.setNavBarButton('','1;');h.hide(this._addPlaceView);h.show(this._searchView);h.hide(this._root);};r.prototype.setDisableFacewebHooks=function(s){"use strict";this._disableFacewebHooks=s;};r.prototype.show=function(){"use strict";if(window.FW_ENABLED)q.setNavBarButton("Cancel",this._cancel.bind(this));if(!this._hasLocation&&('geolocation' in navigator)){this._locationListener=l.listen('location-update',null,this._handleLocationUpdate.bind(this));this._errorListener=l.listen('location-error',null,this._handleLocationError.bind(this));j.monitorLocation();}else this._showed();h.show(this._root);};r.prototype._removeListeners=function(){"use strict";this._locationListener.remove();this._errorListener.remove();};r.prototype._handleLocationUpdate=function(event){"use strict";this._removeListeners();this._hasLocation=true;l.invoke('m:quicksearch:places:search');this._showed();};r.prototype._handleLocationError=function(event){"use strict";this._removeListeners();this._hasLocation=false;h.show(this._errorMessage);h.hide(this._throbber);this._showed();};r.prototype._showed=function(){"use strict";if(window.FW_ENABLED&&!this.getDisableFacewebHooks()){q.setNavBarTitle("Add a Place");q.setNavBarButton("Cancel",this._cancel.bind(this),q.BUTTON_CANCEL,false,'left');}this.invoke('showed');h.show(this._root);};r.prototype._cancel=function(){"use strict";if(!this.invoke('cancel').getPrevented()){l.invoke('m:quicksearch:places:cancel');this.hide();}};r.prototype._submit=function(event){"use strict";if(i.bySigil(event.getTarget(),'place-tagger')!==this._root)return;var s=g.get(event.getNode('place_result'));s.new_place=false;this._placeResult=s;l.invoke('m:quicksearch:places:click',null,{results:event.getNode('id:places_search_results'),selected_result:event.getNode('place_result')});this.invoke('submit',s);event.kill();};r.prototype._showAddPlace=function(event){"use strict";var s=g.get(event.getNode('add_place_link')).name;this._newPlaceNameTextbox.value=s;h.hide(this._searchView);h.show(this._addPlaceView);var t=h.scry(this._addPlaceView,'*','map_view_container')[0];if(t)new k('/places/showmap.php').addData({target_id:t.id}).setMethod('GET').send();l.invoke('m:places:addplace:show');event.kill();};r.prototype._submitAddPlace=function(event){"use strict";var s=event.getData();this.hide();this.invoke('submit',s);event.kill();};r.prototype._submitFreeformPlace=function(event){"use strict";var s=g.get(event.getNode('freeform_link'));this.hide();this.invoke('submit',s);event.kill();};r.fromID=function(s){"use strict";var t=m(s),u=g.get(t);if(!u._placesTagger)u._placesTagger=new r(t);return u._placesTagger;};o(r,['searching','showed','submit','cancel']);n(r.prototype,{_hasLocation:false,_locationListener:null,_errorListener:null,_root:null,_addPlaceView:null,_errorMessage:null,_newPlaceName:null,_newPlaceNameTextbox:null,_searchView:null,_throbber:null,_listeners:null,_placeResult:null});e.exports=r;});
__d("MAudienceListenerMixin",["Stratcom"],function(a,b,c,d,e,f,g){function h(j,k){return {listen:function(event,l){return this._getMixinInstance().listen(this,event,l);},_invoke:function(event,l){return this._getMixinInstance().invoke(this,event,l);},_cleanupListeners:function(){this._getMixinInstance().cleanupListeners();},_getMixinInstance:function(){if(!this._listenerMixin){this._listenerMixin=new i(j);if(!k){var l=g.listen('m:page:unload',null,function(){this._listenerMixin.cleanupListeners();}.bind(this));this._listenerMixin._listeners.push(l);}}return this._listenerMixin;}};}function i(j){"use strict";this._eventPrefix=j;this._listeners=[];}i.prototype.listen=function(j,event,k){"use strict";var l=this._eventPrefix+'-'+event,m=g.listen(l,null,function(n){if(n.getData().instance==j)k(n);});this._listeners.push(m);};i.prototype.invoke=function(j,event,k){"use strict";k=k||{};k.instance=j;g.invoke(this._eventPrefix+'-'+event,null,k);};i.prototype.cleanupListeners=function(){"use strict";this._listeners.forEach(function(j){j.remove();});this._listeners=[];};e.exports=h;});
__d("MComposerAudienceButton",["DOM","MAudienceListenerMixin","copyProperties","cx","fbt","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p){this._root=n;this._label=g.find(this._root,'td','button-label');this._icon=g.find(this._root,'img','button-icon');this._customIconSrc=o;this._prefix=p;g.listen(this._root,'click',null,this._invoke.bind(this,'click'));}i(m.prototype,h('MComposerAudienceButton'),{setState:function(n,o){var p,q;if(n){if(this._prefix){p=k._("To {who-can-see-this}",[k.param("who-can-see-this",n.label)]);}else p=n.label;q=n.buttonBarIconSrc;}else if(!l(o)){q=this._customIconSrc;var r=[];for(var s in o)r.push(o[s]);if(r.length==1){if(this._prefix){p=k._("To {name}",[k.param("name",r[0])]);}else p=r[0];}else if(r.length==2){if(this._prefix){p=k._("To {name1} and {name2}",[k.param("name1",r[0]),k.param("name2",r[1])]);}else p=k._("{name1} and {name2}",[k.param("name1",r[0]),k.param("name2",r[1])]);}else if(this._prefix){p=k._("To {name1} and {num} others",[k.param("name1",r[0]),k.param("num",r.length-1)]);}else p=k._("{name1} and {num} others",[k.param("name1",r[0]),k.param("num",r.length-1)]);}var t=g.create('img',{className:"_5eu9",src:q});g.replace(this._icon,t);this._icon=t;g.setContent(this._label,p);}});e.exports=m;});
__d("MTokenizerX",["CSS","DataStore","DOM","Stratcom","MViewport","MAudienceListenerMixin","Vector","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=8,q=46;function r(t){this._root=t;this._tokenContainer=i.find(t,'span','token-container');this._input=i.find(t,'input','xm-tokenizer-input');this._label=i.scry(t,'span','xm-tokenizer-label')[0];this._tokens=[];this._selectedToken=null;this._enabled=true;this._lastKeypressHadText=false;this._compressTokens=false;this._orientationChangeListener=null;i.listen(this._root,'click',null,function(event){this.focusInput();event.kill();this._invoke('click');}.bind(this));i.listen(this._input,'keydown',null,function(event){this._lastKeypressHadText=!!this._input.value;this.scrollToTop();}.bind(this));i.listen(this._input,'keyup',null,function(event){var u=event.getRawEvent().keyCode;if(!this._lastKeypressHadText&&(u==p||u==q)){if(this._selectedToken){var v=h.get(this._selectedToken);this._invoke('delete',{key:v.tokenKey});}else{var w=this._tokens[this._tokens.length-1];w&&this._selectToken(w.elem);}}else{this._invoke('input',{inputText:this._input.value});this._selectedToken&&this._selectToken(null);}}.bind(this));i.listen(this._input,'blur',null,function(event){this._invoke('blur');}.bind(this));i.listen(this._root,'touchend','tokenizer-token',function(event){if(!this._enabled)return;var u=event.getNode('tokenizer-token');this._selectToken(this._selectedToken==u?null:u);this.focusInput();event.kill();}.bind(this));j.listen('m:page:unload',null,function(){this._orientationChangeListener&&this._orientationChangeListener.remove();j.removeCurrentListener();});}n(r.prototype,l('MTokenizerX'),{setEnabled:function(t){this._input.disabled=!t;this._enabled=t;},setCompressTokens:function(t){t=!!t;if(this._compressTokens==t)return;this._compressTokens=t;if(t){this._updateCompressed();this._orientationChangeListener=j.listen('m:viewport:orientation-change',null,this._updateCompressed.bind(this));}else{var u=this._tokens.map(function(v){return v.elem;});i.setContent(this._tokenContainer,u);this._orientationChangeListener.remove();this._orientationChangeListener=null;}},_updateCompressed:function(){if(!this._compressTokens)return;i.setContent(this._tokenContainer,null);var t=this._tokens.length;if(!t)return;var u=this._tokens[0].elem;i.appendContent(this._tokenContainer,u);var v=m.getPos(u);for(var w=1;w<t;w++){var x=this._tokens[w].elem;i.appendContent(this._tokenContainer,x);var y=m.getPos(x);if(y.y>v.y){i.remove(x);var z=s(null,'+'+(t-w));i.appendContent(this._tokenContainer,z);if(m.getPos(z).y>v.y){var aa=this._tokenContainer.childNodes;i.remove(aa[aa.length-2]);i.setContent(z,'+'+(t-w+1));}break;}}return;},_indexOf:function(t){for(var u=0;u<this._tokens.length;u++)if(this._tokens[u].key==t)return u;return -1;},getTokenKeys:function(){return this._tokens.map(function(t){return t.key;});},getTokenCount:function(){return this._tokens.length;},addToken:function(t,u,v){if(this._indexOf(t)==-1){var w=s(t,u,v);this._tokens.push({key:t,elem:w});if(this._compressTokens){this._updateCompressed();}else i.appendContent(this._tokenContainer,w);}},prependToken:function(t,u,v){if(this._indexOf(t)==-1){var w=s(t,u,v);this._tokens.unshift({key:t,elem:w});if(this._compressTokens){this._updateCompressed();}else i.prependContent(this._tokenContainer,w);}},removeToken:function(t){var u=this._indexOf(t);if(u!=-1){var v=this._tokens[u].elem;this._tokens.splice(u,1);if(v==this._selectedToken)this._selectedToken=null;if(this._compressTokens){this._updateCompressed();}else i.remove(v);}},clearTokens:function(){i.setContent(this._tokenContainer,null);this._tokens=[];this._selectedToken=null;},getInputValue:function(){return this._input.value;},focusInput:function(){this._input.focus();},clearInput:function(){this._input.value='';this._input.blur();},scrollToTop:function(){k.scrollToNode(this._root);},setLabel:function(t){this._label&&i.setContent(this._label,t);},_selectToken:function(t){var u=this._selectedToken;u&&g.conditionClass(u,'selected',false);t&&g.conditionClass(t,'selected',true);this._selectedToken=t;}});function s(t,u,v){var w=i.create('span',{className:"_59tt touchable"},[v,u]);h.set(w,{tokenKey:t});j.addSigil(w,'tokenizer-token');return w;}e.exports=r;});
__d("MComposerAudienceTokenizer",["DOM","MAudienceListenerMixin","MTokenizerX","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._tokenizer=new i(m);this._tokenizer.listen('click',this._invoke.bind(this,'click'));this._tokenizer.setEnabled(false);this._smallAudText=n;this._largeAudText=o;}j(l.prototype,h('MComposerAudienceTokenizer'),{setState:function(m,n){this._tokenizer.clearTokens();if(m){var o=g.create('img',{className:"_5ajh",src:m.iconSrc});this._tokenizer.addToken('privacy',m.label,o);this._tokenizer.setLabel(this._largeAudText);}else if(n){for(var p in n)this._tokenizer.addToken(p,n[p]);this._tokenizer.setLabel(this._smallAudText);}this._tokenizer.setCompressTokens(true);}});e.exports=l;});
__d("MPrivacySelectorButtonInterstitial",["DOM","MAudienceListenerMixin","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(k,l){this._root=k;this._icon=g.scry(this._root,'div','privacy-button-icon')[0];this._icon&&(this._icon=this._icon.firstChild);this._customIconSrc=l;g.listen(this._root,'click',null,this._invoke.bind(this,'click'));}i(j.prototype,h('MPrivacySelectorButtonInterstitial'),{setState:function(k,l){var m=k?k.buttonBarIconSrc:this._customIconSrc,n=g.create('img',{src:m});g.replace(this._icon,n);this._icon=n;}});e.exports=j;});
__d("MPrivacyAudienceToggle",["CSS","DataStore","DOM","Stratcom"],function(a,b,c,d,e,f,g,h,i,j){function k(m){"use strict";this._root=m;this._secondaryVisible=false;this._selectedAudience=null;i.listen(this._root,'click','audience-option',function(event){var n=event.getNode('audience-option'),o=h.get(n);j.invoke('MPrivacyAudienceToggle-click',null,o);});i.listen(this._root,'click','toggle-secondary',function(){this._toggleSecondaryAudience();j.invoke('MPrivacyAudienceToggle-moreButtonTapped');}.bind(this));}k.prototype.setVisible=function(m){"use strict";m?i.show(this._root):i.hide(this._root);};k.prototype.setSelected=function(m){"use strict";var n=i.scry(this._root,'a','audience-option');n.forEach(function(o){var p=h.get(o).postParam==m;g.conditionClass(o,'selected',p);if(p)this._selectedAudience=o;},this);};k.prototype.resetState=function(){"use strict";this._secondaryVisible&&this._toggleSecondaryAudience();};k.prototype._toggleSecondaryAudience=function(){"use strict";var m=i.scry(this._root,'a','secondary-option'),n=i.find(this._root,'a','more-link'),o=i.find(this._root,'a','less-link');this._secondaryVisible=!this._secondaryVisible;l(n,!this._secondaryVisible);l(o,this._secondaryVisible);m.forEach(function(p){l(p,this._secondaryVisible||p==this._selectedAudience);},this);};function l(m,n){(n?i.show:i.hide)(m);}e.exports=k;});
__d("MPrivacyMessageFriendsList",["CSS","DataStore","DOM","MTypeaheadDataOnlyController","Stratcom","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=20;function n(o){"use strict";this._root=o;this._options={};this._selected={};this._messageArea=i.find(this._root,'div','message-friends-list');this._searchMessage=i.find(this._root,'div','see-more-label');var p=h.get(this._root);this._dataController=new j(p.datasourceConfig);this._dataController.init();this._dataController.setMaxResults(m);i.listen(this._root,'click','friend-audience-option',function(event){var q=event.getNode('friend-audience-option'),r=h.get(q);k.invoke('MPrivacyMessageFriendsList-clicked',null,r);event.kill();}.bind(this));i.listen(this._root,'touchend','friend-audience-option',function(event){event.prevent();});k.listen('MTypeaheadDataOnlyController-waiting',null,function(q){});k.listen('MTypeaheadDataOnlyController-results',null,function(q){var r=q.getData();if(r.instance==this._dataController)this._renderResults(r.results);}.bind(this));this.filterBy(null);}n.prototype.setSelected=function(o,p){"use strict";var q=this._options[o];q&&g.conditionClass(q,'selected',p);if(p){this._selected[o]=true;}else delete this._selected[o];};n.prototype.filterBy=function(o){"use strict";this._dataController.query(o||'');};n.prototype._renderResults=function(o){"use strict";this._options={};var p=[];o.forEach(function(q){var r=this._renderRow(q);this._options[q.id]=r;p.push(r);},this);i.setContent(this._messageArea,p);if(o.length<m){i.hide(this._searchMessage);}else i.show(this._searchMessage);};n.prototype._renderRow=function(o){"use strict";var p=i.create('img',{className:"_51u-",src:o.photo,style:{height:'39px',width:'39px'}}),q=i.create('span',{className:"_51lj"},o.display);k.addSigil(q,'message-participant-name');var r=i.create('div',{className:"_51li touchable"},[p,q]);k.addSigil(r,'friend-audience-option');k.addSigil(r,'touchable');h.set(r,{userID:o.id,name:o.display});this._selected[o.id]&&g.conditionClass(r,'selected',true);return r;};e.exports=n;});
__d("MPrivacySelectorInterstitialX",["DataStore","DOM","MComposerNavigation","MPrivacyAudienceToggle","MPrivacyMessageFriendsList","MTokenizerX","MViewport","Stratcom","SubscriptionsHandler","$","cx","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=10;function t(u){"use strict";this._root=u;var v=g.get(u);this._listeners=new o();this._smallAudienceText=v.smallAudienceText;this._largeAudienceText=v.largeAudienceText;this._tokenizer=new l(h.find(this._root,'div','audience-tokenizer'));this._audienceToggle=new j(h.find(this._root,'div','audience-list'));var w=h.scry(this._root,'div','message-friends-area')[0];if(w){this._messageFriendsList=new k(w);}else this._tokenizer.setEnabled(false);this._selectedUsers={};this._selectedAudience=null;this._updateButtonState();if(this._messageFriendsList){this._tokenizer.listen('input',function(y){var z=y.getData().inputText;this._audienceToggle.setVisible(!z);this._messageFriendsList.filterBy(z);}.bind(this));this._listeners.addSubscriptions(n.listen('MPrivacyMessageFriendsList-clicked',null,function(y){var z=y.getData(),aa=z.userID;if(this._selectedUsers[aa]){this._deselectUser(aa);}else this._selectUser(aa,z.name);if(this._tokenizer.getInputValue()){this._messageFriendsList.filterBy(null);this._audienceToggle.setVisible(true);this._tokenizer.clearInput();this._tokenizer.focusInput();this._tokenizer.scrollToTop();}}.bind(this)));}this._tokenizer.listen('delete',function(y){var z=y.getData().key;if(z=='privacy'){this.setAudience(null);}else this._deselectUser(z);}.bind(this));this._tokenizer.listen('blur',function(){return m.scrollToHeader();});this._listeners.addSubscriptions(n.listen('MPrivacyAudienceToggle-click',null,function(y){var z=y.getData();if(this._selectedAudience&&this._selectedAudience.postParam==z.postParam)z=null;this.setAudience(z);}.bind(this)),h.listen(this._root,'click','cancel-button',function(){this.cancel();i.back();}.bind(this)),h.listen(this._root,'click','confirm-button',function(y){var z=y.getNode('confirm-button');z.disabled=true;this._handleClose({canceled:false,audience:this._selectedAudience,messageRecipients:this._selectedUsers});i.back();}.bind(this)),n.listen('m:page:unload',null,function(){return this._listeners.release();}.bind(this)));var x=g.get(this._root);x.instance=this;g.set(this._root,x);}t.prototype.cancel=function(){"use strict";this._handleClose.bind(this,{canceled:true});};t.prototype.setVisible=function(u){"use strict";u?h.show(this._root):h.hide(this._root);};t.prototype.setMessageParticipants=function(u){"use strict";if(!this._messageFriendsList)return;this._clearAudienceAndParticipants();var v=0;for(var w in u){var x=u[w];this._selectedUsers[w]=u[w];this._messageFriendsList.setSelected(w,true);this._tokenizer.addToken(w,x);if(++v==s)break;}this._updateButtonState();};t.prototype.setAudience=function(u){"use strict";this._clearAudienceAndParticipants();var v=null;if(u){v=h.create('img',{className:"_5ajh",src:u.iconSrc});this._tokenizer.prependToken('privacy',u.label,v);}this._audienceToggle.setSelected(u?u.postParam:null);this._selectedAudience=u;this._updateButtonState();};t.prototype._clearAudienceAndParticipants=function(){"use strict";if(this._selectedAudience){this._tokenizer.removeToken('privacy');this._audienceToggle.setSelected(null);this._selectedAudience=null;}for(var u in this._selectedUsers)this._deselectUser(u);};t.prototype._updateButtonState=function(){"use strict";var u=h.find(this._root,'button','confirm-button'),v=!this._selectedAudience&&r(this._selectedUsers);u.disabled=v;this._updateTokenizerLabel();};t.prototype._deselectUser=function(u){"use strict";if(!this._messageFriendsList)return;if(this._selectedUsers[u]){this._messageFriendsList.setSelected(u,false);this._tokenizer.removeToken(u);delete this._selectedUsers[u];this._updateButtonState();}};t.prototype._selectUser=function(u,v){"use strict";if(!this._messageFriendsList)return;this._selectedAudience&&this.setAudience(null);if(Object.keys(this._selectedUsers).length>=s)return;this._selectedUsers[u]=v;this._messageFriendsList.setSelected(u,true);this._tokenizer.addToken(u,v);this._updateButtonState();};t.prototype._updateTokenizerLabel=function(){"use strict";if(!r(this._selectedUsers)){this._tokenizer.setLabel(this._smallAudienceText);}else this._tokenizer.setLabel(this._largeAudienceText);};t.prototype._handleClose=function(u){"use strict";this.setVisible(false);this._audienceToggle.resetState();n.invoke('MPrivacySelectorInterstitialX-closed',null,u);};t.getInstance=function(u){"use strict";var v=p(u),w=g.get(v),x=w.instance;return x?x:new t(v);};e.exports=t;});
__d("MComposerAudienceController",["DataStore","DOM","getActiveElement","MAjaxify","MComposerAudienceButton","MComposerAudienceConfig","MComposerAudienceTokenizer","MComposerNavigation","MParent","MPrivacySelectorButtonInterstitial","MRequest","Stratcom","SubscriptionsHandler","$","copyProperties","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w='composer_audience_interstitial',x=l.current_condition,y=l.conditions;function z(ba,ca,da){"use strict";this._input=h.find(ba,'input','privacy-input');this._specificAudienceFlag=h.find(ba,'input','specific-audience-flag');this._asyncPlaceholder=h.scry(ba,'div','interstitial-placeholder')[0];this._audienceInterstitial=h.find(document.body,'div',w);this._listeners=new s();this._smallAudText=ca.smallAudienceText;this._largeAudText=ca.largeAudienceText;var ea=ca.customIconSrc;if(x===y.BUTTON_BAR){var fa=h.scry(ba,'table','top-interstitial-button')[0];v(h.isNode(fa));this._view=new k(fa,ea,this._largeAudText);}else if(x===y.TOKENIZER){this._tokenizerElem=h.scry(ba,'div','top-tokenizer')[0];v(h.isNode(this._tokenizerElem));this._view=new m(this._tokenizerElem,this._smallAudText,this._largeAudText);}else if(x===y.PRIVACY_SELECTOR){v(h.isNode(da));this._view=new p(da,ea);}this._interstitial=null;this._asyncStarted=!this._asyncPlaceholder;this._stickySetting=ca.initialAudience;this._audience=ca.initialAudience;this._participants=null;this._updateState();this._view.listen('click',this.openInterstitial.bind(this));this._listeners.addSubscriptions(r.listen('MPrivacySelectorInterstitialX-closed',null,function(ga){var ha=ga.getData();r.invoke('audience-x-closed',null,{canceled:ha.canceled});if(ha.canceled)return;this._audience=ha.audience;this._participants=u({},ha.messageRecipients);this._updateState();}.bind(this)),r.listen('m:page:unload',null,function(){return this._listeners.release();}.bind(this)));ca.instance=this;g.set(ba,ca);}z.prototype.setVisible=function(ba){"use strict";if(this._tokenizerElem)ba?h.show(this._tokenizerElem):h.hide(this._tokenizerElem);};z.prototype.openInterstitial=function(){"use strict";n.newPolicy().addOnOpen(function(){i().blur();r.invoke('audience-x-opened',null,{instance:this});if(!this._interstitial){this._showLoader();}else this._showInterstitial();}.bind(this)).addOnClose(function(){if(!this._interstitial){this._hideLoader();}else this._interstitial.setVisible(false);}.bind(this)).addOnCloseByBrowser(function(){if(this._interstitial)this._interstitial.cancel();}.bind(this)).open();};z.prototype.reset=function(){"use strict";this._audience=this._stickySetting;this._participants={};this._updateState();};z.prototype.setCurrentAsSticky=function(){"use strict";if(this._audience)this._stickySetting=this._audience;};z.prototype.asyncLoadInterstitial=function(){"use strict";if(this._asyncStarted)return;var ba=new q('/privacy/composer/audience_interstitial');ba.setMethod('GET').setAutoRetry(true).setData({tid:this._asyncPlaceholder.id});j.ajaxify(null,null,ba);this._asyncStarted=true;};z.prototype._updateState=function(){"use strict";this._view.setState(this._audience,this._participants);var ba=null;if(this._audience){ba=this._audience.postParam;this._specificAudienceFlag.value=0;}else{ba=JSON.stringify({allow:Object.keys(this._participants),deny:[]});this._specificAudienceFlag.value=1;}this._input.value=ba;};z.prototype._hideLoader=function(){"use strict";this._openOnLoaded=false;h.hide(this._audienceInterstitial);};z.prototype._showInterstitial=function(){"use strict";if(this._audience){this._interstitial.setAudience(this._audience);}else this._interstitial.setMessageParticipants(this._participants||{});this._interstitial.setVisible(true);};z.prototype._showLoader=function(){"use strict";this.asyncLoadInterstitial();this._openOnLoaded=true;h.show(this._audienceInterstitial);};z.prototype._asyncLoaded=function(ba){"use strict";d(['MPrivacySelectorInterstitialX'],function(ca){h.replace(this._audienceInterstitial,ba);this._interstitial=ca.getInstance(ba);if(this._openOnLoaded){this._hideLoader();this._showInterstitial();}}.bind(this));};var aa={asyncLoaded:function(ba){var ca=o.bySigil(ba,'audience-controller'),da=aa.getInstance(ca);da._asyncLoaded(ba);},getInstance:function(ba){var ca=g.get(ba),da;if(x===y.PRIVACY_SELECTOR)da=h.scry(t('structured_composer'),'button','opens-interstitial')[0];return ca.instance||new z(ba,ca,da);}};e.exports=aa;});
__d("MStructuredComposerOGInput",["CSS","DOM","MAjaxify","MarauderLogger","MRequest","MViewport","Stratcom","MUnifiedTaggerConstants","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n.SHOW_UNIFIED_TAGGER,q=55;function r(s,t,u,v,w){"use strict";this.$MStructuredComposerOGInput0=s;this.$MStructuredComposerOGInput1=true;this.$MStructuredComposerOGInput2=null;this.$MStructuredComposerOGInput3=t;this.$MStructuredComposerOGInput4=u;this.$MStructuredComposerOGInput5=u.parentNode;this.$MStructuredComposerOGInput6=w;this.$MStructuredComposerOGInput7=h.find(this.$MStructuredComposerOGInput0,'input','og-action-input');this.$MStructuredComposerOGInput8=h.find(this.$MStructuredComposerOGInput0,'input','og-object-input');this.$MStructuredComposerOGInput9=h.find(this.$MStructuredComposerOGInput0,'input','og-phrase-input');this.$MStructuredComposerOGInputa=h.find(this.$MStructuredComposerOGInput0,'input','og-icon-input');this.$MStructuredComposerOGInputb=h.find(this.$MStructuredComposerOGInput0,'input','og-suggestion-mechanism');this.$MStructuredComposerOGInputc=h.find(this.$MStructuredComposerOGInput0,'input','og-hide-attachment');this.$MStructuredComposerOGInputd=h.find(this.$MStructuredComposerOGInput0,'input','og-location-id');this.$MStructuredComposerOGInpute=h.find(this.$MStructuredComposerOGInput0,'ul','og-tag');this.$MStructuredComposerOGInputf=v;var x=[];if(this.$MStructuredComposerOGInput6){x.push(this.$MStructuredComposerOGInputf.listen('clear',function(){this.$MStructuredComposerOGInput6.clear();this.$MStructuredComposerOGInputg();}.bind(this)));x.push(this.$MStructuredComposerOGInput6.addListener('clear',this.$MStructuredComposerOGInputg.bind(this)));}x.push(this.$MStructuredComposerOGInputf.listen('submit',function(event){var y=h.find(this.$MStructuredComposerOGInpute,'li','token');this.$MStructuredComposerOGInputh();if(event.object_str&&!event.object){this.$MStructuredComposerOGInput9.value=event.object_str;}else{this.$MStructuredComposerOGInput9.value='';if(event.show_attachment){this.$MStructuredComposerOGInputi(event.object,event.object_str);this.$MStructuredComposerOGInputc.value=false;}}if(p){m.invoke('MComposer:tagger:update',null,{ogActivity:{id:event.action_type,icon:event.icon_src,object:event.object_str}});}else{h.remove(y.firstChild);var z={'max-width':(l.getUseableWidth()-q)+'px'},aa=h.create('span',{className:"_52x0",style:z},event.fbt_phrase);h.prependContent(y,aa);}if(this.$MStructuredComposerOGInput6){this.$MStructuredComposerOGInput2=event.fbt_phrase;this.$MStructuredComposerOGInput6.setValue(this.$MStructuredComposerOGInput2);}this.$MStructuredComposerOGInput8.value=event.object;this.$MStructuredComposerOGInput7.value=event.action_type;this.$MStructuredComposerOGInputa.value=null;this.$MStructuredComposerOGInputf.hide();this.$MStructuredComposerOGInputj();this.$MStructuredComposerOGInputb.value=event.suggestion_mechanism;this.$MStructuredComposerOGInputd.value=event.location_id;if(!event.object){if(this.$MStructuredComposerOGInput6)this.$MStructuredComposerOGInput6.hide();this.$MStructuredComposerOGInputf.showIconSelector(event.action_type,event.object,event.object_str,event.icon);}else m.invoke('MStructuredComposerOGInput-done',null,{add:true});}.bind(this)));x.push(this.$MStructuredComposerOGInputf.listen('iconChanged',function(event){if(p){m.invoke('MComposer:tagger:update:og-icon',null,{icon:event.icon_src});}else{var y=h.find(this.$MStructuredComposerOGInpute,'li','token'),z=h.find(y,'i');h.replace(z,event.icon);}this.$MStructuredComposerOGInputa.value=event.custom_icon_id;this.$MStructuredComposerOGInputf.hide();if(this.$MStructuredComposerOGInput6){this.$MStructuredComposerOGInput2['{icon}']=h.create('i',{className:event.icon.className,style:event.icon.style});this.$MStructuredComposerOGInput6.setValue(this.$MStructuredComposerOGInput2);}m.invoke('MStructuredComposerOGInput-done',null,{icon_changed:true});}.bind(this)));x.push(this.$MStructuredComposerOGInputf.listen('cancel',function(event){m.invoke('MStructuredComposerOGInput-done',null,{cancel:true});}.bind(this)));if(p){x.push(m.listen('MComposer:tagger:click',n.TOKEN_TYPES.OBJECT,this.$MStructuredComposerOGInputk.bind(this)),m.listen('MComposer:tagger:click',n.TOKEN_TYPES.ICON,function(){if(this.$MStructuredComposerOGInput6)this.$MStructuredComposerOGInput6.hide();m.invoke('MStructuredComposerOGInput-started',null,{choose_icon:true});this.$MStructuredComposerOGInputf.showIconSelector(this.$MStructuredComposerOGInput7.value,this.$MStructuredComposerOGInput8.value,this.$MStructuredComposerOGInput9.value,this.$MStructuredComposerOGInputa.value);}.bind(this)));}else x.push(h.listen(this.$MStructuredComposerOGInput0,'click','og-tags',this.$MStructuredComposerOGInputl.bind(this)));x.push(h.listen(this.$MStructuredComposerOGInput3,'click',null,this.$MStructuredComposerOGInputk.bind(this)));x.push(h.listen(this.$MStructuredComposerOGInput5,'click','close-composer-attachment',function(event){this.$MStructuredComposerOGInputh();this.$MStructuredComposerOGInputc.value=true;}.bind(this)));x.push(m.listen('m:page:unload',null,function(){this.$MStructuredComposerOGInputm.forEach(function(y){y.remove();});this.$MStructuredComposerOGInputm=[];}.bind(this)));this.$MStructuredComposerOGInputm=x;}r.prototype.$MStructuredComposerOGInputg=function(){"use strict";this.reset();this.$MStructuredComposerOGInputf.hide();m.invoke('MStructuredComposerOGInput-done',null,{remove:true});};r.prototype.reset=function(){"use strict";this.$MStructuredComposerOGInput2=null;this.$MStructuredComposerOGInput7.value='';this.$MStructuredComposerOGInput8.value='';this.$MStructuredComposerOGInput9.value='';this.$MStructuredComposerOGInputa.value='';this.$MStructuredComposerOGInputc.value=false;if(p)m.invoke('MComposer:tagger:update',null,{ogActivity:null});this.$MStructuredComposerOGInputh();if(this.$MStructuredComposerOGInput6)this.$MStructuredComposerOGInput6.clear();this.$MStructuredComposerOGInputj();};r.prototype.setVisible=function(s){"use strict";this.$MStructuredComposerOGInput1=s;this.$MStructuredComposerOGInputj();};r.prototype.hasValue=function(){"use strict";return !!this.$MStructuredComposerOGInput7.value;};r.prototype.getLoggingData=function(){"use strict";if(this.$MStructuredComposerOGInput7.value)return {action_type:this.$MStructuredComposerOGInput7.value,object:this.$MStructuredComposerOGInput8.value,object_str:this.$MStructuredComposerOGInput9.value};return null;};r.prototype.$MStructuredComposerOGInputj=function(){"use strict";var s=!!this.$MStructuredComposerOGInput7.value;if(!p)(s&&this.$MStructuredComposerOGInput1?h.show:h.hide)(this.$MStructuredComposerOGInput0);(this.$MStructuredComposerOGInput1?h.show:h.hide)(this.$MStructuredComposerOGInput3);g.conditionClass(this.$MStructuredComposerOGInput3,'active',s);};r.prototype.$MStructuredComposerOGInputi=function(s,t){"use strict";this.$MStructuredComposerOGInputh();h.show(this.$MStructuredComposerOGInput4);var u='/platform/og/composer/attachment',v=new k(u).setData({object_id:s});i.ajaxify(null,null,v,null);};r.prototype.$MStructuredComposerOGInputh=function(){"use strict";h.replace(h.find(this.$MStructuredComposerOGInput5,'div','og-object-attachment'),this.$MStructuredComposerOGInput4);h.hide(this.$MStructuredComposerOGInput4);};r.prototype.$MStructuredComposerOGInputl=function(event){"use strict";if(event.getNode('remove-token')){this.reset();m.invoke('MStructuredComposerOGInput-done',null,{remove:true});event.kill();return;}else{m.invoke('MStructuredComposerOGInput-started',null,{choose_icon:true});if(this.$MStructuredComposerOGInput6)this.$MStructuredComposerOGInput6.hide();this.$MStructuredComposerOGInputf.showIconSelector(this.$MStructuredComposerOGInput7.value,this.$MStructuredComposerOGInput8.value,this.$MStructuredComposerOGInput9.value,this.$MStructuredComposerOGInputa.value);}};r.prototype.$MStructuredComposerOGInputk=function(event){"use strict";m.invoke('MStructuredComposerOGInput-started');if(this.$MStructuredComposerOGInput6)this.$MStructuredComposerOGInput6.showIfHasValue();j.log('og_composer_icon_clicked');this.$MStructuredComposerOGInputf.show();};e.exports=r;});
__d("MStructuredComposerPlaceInput",["DOM","Stratcom","MUnifiedTaggerConstants"],function(a,b,c,d,e,f,g,h){var i=b('MUnifiedTaggerConstants').SHOW_UNIFIED_TAGGER;function j(k){"use strict";this.$MStructuredComposerPlaceInput0=k;this.$MStructuredComposerPlaceInput1=g.find(this.$MStructuredComposerPlaceInput0,'input','at-input');this.$MStructuredComposerPlaceInput2=g.find(this.$MStructuredComposerPlaceInput0,'ul','place-tag');this.$MStructuredComposerPlaceInput3=g.scry(this.$MStructuredComposerPlaceInput0,'input','new-place-cat-input')[0];if(!this.$MStructuredComposerPlaceInput3)this.$MStructuredComposerPlaceInput3=g.find(this.$MStructuredComposerPlaceInput0,'ul','new-place-cat-input');this.$MStructuredComposerPlaceInput4=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-is-current');this.$MStructuredComposerPlaceInput5=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-name-input');this.$MStructuredComposerPlaceInput6=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-phone-input');this.$MStructuredComposerPlaceInput7=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-website-input');this.$MStructuredComposerPlaceInput8=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-address-input');this.$MStructuredComposerPlaceInput9=g.find(this.$MStructuredComposerPlaceInput0,'input','new-place-freeform');}j.prototype.clear=function(){"use strict";this.$MStructuredComposerPlaceInput1.value='';this.$MStructuredComposerPlaceInput5.value='';this.$MStructuredComposerPlaceInput6.value='';this.$MStructuredComposerPlaceInput7.value='';this.$MStructuredComposerPlaceInput8.value='';g.setContent(this.$MStructuredComposerPlaceInput3,null);this.$MStructuredComposerPlaceInput9.value='';this.$MStructuredComposerPlaceInput4.value='';if(i)h.invoke('MComposer:tagger:update',null,{place:null});};j.prototype.hasValue=function(){"use strict";return !!(this.$MStructuredComposerPlaceInput1.value||this.$MStructuredComposerPlaceInput5.value||this.$MStructuredComposerPlaceInput9.value);};j.prototype.placeSelected=function(k){"use strict";this.clear();if(i){h.invoke('MComposer:tagger:update',null,{place:k});}else{var l=g.find(this.$MStructuredComposerPlaceInput2,'li','token'),m=g.create('span',{className:'innerToken'},k.name);g.replace(l.firstChild,m);}if(k.id){this.$MStructuredComposerPlaceInput1.value=k.id;}else this.$MStructuredComposerPlaceInput9.value=k.name;if(k.new_place){this.$MStructuredComposerPlaceInput5.value=k.name;this.$MStructuredComposerPlaceInput6.value=k.phone||'';this.$MStructuredComposerPlaceInput7.value=k.website||'';this.$MStructuredComposerPlaceInput8.value=k.address||'';this.$MStructuredComposerPlaceInput9.value='';this.$MStructuredComposerPlaceInput4.value=k.is_current;if(k.topic_tokens.value){this.$MStructuredComposerPlaceInput3.value=k.topic_tokens.value;}else for(var n=0;n<k.topic_tokens.length;n++)g.appendContent(this.$MStructuredComposerPlaceInput3,k.topic_tokens[n].cloneNode(true));}};e.exports=j;});
__d("MSuggestCheckinController",["DOM","MFlyout","MPlaces","MRequest","Stratcom","Style","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=50,o=0,p={};function q(r){"use strict";this.$MSuggestCheckinController0=r;this.$MSuggestCheckinController1=g.find(r,'div','composer-buttons');this.$MSuggestCheckinController2=g.find(this.$MSuggestCheckinController1,'button','at-button');this.$MSuggestCheckinController3=false;this.$MSuggestCheckinController4=false;this.$MSuggestCheckinController5=false;this.$MSuggestCheckinController6=false;this.$MSuggestCheckinController7=null;this.$MSuggestCheckinController8=null;this.$MSuggestCheckinController9=true;this.$MSuggestCheckinControllera=[];}q.setContent=function(r,s,t,u){"use strict";if(!p[r])return;p[r].$MSuggestCheckinControllerb(s,t,u);delete p[r];};q.prototype.start=function(){"use strict";if(this.$MSuggestCheckinController3||this.$MSuggestCheckinController6)return;this.$MSuggestCheckinController3=this.$MSuggestCheckinController9=true;var r=this.$MSuggestCheckinControllerc.bind(this);this.$MSuggestCheckinControllerd('focus','composer-textarea',r);this.$MSuggestCheckinControllerd('change','photo-input',r);var s=this.$MSuggestCheckinControllere.bind(this);this.$MSuggestCheckinControllerd('MStructuredComposer:reset',null,s);this.$MSuggestCheckinControllerd('MStructuredComposer-addLocationClicked',null,s);};q.prototype.$MSuggestCheckinControllerc=function(){"use strict";if(!('geolocation' in navigator)||this.$MSuggestCheckinController4||!this.$MSuggestCheckinController9)return;this.$MSuggestCheckinController4=true;this.$MSuggestCheckinControllerd('location-update',null,this.$MSuggestCheckinControllerf.bind(this));this.$MSuggestCheckinControllerd('location-error',null,this.$MSuggestCheckinControllere.bind(this));i.monitorLocation();};q.prototype.$MSuggestCheckinControllerf=function(r){"use strict";var s=r.getData();if(s.position.coords.accuracy==null||s.position.coords.accuracy>n)return;if(this.$MSuggestCheckinController5||!this.$MSuggestCheckinController9)return;this.$MSuggestCheckinController5=true;o++;p[o]=this;var t={json_location:i.getCurrentJSONLocation(),query_id:o},u=new j('/places/checkin/suggest').setMethod('GET').setData(t);this.$MSuggestCheckinControllera.push(u.listen('error',this.$MSuggestCheckinControllere.bind(this)));u.send();};q.prototype.$MSuggestCheckinControllerb=function(r,s,t){"use strict";if(this.$MSuggestCheckinController8||!this.$MSuggestCheckinController9)return;if(!s||l.get(this.$MSuggestCheckinController0,'display')=='none'){this.$MSuggestCheckinControllere();return;}this.$MSuggestCheckinControllerg();this.$MSuggestCheckinController7=s;this.$MSuggestCheckinController8=new h({context:this.$MSuggestCheckinController2,causalElement:document.createElement('span'),classNames:["_5tp-"],margin:'medium',position:'above',nubalign:'center',offsetY:-2,width:'100%'},r);this.$MSuggestCheckinController8.setInsertParent(this.$MSuggestCheckinController1);this.$MSuggestCheckinController8.show();k.invoke('MSuggestCheckin-suggest',null,s);var u=this.$MSuggestCheckinControllerh.bind(this);this.$MSuggestCheckinControllerd('click','suggest_checkin_confirm',u);var v=this.$MSuggestCheckinControlleri.bind(this);this.$MSuggestCheckinControllerd('click','suggest_checkin_reject',v);var w=this.$MSuggestCheckinControllerj.bind(this);this.$MSuggestCheckinControllerd('MStructuredComposer-addedLocation',null,w);this.$MSuggestCheckinControllerd('MStructuredComposer:reset',null,w);if(t.flyout!='yes_no_buttons')this.$MSuggestCheckinController8.addListener('blur',w);};q.prototype.$MSuggestCheckinControllerh=function(){"use strict";this.$MSuggestCheckinControllerk();k.invoke('MSuggestCheckin-confirmed',null,this.$MSuggestCheckinController7);};q.prototype.$MSuggestCheckinControlleri=function(){"use strict";this.$MSuggestCheckinController6=true;this.$MSuggestCheckinControllerk();k.invoke('MSuggestCheckin-rejected',null,this.$MSuggestCheckinController7);};q.prototype.$MSuggestCheckinControllerj=function(){"use strict";this.$MSuggestCheckinController6=true;this.$MSuggestCheckinControllerk();k.invoke('MSuggestCheckin-dismissed',null,this.$MSuggestCheckinController7);};q.prototype.$MSuggestCheckinControllerk=function(){"use strict";this.$MSuggestCheckinController8.destroy();this.$MSuggestCheckinController8=null;this.$MSuggestCheckinControllerl();};q.prototype.$MSuggestCheckinControllere=function(){"use strict";this.$MSuggestCheckinController9=false;this.$MSuggestCheckinControllerl();};q.prototype.$MSuggestCheckinControllerl=function(){"use strict";this.$MSuggestCheckinController3=this.$MSuggestCheckinController4=this.$MSuggestCheckinController5=false;this.$MSuggestCheckinControllerg();p={};};q.prototype.$MSuggestCheckinControllerg=function(){"use strict";for(var r=0;r<this.$MSuggestCheckinControllera.length;r++)this.$MSuggestCheckinControllera[r].remove();this.$MSuggestCheckinControllera=[];};q.prototype.$MSuggestCheckinControllerd=function(r,s,t){"use strict";this.$MSuggestCheckinControllera.push(k.listen(r,s,t));};e.exports=q;});
__d("MTagSuggestionsPoller",["MRequest","XPhotosGetRecognitionControllerURIBuilder","PhotosUploadWaterfallXMixin","mixin","performanceNow","PUWSteps"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=4,n=5000,o=j(i);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(){"use strict";this.$MTagSuggestionsPoller0=2000;this.$MTagSuggestionsPoller1=0;this.$MTagSuggestionsPoller2={};this.$MTagSuggestionsPoller3=false;this.$MTagSuggestionsPoller4=null;}r.prototype.setRecognitionProject=function(s){"use strict";this.$MTagSuggestionsPoller5=s;return this;};r.prototype.setIncludeUnrecognized=function(s){"use strict";this.$MTagSuggestionsPoller6=s;return this;};r.prototype.setTargetIsPage=function(s){"use strict";this.$MTagSuggestionsPoller7=s;return this;};r.prototype.setTargetId=function(s){"use strict";this.$MTagSuggestionsPoller8=s;return this;};r.prototype.setHandler=function(s){"use strict";this.$MTagSuggestionsPoller9=s;return this;};r.prototype.setTimeoutHandler=function(s){"use strict";this.$MTagSuggestionsPollera=s;return this;};r.prototype.setWaterfall=function(s,t,u){"use strict";this.$MTagSuggestionsPollerb=s;this.$MTagSuggestionsPollerc=t;this.$MTagSuggestionsPollerd=u;return this;};r.prototype.addPhotoIDAndLog=function(s,t){"use strict";this.$MTagSuggestionsPoller2[s]=t;this.logStep(l.CLIENT_FACEREC_BEGIN);};r.prototype.removePhotoID=function(s){"use strict";delete this.$MTagSuggestionsPoller2[s];};r.prototype.hasPhotoID=function(s){"use strict";return this.$MTagSuggestionsPoller2.hasOwnProperty(s);};r.prototype.$MTagSuggestionsPollere=function(s){"use strict";return this.$MTagSuggestionsPoller2[s];};r.prototype.invalidateTimeout=function(){"use strict";this.$MTagSuggestionsPoller1=0;if(this.$MTagSuggestionsPoller4){clearTimeout(this.$MTagSuggestionsPoller4);this.$MTagSuggestionsPoller4=null;}};r.prototype.start=function(){"use strict";var s=this.$MTagSuggestionsPollerf();if(s.length>0){this.$MTagSuggestionsPoller3=true;this.$MTagSuggestionsPoller1++;var t=new g(this.$MTagSuggestionsPollerg(s));this.$MTagSuggestionsPollerh=t;t.listen('done',function(u){this.$MTagSuggestionsPolleri(u);}.bind(this));t.listen('error',function(u){this.$MTagSuggestionsPollerj(u);}.bind(this));t.send();if(!this.$MTagSuggestionsPoller4){this.$MTagSuggestionsPollerk=k();this.$MTagSuggestionsPoller4=setTimeout(this.$MTagSuggestionsPollerl.bind(this),n);}}};r.prototype.$MTagSuggestionsPollerl=function(){"use strict";this.$MTagSuggestionsPollera&&this.$MTagSuggestionsPollera(this.$MTagSuggestionsPollerm());this.abort();};r.prototype.abort=function(){"use strict";this.$MTagSuggestionsPoller3=false;this.$MTagSuggestionsPollerm().forEach(function(){this.logStep(l.CLIENT_FACEREC_FAIL,{attempt_number:this.$MTagSuggestionsPoller1,elapsed_time:k()-this.$MTagSuggestionsPollerk});}.bind(this));this.$MTagSuggestionsPoller2={};this.invalidateTimeout();if(this.$MTagSuggestionsPollerh){this.$MTagSuggestionsPollerh&&this.$MTagSuggestionsPollerh.abort();this.$MTagSuggestionsPollerh=null;}};r.prototype.$MTagSuggestionsPolleri=function(s){"use strict";this.$MTagSuggestionsPoller3=false;if(s.payload){var t=s.payload.filter(function(u){var v=u.fbid,w=this.hasPhotoID(v);if(w){u.attachmentID=this.$MTagSuggestionsPollere(v);this.removePhotoID(v);this.logStep(l.CLIENT_FACEREC_SUCCESS,{attempt_number:this.$MTagSuggestionsPoller1,elapsed_time:k()-this.$MTagSuggestionsPollerk,xy_tag_count:u.faceboxes.length});}return w;}.bind(this));if(t.length>0)this.$MTagSuggestionsPoller9(t);}this.restart();};r.prototype.$MTagSuggestionsPollerj=function(s){"use strict";this.$MTagSuggestionsPoller3=false;this.restart();};r.prototype.restart=function(){"use strict";if(this.$MTagSuggestionsPoller1<m){setTimeout(this.start.bind(this),this.$MTagSuggestionsPoller0);}else this.$MTagSuggestionsPollerl();};r.prototype.$MTagSuggestionsPollerf=function(){"use strict";var s=[];for(var t in this.$MTagSuggestionsPoller2)s.push(t);return s;};r.prototype.$MTagSuggestionsPollerm=function(){"use strict";var s=[];for(var t in this.$MTagSuggestionsPoller2)s.push(this.$MTagSuggestionsPoller2[t]);return s;};r.prototype.$MTagSuggestionsPollerg=function(s){"use strict";var t=new h().setIntVector('photos',s).setString('recognition_project',this.$MTagSuggestionsPoller5).setBool('include_unrecognized_faceboxes',this.$MTagSuggestionsPoller6).setBool('is_page',this.$MTagSuggestionsPoller7).setInt('target',this.$MTagSuggestionsPoller8).getURI();return t;};r.prototype.getWaterfallID=function(){"use strict";return this.$MTagSuggestionsPollerb;};r.prototype.getWaterfallAppName=function(){"use strict";return this.$MTagSuggestionsPollerc;};r.prototype.getWaterfallSource=function(){"use strict";return this.$MTagSuggestionsPollerd;};e.exports=r;});
__d("MStructuredComposerTaggingInputReact",["React"],function(a,b,c,d,e,f,g){var h="xy_tags",i=g.createClass({displayName:'MStructuredComposerTaggingInputReact',render:function(){var j=this.props.tokenCollection,k=this.props.tagSuggestions,l=[],m=0;for(var n in j){var o=j[n],p=k[+(o.id)];for(var q in p){var r=p[q],s=h+"["+m+"]",t=(g.DOM.div({key:r.fbid},g.DOM.input({type:"hidden",name:s+"[x]",value:r.x}),g.DOM.input({type:"hidden",name:s+"[y]",value:r.y}),g.DOM.input({type:"hidden",name:s+"[fbid]",value:r.photoID}),g.DOM.input({type:"hidden",name:s+"[name]",value:o.name}),g.DOM.input({type:"hidden",name:s+"[subject]",value:o.id}),g.DOM.input({type:"hidden",name:s+"[facebox]",value:r.fbid}),g.DOM.input({type:"hidden",name:s+"[source]",value:"photos_touch_composer"})));l.push(t);m++;}}return (g.DOM.div(null,l));}});e.exports=i;});
__d("MTagSuggestionsController",["MTagSuggestionsPoller","React","MStructuredComposerTaggingInputReact","DOM","BanzaiODS","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m='mtouch_composer_facerec_suggestions';function n(o,p,q,r,s,t){"use strict";this.$MTagSuggestionsController0=o;this.$MTagSuggestionsController0.setOnShow(this.onTokenizerInit.bind(this));this.$MTagSuggestionsController0.setOnClear(this.reset.bind(this));this.$MTagSuggestionsController1=p.getUploader();this.$MTagSuggestionsController2=s;this.$MTagSuggestionsController2.setOnEntriesChangedHandler(this.$MTagSuggestionsController3.bind(this));this.$MTagSuggestionsController1.setProps({onUploadSuccess:this.onPhotoUploadSuccess.bind(this),onRemove:this.removeFaceboxesByPhotoID.bind(this)});this.$MTagSuggestionsController4=new g().setRecognitionProject('composer_facerec').setIncludeUnrecognized(true).setTargetIsPage(q==='page').setTargetId(r).setHandler(function(u){this.handleFaceboxResponse(u);}.bind(this)).setTimeoutHandler(function(u){this.onPollerTimeout(u);}.bind(this)).setWaterfall(this.$MTagSuggestionsController1.getWaterfallID(),this.$MTagSuggestionsController1.getWaterfallAppName(),this.$MTagSuggestionsController1.getWaterfallSource());this.$MTagSuggestionsController5={};this.$MTagSuggestionsController6={};this.$MTagSuggestionsController7={};this.$MTagSuggestionsController8=false;this.$MTagSuggestionsController9={};this.$MTagSuggestionsControllera=!!t;}n.prototype.onTokenizerInit=function(){"use strict";if(Object.keys(this.$MTagSuggestionsController7).length>0)this.updateTypeaheadWithFaceboxSuggestions();if(!this.$MTagSuggestionsController8){this.$MTagSuggestionsController8=true;this.$MTagSuggestionsController0.getTokenizer().setProps({onAdd:this.$MTagSuggestionsControllerb.bind(this),onRemove:this.$MTagSuggestionsControllerc.bind(this)});}};n.prototype.$MTagSuggestionsControllerb=function(o){"use strict";this.$MTagSuggestionsController9[o.id]=true;};n.prototype.$MTagSuggestionsControllerc=function(o){"use strict";delete(this.$MTagSuggestionsController9[o.id]);if(o.autoTag)k.bumpEntityKey(m,'remove_auto_tag');};n.prototype.$MTagSuggestionsControllerd=function(o){"use strict";var p={};o.forEach(function(v){p[v.id]=true;});for(var q in this.$MTagSuggestionsController5)for(var r in this.$MTagSuggestionsController5[q]){var s=this.$MTagSuggestionsController5[q][r];if(!s.tagUserID){if(!s.ignoreRecognition){var t=s.recognitions[0].user.fbid,u=s.recognitions[0].user.name;if(p[t]){s.tagUserID=t;s.tagName=u;}}}else if(!p[s.tagUserID]){if(this.$MTagSuggestionsController6[s.tagUserID]&&s.ignoreRecognition)delete this.$MTagSuggestionsController6[s.tagUserID][r];delete s.tagUserID;delete s.tagName;}}};n.prototype.$MTagSuggestionsController3=function(o){"use strict";this.$MTagSuggestionsControllerd(o);this.$MTagSuggestionsControllere(o);};n.prototype.$MTagSuggestionsControllere=function(o){"use strict";var p={};o.forEach(function(q){var r=this.$MTagSuggestionsController6[q.id];for(var s in r){var t=r[s].attachmentID;if(!p[t])p[t]=0;p[t]++;}}.bind(this));this.$MTagSuggestionsController1.setAttachmentTagCounts(p);};n.prototype.onPhotoUploadSuccess=function(o,p){"use strict";this.$MTagSuggestionsController4.addPhotoIDAndLog(o,p);this.$MTagSuggestionsController1.setAttachmentProps(p,{isPollingTagSuggestions:true});this.$MTagSuggestionsController4.invalidateTimeout();if(!this.$MTagSuggestionsController4.isPolling)this.$MTagSuggestionsController4.start();};n.prototype.$MTagSuggestionsControllerf=function(o){"use strict";return ({name:o.tagName,display:o.tagName,id:+o.tagUserID,autoTag:true});};n.prototype.handleFaceboxResponse=function(o){"use strict";o.forEach(function(q){var r=q.fbid,s=q.faceboxes;this.$MTagSuggestionsController1.setAttachmentProps(q.attachmentID,{isPollingTagSuggestions:false});s.forEach(function(t){t.photoID=r;t.attachmentID=q.attachmentID;if(!this.$MTagSuggestionsController5[r])this.$MTagSuggestionsController5[r]={};this.$MTagSuggestionsController5[r][t.fbid]=t;if(t.recognitions.length>0){t.ignoreRecognition=false;var u=t.recognitions[0].user.fbid;if(!this.$MTagSuggestionsController6[u])this.$MTagSuggestionsController6[u]={};this.$MTagSuggestionsController6[u][t.fbid]=t;if(!this.$MTagSuggestionsController7[u])this.$MTagSuggestionsController7[u]=0;this.$MTagSuggestionsController7[u]++;if(!this.$MTagSuggestionsController8&&this.$MTagSuggestionsControllera){t.tagName=t.recognitions[0].user.name;t.tagUserID=u;var v=this.$MTagSuggestionsControllerf(t);this.$MTagSuggestionsController2.addAutoToken(v);}}else t.ignoreRecognition=true;}.bind(this));}.bind(this));var p=this.$MTagSuggestionsController2.getEntries();this.$MTagSuggestionsControllerd(p);this.$MTagSuggestionsControllere(p);};n.prototype.removeFaceboxesByPhotoID=function(o){"use strict";if(this.$MTagSuggestionsController4.hasPhotoID(o)){this.$MTagSuggestionsController4.removePhotoID(o);}else if(this.$MTagSuggestionsController5[o]){var p=this.$MTagSuggestionsController5[o];for(var q in p){var r=p[q];if(r.recognitions.length>0)this.$MTagSuggestionsControllerg(r);}this.$MTagSuggestionsController5[o]=null;}};n.prototype.$MTagSuggestionsControllerg=function(o){"use strict";var p=o.tagUserID||o.recognitions[0].user.fbid;if(o.recognitions.length>0){this.$MTagSuggestionsController7[p]--;if(this.$MTagSuggestionsController7[p]===0)delete this.$MTagSuggestionsController7[p];}if(this.$MTagSuggestionsController6[p]){delete this.$MTagSuggestionsController6[p][o.fbid];if(Object.keys(this.$MTagSuggestionsController6[p]).length<=0&&!this.$MTagSuggestionsController9[p]&&this.$MTagSuggestionsControllera){var q=this.$MTagSuggestionsControllerf(o);this.$MTagSuggestionsController2.onRemove(q);}else this.$MTagSuggestionsControllere(this.$MTagSuggestionsController2.getEntries());}};n.prototype.updateTypeaheadWithFaceboxSuggestions=function(){"use strict";var o=Object.keys(this.$MTagSuggestionsController7);o=o.map(function(r){return +r;});var p=this.$MTagSuggestionsController0.getTokenizer(),q=p.props.suggestions.map(function(r){return r.uid;});q.forEach(function(r){if(o.indexOf(r)<0)o.push(r);});p.updateTypeaheadWithSuggestions(o);};n.prototype.$MTagSuggestionsControllerh=function(){"use strict";var o=this.$MTagSuggestionsController0.getTokenizer();o.updateTypeaheadWithSuggestions([]);};n.prototype.generateHiddenInput=function(o){"use strict";var p=j.create('div',{});j.appendContent(o,p);h.renderComponent(i({tokenCollection:this.$MTagSuggestionsController2.getEntries(),tagSuggestions:this.$MTagSuggestionsController6}),p);};n.prototype.onPollerTimeout=function(o){"use strict";o.forEach(function(p){this.$MTagSuggestionsController1.setAttachmentProps(p,{isPollingTagSuggestions:false});}.bind(this));};n.prototype.addXYTag=function(o){"use strict";var p=this.$MTagSuggestionsController5[o.photoID][o.fbid];if(p.recognitions.length>0)this.$MTagSuggestionsControllerg(p);n.addFaceboxData(p,o.tagName,o.tagUserID);if(!this.$MTagSuggestionsController6[p.tagUserID])this.$MTagSuggestionsController6[p.tagUserID]={};this.$MTagSuggestionsController6[p.tagUserID][p.fbid]=p;var q=this.$MTagSuggestionsControllerf(p);this.$MTagSuggestionsController2.addManualXYTag(q);};n.prototype.deleteXYTag=function(o){"use strict";var p=this.$MTagSuggestionsController5[o.photoID][o.fbid];p.ignoreRecognition=true;delete p.tagUserID;delete p.tagName;this.$MTagSuggestionsControllerg(o);};n.prototype.getFaceboxesCopyForPhoto=function(o){"use strict";var p={};for(var q in this.$MTagSuggestionsController5[o])p[q]=l({},this.$MTagSuggestionsController5[o][q]);return p;};n.prototype.reset=function(){"use strict";this.$MTagSuggestionsController4.abort();this.$MTagSuggestionsController7={};this.$MTagSuggestionsController5={};this.$MTagSuggestionsController6={};this.$MTagSuggestionsControllerh();this.$MTagSuggestionsController8=false;this.$MTagSuggestionsController9={};};n.addFaceboxData=function(o,p,q){"use strict";o.tagName=p;o.tagUserID=q;o.ignoreRecognition=true;};n.deleteFaceboxData=function(o){"use strict";delete(o.tagUserID);delete(o.tagName);o.ignoreRecognition=true;};e.exports=n;});
__d("debounceCore",[],function(a,b,c,d,e,f){function g(h,i,j,k,l){k=k||setTimeout;l=l||clearTimeout;var m;function n(){var o=Array.prototype.slice.call(arguments,0);n.reset();m=k(function(){h.apply(j,o);},i);}n.reset=function(){l(m);};return n;}e.exports=g;});
__d("debounceAcrossTransitions",["debounceCore"],function(a,b,c,d,e,f,g){function h(i,j,k){return g(i,j,k);}e.exports=h;});
__d("XPrivacyRemindersImpressionLoggingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/privacy\/reminders\/log_imp\/",{type:{type:"String",required:true}});});
__d("MStructuredComposerFriendsInput",["CSS","DOM","MComposerNavigation","MUnifiedTaggerConstants","Stratcom","SubscriptionsHandler","destroyOnUnload"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.SHOW_UNIFIED_TAGGER;function o(p,q,r){"use strict";this.$MStructuredComposerFriendsInput0=p;this.$MStructuredComposerFriendsInput1=q;this.$MStructuredComposerFriendsInput2=h.find(this.$MStructuredComposerFriendsInput1,'ul','friend-tokens');this.$MStructuredComposerFriendsInput3=r;this.$MStructuredComposerFriendsInput4=this.$MStructuredComposerFriendsInput3.style.display;this.$MStructuredComposerFriendsInput5=new l();this.$MStructuredComposerFriendsInput5.addSubscriptions(h.listen(this.$MStructuredComposerFriendsInput3,'click',null,function(){return this.$MStructuredComposerFriendsInput6();}.bind(this)));if(n){this.$MStructuredComposerFriendsInput5.addSubscriptions(k.listen('MComposer:tagger:click',j.TOKEN_TYPES.PEOPLE,function(){return this.$MStructuredComposerFriendsInput6();}.bind(this)));}else this.$MStructuredComposerFriendsInput5.addSubscriptions(h.listen(this.$MStructuredComposerFriendsInput1,'click','remove',function(event){event.stop();this.removeWithToken(event.getNode('token'));if(!this.hasTokens())this.$MStructuredComposerFriendsInput7();}.bind(this)),h.listen(this.$MStructuredComposerFriendsInput1,'click','token',function(){return this.$MStructuredComposerFriendsInput6();}.bind(this)));this.$MStructuredComposerFriendsInput5.addSubscriptions(this.$MStructuredComposerFriendsInput0.listen('cancel',function(){return this.$MStructuredComposerFriendsInput8();}.bind(this)),this.$MStructuredComposerFriendsInput0.listen('submit',function(event){var s=event.tokens,t=s.length>0;this.$MStructuredComposerFriendsInput9(s);if(n){k.invoke('MComposer:tagger:update',null,{people:event.tokens.map(function(u){return {name:u.firstChild.wholeText};})});}else this.$MStructuredComposerFriendsInputa(t);this.$MStructuredComposerFriendsInputb(t);this.$MStructuredComposerFriendsInputc();}.bind(this)));m(function(){return this.$MStructuredComposerFriendsInput5.release();}.bind(this));}o.prototype.$MStructuredComposerFriendsInputb=function(p){"use strict";g.conditionClass(this.$MStructuredComposerFriendsInput3,'active',p);};o.prototype.removeWithToken=function(p){"use strict";this.$MStructuredComposerFriendsInput0.removeToken(p);h.remove(p);if(!this.hasTokens()){this.$MStructuredComposerFriendsInputa(false);this.$MStructuredComposerFriendsInputb(false);}};o.prototype.$MStructuredComposerFriendsInput7=function(){"use strict";k.invoke('MStructuredComposerFriendsInput-done',null,{num_tags:this.getTokenCount()});};o.prototype.$MStructuredComposerFriendsInputd=function(){"use strict";k.invoke('MStructuredComposerFriendsInput-done',null,{cancel:true,num_tags:this.getTokenCount()});};o.prototype.reset=function(){"use strict";if(n)k.invoke('MComposer:tagger:update',null,{people:[]});this.$MStructuredComposerFriendsInputb(false);this.$MStructuredComposerFriendsInpute().forEach(function(p){return this.removeWithToken(p);}.bind(this));this.$MStructuredComposerFriendsInput3.style.display=this.$MStructuredComposerFriendsInput4;this.$MStructuredComposerFriendsInput0.hide();this.$MStructuredComposerFriendsInput0.clear();};o.prototype.getTokenCount=function(){"use strict";return this.$MStructuredComposerFriendsInpute().length;};o.prototype.$MStructuredComposerFriendsInpute=function(){"use strict";return h.scry(this.$MStructuredComposerFriendsInput2,'span','token');};o.prototype.hasTokens=function(){"use strict";return this.getTokenCount()>0;};o.prototype.$MStructuredComposerFriendsInputf=function(){"use strict";this.$MStructuredComposerFriendsInput0.show();k.invoke('MStructuredComposerFriendsInput-started');};o.prototype.setVisible=function(p){"use strict";if(p){h.show(this.$MStructuredComposerFriendsInput3);}else h.hide(this.$MStructuredComposerFriendsInput3);};o.prototype.$MStructuredComposerFriendsInputa=function(p){"use strict";if(p){h.show(this.$MStructuredComposerFriendsInput1);}else h.hide(this.$MStructuredComposerFriendsInput1);};o.prototype.$MStructuredComposerFriendsInput9=function(p){"use strict";h.setContent(this.$MStructuredComposerFriendsInput2,p.map(function(q){return q.cloneNode(true);}));};o.prototype.$MStructuredComposerFriendsInputg=function(){"use strict";this.$MStructuredComposerFriendsInput0.hide();this.$MStructuredComposerFriendsInput7();};o.prototype.$MStructuredComposerFriendsInput6=function(){"use strict";i.newPolicy().addOnOpen(function(){return this.$MStructuredComposerFriendsInputf();}.bind(this)).addOnCloseByBrowser(function(){this.$MStructuredComposerFriendsInput0.cancel();this.$MStructuredComposerFriendsInputd();}.bind(this)).open();};o.prototype.$MStructuredComposerFriendsInput8=function(){"use strict";i.currentPolicy().addOnClose(function(){return this.$MStructuredComposerFriendsInputd();}.bind(this)).close();};o.prototype.$MStructuredComposerFriendsInputc=function(){"use strict";i.currentPolicy().addOnClose(function(){return this.$MStructuredComposerFriendsInputg();}.bind(this)).close();};e.exports=o;});
__d("MStructuredComposer",["CSS","CurrentUser","DataStore","DOM","HashtagParser","MAjaxify","MAjaxifyFormTypes","MarauderLogger","MComposerAudienceController","MComposerNavigation","MInputFocus","MJSEnvironment","MPlaces","MPrivacyComposerSelector","MRequest","MRequestTypes","MStructuredComposerOGInput","MStructuredComposerPlaceInput","MSuggestCheckinController","MTouchClick","MViewport","MUnifiedTaggerConstants","PrivacyConst","PrivacyRemindersLoggingTypes","Stratcom","Style","MTagSuggestionsController","MMultiPhotoUploaderAttachmentState","$","fbt","ge","setTimeoutAcrossTransitions","Vector","copyProperties","createDeprecatedProperties","cx","debounceAcrossTransitions","mtx","XPrivacyAudienceAlignmentLoggingControllerURIBuilder","XPrivacyRemindersImpressionLoggingControllerURIBuilder","MStructuredComposerFriendsInput"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua){var va=480,wa='mttux',xa='holdout',ya='device_short',za='exposed',ab='learn_more',bb='blur',cb='selector',db='public_sticky',eb='friends_sticky',fb='dismissal',gb=ba.SHOW_UNIFIED_TAGGER;function hb(kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc){"use strict";if(wb)ua=wb;this._placesTagger=mb;this._placeClearablePreview=xb;this._ogClearablePreview=yb;this._albumPicker=nb;this._ogTagger=ob;this._multiPhotoUploader=pb;this._hashtagTagger=qb;this._pageInfo=rb;this._createLabel=sb;this._updateLabel=tb;this._photoPreview=cc;this._targetType=ub;this._entryPointRef=vb;this._survey_photos_composercancel=bc;this._root=kb;this._longestInput=0;this._isCreateAlbumDialogOpen=false;this._mentionsEnabled=true;var dc=ia('attach_photo');if(this._albumPicker||this._multiPhotoUploader){g.conditionClass(dc,"_6-k",true);}else j.hide(dc);this._mainPage=ia('viewport');this._composer=j.find(this._root,'div','composer-main-view');this._composerTitle=j.find(this._composer,'div','composer-title');this._staticTemplates=ia('static_templates');this._form=j.find(this._composer,'form');this._atButton=j.find(this._form,'button','at-button');this._starsRatableInput=j.find(this._form,'div','composer-stars-ratable-input');this._atTags=j.find(this._form,'div','at-tags');this._placeInputController=new x(this._atTags);this._friendsInputController=new ua(lb,j.find(this._form,'div','with-tags'),j.find(this._form,'button','with-button'));if(this._multiPhotoUploader&&zb){this._tagSuggestionsController=new ga(lb,this._multiPhotoUploader,this._targetType,this._form.target.value,this._friendsInputController,ac);if(this._photoPreview){this._multiPhotoUploader.getUploader().setProps({onThumbnailClicked:this._showPhotosPreview.bind(this)});this._photoPreview.setOnAddXYTag(this._tagSuggestionsController.addXYTag.bind(this._tagSuggestionsController));this._photoPreview.setOnDeleteXYTag(this._tagSuggestionsController.deleteXYTag.bind(this._tagSuggestionsController));}}this._isCheckinInput=j.find(this._form,'input','is-checkin');this._jsonLocationInput=j.find(this._form,'input','json-location');this._textarea=j.find(this._form,'textarea','composer-textarea');if(r.IS_APPLE_WEBKIT_IOS&&!r.IS_CHROME&&r.OS_VERSION>=7&&aa.getScreenHeight()<=va)fa.set(this._textarea,'height','75px');this._defaultAction=this._form.action;if(ob)this._ogInputController=new w(j.find(this._form,'div','og-tags'),j.find(this._form,'button','og-button'),j.find(this._form,'div','og-object-attachment'),ob,this._ogClearablePreview);this._audienceNode=j.scry(this._root,'div','audience-controller')[0];this._buttonbar=j.find(this._root,'div','composer-buttons');this._listeners=[];}hb.prototype._getNavigationPolicy=function(kb,lb){"use strict";return p.newPolicy().addOnOpen(function(){return this._showComposer(kb,lb);}.bind(this)).addOnOpenChild(function(){return this._hideForInterstitial();}.bind(this)).addOnReturnFromChild(function(){return j.show(this._composer);}.bind(this)).addOnCloseByBrowser(function(){return this._cancelComposer();}.bind(this));};hb.prototype._navigateAwayFromComposer=function(){"use strict";p.currentPolicy().addOnClose(function(){return this._resetComposer();}.bind(this)).close();};hb.prototype._navigateAwayFromComposerAndCancel=function(){"use strict";p.currentPolicy().addOnClose(function(){return this._cancelComposer();}.bind(this)).close();};hb.prototype._navigateToComposer=function(kb,lb){"use strict";this._getNavigationPolicy(kb,lb).open();};hb.prototype._showComposer=function(kb,lb){"use strict";this._resetLoggingSessionID();this._composerType=kb;if(lb)if(lb.place)this._selectPlace({id:lb.place.id,name:lb.place.name,new_place:lb.place.new_place});if(this._ogTagger){n.log('og_composer_show_composer');if(!this._ogTaggerLoaded){var mb='/platform/og/composer/tagger',nb=new u(mb).setType(v.DEPENDENT);nb.listen('postprocess',function(){if(this._composerType=='activity')this._ogTagger.toggleIncludedPlaceSelector(true);n.log('og_composer_async_loaded');}.bind(this));l.ajaxify(null,null,nb,null);this._ogTaggerLoaded=true;}}if(this._multiPhotoUploader&&kb==='photo'){this._showMultiPhotoUploader();}else if(this._ogTagger&&kb=='activity')this._ogTagger.toggleIncludedPlaceSelector(true);j.hide(this._mainPage);j.show(this._composer);aa.scrollToNode(this._composer);this._saveConfig();if(this._audienceNode){if(!this._audienceController)this._audienceController=o.getInstance(this._audienceNode);this._audienceController.asyncLoadInterstitial();}if(this._specificAudienceTooltip&&!this._specificAudienceTooltipShown){this._specificAudienceTooltip.show();this._specificAudienceTooltipShown=true;var ob=new u('/a/composer/nux/write/').setMethod('POST').setData({cns:1});l.ajaxify(null,null,ob);}else if(this._inAudienceAlignmentExp&&!this._triedToShowInterstitial&&this._composerEligibleForInterstitial()){this._triedToShowInterstitial=true;if(this._shouldShowInterstitial()){this._logAAA(za);setTimeout(this._showInterstitial.bind(this),300);this._friendsPrivacyRow=null;ea.listen('MPrivacyDeferredSelector-loaded',null,this.captureFriendsPrivacyRow.bind(this));}else this._logAAA(xa);}if(this._suggestCheckinPlace&&!this._isCheckin){if(!this._suggestCheckinController)this._suggestCheckinController=new y(this._composer);this._suggestCheckinController.start();}ea.invoke('MStructuredComposer-opened',null,{session_id:this._loggingSessionID,composer_type:kb,target_type:this._targetType,entry_point_ref:this._entryPointRef,opened_time:Date.now()});return true;};hb.prototype._navigateToComposerAndShowFileDialog=function(kb,event){"use strict";this._getNavigationPolicy('photo',kb).addOnOpen(function(){if(r.IS_ANDROID)this._form.offsetHeight;z.click(ia('photo_input'),event);}.bind(this)).open();};hb.prototype._navigateToComposerAndFocus=function(kb,lb){"use strict";this._getNavigationPolicy(kb,lb).addOnOpen(function(){var mb=!this._postInterstitialTooltip||(r.IS_APPLE_WEBKIT_IOS&&r.OS_VERSION>=7),nb;if(!this._specificAudienceTooltip&&mb){this._textarea.focus();nb=this._textarea.value.length;this._textarea.setSelectionRange(nb,nb);}}.bind(this)).open();};hb.prototype._closePrivacy=function(){"use strict";var kb=this._getPrivacySelector();kb&&kb.hideMenu();};hb.prototype._openPrivacy=function(){"use strict";var kb=this._getPrivacySelector();kb&&kb.showMenu();};hb.prototype._removeAlbumAndPhoto=function(){"use strict";var kb=ka('default-album');if(kb)z.click(kb);if(!this._multiPhotoUploader)j.hide(ia('photo_display'));if(this._albumPicker)j.hide(ia('album-button'));};hb.prototype._resizeTextarea=function(){"use strict";if(a.FB_GKS&&a.FB_GKS.mtouch_composer_no_autoresize)return;var kb=j.textMetrics(this._textarea,'jx-tokenizer-metrics');kb.x=null;kb.y=Math.max(kb.y+20,110);kb.setDim(this._textarea);};hb.prototype._resetAlbumSelection=function(){"use strict";if(this._albumPicker)g.conditionClass(ia('album-button'),'active',false);this._privacySelector&&j.show(this._privacySelector);this._audienceController&&this._audienceController.setVisible(true);ia('album_fbid').value='0';ia('album_privacy').value='';this._albumChosen=false;};hb.prototype._resetComposer=function(){"use strict";if(this._isPageCheckin){this._isPageCheckin=false;this._changeConfig(this._defaultConfig);}this._toggleSubmitButtonState(true);j.hide(j.find(document,'div','m-status-empty-error'));this._textarea.value=i.get(this._textarea).defaultvalue||'';this._resizeTextarea();this._longestInput=0;this._friendsInputController.reset();j.hide(this._atTags);g.conditionClass(this._atButton,'active',false);if(this.getShowPlace()&&!this._pinPlace){j.show(this._atButton);j.show(j.find(this._atTags,'a','remove-token'));}else j.hide(this._atButton);this._placeInputController.clear();this._placeClearablePreview.clear();this._placesTagger.hide();if(this._ogTagger){this._ogInputController.reset();ea.invoke('composerReset');this._ogTagger.hide();}if(this._photoAction){j.find(this._attachPhoto,'input','photo-input').value='';this._hasPhoto=false;if(this._albumPicker){this._removeAlbumAndPhoto();this._albumPicker.hide();}else{j.hide(this._attachPhoto);this._photoOpen=false;}g.conditionClass(this._photoButton,'active',false);j.show(this._photoButton);}if(this._pageInfo)j.hide(this._pageInfo);if(this._starsRatableInput)j.hide(this._starsRatableInput);this._photoButton&&j.show(this._photoButton);this._privacySelector&&j.show(this._privacySelector);this._updateTagExpansion();this._jsonLocationInput.value='{}';this._isCheckinInput.value='';this._isCheckin=false;this._onlyMeFlyoutShown=false;this._mentionsEnabled=true;ea.invoke('MComposer:tagger:clear');this._resetPosition();this._determineFormAction();this._closeComposer();this._audienceController&&this._audienceController.reset();ea.invoke('MMentions:enable');ea.invoke('MStructuredComposer:reset');if(this._multiPhotoUploader){this._multiPhotoUploader.resetState();this._multiPhotoUploader.alterPreviewGrid(false);}};hb.prototype._resetPosition=function(){"use strict";if(this.getScrollToElem()&&this.getShouldScroll()){var kb=ma.getPos(this.getScrollToElem()).y-5;la(aa.scrollTo.bind(null,0,kb),0);}};hb.prototype._shouldSyncSubmit=function(){"use strict";return (!this._forceAsync)&&(this.getSyncSubmit()||this._isPageCheckin||this._hasPhotos());};hb.prototype._shouldPostStatus=function(){"use strict";var kb=j.convertFormToDictionary(this._form),lb=ib(kb.status)!=='',mb=ib(kb.message)!=='',nb=ib(kb.recommendation)!=='',ob=lb||mb||nb,pb=kb.rating!=="0",qb=this._friendsInputController.hasTokens(),rb=this._ogInputController&&this._ogInputController.hasValue(),sb=this._hasPhotos()||rb,tb=this._placeInputController.hasValue()||this._isPageCheckin||this._isCheckin||this._pinPlace;if(ob||sb||tb||qb||pb)return true;return false;};hb.prototype._confirmClicked=function(){"use strict";if(!this._shouldPostStatus()){var kb=j.find(document,'div','m-status-empty-error');this._resetComposer();this._restoreComposer();j.show(kb);j.setContent(kb,"Please add content to your status before posting");return;}if(this._tagSuggestionsController)this._tagSuggestionsController.generateHiddenInput(this._form);if(!this._mentionsEnabled){var lb=j.scry(this._form,"input","mentionsHiddenInput")[0];if(lb)lb.value=this._textarea.value;}if(!this._albumChosen){var mb=this._getPrivacySelector(),nb;if(mb&&(mb.getSelectedValue()==ca.PostParam.SELF)){nb=(new ta()).setString('type',da.ONLY_ME_IMPRESSION).getURI();l.ajaxify(null,null,new u(nb));var ob=this._friendsInputController.hasTokens()||this._hasMentions;if(!ob&&!window.confirm("Only you will be able to see this post. Click 'Cancel' to change your audience.")){this._onlyMeFlyoutShown=true;return;}}else if(this._onlyMeFlyoutShown){nb=(new ta()).setString('type',da.ONLY_ME_CONVERSION).getURI();l.ajaxify(null,null,new u(nb));}}this._onlyMeFlyoutShown=false;if(this._isCheckin||this._placeInputController.hasValue()){if(this._jsonLocationInput.value==="{}")this._jsonLocationInput.value=s.getCurrentJSONLocation();this._isCheckinInput.value=true;}var pb=this._ogInputController&&this._ogInputController.getLoggingData();if(pb)n.log('og_composer_action_created',undefined,pb);this._audienceController&&this._audienceController.setCurrentAsSticky();this._toggleSubmitButtonState(false);ea.invoke('MStructuredComposer-beforeSubmit',null,{instance:this,publish_target:this._form.target.value||h.getID()});if(this._multiPhotoUploader&&this._multiPhotoUploader.hasPhotos()){this._multiPhotoUploader.logClientPost(this._submit.bind(this));}else this._submit();};hb.prototype._submit=function(){"use strict";if(this._shouldSyncSubmit()){this._form.submit();}else{var kb=document.getElementById('structured_composer_async_container')||(this._clickedButton?this._clickedButton.parentNode:null);l.form(null,this._form,'async_composer',m.CACHE,kb);this._staticTemplates.style.height='';this._navigateAwayFromComposer();}this._resetPosition();};hb.prototype._resetLoggingSessionID=function(){"use strict";this._loggingSessionID=jb();var kb=j.find(this._form,'input','session-id-input');kb.value=this._loggingSessionID;};hb.prototype._saveConfig=function(){"use strict";var kb=j.scry(this._form,"input","mentionsHiddenInput")[0]||this._textarea;this._defaultConfig={action:this._form.action,targetid:this._form.target.value,inputname:kb.name,placeholder:this._textarea.placeholder,composertitle:this._composerTitle.textContent,pinplace:this._pinPlace,forceasync:this._forceAsync};};hb.prototype._changeConfig=function(kb){"use strict";var lb=j.scry(this._form,"input","mentionsHiddenInput")[0]||this._textarea;this._form.action=kb.action;if(this._form.target)this._form.target.value=kb.targetid;this._textarea.placeholder=kb.placeholder;this._composerTitle.textContent=kb.composertitle;this._pinPlace=kb.pinplace;this._forceAsync=kb.forceasync;lb.name=kb.inputname;};hb.prototype._selectPlace=function(kb){"use strict";this._placeInputController.placeSelected(kb);if(kb.isNonSpecific){this._placeClearablePreview.setValue(ja._("in {non-specific-place-name}.",[ja.param("non-specific-place-name",kb.name)]));}else this._placeClearablePreview.setValue(ja._("at {place-name}.",[ja.param("place-name",kb.name)]));if(kb.latitude&&kb.longitude){var lb={latitude:kb.latitude,longitude:kb.longitude};this._jsonLocationInput.value=JSON.stringify(lb);}j.show(this._composer);this._placesTagger.hide();g.conditionClass(this._atButton,'active',true);if(this._pinPlace)j.hide(this._atButton);if(!gb){j.show(this._atTags);if(this._pinPlace)j.hide(j.find(this._atTags,'a','remove-token'));}};hb.prototype._extendComposerHeight=function(){"use strict";if(this._composer.style.display!=='none')this._staticTemplates.style.height=a.innerHeight+'px';};hb.prototype.setPrivacySelector=function(kb){"use strict";this._privacySelector=kb;};hb.prototype._getPrivacySelector=function(){"use strict";return this._privacySelector&&t.getInstance(this._privacySelector);};hb.prototype.setPhotoAction=function(kb){"use strict";if(kb){this._attachPhoto=ia('attach_photo');this._photoButton=j.find(this._form,'button','photo-button');}this._photoAction=kb;return this;};hb.prototype.setKeyboardStateDown=function(){"use strict";this._keyboardState='down';};hb.prototype.setSuggestCheckinPlace=function(){"use strict";this._suggestCheckinPlace=true;};hb.prototype._determineFormAction=function(){"use strict";if(this._hasPhotos()&&this._photoAction!==''){this._form.action=this._photoAction;}else this._form.action=this._defaultAction;};hb.prototype._determineMultiPhotoComposerState=function(){"use strict";if(!this._multiPhotoUploader)return;if(this._photoButton)g.conditionClass(this._photoButton,'active',this._hasPhotos());if(this._albumPicker)if(this._hasPhotos()){j.show(ia('album-button'));}else j.hide(ia('album-button'));};hb.prototype._showMultiPhotoUploader=function(){"use strict";if(this._multiPhotoUploader){this._determineMultiPhotoComposerState();this._multiPhotoUploader.alterPreviewGrid(true);}};hb.prototype._hasPhotos=function(){"use strict";if(this._multiPhotoUploader){return this._multiPhotoUploader.hasPhotos();}else if(this._albumPicker){return this._hasPhoto;}else return this._photoOpen&&this._hasPhoto;};hb.prototype._pagePostClicked=function(kb){"use strict";if(!kb)return;var lb=i.get(kb);this._saveConfig();this._changeConfig(lb);this._privacySelector&&j.hide(this._privacySelector);};hb.prototype.start=function(){"use strict";this._form.addEventListener('reset',this._resetComposer.bind(this));this._listen('click','show_composer',function(event){var mb=event.getNode('show_composer'),nb=i.get(mb);if(this._keyboardState==='down'){this._navigateToComposer('status',nb);}else this._navigateToComposerAndFocus('status',nb);this._clickedButton=mb;}.bind(this));this._listen('click','cancel_composer',this._navigateAwayFromComposerAndCancel.bind(this));this._listen('click','submit_composer',this._confirmClicked.bind(this));this._listen('m:viewport:scroll-to-header',null,this._extendComposerHeight.bind(this));this._listen('click','checkin_link',function(event){this._clickedButton=event.getNode('checkin_link');this._startCheckin();event.prevent();}.bind(this));if(this._ogTagger){this._listen('click','activity_link',function(event){this._navigateToComposer('activity');j.hide(this._composer);this._ogTagger.show();event.prevent();}.bind(this));this._listen('click','og_included_place_checkin',function(event){this._ogTagger.hide();this._startCheckin();}.bind(this));this._listeners.push(this._ogTagger.listen('cancelFromActivity',function(event){j.show(this._mainPage);this._navigateAwayFromComposerAndCancel();}.bind(this)));}this._listen('click','write_post_posts_by_others',function(event){this._pagePostClicked(event.getNode('write_post_posts_by_others'));event.prevent();}.bind(this));this._listen('composerPhotoLinkPostsByOthers',null,function(event){this._pagePostClicked(event.getData());event.prevent();}.bind(this));this._listen('click','write_post_admin',function(event){this._pagePostClicked(event.getNode('write_post_admin'));event.prevent();}.bind(this));this._listen('click','page_checkin',function(event){var mb=i.get(event.getNode('page_checkin'));this._isCheckin=true;this._isPageCheckin=true;this._saveConfig();this._changeConfig(mb);this._navigateToComposer('checkin');j.hide(this._composer);this._selectPlace({id:mb.pageid,name:mb.pagename,new_place:false});if(this._ogTagger)this._ogTagger.setPlaceID(mb.pageid);event.prevent();}.bind(this));this._listen('click','write-recommendation',function(event){var mb=i.get(event.getNode('write-recommendation'));this._saveConfig();this._changeConfig(mb);this._navigateToComposer('recommendation');this._photoButton&&j.hide(this._photoButton);this._atButton&&j.hide(this._atButton);if(this._ogTagger){var nb=j.scry(this._form,'button','og-button')[0];nb&&j.hide(nb);this._ogTagger.hide();}this._friendsInputController.setVisible(false);j.show(this._starsRatableInput);if(this._pageInfo)if(mb.pageinfo){j.show(this._pageInfo);j.setContent(this._pageInfo,mb.pageinfo);}else j.hide(this._pageInfo);if(mb.viewerrating){var ob=j.scry(this._starsRatableInput,'span','stars-ratable-star')[mb.viewerrating-1];ob&&ob.click();this._textarea.focus();}if(mb.reviewtext)this._textarea.value=mb.reviewtext;if(this._createLabel&&this._updateLabel){var pb=j.find(this._composer,'button','submit_composer');if(this._textarea.value){j.setContent(pb,this._updateLabel);}else j.setContent(pb,this._createLabel);}this._mentionsEnabled=false;ea.invoke('MMentions:disable');event.prevent();}.bind(this));if(this._ogTagger){this._listen('MStructuredComposerOGInput-started',null,this._hideForInterstitial.bind(this));this._listen('MStructuredComposerOGInput-done',null,this._restoreComposer.bind(this));}this._listen('MStructuredComposerFriendsInput-done',null,function(){return this._updateTagExpansion();}.bind(this));this._listen('MStructuredComposerFriendsInput-addedAutoTags',null,function(){return this._updateTagExpansion();}.bind(this));this._listen('MStructuredComposerFriendsInput-addedManualXYTags',null,function(){return this._updateTagExpansion();}.bind(this));this._listen('MMentions:change',null,function(event){var mb=event.getData();if(mb.input==this._textarea){this._hasMentions=mb.hasTags;this._updateTagExpansion();}}.bind(this));this._listen('click','at-button',this._showAtTagger.bind(this));if(gb)this._listeners.push(ea.listen('MComposer:tagger:click',ba.TOKEN_TYPES.PLACE,this._showAtTagger.bind(this)));this._listeners.push(this._placesTagger.listen('submit',function(event){if(this._isCreateAlbumDialogOpen)return;ea.invoke('MStructuredComposer-addedLocation');this._selectPlace(event);if(this._ogTagger){this._ogTagger.setPlaceID(event.id);if(event.og_action_type_id&&!this._ogInputController.hasValue()){this._ogTagger.setCancelButtonText("Skip");if(this._ogTagger.selectActionTypeImplicitly(event.og_action_type_id)){j.hide(this._composer);this._ogTagger.setSuggestionMechanism(event.suggestion_mechanism);n.log('og_composer_implicit_verb_selected',undefined,{place_id:event.id,suggestion_mechanism:event.suggestion_mechanism});this._ogTagger.show();}}}}.bind(this)));this._listen('MSuggestCheckin-confirmed',null,function(mb){this._selectPlace(mb.getData());}.bind(this));this._listeners.push(this._placesTagger.listen('cancel',function(event){if(this._isCreateAlbumDialogOpen)return;ea.invoke('MStructuredComposer-canceledLocation');if(this._isCheckin&&!this._placeInputController.hasValue()){ea.invoke('MStructuredComposer-canceled');this._navigateAwayFromComposerAndCancel();}else{this._restoreComposer();aa.scrollToHeader();}}.bind(this)));this._listeners.push(this._placeClearablePreview.addListener('clear',function(){this._placeInputController.clear();j.hide(this._atTags);g.conditionClass(this._atButton,'active',false);j.show(this._composer);this._placesTagger.hide();ea.invoke('MStructuredComposer-removedLocation');}.bind(this)));this._listen('MAlbumPicker:createalbum:open',null,function(event){this._isCreateAlbumDialogOpen=true;}.bind(this));this._listen('MAlbumPicker:createalbum:close',null,function(event){this._isCreateAlbumDialogOpen=false;}.bind(this));this._listen('keydown','tokenizer-input',function(event){if(event.getNode('structured-composer')&&this.getShouldScroll()){var mb=event.getNode('tokenizer-input'),nb=ma.getPos(mb).y;aa.scrollTo(0,nb);}}.bind(this));this._listen('blur','tokenizer-input',function(event){if(event.getNode('structured-composer')&&this.getShouldScroll())aa.scrollToHeader();}.bind(this));this._listen('keyup','composer-textarea',function(mb){var nb=this._textarea.value;this._longestInput=Math.max(this._longestInput,nb.length);ea.invoke('MStructuredComposer-input',null,{text:nb,publish_target:this._form.target.value||h.getID(),written_time:Date.now()});this._resizeTextarea();}.bind(this));this._listen('click','photo_link',function(event){var mb=event.getNode('photo_link'),nb=i.get(mb);if(this.getShouldScroll())aa.scrollToHeader();if(this._multiPhotoUploader){if(this._albumPicker)j.show(ia('album-button'));this._navigateToComposerAndShowFileDialog(nb,event);}else{if(this._albumPicker){this._navigateToComposerAndShowFileDialog(nb,event);event.prevent();}else{this._navigateToComposer('photo',nb);this._photoOpen=true;j.show(this._attachPhoto);g.conditionClass(this._photoButton,'active',true);}this._clickedButton=mb;event.kill();ea.invoke('composerPhotoLink');ea.invoke('composerPhotoLinkPostsByOthers',null,event.getNode('write_post_posts_by_others'));}}.bind(this));this._listen('click','add-photo-thumbnail',function(event){ea.invoke('MStructuredComposer-addPhotoClicked');z.click(ia('photo_input'),event);event.prevent();}.bind(this));this._listen('click','photo-button',function(event){ea.invoke('MStructuredComposer-addPhotoClicked');if(this._multiPhotoUploader){this._closePrivacy();if(this._albumPicker)if(this._hasPhotos()){j.show(ia('album-button'));}else j.hide(ia('album-button'));z.click(ia('photo_input'),event);this._determineFormAction();this._showMultiPhotoUploader();}else if(this._albumPicker){z.click(ia('photo_input'),event);event.prevent();return;}else{this._closePrivacy();if(this._photoOpen){j.hide(this._attachPhoto);}else j.show(this._attachPhoto);this._photoOpen=!this._photoOpen;g.conditionClass(this._photoButton,'active',this._photoOpen);}}.bind(this));if(this._albumPicker){this._listeners.push(this._albumPicker.listen('cancel',function(event){ea.invoke('MStructuredComposer-selectAlbumCanceled');this._restoreComposer();}.bind(this)));this._listeners.push(this._albumPicker.listen('choose-album',function(event){if(event.is_mobile_uploads_album){this._resetAlbumSelection();}else{ea.invoke('MStructuredComposer-selectAlbum');ia('album_fbid').value=event.album_id;ia('album_privacy').value=event.privacy_id;this._albumChosen=true;this._closePrivacy();this._privacySelector&&j.hide(this._privacySelector);this._audienceController&&this._audienceController.setVisible(false);}j.show(this._composer);}.bind(this)));this._listen('click','album-button',function(event){ea.invoke('MStructuredComposer-selectAlbumClicked');this._albumPicker.show();j.hide(this._composer);}.bind(this));}this._listen('change','photo-input',function(event){var mb=ia('photo_input');if(mb.value!==''&&this._photoAction!==''){if(!this._multiPhotoUploader)ea.invoke('MStructuredComposer-addedPhoto',null,{photo_count:1});mb.name="file1";this._hasPhoto=true;this._determineFormAction();this._photoButton&&g.conditionClass(this._photoButton,'active',true);if(this._albumPicker){if(!this._multiPhotoUploader)j.show(ia('photo_display'));j.show(ia('album-button'));}}else{this._hasPhoto=false;this._determineFormAction();g.conditionClass(this._photoButton,'active',false);if(!this._multiPhotoUploader)ea.invoke('MStructuredComposer-addedPhoto',null,{photo_count:0});if(this._albumPicker&&!this._multiPhotoUploader)this._removeAlbumAndPhoto();}}.bind(this));this._listen('multi-photos-change',null,function(event){var mb=ia('photo_input');if(event.getData().input_id!='photo_input')return;var nb=this._multiPhotoUploader.getPhotosCount();ea.invoke('MStructuredComposer-addedPhoto',null,{photo_count:nb,is_multi_photo_upload:true});this._determineFormAction();this._determineMultiPhotoComposerState();}.bind(this));this._listen('click','composer-buttons',function(event){this._textarea.blur();}.bind(this));this._listen('focus','composer-textarea',function(event){if(this.getShouldScroll())if(this._textarea.value==='')q.scrollTo(this._textarea,aa.getHeaderTop());}.bind(this));this._listen('click','composer-textarea',function(event){this._closePrivacy();if(this.getShouldScroll())if(this._textarea.value==='')q.scrollTo(this._textarea,aa.getHeaderTop());}.bind(this));if(this._hashtagTagger){this._listen('click','hashtag-button',function(){var mb={};k.parse(this._textarea.value).forEach(function(nb){mb[nb.tag]=true;});j.hide(this._composer);this._hashtagTagger.initAndShow(mb);}.bind(this));this._listen('click','hashtag-tagger-cancel',function(){this._hashtagTagger.commitChangesAndHide(false);j.show(this._composer);}.bind(this));this._listen('click','hashtag-tagger-done',function(){var mb=this._hashtagTagger.commitChangesAndHide(false),nb=this._textarea.value,ob=nb.split('');k.parse(nb).filter(function(tb){var ub=tb.tag;return mb.remove[ub];}).sort(function(tb,ub){return ub.rawOffset-tb.rawOffset;}).forEach(function(tb){var ub=tb.rawOffset,vb=tb.marker.length+tb.tag.length;if(ub===0){vb+=1;}else{ub-=1;vb+=1;}ob.splice(ub,vb);});this._textarea.value=ob.join('');var pb=Object.keys(mb.add).map(function(tb){return '#'+tb;}).join(' '),qb=(nb[nb.length-1]==' '),rb=(this._textarea.value.length===0),sb=(qb||rb);this._textarea.value+=sb?pb:' '+pb;ea.invoke('MMentions:update');j.show(this._composer);}.bind(this));var kb='',lb=qa(function(){var mb=this._textarea.value;if(mb&&mb!=kb){this._hashtagTagger.updateSuggestionsForText(mb);kb=mb;}},800,this);this._listen('MStructuredComposer-input',null,lb);}this._listen(['m:page:loading','MPagesFinchVoiceSwitcher:reload'],null,this.cleanup.bind(this));this._listen('audience-x-opened',null,function(event){j.hide(this._composer);this._specificAudienceTooltip&&this._specificAudienceTooltip.hide();}.bind(this));this._listen('MPrivacySelectorInterstitialX-closed',null,function(mb){this._textarea.focus();}.bind(this));this._listen('MMultiPhotoUploader:attachments:change',null,function(event){var mb=event.getData();this._toggleSubmitButtonState(mb.sending+mb.polling===0);}.bind(this));this._listen('MWebActivityUploader:received:share',null,this._navigateToComposer.bind(this,'photo'));if(this._photoPreview)this._listen('click','structured-composer-photo-preview-done',this._hidePhotoPreviews.bind(this));ea.invoke('MStructuredComposer:start');return this;};hb.prototype._cancelComposer=function(){"use strict";var kb=this._getPrivacySelector();if(kb&&kb.isOpen()){kb.hideMenu();return;}this._staticTemplates.style.height='';ea.invoke('MStructuredComposer-canceled',null,{maximum_character_count:this._longestInput,remaining_character_count:this._textarea.value.length,publish_target:this._form.target.value||h.getID()});var lb=this._hasPhotos();this._resetComposer();if(lb&&this._survey_photos_composercancel){j.hide(this._mainPage);g.conditionClass(this._survey_photos_composercancel,"_527t",false);aa.scrollToNode(this._survey_photos_composercancel);}};hb.prototype.cleanup=function(){"use strict";ea.invoke('MStructuredComposer:cleanup');this._closeComposer();this._form.removeEventListener('reset',this._resetComposer,false);for(var kb=0;kb<this._listeners.length;kb++)this._listeners[kb].remove();this._listeners=[];this._placesTagger.cleanup();};hb.prototype._listen=function(event,kb,lb){"use strict";this._listeners.push(ea.listen(event,kb,lb));};hb.prototype.setSpecificAudienceTooltip=function(kb){"use strict";this._specificAudienceTooltip=kb;};hb.prototype._isPublicAudience=function(){"use strict";var kb=j.scry(this._buttonbar,'table','privacy-table')[0];if(!kb)return false;var lb=j.scry(kb,'tr','privacy-option checked')[0];if(!lb)return false;var mb=i.get(lb);return mb.value==ca.PostParam.EVERYONE;};hb.prototype.setInAudienceAlignmentExp=function(kb){"use strict";this._inAudienceAlignmentExp=kb;};hb.prototype.setAudienceAlignmentFlyout=function(kb){"use strict";this._audienceAlignmentFlyout=kb;};hb.prototype.setAudienceAlignmentTitle=function(kb){"use strict";this._audienceAlignmentTitle=kb;};hb.prototype.setPostInterstitialTooltip=function(kb){"use strict";this._postInterstitialTooltip=kb;};hb.prototype.setPostInterstitialTooltipText=function(kb){"use strict";this._postInterstitialTooltipText=kb;};hb.prototype.setInterstitialDismissable=function(kb){"use strict";this._interstitialDismissable=kb;};hb.prototype._resetTooltip=function(){"use strict";var kb=j.find(this._buttonbar,'div','privacy-button-icon');this._postInterstitialTooltip.setContext(kb);};hb.prototype._composerEligibleForInterstitial=function(){"use strict";var kb=this._form.target.value;if(kb&&kb!=h.getID())return false;if(this._composerType!='status')return false;if(!this._isPublicAudience())return false;if(aa.getScreenHeight()<340&&r.IS_ANDROID){this._logAAA(ya);return false;}return true;};hb.prototype._showAtTagger=function(event){"use strict";if(this._pinPlace)return;if(event&&event.getNode('remove-token')){j.hide(this._atTags);g.conditionClass(this._atButton,'active',false);ea.invoke('MStructuredComposer-removedLocation');this._placeInputController.clear();this._placeClearablePreview.clear();event.kill();if(this._ogTagger)this._ogTagger.setPlaceID(event.id);return;}ea.invoke('MStructuredComposer-addLocationClicked');this._hideForInterstitial();this._placesTagger.show();};hb.prototype._shouldShowInterstitial=function(){"use strict";if(!this._audienceAlignmentFlyout||!this._audienceAlignmentTitle||!this._postInterstitialTooltip||!this._postInterstitialTooltipText||this._postInterstitialTooltipText.length!=4)return false;return true;};hb.prototype._showInterstitial=function(){"use strict";if(!this._shouldShowInterstitial()||!this._composerEligibleForInterstitial())return;ea.invoke('MMentions:decorations:hide',null,{});this._textarea.blur();this._composerTitle.textContent=this._audienceAlignmentTitle;aa.scrollTo(0,0);this._audienceAlignmentFlyout.setContext(this._composerTitle);this._audienceAlignmentFlyout.addListener('blur',function(){this._logAAA(bb);}.bind(this));this._audienceAlignmentFlyout.show();this._adjustAudienceFlyoutToHeight();if(!this._interstitialDismissable){this._toggleCancelButtonHidden(true);this._toggleSubmitButtonHidden(true);}if(!this._alignmentLearnmoreBody)this._alignmentLearnmoreBody=j.scry(document.body,'div','aaa_learn_more')[0];if(!this._alignmentInterstitialBody)this._alignmentInterstitialBody=j.scry(document.body,'div','composer_aaa_tux')[0];this._listen('click','aaa_dismiss',function(kb){var lb=this._postInterstitialTooltipText[0];this.closeInterstitial(lb);this._logAAA(fb);}.bind(this));this._listen('click','aaa_learn_back',function(kb){aa.scrollTo(0,0);j.hide(this._alignmentLearnmoreBody);j.show(this._alignmentInterstitialBody);}.bind(this));this._listen('click','aaa_learn',function(kb){aa.scrollTo(0,0);j.hide(this._alignmentInterstitialBody);j.show(this._alignmentLearnmoreBody);j.show(this._alignmentLearnmoreBody.firstChild);this._logAAA(ab);}.bind(this));this._listen('click','aaa_more',function(kb){this._openPrivacy();var lb=this._postInterstitialTooltipText[1];this.closeInterstitial(lb);this._logAAA(cb);}.bind(this));this._listen('click','aaa_friends',function(kb){if(this._friendsPrivacyRow){this._handleInterstitialFriends();}else this._waitingForFriendsRow=true;this._logAAA(eb);}.bind(this));this._listen('click','aaa_public',function(kb){var lb=this._postInterstitialTooltipText[3];this.closeInterstitial(lb);this._logAAA(db);}.bind(this));};hb.prototype._adjustAudienceFlyoutToHeight=function(){"use strict";if(r.IS_APPLE_WEBKIT_IOS)return;var kb=j.scry(document.body,'div','m-layer-root')[0],lb=j.scry(document.body,'a','aaa_more')[0];if(!lb||!kb)return;var mb=aa.getScreenHeight(),nb=ma.getElementPosition(lb).y+lb.offsetHeight;if(nb>mb)j.hide(j.scry(kb,'div','tux-body')[0]);};hb.prototype.captureFriendsPrivacyRow=function(){"use strict";var kb=j.find(this._buttonbar,'table','privacy-table');for(var lb=0;lb<kb.rows.length;lb++){var mb=kb.rows[lb],nb=i.get(mb);if(nb.value==ca.PostParam.ALL_FRIENDS){this._friendsPrivacyRow=mb;break;}}if(!this._friendsPrivacyRow)this.closeInterstitial(this._postInterstitialTooltipText[0]);if(this._waitingForFriendsRow)this._handleInterstitialFriends();};hb.prototype._handleInterstitialFriends=function(){"use strict";ea.invoke('MPrivacyComposerMenu:updatePrivacy',null,{row:this._friendsPrivacyRow});var kb=this._postInterstitialTooltipText[2];this.closeInterstitial(kb);};hb.prototype.closeInterstitial=function(kb){"use strict";if(!this._interstitialDismissable){this._toggleCancelButtonHidden(false);this._toggleSubmitButtonHidden(false);}aa.scrollTo(0,0);this._resetTooltip();this._audienceAlignmentFlyout.hide();this._restoreComposerWithoutFocus();this._composerTitle.textContent=this._defaultConfig.composertitle;var lb=j.find(this._postInterstitialTooltip.getRoot(),'div','aaa_tooltip_text');j.setContent(lb,kb);this._postInterstitialTooltip.show();};hb.prototype._hideForInterstitial=function(){"use strict";j.hide(this._composer);this._textarea.blur();};hb.prototype._closeComposer=function(){"use strict";this._textarea.blur();j.hide(this._composer);j.show(this._mainPage);};hb.prototype._toggleSubmitButtonState=function(kb){"use strict";var lb=j.find(this._composer,'button','submit_composer');lb.disabled=!kb;};hb.prototype._toggleCancelButtonHidden=function(kb){"use strict";var lb=j.find(this._composer,'button','cancel_composer');lb=lb.parentElement;kb?j.hide(lb):j.show(lb);};hb.prototype._toggleSubmitButtonHidden=function(kb){"use strict";var lb=j.find(this._composer,'button','submit_composer');lb=lb.parentElement;kb?j.hide(lb):j.show(lb);};hb.prototype._restoreComposerWithoutFocus=function(){"use strict";ea.invoke('MMentions:decorations:show',null,{});j.hide(this._mainPage);j.show(this._composer);j.show(this._textarea);j.show(this._buttonbar);};hb.prototype._restoreComposer=function(){"use strict";this._restoreComposerWithoutFocus();this._textarea.focus();};hb.prototype._logAAA=function(kb){"use strict";var lb=new sa().setEnum('product',wa).setEnum('event',kb).setInt('client_time',Date.now()).getURI();l.ajaxify(null,null,new u(lb));};hb.prototype._showPhotosPreview=function(kb){"use strict";if(!this._photoPreview)return;if(kb.state===ha.UPLOADED&&!kb.isPollingTagSuggestions){j.hide(this._composer);this._photoPreview.show(kb,this._tagSuggestionsController.getFaceboxesCopyForPhoto(kb.fbid));}};hb.prototype._hidePhotoPreviews=function(){"use strict";if(!this._photoPreview)return;j.show(this._composer);this._photoPreview.hide();};hb.prototype._updateTagExpansion=function(){"use strict";var kb=this._friendsInputController.hasTokens()||this._hasMentions,lb=this._getPrivacySelector();lb&&lb.setShowTagExpansion(kb);};hb.prototype._startCheckin=function(){"use strict";this._isCheckin=true;this._navigateToComposer('checkin');j.hide(this._composer);this._placesTagger.show();var kb=j.scry(this._placesTagger._root,'*','places-category-selector-container')[0];if(kb&&kb.id&&kb.children.length===0)new u('/places/addform/category.php').addData({target_id:kb.id,parent_id:0}).setMethod('GET').send();};oa(hb,{scrollToElem:null,showPlace:true,shouldScroll:true,syncSubmit:false,eventTaggingNuxHref:null});na(hb.prototype,{_defaultAction:null,_defaultConfig:null,_photoAction:null,_photoOpen:false,_hasPhoto:false,_albumChosen:false,_onlyMeFlyoutShown:false,_prefill:null,_forceAsync:false,_isCheckin:false,_isPageCheckin:false,_pinPlace:false,_albumPicker:null,_EventTaggingNuxDisplayed:false,_placesTagger:null,_ogTagger:null,_textarea:null,_atButton:null,_attachPhoto:null,_atTags:null,_clickedButton:null,_composer:null,_composerTitle:null,_form:null,_isCheckinInput:null,_jsonLocationInput:null,_mainPage:null,_photoButton:null,_staticTemplates:null,_ogTaggerLoaded:false,_specificAudienceTooltip:null,_specificAudienceTooltipShown:false,_listeners:null,_suggestCheckinPlace:false});function ib(kb){if(!kb)return '';kb=kb.trim();kb=kb.replace(/\n{3,}/,'\n\n');kb=kb.replace(/\t+/,' ');return kb;}function jb(){return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(kb){var lb=Math.random()*16|0,mb=kb=='x'?lb:(lb&3|8);return mb.toString(16);});}e.exports=hb;});
__d("MFriendsTagger",["DataStore","DOM","MRequest","SubscriptionsHandler","$","destroyOnUnload","eventsMixinDeprecated","getActiveElement"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p){"use strict";this._originalTokens=[];this._listeners=new j();this._root=p;this._tokenizer=null;this._listeners.addSubscriptions(h.listen(this.getRoot(),'click',null,this._handleClick.bind(this)));l(function(){this._listeners.release();this._listeners=null;}.bind(this));}o.prototype.hide=function(){"use strict";n().blur();h.hide(this.getRoot());};o.prototype.show=function(){"use strict";this._originalTokens=this._getOrderedTokens();h.show(this.getRoot());var p=new i('/a/tagging/fof/user_ed/');p.setData({increment:1});p.send();};o.prototype.clear=function(){"use strict";this._getTokenNodes().forEach(function(p){return this.removeToken(p);}.bind(this));};o.prototype.hasTokens=function(){"use strict";return Object.keys(this._getTokenizer().getTokens()).length>0;};o.prototype.getTokens=function(){"use strict";return this._getTokenizer().getTokens();};o.prototype.removeToken=function(p){"use strict";this._getTokenizer()._remove(g.get(p).key);};o.prototype._handleClick=function(event){"use strict";if(event.getNode('cancel_with_tagger')){this._cancelAndInvoke();}else if(event.getNode('submit_with_tagger'))this._submit();};o.prototype._getOrderedTokens=function(){"use strict";var p=this.getTokens();return Object.keys(p).map(function(q){return {key:q,value:p[q]};});};o.prototype.getRoot=function(){"use strict";return this._root;};o.prototype._getTokenizer=function(){"use strict";if(!this._tokenizer)this._tokenizer=h.find(this.getRoot(),'div','tokenizer').tokenizer;return this._tokenizer;};o.prototype._getTokenNodes=function(){"use strict";return h.scry(this.getRoot(),'span','token');};o.prototype._cancelAndInvoke=function(){"use strict";this.cancel();this.invoke('cancel',{tokenizer:this._getTokenizer()});};o.prototype.cancel=function(){"use strict";this.hide();this.clear();var p=h.create('a'),q=this._getTokenizer(),r;while(this._originalTokens.length){r=this._originalTokens.pop();q.addToken(r.key,r.value,p);}};o.prototype.setRoot=function(p){"use strict";this._root=p;return this;};o.prototype._submit=function(){"use strict";this.hide();this._originalTokens=[];this.invoke('submit',{friend_ids:Object.keys(this.getTokens()),tokens:this._getTokenNodes(),tokenizer:this._getTokenizer()});};o.fromID=function(p){"use strict";var q=k(p),r=g.get(q);if(!r._friendsTagger)r._friendsTagger=new o(q);return r._friendsTagger;};m(o,['submit','cancel']);e.exports=o;});
__d("InitMStructuredComposer",["$","DOM","DataStore","MAlbumPicker","MHashtagTagger","MOpenGraphTagger","MPlacesTagger","MStructuredComposer","Stratcom","MFriendsTagger"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(r){if(r.friends_tagger)p=r.friends_tagger;var s=g(r.open_id),t=i.get(s),u=t._friendsTagger||p.fromID(r.friends_tagger_id),v=t._placesTagger||new m(g(r.places_tagger_id)),w=null;if(r.album_picker_id)w=t._albumPicker||new j(g(r.album_picker_id));var x;if(r.og_tagger_id)x=new l(g(r.og_tagger_id));var y;if(r.hashtag_tagger_id)y=new k(g(r.hashtag_tagger_id),h.find(s,'div','hashtag-input-container'),h.find(s,'button','hashtag-button'));var z;if(r.survey_photos_id)z=g(r.survey_photos_id);var aa=new n(s,u,v,w,x,r.multi_photo_uploader,y,r.page_info,r.create_label,r.update_label,r.composer_target_type,r.composer_entry_point,r.friends_input,r.place_clearable_preview,r.og_clearable_preview,r.should_show_tag_suggestions,r.should_auto_tag,z,r.photos_preview);if(r.privacy_selector_rewrite_id)aa.setPrivacySelector(g(r.privacy_selector_rewrite_id));i.set(s,{composer:aa});if(r.scroll_to_elem_id)aa.setScrollToElem(g(r.scroll_to_elem_id));aa.setSyncSubmit(r.syncsubmit);aa.setShowPlace(r.showplace);aa.setShouldScroll(r.shouldscroll);if(r.disablefacewebhooks)v.setDisableFacewebHooks(true);aa.start();if(r.photouploaduri)aa.setPhotoAction(r.photouploaduri);if(r.specific_audience_tooltip)aa.setSpecificAudienceTooltip(r.specific_audience_tooltip);aa.setInAudienceAlignmentExp(r.in_aaa_exp);aa.setAudienceAlignmentFlyout(r.aaa_flyout);aa.setAudienceAlignmentTitle(r.aaa_title);if(r.post_interstitial_tooltip){aa.setPostInterstitialTooltip(r.post_interstitial_tooltip);aa.setPostInterstitialTooltipText(r.post_interstitial_tooltip_text);aa.setInterstitialDismissable(r.interstitial_dismissable);}if(r.bc_keyboard_state==="down")aa.setKeyboardStateDown();if(r.suggest_checkin_place)aa.setSuggestCheckinPlace();o.listen('MPrivacyComposerMenu::custom',null,function(ba){if(ba.getData().visible){h.hide(g('structured_composer'));}else{h.hide(g('viewport'));h.show(g('structured_composer'));}});}f.main=q;});
__d("MPlacesCategorySelector",["DataStore","DOM","MRequest","Stratcom","copyProperties","createDeprecatedProperties","eventsMixinDeprecated"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){"use strict";this._root=o;this._listeners=[j.listen('click',[o.getAttribute('data-sigil'),'cancel_places_category_selector'],this._cancel.bind(this)),j.listen('click',[o.getAttribute('data-sigil'),'category_option'],this._submit.bind(this))];this._currentlyMakingServerRequest=false;this._viewcount=1;}n.prototype.hide=function(){"use strict";h.hide(this._root);};n.prototype.show=function(){"use strict";h.show(this._root);};n.prototype.cleanup=function(){"use strict";while(this._listeners.length)this._listeners.pop().remove();};n.prototype._hideCurrentChild=function(){"use strict";for(var o=0;o<this._viewcount-1;o++){if(!this._root.childNodes[o])return;h.hide(this._root.childNodes[o]);}};n.prototype._showCurrentChild=function(){"use strict";if(this._viewcount>=1){var o=this._getCurrentVisibleView();h.show(o);}};n.prototype._deleteLastChild=function(){"use strict";var o=this._root.childElementCount;if(o>=1)h.remove(this._root.childNodes[o-1]);};n.prototype._deleteAllChildren=function(){"use strict";var o=this._root.childElementCount;for(var p=o-1;p>=1;p--)h.remove(this._root.childNodes[p]);if(o>=1)h.show(this._root.childNodes[0]);this._viewcount=1;};n.prototype._getCurrentVisibleView=function(){"use strict";return this._root.childNodes[this._viewcount-1];};n.prototype._submit=function(event){"use strict";if(this._currentlyMakingServerRequest)return;var o=this._getCurrentVisibleView(),p=h.find(o,'*','loading'),q=h.find(o,'div','category-list-view'),r=g.get(event.getNode('category_option'));if(r.haschildren){this._currentlyMakingServerRequest=true;this._hideCurrentChild();h.show(p);h.hide(q);var s=new i('/places/addform/category.php');s.listen('done',function(){this._viewcount=this._viewcount+1;this._hideCurrentChild();this._currentlyMakingServerRequest=false;h.hide(p);h.show(q);}.bind(this));s.addData({parent_category_id:r.id,target_id:this._root.id});s.setMethod('GET');s.send();}else{this._deleteAllChildren();this._currentid=null;var t={category_name:r.name,category_value:r.id};this.hide();this.invoke('submit',t);}event.kill();};n.prototype._cancel=function(event){"use strict";if(this._currentlyMakingServerRequest)return;if(this._viewcount>1){this._deleteLastChild();this._viewcount--;this._showCurrentChild();}else{this.hide();this.invoke('cancel');}};m(n,['submit','cancel']);l(n,{disableFacewebHooks:false});k(n.prototype,{_root:null,_currentlyMakingServerRequest:null,_viewcount:null});e.exports=n;});
__d("MPlacesAddView",["DOM","FBJSON","MPlacesCategorySelector","MRequest","Stratcom","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=null,ga=true,ha={init:function(ia){m=l(ia);if(!m)return;s=g.scry(m,'div','places-category-selector-container')[0];if(s){p=new i(s);o=g.find(m,'div','add-place-form');t=g.find(m,'div','new-place-name');u=g.find(t,'input','');v=g.find(m,'div','new-place-address');w=g.find(v,'input','');x=g.find(m,'div','new-place-phone');y=g.find(x,'input','');z=g.find(m,'div','new-place-website');aa=g.find(z,'input','');da=g.scry(m,'input','is_current')[0];q=g.find(m,'span','category_input_display_text');r=g.scry(m,'input','category_input_value')[0];ba=g.scry(m.parentNode,'div','place-header')[0];ca=g.find(m,'div','address-error-box');}else u=g.find(m,'input','new-place-name');if(!ba)ba=g.scry(m.parentNode.parentNode.parentNode,'div','MTopBlueBarHeader')[0];n=g.find(m,'button','add_place_submit');this._listeners=[k.listen('click','add_place_submit',ha._verifyAndSubmitAddPlace.bind(this)),k.listen('MStructuredComposer:cleanup',null,ha._cleanup.bind(this)),k.listen('m:places:map:move',null,function(event){ea=event.getData().lat;fa=event.getData().lng;}),k.listen('m:places:map:render',null,function(event){var ja=h.parse(event.getData(),e.id);ea=ja.latitude;fa=ja.longitude;})];u.addEventListener('focus',function(){if(ga){u.blur();ga=false;}});if(s){this._listeners.push(k.listen('click','category-selector',ha._showCategorySelector.bind(this)));this._listeners.push(p.listen('cancel',ha._cancelCategorySelector.bind(this)));this._listeners.push(p.listen('submit',ha._submitCategorySelector.bind(this)));}},_cleanup:function(){while(this._listeners.length)this._listeners.pop().remove();if(p)p.cleanup();},_showCategorySelector:function(event){if(ba)g.hide(ba);g.hide(o);g.show(s);event.kill();},_showAddButton:function(){if(!r.value)return false;return true;},_updateCategorySelector:function(ia){if(q&&ia){var ja=ia.category_name,ka=ia.category_value;g.setContent(q,ja);if(ka.length!==0){r.value=ka;if(n.disabled&&ha._showAddButton())n.disabled=false;}}},_submitCategorySelector:function(event){ha._updateCategorySelector(event);g.hide(s);g.show(o);k.invoke('m:places:addplace:show');ga=true;if(ba)g.show(ba);},_cancelCategorySelector:function(){g.hide(s);g.show(o);k.invoke('m:places:addplace:show');ga=true;if(ba)g.show(ba);},_verifyAndSubmitAddPlace:function(event){var ia={new_place:true,name:u.value};if(s){ia.phone=y.value;ia.address=w.value;ia.website=aa.value;}ia.is_current=true;if(da)ia.is_current=da.checked;if(ea){ia.latitude=ea;ia.longitude=fa;}if(r){ia.topic_tokens=r;}else{var ja=g.scry(m,'span','token');ia.topic_tokens=ja;}if(ia.address){var ka=new j('/places/addform/verifyaddress.php');ka.listen('done',function(la){if(la.actions.length===1){this._submitData(ia,event);}else event.kill();}.bind(this));ka.setData({address:ia.address,latitude:ia.latitude,longitude:ia.longitude,target_id:ca.id}).setMethod('GET').send();}else this._submitData(ia,event);},_submitData:function(ia,event){if(ia.name.length!==0){g.hide(m);k.invoke('m:places:addform:submit',null,ia);}else event.kill();}};e.exports=ha;});
__d("MComposerDialogClearablePreview",["DOM","Stratcom","SubscriptionsHandler","mixInEventEmitter","MComposerDialogClearablePreviewConstants"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MComposerDialogClearablePreviewConstants').sigils;function l(m,n){"use strict";this.$MComposerDialogClearablePreview0=new i();this.$MComposerDialogClearablePreview1=n;this.$MComposerDialogClearablePreview2=m;this.$MComposerDialogClearablePreview0.addSubscriptions(g.listen(this.$MComposerDialogClearablePreview2,'click',k.CLEAR,this.$MComposerDialogClearablePreview3.bind(this)),h.listen('m:page:unload',null,function(){return this.$MComposerDialogClearablePreview0.release();}.bind(this)));}l.prototype.clear=function(){"use strict";this.hide();g.setContent(this.$MComposerDialogClearablePreview1,'');return this;};l.prototype.$MComposerDialogClearablePreview3=function(){"use strict";this.clear();this.emit('clear');return this;};l.prototype.hide=function(){"use strict";g.hide(this.$MComposerDialogClearablePreview2);return this;};l.prototype.setValue=function(m){"use strict";g.setContent(this.$MComposerDialogClearablePreview1,m);this.show();return this;};l.prototype.show=function(){"use strict";g.show(this.$MComposerDialogClearablePreview2);return this;};l.prototype.showIfHasValue=function(){"use strict";return !this.$MComposerDialogClearablePreview1.innerText?this.hide():this.show();};j(l,{clear:true});e.exports=l;});
__d("MChronoFeedSelect",["DOM","DataStore","Popover","Stratcom"],function(a,b,c,d,e,f,g,h,i,j){function k(l){var m=false,n=new i(l),o=[n.listen('open',function(){j.invoke(':m:page-header-right:open');}),n.listen('close',function(){j.invoke(':m:page-header-right:close');}),j.listen('click','feed-selection',function(event){var p=event.getNode('feed-selection');if(h.get(p).checked){event.prevent();}else m=true;n.close();}),j.listen('m:page:unload',null,function(){while(o.length)o.pop().remove();var p=document.getElementById(l.button);if(p)if(m){p.disabled=true;}else g.hide(p);n.close();n.clear();n=null;l=null;o=null;})];}f.main=k;});
__d("Time",[],function(a,b,c,d,e,f){var g={getGMTOffset:function(h){var i=new Date(),j=i.getTimezoneOffset()/30,k=i.getTime()/1000,l=Math.round((h-k)/1800),m=Math.round(j+l)%48;if(m>24){m-=Math.ceil(m/48)*48;}else if(m<-28)m+=Math.ceil(m/-48)*48;return m*30;}};e.exports=g;});
__d("MViewportTracking",["setTimeoutAcrossTransitions","MViewport","Stratcom","Vector"],function(a,b,c,d,e,f,g,h,i,j){function k(){"use strict";}k.prototype.init=function(l){"use strict";this.getDataFromConfig(l);this.maxScrollPosition=0;this.minSizeToBeVisible=200;this.readStoryIDs={};this.isLoose=!!l.is_loose;this.fireEvent();this.$MViewportTracking0=[i.listen('scroll',null,this.$MViewportTracking1.bind(this)),i.listen('m:page:unload',null,this.onUnload.bind(this))];};k.prototype.fireEvent=function(){"use strict";var l=this.getAllStories(),m=h.getScrollTop(),n=h.getHeight(),o=this.isLoose,p=n+this.maxScrollPosition-m;for(var q=0;q<l.length;q++){var r=l[q],s=this.getStoryID(r);if(!s||s in this.readStoryIDs)continue;var t,u,v;if('getBoundingClientRect' in r){t=r.getBoundingClientRect();u=t.bottom;v=t.top;}else{v=j.getPos(r).y-m;u=v+j.getDim(r).y;}if(!v&&!u)continue;if(!o&&v>n-this.minSizeToBeVisible)break;if((!o&&v<=n-this.minSizeToBeVisible&&u>=this.minSizeToBeVisible)||(o&&v<p)){this.readStoryIDs[s]=true;this.sendDataToLog(this.getDataToLog(r));}}};k.prototype.$MViewportTracking1=function(){"use strict";if(!this.$MViewportTracking2)this.$MViewportTracking2=g(function(){this.$MViewportTracking2=null;this.maxScrollPosition=Math.max(this.maxScrollPosition,h.getScrollTop());clearTimeout(this.$MViewportTracking3);this.$MViewportTracking3=g(function(){this.fireEvent();}.bind(this),this.getTimeout());}.bind(this),100);};k.prototype.onUnload=function(){"use strict";this.$MViewportTracking0.forEach(function(l){l.remove();});this.$MViewportTracking0=[];};e.exports=k;});
__d("MEntstreamViewportTracking",["Banzai","DOM","FBJSON","MViewport","MViewportTracking","StratcomManager","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=51;for(var p in k)if(k.hasOwnProperty(p))r[p]=k[p];var q=k===null?null:k.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=k;function r(){"use strict";if(k!==null)k.apply(this,arguments);}r.prototype.getDataFromConfig=function(s){"use strict";this.logStoryHeight=!!s.story_height_logging;};r.prototype.$MEntstreamViewportTracking0=function(){"use strict";if(!this.$MEntstreamViewportTracking1)this.$MEntstreamViewportTracking1=document.getElementById('root');return this.$MEntstreamViewportTracking1;};r.prototype.getAllStories=function(){"use strict";return h.scry(this.$MEntstreamViewportTracking0(),'article','story-div');};r.prototype.getTimeout=function(){"use strict";return 300;};r.prototype.getDataToLog=function(s){"use strict";var t=n(i.parse(s.getAttribute('data-ft'),e.id),{evt:o}),u,v,w;if(this.logStoryHeight){if('getBoundingClientRect' in s){u=s.getBoundingClientRect();v=u.height;w=u.top+j.getScrollTop();}else{v=m.getDim(s).y;w=m.getPos(s).y;}t.evt_value=v;t.offset=w;}return t;};r.prototype.getStoryID=function(s){"use strict";var t=s.getAttribute('data-ft');if(!t)return null;return i.parse(t,e.id).mf_story_key;};r.prototype.sendDataToLog=function(s){"use strict";g.post('feed_tracking',{ft:s});};e.exports.init=function(s){l.enableDispatch(document,'scroll');(new r()).init(s);};});
__d("MComposerMarauderLogger",["MarauderLogger","Stratcom"],function(a,b,c,d,e,f,g,h){var i='composer_entry',j='composer_cancel',k='composer_post',l='composer_written',m='composer_open_privacy',n='intent_friend_tag',o='composer_friend_tag',p='cancel_friend_tag',q='composer_attach_photo_click',r='composer_attach_photo',s='composer_attach_movie',t='composer_select_album_click',u='composer_select_album',v='composer_select_album_cancel',w='intent_location',x='add_location',y='remove_location',z='cancel_location',aa='intent_minutiae',ba='add_minutiae',ca='composer_minutiae_change_icon',da='composer_minutiae_change_icon_click',ea='cancel_minutiae',fa='remove_minutiae',ga='picker_displayed',ha='picker_canceled',ia='picker_saved',ja='picker_more_button_tapped',ka=false,la,ma=null;function na(event){var ua=event.getData()||{};ma=ua.session_id;ka=false;la=ua.opened_time||Date.now();g.toggleModule('composer',true);ta(i,{composer_type:ua.composer_type,target_type:ua.target_type,ref:ua.entry_point_ref});}function oa(event){var ua=event.getData()||{},va=g.getNavigationModule(),wa='unspecified_source';if(va==='newsfeed'){wa='newsfeed_composer';}else if(va==='timeline')wa='timeline_composer';ta(k,{nectar_module:wa,targetId:ua.publish_target,loaded_time:la||-1});g.toggleModule('composer',false);ma=null;}function pa(event){var ua=event.getData()||{};ta(j,{maximum_character_count:ua.maximum_character_count||0,remaining_character_count:ua.remaining_character_count||0,publish_target:ua.publish_target||-1,loaded_time:la||-1});g.toggleModule('composer',false);ma=null;}function qa(event){var ua=event.getData()||{};if(!ua.text)return;var va=ua.text.replace(/ /g,"");if(va.length>=5&&!ka){ta(l,{publish_target:ua.publish_target||-1,loaded_time:la||-1,written_time:ua.written_time||-1});ka=true;}}function ra(){ta(m);}function sa(ua,va,wa){h.listen(ua,null,ta.bind(null,va,wa));}function ta(ua,va){if(!ma)return;g.log(ua,'composer',va,undefined,undefined,ma);}h.listen('MStructuredComposer-input',null,qa);h.listen('MStructuredComposer-opened',null,na);h.listen('MStructuredComposer-canceled',null,pa);h.listen('MStructuredComposer-beforeSubmit',null,oa);h.listen('MStructuredComposerOGInput-started',null,function(event){var ua=event.getData();if(ua.choose_icon){ta(da);}else ta(aa);});h.listen('MStructuredComposerOGInput-done',null,function(ua){var va=ua.getData();if(va.cancel){ta(ea);}else if(va.icon_changed){ta(ca);}else if(va.add){ta(ba);}else if(va.remove)ta(fa);});sa('MStructuredComposerFriendsInput-started',n);h.listen('MStructuredComposerFriendsInput-done',null,function(ua){var va=ua.getData(),event;if(va.cancel){event=p;}else event=o;ta(event,{friend_tag_count:va.num_tags});});sa('MStructuredComposer-addLocationClicked',w);sa('MStructuredComposer-canceledLocation',z);sa('MStructuredComposer-removedLocation',y);sa('MStructuredComposer-addedLocation',x);sa('MStructuredComposer-addPhotoClicked',q);h.listen('MStructuredComposer-addedPhoto',null,function(ua){var va=ua.getData();ta(r,{photo_count:va.photo_count});});sa('MStructuredComposer-addedVideo',s);sa('MStructuredComposer-selectAlbumClicked',t);sa('MStructuredComposer-selectAlbum',u);sa('MStructuredComposer-selectAlbumCanceled',v);h.listen('click','privacy-button',ra);sa('audience-x-opened',ga);h.listen('audience-x-closed',null,function(ua){var va=ua.getData();ta(va.canceled?ha:ia);});sa('MPrivacyAudienceToggle-moreButtonTapped',ja);});
__d("MSuggestCheckinMarauderLogger",["MarauderLogger","Stratcom"],function(a,b,c,d,e,f,g,h){var i='composer_suggest_checkin',j='composer_suggest_checkin_confirmed',k='composer_suggest_checkin_dismissed',l='composer_suggest_checkin_rejected',m=null;function n(p,q){if(!m)return;g.log(p,'composer',q,undefined,undefined,m);}function o(p,q,r){h.listen(p,null,function(event){var s=event.getData();if(!s||!s.id)return;n(q,{place_id:s.id});});}h.listen('MStructuredComposer-opened',null,function(event){var p=event.getData()||{};m=p.session_id;});o('MSuggestCheckin-suggest',i);o('MSuggestCheckin-confirmed',j);o('MSuggestCheckin-dismissed',k);o('MSuggestCheckin-rejected',l);e.exports={};});
__d("MPagesStarsRatableBase",["CSS","DOM","Stratcom"],function(a,b,c,d,e,f,g,h,i){function j(k,l){"use strict";this.root=k;this.stars=h.scry(k,'span','stars-ratable-star');this.hiddenInput=h.find(k,'input','stars-ratable-input');this.listeners=[h.listen(this.root,'click',null,this._onClick.bind(this))];this.setRating(l);var m=this.listeners;i.listen('m:page:unload',null,function(){i.removeCurrentListener();m.forEach(function(n){n.remove();});});}j.prototype._onClick=function(event){"use strict";var k=this._getStarIndexFromEvent(event);if(!k)return;this.setRating(k);};j.prototype._getStarIndexFromEvent=function(event){"use strict";var k=event.getTarget();if(k)return this.stars.indexOf(k)+1;return 0;};j.prototype.setRating=function(k){"use strict";for(var l=0;l<this.stars.length;++l){var m=(l>=k);g.conditionClass(this.stars[l],'fullStar',!m);g.conditionClass(this.stars[l],'emptyStar',m);}this.hiddenInput.value=k;};j.init=function(k,l){"use strict";new j(k,l);};e.exports=j;});
__d("MPlacesCurrentLocation",["MPlaces"],function(a,b,c,d,e,f,g){var h=function(i){g.setCurrentJSONLocation(i.location);g.setLocationSearchMode(i.mode);if(i.mode==g.locationSearchModes.MODE_CHECKIN)g.monitorLocation();};f.main=h;});
__d("MPlacesInit",["MPlaces","Stratcom"],function(a,b,c,d,e,f,g,h){if(typeof window.usingGears!=='undefined')g.locationOptions.enableHighAccuracy=false;h.listen('click',g.LINK_SIGIL,g.onClick);h.listen('submit',g.FORM_SIGIL,g.onSubmit);});
__d("MQuickSearchLogger",[],function(a,b,c,d,e,f){function g(){"use strict";this.$MQuickSearchLogger0=false;this.$MQuickSearchLogger1=false;}g.prototype.$MQuickSearchLogger2=function(){"use strict";this.$MQuickSearchLogger0=true;this.$MQuickSearchLogger1=false;this.$MQuickSearchLogger3=Math.random();};g.prototype.$MQuickSearchLogger4=function(){"use strict";this.$MQuickSearchLogger0=false;};g.prototype.logSessionStart=function(h){"use strict";};g.prototype.logResults=function(h,i){"use strict";};g.prototype.logClick=function(h){"use strict";};g.prototype.onSearch=function(h){"use strict";if(!this.$MQuickSearchLogger0){this.$MQuickSearchLogger2();this.logSessionStart(h);}this.$MQuickSearchLogger5=h;};g.prototype.onResults=function(h,i){"use strict";this.logResults(h,i);};g.prototype.onCleanup=function(){"use strict";this.$MQuickSearchLogger4();};g.prototype.onClick=function(h){"use strict";if(!this.$MQuickSearchLogger1){this.logClick(h);this.$MQuickSearchLogger1=true;this.$MQuickSearchLogger4();}};g.prototype.getSID=function(){"use strict";return this.$MQuickSearchLogger3;};g.prototype.getLastRequest=function(){"use strict";return this.$MQuickSearchLogger5;};e.exports=g;});
__d("MQuickSearchLoggerPlaces",["MQuickSearchLogger","MarauderLogger","DataStore"],function(a,b,c,d,e,f,g,h,i){for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(){"use strict";g.call(this);}l.prototype.logSessionStart=function(m){"use strict";h.log('m_checkin_search_session_start',undefined,{sid:this.getSID()});};l.prototype.logResults=function(m,n){"use strict";h.log('m_checkin_search_results',undefined,{sid:this.getSID(),search_experiment:i.get(n).searchExperiment});};l.prototype.logClick=function(m){"use strict";var n=false,o=-1;if(m){var p=i.get(m.selected_result);if(p!==null)n=p.isEventResult;var q=[];if(m.results!==null&&m.results.children!==null)q=m.results.children;for(var r=0;r<q.length;r++){var s=i.get(q[r]);if(p.id===s.id){o=r;break;}}}var t=-1;if(this.getLastRequest()!==null){var u=this.getLastRequest();if(u.hasOwnProperty('q')&&u.q.hasOwnProperty('length'))t=this.getLastRequest().q.length;}h.log('m_checkin_search_click',undefined,{sid:this.getSID(),query_length:t,position:o,is_event:n});};e.exports=l;});
__d("MQuickSearchPlaces",["MQuickSearch","MPlaces","Stratcom","MQuickSearchLoggerPlaces"],function(a,b,c,d,e,f,g,h,i,j){var k=function(l){var m,n,o=new j(),p=new g(l,o),q=p.listen('search',function(u){var v=h.getCurrentJSONLocation();if(v==m&&u==n){i.context().prevent();return;}m=h.getCurrentJSONLocation();n=u;var w={json_location:m};w[h.locationSearchModes.SEARCH_MODE]=h.getLocationSearchMode();p.maybeAddQueryParameters(w);i.invoke('m:quicksearch:location:change',null,v);}),r=i.listen('m:quicksearch:places:search',null,function(){p.search();}),s=i.listen('m:quicksearch:places:cancel',null,function(){return p.reset();}),t=i.listen('m:quicksearch:places:click',null,function(event){o.onClick(event.getData());});i.listen('m:page:loading',null,function(){i.removeCurrentListener();q.remove();r.remove();s.remove();t.remove();q=r=m=n=p=null;});};f.init=k;});
__d("XdStore",["setTimeoutAcrossTransitions","XD"],function(a,b,c,d,e,f,g,h){var i={_batch:[],setItem:function(j){var k=i;k._batch.push(j);g(k._runBatch,0);},getItem:function(j,k){i._getXdStoreWindow(function(l){var m=h.guid();h.register(m,function(n){k(n.data);});l.postMessage(JSON.stringify({method:'getItem',params:[j],returnCb:m}),'*');});},_runBatch:function(){var j=i;j._getXdStoreWindow(function(k){if(j._batch.length===0)return;k.postMessage(JSON.stringify({method:'setItems',params:[j._batch]}),'*');j._batch=[];});},_getXdStoreWindow:function(j){var k=document.getElementById('xd_local_storage_server');if(!k)return;if(k.__loaded){j(frames.xd_local_storage_server);}else if(k.addEventListener)k.addEventListener('load',function(){j(frames.xd_local_storage_server);},false,true);}};e.exports=i;});
__d("MCanvasLogger",["setIntervalAcrossTransitions","AsyncSignal","MCache","MLogger","XdStore"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(m){var n=false;function o(p){return (Date.now()-p)>m.event_timeout*1000;}g(function(){if(n)return;k.getItem('_log',function(p){p=p||[];var q=i.getItem('appEventList')||[],r=q.concat(p);i.setItem('appEventList',r);if(!r.length||(r.length<m.min_batch_num_events&&!o(r[0].time)))return;var s=Math.min(m.max_batch_num_events,r.length),t=r.slice(0,s),u=new h(m.uri,{app_log:JSON.stringify(t),time:Date.now()});u.listen('load',function(v){var w=v.all_events;i.setItem('appEventList',w.slice(v.batch.length,w.length));n=false;}.bind(this,{all_events:r,batch:t}));u.listen('fail',function(){n=false;});n=true;u.send();if(r.length>m.overload_limit_num_events){i.removeItem('appEventList');j.warn('appEventList dropped because it became too large.');}});},m.log_scan_interval);};f.main=l;});
__d("MPrivacyDeferredSelector",["Stratcom","MRequest","MRequestTypes","MURI"],function(a,b,c,d,e,f,g,h,i,j){var k=null,l=null,m=null,n=null;function o(r,s,t){l=r;k=s;m=t;if(n===null){n=[];n.push(g.listen('click','show_composer',p));n.push(g.listen('composerPhotoLink',null,p));n.push(g.listen('click','checkin_link',p));n.push(g.listen('click','privacy-button',p));}}function p(event){var r=new j('/privacy/selector');r.setQueryData({pt_id:l,eco:k,selected:m}).setAsync(true);var s=new h(r.toString());s.setType(i.DEPENDENT);s.send();for(var t=0;t<n.length;t++)n[t].remove();n=null;}function q(r){g.invoke('MPrivacyDeferredSelector-loaded',null,{id:r});}e.exports={init:o,informLoaded:q};});
__d("TimezoneAutoset",["MRequest","Time"],function(a,b,c,d,e,f,g,h){var i,j=function(k){if(i)return;i=true;if(!k.time||k.offset===undefined)return;var l=-h.getGMTOffset(k.time);if(k.forceUpdate||l!=k.offset)new g(k.uri).setMethod('GET').setData({offset:l,is_forced:k.forceUpdate}).send();};f.main=j;});