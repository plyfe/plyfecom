/*!CK:186700958!*//*1397444659,178158613*/

if (self.CavalryLogger) { CavalryLogger.start_js(["FZ2GF"]); }

__d("ChannelDefaults",[],function(a,b,c,d,e,f){e.exports={LONGPOLL_TIMEOUT:60000,STALL_THRESHOLD:180000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000};});
__d("ChannelStateMap",[],function(a,b,c,d,e,f){e.exports={pull:{ok:'pull!',error:'pull',error_missing:'pull',error_msg_type:'pull',clock_anomaly:'pull!',refresh_0:'reconnect',refresh_110:'reconnect!',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},reconnect:{ok:'pull!',error:'reconnect',clock_anomaly:'reconnect!'},shutdown:{clock_anomaly:'shutdown!'}};});
__d("StateMachine",["setTimeoutAcrossTransitions","EventEmitter","ex"],function(a,b,c,d,e,f,g,h,i){var j=0;function k(p,q){"use strict";this.idx=j++;this.machine=p;this.asap=q&&q.substr(-1)=='!';this.name=this.asap?q.substr(0,q.length-1):q;this.progress=o.NEW;this.status=null;}k.prototype.enter=function(){"use strict";this.machine.enter_private(this);};k.prototype.exit=function(p){"use strict";this.machine.exit_private(this,p);};k.prototype.toString=function(){"use strict";return this.name+'('+this.progress+','+this.status+')';};var l='_ABORT_';for(var m in h)if(h.hasOwnProperty(m))o[m]=h[m];var n=h===null?null:h.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=h;function o(p,q){"use strict";h.call(this);this.$StateMachine0=p;this.$StateMachine1=q;this.$StateMachine2=0;this.$StateMachine3=[];this.$StateMachine4=Date.now();}o.prototype.$StateMachine5=function(p){"use strict";this.$StateMachine3.push((Date.now()-this.$StateMachine4)+': '+p);if(this.$StateMachine3.length>40)this.$StateMachine3=this.$StateMachine3.splice(-20);};o.prototype.getState=function(){"use strict";return this.$StateMachine6;};o.prototype.setDelay=function(p){"use strict";this.$StateMachine2=p||0;return this;};o.prototype.getDelay=function(){"use strict";return this.$StateMachine2;};o.prototype.enter=function(p){"use strict";this.enter_private(new k(this,p));};o.prototype.enter_private=function(p){"use strict";this.$StateMachine5('enter '+p+', '+this.$StateMachine6);if(this.$StateMachine6&&this.$StateMachine6!=p)this.$StateMachine6.exit(l);this.$StateMachine6=p;if(p.asap){delete p.asap;if(this.$StateMachine1.enter)this.$StateMachine1.enter(p);p.progress=o.ENTERED;}else{p.progress=o.PENDING;p.asap=true;p.$StateMachine7=g(function(){p.enter();},this.$StateMachine2);}this.emit(o.ENTER,p);};o.prototype.exit=function(p){"use strict";this.exit_private(this.$StateMachine6,p);};o.prototype.exit_private=function(p,q){"use strict";this.$StateMachine5('exit '+p+', '+q+', '+this.$StateMachine6);if(!p||p!=this.$StateMachine6)throw new Error(i('Invalid state: %s, history: %s',p,this.$StateMachine3.join('|')));if(p.progress==o.EXITED)return;p.status=q;p.progress=o.EXITED;if(p.$StateMachine7){clearInterval(p.$StateMachine7);p.$StateMachine7=null;}this.$StateMachine6=null;if(p&&this.$StateMachine1.exit)this.$StateMachine1.exit(p);p.exited=true;this.emit(o.EXIT,p);if(q!=l){var r=this.$StateMachine0[p.name];if(!r||!r[q])throw new Error(i('No exit for state:%s, status: %s',p.name,q));this.enter(r[q]);}};o.ENTER='enter';o.EXIT='exit';o.NEW='new';o.PENDING='pending';o.ENTERED='entered';o.EXITED='exited';e.exports=o;});
__d("MChannelManager",["Banzai","BaxterUtils","ChannelClientConfig","ChannelDefaults","ChannelStateMap","Clock","LogHistory","MLogger","MRequest","MURI","StateMachine","URI","copyProperties","rand32","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w='ok',x='error',y='error_missing',z=60000,aa=null,ba=null,ca=null,da=null,ea=null,fa=8,ga=-1,ha={enter:function(qa){if(da){da.abort();da=null;}switch(qa.name){case 'pull':if(!ba.uri)break;var ra=new r(ba.uri),sa={channel:ba.user_channel,seq:ca,profile:'mobile',partition:ba.partition,sticky_token:ga,cb:t()};if(ba.chat_enabled)sa.state='active';if(h.canUseBaxter()&&ba.baxter_enabled)sa.cap=fa;da=(new o(ra+'')).setCORS(true).setMethod('GET').setData(sa).setRaw(true);da.listen('open',function(ua){ua.getTransport().withCredentials=true;});da.listen('done',function(ua){ka(qa,ua);});da.listen('error',function(){ka(qa);});break;case 'reconnect':var ta=new p('/a/channel/reconnect.php').setAsync(true);da=(new o(ta+'')).setMethod('GET');da.listen('done',function(ua){ja(qa,ua);});da.listen('error',function(){ja(qa);});break;default:}if(da)da.send();},exit:function(qa){if(qa.status==='ok'){if(qa.name==='pull')v.setDelay(0);}else if(!(qa.status==null)){var ra=v.getDelay();ra=ra>0?(ra*2):aa.MIN_RETRY_INTERVAL;ra=Math.min(ra,aa.MAX_RETRY_INTERVAL);v.setDelay(ra);}if(da){da.abort();da=null;}}};function ia(qa){ea=qa;}function ja(qa,ra){if(!ra){n.warn('_onReconnectError: reconnect request error');qa.exit(x);}else if(ra.user_channel){ba=ra;ca=ba.seq;qa.exit(w);}else{n.warn('_onReconnectError: bad reconnect response - %s',JSON.stringify(ra));qa.exit(x);}}function ka(qa,ra){var sa=w;if(!ra){qa.exit(x);return;}switch(ra.t){case 'refresh':case 'refreshDelay':sa='refresh_'+(ra.reason||0);break;case 'fullReload':sa=y;break;case 'continue':break;case 'lb':var ta=ra.lb_info;if(ta){ga=ta.sticky;var ua="http://";if(ba.is_secure_uri)ua="https://";ba.uri=ua+ta.vip+'.facebook.com/pull';}else n.error('bad lb info from channel proxy');break;case 'msg':var va=ra.seq-ra.ms.length;for(var wa=0;wa<ra.ms.length;wa++){var xa=va+wa;if(xa>=ca){if(ea)ra.ms[wa]=ea(ra.ms[wa]);v.emit(v.CHANNEL_MESSAGE,ra.ms[wa]);}}break;default:sa=x;n.warn('_onRequestSuccess: invalid channel response, sending request again.');break;}if('seq' in ra)ca=ra.seq;qa.exit(sa);}function la(){if(!v.xhrEnabled||aa)return;aa=s(j,i.config);ba=i.info;ca=ba.seq;l.addListener(l.ANOMALY,function(){v.exit('clock_anomaly');});a.onbeforeunload=function(){if(da)da.abort();};ma();}function ma(){v.setDelay(aa.MIN_RETRY_INTERVAL);v.enter(ba.uri?'pull!':'reconnect!');}v=new q(k,ha);v.startChannel=la;v.setTransform=ia;v.xhrEnabled=!!a.XMLHttpRequest;v.CHANNEL_MESSAGE='channel_message';var na;function oa(){v.emit(q.ENTER,{name:'stall',progress:q.ENTERED});if(g.isEnabled('mchannel_jumpstart'))ma();}function pa(qa){m.getInstance('channel').log(qa.name,qa.status||qa.progress);if(qa.name!=='stall'){clearTimeout(na);na=u(oa,z);}}v.addListener(q.ENTER,pa);v.addListener(q.EXIT,pa);e.exports=v;});
__d("MTouchChannelManager",["MChannelManager","Stratcom"],function(a,b,c,d,e,f,g,h){function i(l){h.invoke(l.type,null,l);}var j=false;function k(){if(j)return;j=true;g.addListener(g.CHANNEL_MESSAGE,i);h.listen(['m:onload','m:jewels:init-counts'],null,g.startChannel);}f.initialize=k;});
__d("MPresenceIcon",["setTimeoutAcrossTransitions","DOM","DataStore","MRequest","MURI","Stratcom"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=0,n=1,o=2,p;function q(){var r=h.scry(document.body,'i','presence-icon'),s=[];for(var t=0,u=r.length;t<u;++t){var v=i.get(r[t]);if(v.userid&&!s[v.userid])s[v.userid]=1;}var w=new j(new k('/chat/presence_icon.php').setAsync(true).toString());w.setData({ids:Object.keys(s)});w.listen('done',function(x){for(var y=0,z=r.length;y<z;++y){var aa=i.get(r[y]);if(aa&&aa.userid&&((l.hasSigil(r[y],'online-icon'))&&(x[aa.userid]==n))||((l.hasSigil(r[y],'mobile-icon'))&&(x[aa.userid]==o))){h.show(r[y]);}else h.hide(r[y]);}});w.listen('finally',function(x){clearTimeout(p);p=g(q,m);});w.send();}m=m?m*100:60000;q();});
__d("MSwipeable",["$","CSS","DOM","Stratcom","MViewport"],function(a,b,c,d,e,f,g,h,i,j,k){var l='swipeable',m='swipedTouchable',n='swiped',o=20,p=.5,q=i.create('div'),r,s,t,u,v,w;function x(event){var ea=event.getRawEvent().targetTouches[0];return {x:ea.pageX+k.getScrollLeft(),y:ea.pageY+k.getScrollTop()};}function y(event){if(event)event.prevent();s=null;if(r){h.conditionClass(r,n,false);r=null;}if(v){v=false;i.hide(q);i.setContent(q,null);w=null;}if(t){t.remove();t=null;}if(u){u.remove();u=null;}}function z(event){y();if(event.getPrevented())return;r=event.getNode(l);if(r){s=x(event);t=j.listen('touchmove',null,aa);w=i.scry(r,'*',m)[0];}}function aa(event){if(event.getPrevented()){y();return;}var ea=x(event),fa=Math.abs(ea.x-s.x),ga=Math.abs(ea.y-s.y),ha=ga/fa;if(Math.abs(ha)>p){y();return;}event.prevent();if(fa>o){if(w){var ia=w.getBoundingClientRect(),ja=ia.top+k.getScrollTop(),ka=ia.left+k.getScrollLeft();da(0,'auto',ja+'px',0);da(ja+'px',ka+'px',ja+ia.height+'px',0);da(ja+'px','auto',ja+ia.height+'px',ka+ia.width+'px');da(ja+ia.height+'px','auto','auto',0);}v=true;ca(event);g('root').appendChild(q);i.show(q);h.conditionClass(r,n,true);t.remove();t=j.listen('touchmove',null,ca);u=j.listen('touchend',null,ba);}}function ba(event){u.remove();u=j.listen('touchend',null,y);}function ca(event){event.prevent();}function da(ea,fa,ga,ha){var ia=i.create('div',{className:'swipeableMask',style:{clip:'rect('+ea+','+fa+','+ga+','+ha+')'}});q.appendChild(ia);}j.listen('touchstart',l,z);j.listen('touchcancel',null,y);j.listen('touchend',m,y);});
__d("MobileZeroRewriteURL",["MChannelManager"],function(a,b,c,d,e,f,g){var h=null,i=null;function j(n){if(!n)return;h=n.regex_matcher;i=n.regex_replacer;for(var o=0;o<h.length;o++){var p=h[o];if(p.indexOf('^')===0)p=p.substr(1);var q=new RegExp(p,"i");h[o]=q;}g.setTransform(k);}function k(n){if(!n||!h)return n;l(n);return n;}function l(n){if(Array.isArray(n)){for(var o=0;o<n.length;o++)m(n,o);}else for(var p in n)if(n.hasOwnProperty(p))m(n,p);}function m(n,o){var p=n[o],q=typeof(p);if(q==="object"){l(p);}else if(q==="string"&&p.indexOf("<img")>=0){p=p.replace(/<img[^>]*>/gi,function(r){for(var s=0;s<h.length;s++){var t=h[s];if(t.test(r))return r.replace(t,i[s]);}return r;});n[o]=p;}}f.main=j;});