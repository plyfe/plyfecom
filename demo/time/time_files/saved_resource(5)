var _TgxAdBridgeGetSlotScript=window.TgxAdBridgeGetSlotScript;window.TgxAdBridgeGetSlotScript=function(){return"try {"+_TgxAdBridgeGetSlotScript.apply(this,arguments)+"} catch (e) { console.error(e) }"},function($){"use strict";var TimeAdFactory={},Time=window.Time||{};getParameterByName("debugads")&&localStorage&&(localStorage.debugads=getParameterByName("debugads")),getParameterByName("noads")&&localStorage&&(localStorage.noads=getParameterByName("noads")),getParameterByName("nodisplay")&&localStorage&&(localStorage.nodisplay=getParameterByName("nodisplay")),getParameterByName("notaboola")&&localStorage&&(localStorage.notaboola=getParameterByName("notaboola")),getParameterByName("testads")&&sessionStorage&&(sessionStorage.testads=getParameterByName("testads")),window.TiiAdsIsDebugMode=function(){return localStorage&&"1"===localStorage.debugads};var IS_ADS_DISABLED=!1;"undefined"==typeof TiiAdConfig&&(console.error("time-dfp -- TiiAdConfig/TGX not defined"),IS_ADS_DISABLED=!0),localStorage&&"true"===localStorage.noads&&(console.error("time-dfp -- localstorage.noads is true"),IS_ADS_DISABLED=!0),window.TGX_SITE_CONFIG={gpt_sync_mode:"async",refresh_oop_slot:!0};var size,pushdown_timeout_notHeader,pushdown_timeout_viewport,prevent_pointer_event_timeout,ad_shield_event_timeout,adFactory,cmAd,current_page_type,doc=document,$window=$(window),window_app_height=$window.height(),window_app_width=$window.width(),$html=$("html"),$body=$html.find("body"),ad_sizes={desktop:{"homepage-pushdown":["101x1","970x1","970x66","970x90","970x250"],pushdown:["101x1","970x66","970x90","970x250","970x418","994x250"],navigation:["900x250","900x500","970x418","1024x768"],"homepage-content-well":["900x250","900x500","970x418","994x250"],"homepage-cm-banner":["268x54"],"ad-divider":["300x251","450x375","728x90","900x250","900x500","970x418","994x250"],"collection-ad-divider":["300x251","450x375","728x90","900x250","900x500","970x418","994x250"],"left-rail":["300x250"],sub:["300x50","320x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["728x90","900x250","900x500","970x418","994x250"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["728x90","900x250","900x500","970x418","994x250"],"special-article-banner":["101x1","728x90","970x1","970x66","970x250"],"collection-logo":["88x31"],"money-homepage-content-well":["300x251","728x90","900x250","900x500","970x418","994x250"],"money-homepage-right-rail":["300x250","300x600"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["155x30","170x30"],"topic-logo":["170x30","300x50"],"right-rail":["120x60"],nativo:["320x80"]},tablet:{pushdown:["101x1","970x66","970x90","970x250"],"homepage-content-well":["450x375","300x251"],"homepage-cm-banner":["268x54"],"ad-divider":["450x375","300x251"],"collection-ad-divider":["450x375","300x251"],"left-rail":["300x250"],sub:["320x50","300x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["450x375","300x251"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["300x250"],"special-article-banner":["320x50"],"collection-logo":["88x31"],"money-homepage-content-well":["450x375","300x251"],"money-homepage-right-rail":["300x250"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["170x30","155x30"],"topic-logo":["170x30","300x50"],"right-rail":["120x60"],nativo:["320x80"]},mobile:{"article-top-ad":["300x50","320x50"],"sub-cm":["300x50"],"homepage-content-well":["300x50","320x50","300x250","320x240"],"homepage-cm-banner":["300x50","320x50"],"ad-divider":["300x50","320x50","300x250","320x240"],"collection-ad-divider":["300x50","320x50","300x250","320x240"],"left-rail":["300x50","320x50","300x250","320x240"],sub:["300x50","320x50"],"in-article":["300x250"],list:["300x50","320x50","300x250","320x240"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250"],"special-article-large":["300x250","320x50"],"special-article-banner":["300x50","320x50"],"collection-logo":["88x31"],"money-homepage-top":["300x50","320x50"],"money-homepage-content-well":["300x50","320x50","300x250","320x240"],"money-homepage-right-rail":["300x250"],"market-data-sponsor":["170x30","155x30"],"topic-logo":["170x30","300x50"],nativo:["320x80"]}},left_rail_ad_timeout={},display_ad_timeouts={},$content_rail_ad_el_divs={},$left_rail_ad_el_divs={},$ad_left_rail_placeholders={},$article_viewport=$body.find(".article-viewport"),$rail_scroll=$body.find(".rail-articles-scroll"),article_viewport_el=$article_viewport.get(0),$notTheHeader=$body.find("#notTheHeader"),$pushdown_ad=$body.find("#pushdown-ad"),$left_rail=$body.find(".left-rail").eq(0),$left_rail_topper=$body.find(".left-rail-topper").eq(0),$top_banner=$body.find(".top-banner"),top_banner_height=$top_banner.eq(0).height(),ad_left_rail_binded_events={},ad_content_rail_binded_events={},device=Time.device,is_ie=$.browser.msie,is_greater_than_ie_11=is_ie&&parseInt($.browser.version,10)>=11,is_webkit_or_ie_11=$.browser.webkit||is_greater_than_ie_11,is_ff=$.browser.mozilla,is_pc=-1!==navigator.appVersion.indexOf("Win"),pushdown_ping_height_change=!0,article_viewport_el_top=0,initial_left_rail_load=!0,disable_pointer_events=!1,ad_shield_on=!1,current_ad_zone="",ad_zone_has_changed=!0,is_tablet_portrait_mode="tablet"===device&&window_app_height>window_app_width,is_tablet_landscape_mode="tablet"===device&&window_app_width>window_app_height,is_left_rail_ad_expandable="desktop"===device?!0:!1,can_have_pushdown_ad="desktop"===device||is_tablet_landscape_mode,initial_app_load=!0,initial_ad_page_load=!0,article_sub_ad_render=!1,section_sub_ad_render=!1,pushdown_rendered=!1,time_authenticated=1===Time.authenticated?!0:!1,nativo_initial_tile_placement=5,nativo_index=1,can_re_render_nativo=!0,current_nativo_id=1e3,nativo_tile_placement_rate=10,nativo_tile_placement=nativo_initial_tile_placement,is_topic=function(){var $topic=$left_rail_topper.find("#topic");return $topic.length&&$topic.hasClass("active")},page_type=function(){var type=Time.application.active_route&&"rail"===Time.application.active_route?"article":Time.application.active_route;return is_topic()&&(type="topic"),type},in_content_well_viewport=function($el,partial){if($el.length<=0)return!1;var content_well_top=top_banner_height,content_well_bottom=window_app_height,el_rect=$el.get(0)?$el.get(0).getBoundingClientRect():!1,el_top=el_rect?el_rect.top-400:0,el_bottom=el_rect?el_rect.bottom:0;return partial?content_well_top>el_top&&el_bottom>content_well_top||el_top>content_well_top&&content_well_bottom>=el_top:el_top>=content_well_top&&content_well_bottom>=el_bottom},get_page_data=function(model){var page_data={$el:$("#article-"+model.get("id")).eq(0),title:model.get("title"),url:model.get("url"),format:model.get("format"),section:model.get("section")?model.get("section").name:null,magazine_article:model.get("magazine_article")?!0:!1,paid:model.get("paid")?!0:!1,id:model.get("id"),list_items:model.get("list_items")?model.get("list_items").length:0,neg:model.get("ads")?model.get("ads").neg:!1},modules=model.get("omniture")&&model.get("omniture").modules,right_rail_ad_id="right-rail-ad-"+page_data.id;return model.collection&&(page_data.env=model.collection.active_env,model.collection.sub&&(page_data.sub=model.collection.sub)),modules&&-1!==modules.indexOf("rr-ad")&&(page_data.right_rail_ad_id=right_rail_ad_id),page_data},get_active_rail=function(){return Time.application&&Time.application.active_rail?Time.application.active_rail:Time.application.visible_rail?Time.application.visible_rail:!1},get_active_article_id=function(){var active_rail=get_active_rail();return active_rail&&Time.application.model.get("activeArticle")?Time.application.model.get("activeArticle").get("id"):active_rail&&active_rail.models[0]?active_rail.models[0].id:Time.bootstrap.single_article?Time.bootstrap.single_article.id:active_rail.visible_article?active_rail.visible_article.get("id"):TIME_DFP.aid?TIME_DFP.aid:TIME_DFP.params&&TIME_DFP.params.aid?TIME_DFP.params.aid:!1},init_nativo=function(){var rand=1e9*Math.random(),ntvInit=doc.createElement("script"),root=doc.body.getElementsByTagName("script")[0],Nativo=window.top.Nativo=window.top.Nativo||{},articleUUID=getParameterByName("ntv_a");Nativo.pageURL="http://time.com",ntvInit.type="text/javascript",""!==articleUUID?(ntvInit.src="http://adserve.postrelease.com/index.js?async=true&prx_url="+Nativo.pageURL+"&ntv_a="+articleUUID+"&rand="+rand,add_nativo_articles_archive_ready_event()):(ntvInit.src="http://adserve.postrelease.com/init.js?async=true&ntv_m=3&prx_url="+Nativo.pageURL+"&rand="+rand,add_nativo_articles_touts_ready_event()),root.parentNode.insertBefore(ntvInit,root)},add_nativo_articles_touts_ready_event=function(){Nativo.onArticlesReady=function(response){var article_data=response.articles?response.articles[0]:{},nativo_article_data=get_nativo_article_data(article_data),active_rail=get_active_rail();!_.isEmpty(nativo_article_data)&&active_rail&&(nativo_article_data.placement=active_rail.at(0).get("sponsor")?nativo_tile_placement-1:nativo_tile_placement,nativo_article_data.is_nativo_page=!1,active_rail.add(nativo_article_data)),update_nativo_placement()}},add_nativo_articles_archive_ready_event=function(){Nativo.onArticlesReady=function(response){var active_rail=get_active_rail(),nativo_articles=_.map(response.articles,function(article){var nativo_article_data=get_nativo_article_data(article);return nativo_article_data.is_nativo_page=!0,nativo_article_data});active_rail&&(active_rail.add(nativo_articles),active_rail.reached_page_limit())}},get_nativo_article_data=function(nativo_data){var nativo_title,nativo_headline,nativo_content,nativo_id,nativo_key,nativo_preview_image,nativo_preview_text,nativo_relative_url,nativo_advertiser_url,nativo_advertiser_logo,nativo_advertiser_name,nativo_time,nativo_date,nativo_encoded_title,nativo_encoded_url,url,id,advertiser_slug_name,url_article_slug,pretty_time,published_date,nativo_article_data={};return _.isEmpty(nativo_data)||(nativo_title=nativo_data.article_title,nativo_headline=nativo_data.preview_headline,nativo_content=nativo_data.article,nativo_id=nativo_data.article_id,nativo_key=nativo_data.article_key,nativo_preview_image=nativo_data.preview_image,nativo_preview_text=nativo_data.preview_text,nativo_relative_url=nativo_data.article_relative_url,nativo_advertiser_url=nativo_data.advertiser_url,nativo_advertiser_logo=nativo_data.advertiser_logo,nativo_advertiser_name=nativo_data.advertiser_name,nativo_time=nativo_data.article_time,nativo_date=nativo_data.article_date,current_nativo_id&&(id="s"+current_nativo_id),current_nativo_id+=1,nativo_advertiser_name&&(advertiser_slug_name=clean_ad_key_value(nativo_advertiser_name)),nativo_title&&(nativo_encoded_title=encodeURIComponent(nativo_title)),nativo_id&&nativo_relative_url&&advertiser_slug_name&&(url_article_slug=nativo_relative_url.split("/").splice(2).join("/"),url=Time.home_url+"content-from/"+advertiser_slug_name+"/"+id+"/"+url_article_slug,nativo_encoded_url=encodeURIComponent(url)),nativo_date&&nativo_time&&(pretty_time=nativo_date+" "+nativo_time,published_date=nativo_date+" "+nativo_time),nativo_article_data.title=nativo_title,nativo_article_data.short_title=nativo_headline,nativo_article_data.content=nativo_content,nativo_article_data.nativo_id=nativo_id,nativo_article_data.id=id,nativo_article_data.format="article",nativo_article_data.email_title="nativo_headline",nativo_article_data.email_body=nativo_preview_text,nativo_article_data.nativo_key=nativo_key,nativo_article_data.nativo_preview_image=nativo_preview_image,nativo_article_data.nativo_preview_text=nativo_preview_text,nativo_article_data.twitter_text=nativo_headline,nativo_article_data.encoded_shortlink=url,nativo_article_data.url=url,nativo_article_data.twitter_via=Time.branding.toUpperCase(),nativo_article_data.encoded_url=nativo_encoded_url,nativo_article_data.encoded_title=nativo_encoded_title,nativo_article_data.is_nativo=!0,nativo_article_data.sponsor={url:nativo_advertiser_url,name:nativo_advertiser_name,color:"",slug:advertiser_slug_name,thumbnail:nativo_advertiser_logo},nativo_article_data.time={pretty:pretty_time,published:published_date,updated:"",minute:"","short":""}),console.dir(nativo_article_data),nativo_article_data},update_nativo_placement=function(){nativo_tile_placement+=nativo_tile_placement_rate},reset_nativo_placement=function(){nativo_tile_placement=nativo_initial_tile_placement,nativo_index=1},render_nativo_tile=function(){if(IS_ADS_DISABLED)return void console.debug("IS_ADS_DISABLED is TRUE",arguments);if(can_re_render_nativo){current_page_type=page_type();var no_nativo_pages=["collection","videos","nativo","magazine","sponsor","topic"];_.contains(no_nativo_pages,current_page_type)||(initial_ad_page_load||delete_ad("nativo-trigger"),Time.trigger("dfpAdManager:activateAd",null,{id:"nativo-trigger",size:size.nativo,position:nativo_index,isTrigger:!0,group:"nativo"},function(){Time.trigger("dfpAdManager:displayTrigger",null,["nativo-trigger"])}),nativo_index+=1,can_re_render_nativo=!1)}else setTimeout(function(){render_nativo_tile()},2500)},get_nativo_placement_rate=function(){return nativo_tile_placement_rate},get_nativo_initial_tile_placement=function(){return nativo_initial_tile_placement},render_ad=function(ad_placeholder_id,size,pos){Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size,position:pos})},render_cmAd=function(ad_placeholder_id,size,pos,type){if(IS_ADS_DISABLED)return void console.debug("IS_ADS_DISABLED is TRUE",arguments);var dim,$ad_el_divs_obj,$el=$("#"+ad_placeholder_id);return $el.length?($ad_el_divs_obj=-1!==ad_placeholder_id.indexOf("sub-ad")?$left_rail_ad_el_divs:$content_rail_ad_el_divs,$ad_el_divs_obj[ad_placeholder_id]=$el,dim=size[0].split("x"),console.log("ad.write this cm ad: "+ad_placeholder_id+" for "+type+" in these sizes "+size+" at this position "+pos),cmAd=adFactory.getCmAd(dim[0],dim[1],pos,type),size.length>1&&cmAd.setParam("sz",size.join(",")),cmAd.setParam("ad_div",ad_placeholder_id),$el.data("zone",adFactory.zone),void cmAd.write(ad_placeholder_id)):!1},delete_ad=function(ad_placeholder_id,is_left_rail_ad){console.debug("---- DELETE AD "+ad_placeholder_id),is_left_rail_ad?remove_pre_render_left_rail_ad_events(ad_placeholder_id):remove_pre_render_content_rail_ad_events(ad_placeholder_id),Time.trigger("dfpAdManager:deleteAd",ad_placeholder_id)},delete_left_rail_ad=function(ad_placeholder_id){console.log("deleting left rail ad "+ad_placeholder_id),delete_ad(ad_placeholder_id,!0)},display_ads=function(arr_ids,display_immediately){if(console.debug("---- OLD DISPLAY_ADS"),IS_ADS_DISABLED)return console.debug("-- IS_ADS_DISABLED is TRUE",arguments),!1;if("true"===localStorage.nodisplay)return!1;if(arr_ids.length>0){console.debug("-- displaying ads ",arr_ids,display_immediately);var articleModel=Time.application.model.get("activeArticle");Time.trigger("dfpAdManager:refreshAds",articleModel,arr_ids,display_immediately)}else console.debug("-- no ads to display")},get_$ad_el_div=function(ad_placeholder_id){var $ad_el_divs_obj,$ad_div;return $ad_el_divs_obj=-1!==ad_placeholder_id.indexOf("ad-unit")||-1!==ad_placeholder_id.indexOf("sub-ad")?$left_rail_ad_el_divs:$content_rail_ad_el_divs,$ad_el_divs_obj[ad_placeholder_id]?$ad_el_divs_obj[ad_placeholder_id]:($ad_div=$("#"+ad_placeholder_id),$ad_div.length?($ad_el_divs_obj[ad_placeholder_id]=$ad_div,$ad_div):!1)},get_$ad_left_rail_placeholder=function(ad_spacer_id){var $ad_spacer;return $ad_left_rail_placeholders[ad_spacer_id]?$ad_left_rail_placeholders[ad_spacer_id]:($ad_spacer=$("#"+ad_spacer_id),$ad_spacer.length?($ad_left_rail_placeholders[ad_spacer_id]=$("#"+ad_spacer_id),$ad_spacer):!1)},adding_pre_render_ad_events=function(ad_placeholder_id,$rail,data,handler,ad_location){var ad_bind_event_obj;ad_bind_event_obj="left-rail"===ad_location?ad_left_rail_binded_events:"content-rail"===ad_location?ad_content_rail_binded_events:ad_content_rail_binded_events,console.log("binding event handlers for "+ad_placeholder_id),console.log("\n"),$rail.bind("scroll."+ad_placeholder_id,data,handler),ad_bind_event_obj["scroll."+ad_placeholder_id]=$rail,$notTheHeader.bind("scroll."+ad_placeholder_id+"_notTheHeader",data,handler),ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]=$notTheHeader,$window.bind("resize."+ad_placeholder_id,data,handler),ad_bind_event_obj["resize."+ad_placeholder_id]=$window,"tablet"===device&&($window.bind("orientationchange."+ad_placeholder_id,data,handler),ad_bind_event_obj["orientationchange."+ad_placeholder_id]=$window)},adding_pre_render_left_rail_ad_events=function(ad_placeholder_id,$rail,data,handler){adding_pre_render_ad_events(ad_placeholder_id,$rail,data,handler,"left-rail")},adding_pre_render_content_rail_ad_events=function(ad_placeholder_id,$rail,data,handler){adding_pre_render_ad_events(ad_placeholder_id,$rail,data,handler,"content-rail")},remove_pre_render_events=function(ad_placeholder_id,ad_location){console.log("removing ad events for "+ad_placeholder_id),console.log("");var ad_bind_event_obj;ad_bind_event_obj="left-rail"===ad_location?ad_left_rail_binded_events:"content-rail"===ad_location?ad_content_rail_binded_events:ad_content_rail_binded_events,ad_bind_event_obj["scroll."+ad_placeholder_id]&&(ad_bind_event_obj["scroll."+ad_placeholder_id].unbind("scroll."+ad_placeholder_id),delete ad_bind_event_obj["scroll."+ad_placeholder_id]),ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]&&(ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"].unbind("scroll."+ad_placeholder_id+"_notTheHeader"),delete ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]),ad_bind_event_obj["resize."+ad_placeholder_id]&&(ad_bind_event_obj["resize."+ad_placeholder_id].unbind("resize."+ad_placeholder_id),delete ad_bind_event_obj["resize."+ad_placeholder_id]),"tablet"===device&&ad_bind_event_obj["orientationchange."+ad_placeholder_id]&&(ad_bind_event_obj["orientationchange."+ad_placeholder_id].unbind("orientationchange."+ad_placeholder_id),delete ad_bind_event_obj["orientationchange."+ad_placeholder_id])},remove_pre_render_left_rail_ad_events=function(ad_placeholder_id){remove_pre_render_events(ad_placeholder_id,"left-rail")},remove_pre_render_content_rail_ad_events=function(ad_placeholder_id){remove_pre_render_events(ad_placeholder_id,"content-rail")},clear_bind_events_maker=function(bind_events_obj){return function(){var prop;for(prop in bind_events_obj)bind_events_obj.hasOwnProperty(prop)&&(bind_events_obj[prop].unbind(prop),delete bind_events_obj[prop])}},clear_timeout_maker=function(timeout_obj){return function(){var prop;for(prop in timeout_obj)timeout_obj.hasOwnProperty(prop)&&(clearTimeout(timeout_obj[prop]),delete timeout_obj[prop])}},clear_content_rail_bind_events=clear_bind_events_maker(ad_content_rail_binded_events),clear_left_rail_bind_events=clear_bind_events_maker(ad_left_rail_binded_events),clear_left_rail_timeouts=clear_timeout_maker(left_rail_ad_timeout),clear_display_ads_timeouts=clear_timeout_maker(display_ad_timeouts),remove_left_rail_ads=function(){console.debug("-- removing left rail ads");for(var prop in $left_rail_ad_el_divs)if($left_rail_ad_el_divs.hasOwnProperty(prop)){-1===prop.indexOf("ad-unit")?(console.debug("-- removing this from $left_rail_ad_el_divs: "+prop),$left_rail_ad_el_divs[prop].empty()):(console.debug("-- removing "+prop),$left_rail_ad_el_divs[prop].remove(),$("#"+prop).remove());try{delete $left_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){console.error("time-dfp -- remove_ads - couldn't delete "+prop)}Time.trigger("dfpAdManager:deleteAd",prop)}if(section_sub_ad_render=!1,article_sub_ad_render=!1,is_left_rail_ad_expandable)for(var prop2 in $ad_left_rail_placeholders)if($ad_left_rail_placeholders.hasOwnProperty(prop2)){console.log("removing this from $ad_left_rail_placeholders: "+prop2);try{delete $ad_left_rail_placeholders[prop2]}catch(e){console.error("time-dfp -- remove_ads - couldn't delete "+prop2)}Time.trigger("dfpAdManager:deleteAd",prop2)}},remove_ads=function(){var prop;if(initial_app_load)return!1;clear_left_rail_bind_events(),clear_left_rail_timeouts(),clear_content_rail_bind_events(),remove_left_rail_ads(),clear_display_ads_timeouts(),Time.trigger("dfpAdManager:removeAds"),pushdown_rendered&&($pushdown_ad.empty(),pushdown_rendered=!1);for(prop in $content_rail_ad_el_divs)try{delete $content_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){console.error("time-dfp -- remove_ads - couldn't delete "+prop)}},clean_ad_key_value=function(value){return value.replace(/[^\w,]/g,"").toLowerCase()},get_adFactory_data=function(model){if(!model)return!1;var adFactory_data={},type=Time.application.active_route&&"rail"===Time.application.active_route?"article":Time.application.active_route;return adFactory_data.params={},model.get("section")&&model.get("section").name?(adFactory_data.params.ch=model.get("section").name,adFactory_data.zone=adFactory_data.params.ch):(adFactory_data.zone="",adFactory_data.params.ch=""),adFactory_data.zone=model.get("collection_meta")?/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?"money/collections/"+model.get("collection_meta").ad_zone:"collections/"+model.get("collection_meta").ad_zone:/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?"money/"+adFactory_data.params.ch:adFactory_data.params.ch,model.get("format")&&(adFactory_data.params.ctype=model.get("format")),model.get("id")&&(adFactory_data.params.aid=model.get("id")),model.get("ads")&&(adFactory_data.params.neg=model.get("ads").neg),model.get("tags")&&(adFactory_data.params.tags=clean_ad_key_value(model.get("tags").replace(/\|/g,","))),model.get("topic")&&model.get("topic").slug&&(adFactory_data.params.topic=clean_ad_key_value(model.get("topic").slug)),model.get("hub_meta")&&(adFactory_data.params.subch=model.get("hub_meta").slug),model.get("is_nativo")&&model.get("sponsor")&&model.get("sponsor").slug&&(adFactory_data.params.spons=clean_ad_key_value(model.get("sponsor").slug)),is_topic()?adFactory_data.params.ptype="topic":Time.application.active_route&&(adFactory_data.params.ptype=type),adFactory_data.url=model.get("url"),adFactory_data},ad_leveling=function($ad,ad_initial_offset,data){var active_rail=get_active_rail(),rail=data.rail;if(rail!==active_rail)return console.log("the rail that was being pass by ad_leveling is not the same as the active_rail"),!1;var $rail=rail.view.$scroll_container,rail_height=Time.application.left_rail_height,rail_bottom=Time.application.left_rail_bottom,ad_rect=$ad.get(0).getBoundingClientRect(),ad_top=ad_rect.top,ad_height=ad_rect.height,ad_shown=rail_bottom-ad_top,ad_left=ad_height-ad_shown,ad_faction_shown=ad_shown/ad_height,scroll_diff=ad_initial_offset-ad_top;return ad_height>271&&console.log("ad is not around 260px"),1.5*ad_height>rail_height&&console.log("the left rail is not 1.5x the size of the ad "),ad_height>271||1.5*ad_height>rail_height?!1:(ad_faction_shown>.2&&1>ad_faction_shown&&(scroll_diff>0&&140>=scroll_diff?(console.log("moving ad "+ad_left),$rail.animate({scrollTop:$rail.scrollTop()+ad_left},500)):(Time.application.model.get("isRailOpen")&&($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),console.log("user has been scrolling or its already in display"))),void console.log("\n"))},binding_ad_leveling=function(ad_placeholder_id,data){var $ad_placeholder_id=data.$ad_placeholder_id,initial_offset_top=$ad_placeholder_id.get(0).getBoundingClientRect().top;console.log("binding ad_leveling event for "+ad_placeholder_id),console.log("\n"),left_rail_ad_timeout[ad_placeholder_id]=setTimeout(function(){ad_leveling($ad_placeholder_id,initial_offset_top,data)},3500)},content_well_ad_sync=function(ad_placeholder_id,display_immediately){var activate_model,modules,right_rail_ad_id,ads=[],active_article_id=get_active_article_id(),active_rail=get_active_rail();Time.application.model.get("isRailOpen")&&(ads=push_visible_left_rail_ads_to_arr(ads),initial_ad_page_load&&can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad"))),ads.push(ad_placeholder_id),active_article_id&&active_rail&&(activate_model=active_rail.get(active_article_id),modules=activate_model.get("omniture")&&activate_model.get("omniture").modules,modules&&-1!==modules.indexOf("rr-ad")&&(right_rail_ad_id="right-rail-ad-"+active_article_id,tgxDo.slots[right_rail_ad_id]&&ads.push(right_rail_ad_id))),console.debug("time-dfp -- content_well_ad_sync -- display_ads",ads),display_ads(ads,display_immediately)},push_visible_left_rail_ads_to_arr=function(ads){console.debug("push_visible_left_rail_ads_to_arr ------");var $sub_ad_unit,active_rail=get_active_rail(),sub_ad_unit=null,sub_ad_size=null;console.debug("-- left rail ad divs",$left_rail_ad_el_divs);var $visibleLeftRailAds=active_rail.view.getAdsInViewport();return console.debug("-- got these ads in viewport",$visibleLeftRailAds),$.each($visibleLeftRailAds,function(i,d){var left_rail_id=$(d).attr("id"),is_ad_unit_ad=-1!==left_rail_id.indexOf("ad-unit"),ad_placeholder_id=is_left_rail_ad_expandable&&is_ad_unit_ad?left_rail_id+"_ad":left_rail_id,this_ad_zone=$("#"+ad_placeholder_id).data("zone"),pos=$(d).data("pos");is_ad_unit_ad&&!$(d).hasClass("collapsed")&&(console.debug("-- the ad_placeholder_id: "+ad_placeholder_id),console.debug("-- the $(d).data(zone): "+this_ad_zone),console.debug("-- the current_ad_zone: "+current_ad_zone),tgxDo.slots[ad_placeholder_id]&&this_ad_zone!==current_ad_zone&&current_ad_zone.length>0&&!initial_left_rail_load||!this_ad_zone&&!initial_left_rail_load?(delete_left_rail_ad(ad_placeholder_id),ad_zone_has_changed=!0,Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["left-rail"],position:pos,group:"leftRail"}),console.debug("-- changing the zone to "+this_ad_zone)):ad_zone_has_changed=!1,console.debug("-- this left rail ad unit is in view "+ad_placeholder_id+" and being pushed into the ad queue"),remove_pre_render_left_rail_ad_events(ad_placeholder_id),ads.push(ad_placeholder_id))}),"article"!==current_page_type&&"popular"!==current_page_type&&"videos"!==current_page_type||"mobile"===device?"section"===current_page_type&&(sub_ad_unit="section-sub-ad",sub_ad_size="sub"):(sub_ad_unit="sub-ad",sub_ad_size="sub-cm"),console.debug("-- find subads, delete if not in zone, re-ad.write if needed"),sub_ad_unit&&($sub_ad_unit=get_$ad_el_div(sub_ad_unit),(tgxDo.slots[sub_ad_unit]&&$sub_ad_unit.data("zone")!==current_ad_zone&&current_ad_zone.length>0&&!initial_left_rail_load||!$sub_ad_unit.data("zone")&&!initial_left_rail_load)&&($sub_ad_unit.empty(),delete tgxDo.slots[sub_ad_unit],"sub-ad"===sub_ad_unit?render_sub_cm_ad(sub_ad_unit):Time.trigger("dfpAdManager:activateAd",null,{id:sub_ad_unit,size:size[sub_ad_size],position:1,group:"subscription",subgroup:"top"}),ad_zone_has_changed=!0),ads.push(sub_ad_unit)),console.debug("-------- push_visible_left_rail_ads_to_arr"),ads},reload_left_rail_ads=function(){console.debug("reloading visible ads on the left rail");var ads=[];ads=push_visible_left_rail_ads_to_arr(ads),ad_zone_has_changed||initial_left_rail_load?(console.debug("time-dfp -- reload_left_rail_ads -- display_ads",ads),display_ads(ads)):(console.debug("time-dfp -- reload_left_rail_ads -- display_ads",ads),display_ads(ads,!0)),ad_zone_has_changed=!1},left_rail_ad_handler=function(e){var data=e.data,rail=data.rail,pos=data.pos,ad_placeholder_id=data.ad_placeholder_id,$ad_placeholder_id=$("#"+ad_placeholder_id),the_ad_id=is_left_rail_ad_expandable?ad_placeholder_id+"_ad":ad_placeholder_id,active_rail=get_active_rail();return rail!==active_rail?(console.log("the rail that was being pass by left_rail_ad_handler is not the same as the active_rail"),console.log("unbinding the handler"),remove_pre_render_left_rail_ad_events(ad_placeholder_id),!1):void(rail.view.isAdInViewport($ad_placeholder_id,!0)&&(console.log(ad_placeholder_id+" is view with pos "+pos),remove_pre_render_left_rail_ad_events(ad_placeholder_id),$ad_placeholder_id.data("zone")===current_ad_zone?(console.debug("time-dfp -- left_rail_ad_handler -- display_ads",the_ad_id),display_ads([the_ad_id],!0)):(delete_left_rail_ad(the_ad_id),Time.trigger("dfpAdManager:activateAd",null,{id:the_ad_id,size:size["left-rail"],position:pos,group:"leftRail"},!0)),"desktop"===device&&binding_ad_leveling(ad_placeholder_id,data)))},content_well_ad_handler=function(e){var data=e.data,ad_placeholder_id=data.ad_placeholder_id,$ad_placeholder_id=$("#"+ad_placeholder_id),ad_sizes=data.ad_sizes,pos=data.pos?data.pos:1,id=data.id,active_article_id=get_active_article_id();(in_content_well_viewport($ad_placeholder_id,!0)||initial_left_rail_load)&&active_article_id===id&&(console.debug("-- content well ad "+ad_placeholder_id+" in sight and active article id is "+id),Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:ad_sizes,position:pos,group:"contentWell"}),remove_pre_render_content_rail_ad_events(ad_placeholder_id),console.debug("-- doing an ad sync for "+id),content_well_ad_sync(ad_placeholder_id,!0))},init=function(){console.debug("---- TIME-DFP INIT ----"),localStorage&&"1"===localStorage.debugads?$html.addClass("debugads"):$html.removeClass("debugads"),$body.addClass("hasAd"),is_left_rail_ad_expandable&&$body.addClass("expandable-ad-enable"),$window.on("resize",function(){window_app_height=$window.height(),window_app_width=$window.width(),top_banner_height=$top_banner.eq(0).height(),Time.application.model.set("isRailOpen",$left_rail.offset().left>=0),Time.application.model.get("isRailOpen")||$(".scroll-for-more").hide()}),$window.on("orientationchange",function(){window_app_height=$window.height(),window_app_width=$window.width(),is_tablet_portrait_mode="tablet"===device&&window_app_height>window_app_width,Time.application.set_left_rail_bounds(),is_tablet_portrait_mode?(size=ad_sizes.mobile,$(".scroll-for-more").hide(),Time.application.model.get("isRailOpen")||$(".scroll-for-more").hide()):size=ad_sizes.tablet}),$window.on("offscreen",function(e,data){var $ad,$ad_height,model=data.model,$el=data.$el,id=model.get("id"),list_ads=data?model.list_ads:!1,list_ads_length=list_ads?list_ads.length:0,i=0,paid=model.get("paid")?!0:!1,right_rail_ad_id="right-rail-ad-"+id;if(list_ads)for(i=0;list_ads_length>i;i+=1)$ad=get_$ad_el_div(list_ads[i]),$ad_height=$ad.height(),$ad.length&&$ad_height&&($ad.css({height:$ad_height}),delete_ad(list_ads[i]));right_rail_ad_id&&($ad=get_$ad_el_div(right_rail_ad_id),$ad.length&&($ad.css({height:$ad.height()}),delete_ad(right_rail_ad_id))),paid&&!time_authenticated&&($el.addClass("rendered-cm-ad-module-removed"),delete_ad("magazine-cm-module-"+id))}),$window.on("onscreen",function(e,data){var list_ad_placeholder_id,$list_ad_placeholder_id,model=data.model,id=model.get("id"),list_ads=model.list_ads?model.list_ads:!1,list_ads_length=list_ads?list_ads.length:0,i=0,list_ad_data={id:id},modules=model.get("omniture")&&model.get("omniture").modules,right_rail_ad_id="right-rail-ad-"+id;if(list_ads&&!initial_left_rail_load)for(i=0;list_ads_length>i;i+=1)list_ad_placeholder_id=list_ads[i],tgxDo.slots[list_ad_placeholder_id]||($list_ad_placeholder_id=get_$ad_el_div(list_ad_placeholder_id),list_ad_data.pos=$list_ad_placeholder_id.attr("pos"),list_ad_data.ad_placeholder_id=list_ad_placeholder_id,render_list_ad(list_ad_data));modules&&-1!==modules.indexOf("rr-ad")&&render_right_rail_ad(right_rail_ad_id,id)}),is_webkit_or_ie_11||is_pc&&is_ff?$window.bind("mousewheel.disable-pointer-events",function(){clearTimeout(prevent_pointer_event_timeout),disable_pointer_events||(disable_pointer_events=!0,$body.addClass("disable-pointer-events")),prevent_pointer_event_timeout=setTimeout(function(){disable_pointer_events&&(disable_pointer_events=!1,$body.removeClass("disable-pointer-events"))
},300)}):is_greater_than_ie_11||($rail_scroll.bind("scroll.ad-shield",function(){clearTimeout(ad_shield_event_timeout),ad_shield_on||(ad_shield_on=!0,$body.addClass("ad-shield-on")),ad_shield_event_timeout=setTimeout(function(){ad_shield_on&&(ad_shield_on=!1,$body.removeClass("ad-shield-on"))},500)}),$window.bind("scroll.ad-shield, mousewheel.ad-shield",function(){clearTimeout(ad_shield_event_timeout),$body.hasClass("ad-shield-on")||$body.addClass("ad-shield-on"),ad_shield_event_timeout=setTimeout(function(){$body.removeClass("ad-shield-on")},500)})),is_left_rail_ad_expandable&&($rail_scroll.bind("scroll.expandable",update_left_rail_ads_pos),$notTheHeader.bind("scroll.expandable",update_left_rail_ads_pos),$left_rail.bind("scroll.expandable",update_left_rail_ads_pos),$window.bind("resize.expandable",update_left_rail_ads_pos),$pushdown_ad.bind("pushdown_height_change.expandable",update_left_rail_ads_pos)),can_have_pushdown_ad&&($notTheHeader.bind("scroll.pushdown_ad",function(){in_content_well_viewport($pushdown_ad,!0)||in_content_well_viewport($pushdown_ad)?pushdown_ping_height_change===!1&&(console.log("starting ping"),pushdown_ping_height_change=!0,detect_pushdown_pushing_event()):(pushdown_ping_height_change===!0&&(console.log("removing ping"),pushdown_ping_height_change=!1),clearInterval(pushdown_timeout_notHeader))}),$article_viewport.bind("scroll.pushdown_ad",function(){in_content_well_viewport($pushdown_ad,!0)&&(pushdown_ping_height_change=!0,detect_pushdown_pushing_event())}))},activate_ads=function(article_model){if(console.debug("-------- ACTIVATE_ADS --------",article_model),IS_ADS_DISABLED)return void console.debug("-- IS_ADS_DISABLED is TRUE",arguments);var page_data=get_page_data(article_model),format=page_data.format,url=page_data.url,title=page_data.title,article_id=page_data.id,$el=page_data.$el,right_rail_ad_id=page_data.right_rail_ad_id,paid=page_data.paid,active_rail=get_active_rail(),ads=[],list_ads_length=article_model.list_ads?article_model.list_ads.length:0,list_ads=list_ads_length?article_model.list_ads:[],i=0;if(current_page_type=page_type(),console.debug("-- activate_ads"),console.debug("-- current page template is "+current_page_type),console.debug("-- current content type is "+format),console.debug("-- current page url is "+url.replace("http://","")),console.debug("-- current page title is "+title),console.debug("-- current page article_id is "+article_id),console.debug("-- is paid content "+paid),console.debug("-- current device type is "+device),console.debug("-- using this ad server: "+adFactory.sitename),console.debug("-- current page_data",page_data),console.debug("-- factory",adFactory),paid&&!time_authenticated&&($el.hasClass("rendered-cm-ad")?$el.hasClass("rendered-cm-ad-module-removed")&&($el.removeClass("rendered-cm-ad-module-removed"),render_magazine_cm_module("magazine-cm-module-"+article_id),display_ads(["magazine-cm-module-"+article_id])):($el.addClass("rendered-cm-ad"),render_magazine_cm_ads(article_id),display_magazine_cm_ads(article_id))),console.debug("-- TIM-192 top ad"),"mobile"===device&&"videos"!==Time.application.active_route&&"collection"!==Time.application.active_route&&initial_ad_page_load&&($("<div />",{id:"article-top-ad"}).prependTo(".article-viewport"),Time.trigger("dfpAdManager:activateAd",null,{id:"article-top-ad",size:size["article-top-ad"],position:1,group:"mobileTopAd",subgroup:"article",isMobileOnly:!0,renderOnce:!0}),ads.push("article-top-ad")),"article"===current_page_type||"popular"===current_page_type||"videos"===current_page_type?(console.debug("-- article, render_sub_cm_ads"),article_sub_ad_render||(render_sub_cm_ad("sub-ad"),article_sub_ad_render=!0)):"section"===current_page_type&&(console.debug("-- section, section sub ads"),section_sub_ad_render||(Time.trigger("dfpAdManager:activateAd",null,{id:"section-sub-ad",size:size.sub,position:1,group:"subscription",subgroup:"section"}),section_sub_ad_render=!0)),initial_left_rail_load&&"mobile"===device&&Time.application.model.get("isRailOpen"))console.debug("------ mobile initial left rail load, activate left rail ads"),activate_left_rail_ads();else if(initial_left_rail_load&&"mobile"!==device||initial_left_rail_load&&"mobile"!==device&&!Time.application.model.get("isRailOpen")&&"collection"!==current_page_type){if(console.debug("------ initial left rail load, ad.write left rail ads"),console.debug("-- checking for left rail ad units"),$body.find(".ad-unit").each(function(){var data,$ad_placeholder_id=$(this),ad_placeholder_id=$ad_placeholder_id.attr("id"),the_ad_id=ad_placeholder_id,pos=$ad_placeholder_id.attr("pos");is_left_rail_ad_expandable&&(the_ad_id=ad_placeholder_id+"_ad",$("<div />",{id:the_ad_id,"class":"left-rail-ad","data-ad_placeholder_id":ad_placeholder_id,"data-cb-ad-id":"left-rail-ad"}).appendTo($body),$ad_placeholder_id.data("pos",pos),$ad_left_rail_placeholders[ad_placeholder_id]=$ad_placeholder_id,$(".scroll-for-more").appendTo($body)),data={ad_placeholder_id:ad_placeholder_id,$ad_placeholder_id:$ad_placeholder_id,rail:active_rail,pos:pos},Time.trigger("dfpAdManager:activateAd",null,{id:the_ad_id,size:size["left-rail"],position:pos,group:"leftRail"}),active_rail.view.isAdInViewport($ad_placeholder_id,!0)?"desktop"===device&&binding_ad_leveling(ad_placeholder_id,data):(console.debug("-- "+ad_placeholder_id+" gets left_rail_ad_handler"),adding_pre_render_left_rail_ad_events(ad_placeholder_id,active_rail.view.$scroll_container,data,left_rail_ad_handler))}),ads=push_visible_left_rail_ads_to_arr(ads),console.debug("-- found these left rail ad units",ads),console.debug("-- checking for unrendered pushdown ads"),can_have_pushdown_ad&&!pushdown_rendered&&(render_pushdown_ad("pushdown-ad"),pushdown_rendered=!0),console.debug("-- checking for pushdown ads",can_have_pushdown_ad),can_have_pushdown_ad&&ads.push("pushdown-ad"),console.debug("-- checking for list ads","list"===format),"list"===format&&list_ads_length)for(i=0;list_ads_length>i;i+=1)Time.trigger("dfpAdManager:activateAd",null,{id:list_ads[i],size:size.list,position:i,group:"listAds"}),ads.push(list_ads[i]);return console.debug("-- checking for right rail ads: "+right_rail_ad_id),right_rail_ad_id&&(render_right_rail_ad(right_rail_ad_id,article_id),ads.push(right_rail_ad_id)),console.debug("-- is collection?","collection"===current_page_type),"collection"===current_page_type&&($top_banner.append('<div id="banner-ad"><div id="collection-banner-ad" data-cb-ad-id="collection-banner-ad"></div></div>'),Time.trigger("dfpAdManager:activateAd",null,{id:"collection-banner-ad",size:size["collection-logo"],position:1,group:"banners",subgroup:"collection"}),ads.push("collection-banner-ad")),console.debug("-- is topic?","topic"===current_page_type),"topic"===current_page_type&&($top_banner.append('<div id="banner-ad"><div id="topic-banner-ad" data-cb-ad-id="topic-banner-ad"></div></div>'),Time.trigger("dfpAdManager:activateAd",null,{id:"topic-banner-ad",size:size["topic-logo"],position:1,group:"banners",subgroup:"topic"}),ads.push("topic-banner-ad")),console.debug("-- old activate_ads rendered all of these ads: ",ads),set_initial_left_rail_load(!1),console.debug("--------- DONE ACTIVATE_ADS ---------"),ads}return console.debug("------ activate_ads -- mobile/l.rail already loaded/not initial load/scrolled to article"),"gallery"===format?(console.debug("--------- DONE ACTIVATE_ADS ---------"),ads):("collection"!==current_page_type&&(console.log("-- no ads are in the current content so just reload visible left rail ads"),ads=push_visible_left_rail_ads_to_arr(ads),right_rail_ad_id&&tgxDo.slots[right_rail_ad_id]&&ads.push(right_rail_ad_id),ad_zone_has_changed=!1),console.debug("--------- DONE ACTIVATE_ADS ---------"),ads)},render_left_rail_ad=function(ad_placeholder_id){console.debug("---- render_left_rail_ad ----");var the_ad_id,$the_ad_id,ad_size,$ad_placeholder_id,pos,data,left_rail_placeholder_el_rect_top,left_rail_placeholder_el,active_rail=get_active_rail(),active_article_id=get_active_article_id(),ads=[];if(!active_rail)return console.debug("-- do not have a reference to a left rail"),!1;if(!active_article_id)return console.debug("-- do not have a active_article_id"),!1;if(initial_left_rail_load&&"mobile"!==device)return console.debug("-- initial_left_rail_load is true so waiting for activate_ads to render: "+ad_placeholder_id),!1;if(the_ad_id=ad_placeholder_id,is_left_rail_ad_expandable){$ad_left_rail_placeholders[ad_placeholder_id]=$("#"+ad_placeholder_id),$ad_placeholder_id=get_$ad_left_rail_placeholder(ad_placeholder_id),left_rail_placeholder_el=$ad_placeholder_id.get(0),left_rail_placeholder_el_rect_top=left_rail_placeholder_el?left_rail_placeholder_el.getBoundingClientRect().top:!1,the_ad_id+="_ad";var top=parseInt(left_rail_placeholder_el_rect_top,10)+10,css="top: "+top+"px; left: 10px;";$("<div />",{id:the_ad_id,"class":"left-rail-ad","data-ad_placeholder_id":ad_placeholder_id,"data-cb-ad-id":"left-rail-ad",style:css}).data("pos",$ad_placeholder_id.attr("pos")).appendTo($body),$(".scroll-for-more").appendTo($body),$ad_placeholder_id.data("zone",current_ad_zone).removeClass("hide-ad"),$the_ad_id=$(the_ad_id),is_ie&&!is_greater_than_ie_11&&$the_ad_id.data("rendered-shield")!==!0&&($the_ad_id.data("rendered-shield",!0),$the_ad_id.append('<div class="ad-shield" id="ad-'+ad_placeholder_id+'"></div>'),$the_ad_id.find("#ad-"+ad_placeholder_id).bind("mousewheel.ad-"+ad_placeholder_id,function(event,delta,deltaX,deltaY){return clearTimeout(ad_shield_event_timeout),$rail_scroll.scrollTop($rail_scroll.scrollTop()-20*deltaY),$body.hasClass("ad-shield-on")||$body.addClass("ad-shield-on"),ad_shield_event_timeout=setTimeout(function(){$body.removeClass("ad-shield-on")},300),!1}))}else $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);if($ad_placeholder_id.length){if(pos=$ad_placeholder_id.attr("pos"),ad_size=size["left-rail"],data={ad_placeholder_id:ad_placeholder_id,$ad_placeholder_id:$ad_placeholder_id,rail:active_rail,pos:pos},console.debug("-- the active_article is "+active_article_id+" and the adFactory.params.aid is "+adFactory.params.aid),active_article_id&&active_article_id!==adFactory.params.aid){var articleModel=active_rail.get(active_article_id)||Time.application.model.get("activeArticle");articleModel&&(console.debug("-- time-dfp - render_left_rail_ad - trigger dfpAdManager:factory:maybeReset"),Time.trigger("dfpAdManager:factory:maybeReset",adFactory,articleModel))}if(Time.trigger("dfpAdManager:activateAd",null,{id:the_ad_id,size:ad_size,position:pos,group:"leftRail"}),!active_rail.view.isAdInViewport($ad_placeholder_id,!0))return console.debug("--"+ad_placeholder_id+" gets left_rail_ad_handler"),void adding_pre_render_left_rail_ad_events(ad_placeholder_id,active_rail.view.$scroll_container,data,left_rail_ad_handler);if(initial_left_rail_load)return;ads.push(the_ad_id),console.debug("-- render_left_rail_ad -- not initial left rail load, display_ads"),console.debug("time-dfp -- render_left_rail_ad -- display_ads",ads),display_ads(ads),"desktop"===device&&binding_ad_leveling(ad_placeholder_id,data)}},render_content_well_ad=function(ad_placeholder_id,data){console.debug("render_content_well_ad",ad_placeholder_id,data);var $ad_placeholder_id=$("#"+ad_placeholder_id),id=data.id,active_article_id=get_active_article_id();if(Time.application.active_rail&&Time.application.model.get("isRailOpen")&&initial_left_rail_load)return void console.log("-- initial_left_rail_load is true so waiting for activate_ads to render: "+ad_placeholder_id);if(in_content_well_viewport($ad_placeholder_id,!0)&&active_article_id===id){console.log("-- content well ad "+ad_placeholder_id+" in sight not on initial render and active article id is "+id),console.log("-- doing an ad sync for "+id);var adData=_.extend(data,{id:ad_placeholder_id,size:data.ad_sizes,position:data.pos,group:"contentWell",subgroup:data.group});Time.trigger("dfpAdManager:activateAd",null,adData),content_well_ad_sync(ad_placeholder_id)}else in_content_well_viewport($ad_placeholder_id,!0)||(console.log("-- content well ad not in sight on initial div ad render for "+ad_placeholder_id+" for active article "+id),adding_pre_render_content_rail_ad_events(ad_placeholder_id,$article_viewport,data,content_well_ad_handler))},render_list_ad=function(data){var ad_data={ad_placeholder_id:data.ad_placeholder_id,ad_sizes:size.list,id:data.id,pos:data.ad_list_index,group:"listAds"};render_content_well_ad(data.ad_placeholder_id,ad_data)},render_right_rail_ad=function(ad_placeholder_id,id){var $article,$articleSection;$("#"+ad_placeholder_id).length<=0&&($article=$("#article-"+id),$articleSection=$article&&$article.find(".article-body"),$articleSection.length>0&&$articleSection.append('<aside class="right-rail-module rr-ad" data-name="rr-ad"><div class="right-rail-ad" id="'+ad_placeholder_id+'"></div></aside>')),Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["right-rail"],position:1,group:"rightRail"})},render_homepage_left_rail_ad=function(ad_placeholder_id,data){var ad_div_conf,pos=data.pos,the_ad_id=ad_placeholder_id;is_left_rail_ad_expandable&&(the_ad_id=ad_placeholder_id+"_ad",ad_div_conf={id:the_ad_id,"class":"left-rail-ad","data-ad_placeholder_id":ad_placeholder_id,"data-cb-ad-id":"left-rail-ad"},$("<div/>",ad_div_conf).appendTo($body),$ad_left_rail_placeholders[ad_placeholder_id]=$("#"+ad_placeholder_id),$(".scroll-for-more").appendTo($body)),Time.trigger("dfpAdManager:activateAd",null,{id:the_ad_id,size:size["left-rail"],position:pos,group:"leftRail",subgroup:"homepage"})},render_homepage_cm_ad=function(ad_placeholder_id,vertical){var size_label,pos;"money"===vertical?(size_label="money-homepage-cm-banner",pos="globalheadermny"):(size_label="homepage-cm-banner",pos="globalheader"),render_cmAd(ad_placeholder_id,size[size_label],pos,"tout")},render_sub_cm_ad=function(ad_placeholder_id){var vertical=window.history&&history.pushState?doc.location.pathname.substring(1).split("/")[0]:doc.location.hash.substring(1).split("/")[0],pos="money"===vertical?"globalheadermny":"globalheader";render_cmAd(ad_placeholder_id,size["sub-cm"],pos,"tout")},render_pushdown_ad=function(ad_placeholder_id){var pushdownAdSizes=size.pushdown,position="0";Time.application.is_homepage&&(pushdownAdSizes=size["homepage-pushdown"],position="1"),Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:pushdownAdSizes,position:position,group:"pushdown",renderOnce:!0})},render_mobile_homepage_sub_ad=function(ad_placeholder_id){render_homepage_cm_ad(ad_placeholder_id)},render_homepage_content_well_ad=function(ad_placeholder_id,pos,vertical){var size_label=vertical?vertical+"-homepage-content-well":"homepage-content-well";Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size[size_label],position:pos,group:"contentWell",subgroup:"homepage"})},render_money_homepage_right_rail_ad=function(ad_placeholder_id){Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["money-homepage-right-rail"],position:1,group:"rightRail",subgroup:"moneyHomepage"})},render_market_data_sponsor_ad=function(ad_placeholder_id){Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["market-data-sponsor"],position:1,group:"sponsor"})},render_money_mobile_top_ad=function(ad_placeholder_id){Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["money-homepage-top"],position:1,group:"topAd",subgroup:"moneyMobile"})},render_magazine_cm_subscribe_link=function(ad_placeholder_id,pos){console.debug("ad.write render_magazine_cm_subscribe_link for "+ad_placeholder_id),render_cmAd(ad_placeholder_id,size["magazine-cm-subscribe"],pos,"tout")},render_magazine_cm_module=function(ad_placeholder_id){console.debug("ad.write render_magazine_cm_module for "+ad_placeholder_id),render_cmAd(ad_placeholder_id,size["magazine-cm-module"],"submodule","tout")},display_magazine_cm_ads=function(id){var ads=[];tgxDo.slots["magazine-cm-subscribe-top-"+id]&&ads.push("magazine-cm-subscribe-top-"+id),tgxDo.slots["magazine-cm-subscribe-bottom-"+id]&&ads.push("magazine-cm-subscribe-bottom-"+id),tgxDo.slots["magazine-cm-module-"+id]&&ads.push("magazine-cm-module-"+id),display_ads(ads)},render_magazine_cm_ads=function(id){$article_viewport.find("#magazine-cm-subscribe-top-"+id).length&&render_magazine_cm_subscribe_link("magazine-cm-subscribe-top-"+id,"subscribeabv"),$article_viewport.find("#magazine-cm-subscribe-bottom-"+id).length&&render_magazine_cm_subscribe_link("magazine-cm-subscribe-bottom-"+id,"subscribeblw"),$article_viewport.find("#magazine-cm-module-"+id).length&&render_magazine_cm_module("magazine-cm-module-"+id)},activate_left_rail_ads=function(){console.log("activate left rail ads"),current_page_type=page_type();var active_rail=get_active_rail(),ads=[],active_rail_view=active_rail.view?active_rail.view:Time.application.page_view.rail_view,ad_suffix=is_left_rail_ad_expandable?"_ad":"";"section"===current_page_type&&(section_sub_ad_render||(render_ad("section-sub-ad",size.sub,1),section_sub_ad_render=!0)),active_rail_view&&"collection"!==current_page_type&&(console.log("have activate rail"),Time.application.is_homepage?("undefined"==typeof Time.application.is_money_homepage||!Time.application.is_money_homepage||Time.application.is_money_homepage.length<1)&&ads.push(["ad-unit-1"+ad_suffix]):""!==active_rail_view.$el.html()&&(Time.application.set_left_rail_bounds(),ads=push_visible_left_rail_ads_to_arr(ads)),ad_zone_has_changed||initial_left_rail_load?(console.debug("time-dfp -- activate_left_rail_ads -- display_ads",ads),display_ads(ads)):(console.debug("time-dfp -- activate_left_rail_ads -- display_ads immediate",ads),display_ads(ads,!0)),ad_zone_has_changed=!1)},activate_homepage_ads=function(){console.log("activate_homepage_ads");var ads=[],left_rail_ad=is_left_rail_ad_expandable?"ad-unit-1_ad":"ad-unit-1";Time.application.model.get("isRailOpen")&&(ads.push(left_rail_ad),$(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),"mobile"!==device?(render_homepage_cm_ad("home-banner-ad"),render_homepage_content_well_ad("ad-homepage-content-well",1),render_market_data_sponsor_ad("market-data-sponsor"),ads.push("ad-homepage-content-well"),ads.push("home-banner-ad"),ads.push("market-data-sponsor"),can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad"))):(Time.application.model.get("isRailOpen")&&(render_mobile_homepage_sub_ad("sub-ad-head"),ads.push("sub-ad-head"),$(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),render_homepage_content_well_ad("ad-homepage-content-well-1",1),render_homepage_content_well_ad("ad-homepage-content-well-2",2),render_homepage_content_well_ad("ad-homepage-content-well-3",3),ads.push("ad-homepage-content-well-1"),ads.push("ad-homepage-content-well-2"),ads.push("ad-homepage-content-well-3")),display_ads(ads)},activate_vertical_homepage_ads=function(){var ads=[];"mobile"!==device?(is_tablet_portrait_mode||(render_homepage_cm_ad("money-homepage-banner-ad","money"),ads.push("money-homepage-banner-ad"),Time.application.model.get("isRailOpen")&&($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show())),render_homepage_content_well_ad("money-homepage-content-well-ad",1,"money"),render_money_homepage_right_rail_ad("money-right-rail-ad"),render_market_data_sponsor_ad("market-data-sponsor"),ads.push("money-right-rail-ad"),ads.push("money-homepage-content-well-ad"),ads.push("market-data-sponsor")):(render_money_mobile_top_ad("money-homepage-top-ad"),render_market_data_sponsor_ad("market-data-sponsor"),ads.push("money-homepage-top-ad"),ads.push("market-data-sponsor")),can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad")),display_ads(ads)},activate_special_article_ads=function(){var ads=[],id=Time.bootstrap.postID||0;render_ad("special-story-banner-ad",size["special-article-logo"],1),$(".special-article-ad").each(function(){var $this=$(this),ad_placeholder_id=$this.attr("id");render_ad(ad_placeholder_id,size["special-article-"+$this.data("size")],$this.data("pos")),ads.push(ad_placeholder_id)}),ads.push("special-story-banner-ad"),$("#magazine-cm-module-"+id).length&&$("#magazine-cm-subscribe-bottom-"+id).length&&(render_magazine_cm_module("magazine-cm-module-"+id),render_magazine_cm_subscribe_link("magazine-cm-subscribe-bottom-"+id,"subscribeblw"),ads.push("magazine-cm-module-"+id),ads.push("magazine-cm-subscribe-bottom-"+id)),display_ads(ads)},set_initial_app_load=function(val){initial_app_load=val},set_initial_left_rail_load=function(val){console.log("setting initial_left_rail_load to "+val),initial_left_rail_load=val,Time.application.is_homepage=!1,initial_left_rail_load&&remove_ads()},get_initial_left_rail_load=function(){return initial_left_rail_load},can_left_rail_ad_expand=function(){return is_left_rail_ad_expandable},left_rail_ad_callback=function(ad_placeholder_id){console.log("left_rail_ad_callback for: "+ad_placeholder_id);var $the_ad_id,left_rail_placeholder_id,$left_rail_placeholder,active_rail,active_rail_view,$scroll_container,left_rail_placeholder_id_el,left_rail_placeholder_id_el_rect,ad_left,data;is_left_rail_ad_expandable&&($the_ad_id=get_$ad_el_div(ad_placeholder_id),$the_ad_id&&(left_rail_placeholder_id=$the_ad_id.data("ad_placeholder_id"),$left_rail_placeholder=get_$ad_left_rail_placeholder(left_rail_placeholder_id)),$the_ad_id&&$the_ad_id.hasClass("hide-ad")&&$left_rail_placeholder?$left_rail_placeholder.addClass("hide-ad"):$left_rail_placeholder&&left_rail_placeholder_id&&$the_ad_id&&$the_ad_id.height()<270&&(console.log("going to update left rail ad postion"),active_rail=get_active_rail(),$scroll_container=active_rail.view?active_rail.view.$scroll_container:Time.application.page_view.rail_view.$scroll_container,active_rail_view=active_rail.view?active_rail.view:Time.application.page_view.rail_view,left_rail_placeholder_id_el=$left_rail_placeholder.get(0),left_rail_placeholder_id_el_rect=left_rail_placeholder_id_el.getBoundingClientRect(),ad_left=$the_ad_id.width()>301?0:11,ad_left=Time.application.model.get("isRailOpen")?ad_left:-3360,data={left_rail_placeholder_id_el:left_rail_placeholder_id_el,left_rail_placeholder_id:left_rail_placeholder_id,$the_ad_id:$the_ad_id,ad_left:ad_left},$left_rail_placeholder.height($the_ad_id.height()+10).removeClass("hide-ad"),$the_ad_id.css({top:left_rail_placeholder_id_el_rect.top+10,left:ad_left}))),Time.application.sizeContent(),Time.application.checkScroll()},sub_ad_callback=function(){return Time.application.sizeContent(),Time.application.checkScroll(),is_left_rail_ad_expandable&&update_left_rail_ads_pos(),!1},ping_pushdown_ad_height=function(){var article_viewport_el_rect=article_viewport_el.getBoundingClientRect(),new_article_viewport_el_top=article_viewport_el_rect.top;article_viewport_el_top!==new_article_viewport_el_top&&($pushdown_ad.trigger("pushdown_height_change"),article_viewport_el_top=new_article_viewport_el_top)},detect_pushdown_pushing_event=function(){pushdown_timeout_notHeader=setInterval(ping_pushdown_ad_height,100),pushdown_timeout_viewport=setInterval(ping_pushdown_ad_height,100)},pushdown_ad_callback=function(){console.log("pushdown ad callback"),$pushdown_ad.hasClass("hide-ad")||($pushdown_ad.css({height:"auto",overflow:"visible","min-height":"66px"}),Time.application.sizeContent(),Time.application.checkScroll(!0),update_left_rail_ads_pos(),detect_pushdown_pushing_event())},hide_ad_div=function(ad_placeholder_id){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);if(console.log("hidding "+ad_placeholder_id),$ad_placeholder_id.addClass("hide-ad"),-1!==ad_placeholder_id.indexOf("ad-unit-"))hide_left_rail_ad_callback(ad_placeholder_id);else if(-1!==ad_placeholder_id.indexOf("pushdown-ad"))hide_pushdown_ad_callback(ad_placeholder_id);else{if(-1===ad_placeholder_id.indexOf("sub-ad"))return!1;hide_sub_ad_callback(ad_placeholder_id)}},hide_left_rail_ad_callback=function(ad_placeholder_id){var $ad_spacer,$ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);Time.application.sizeContent(),Time.application.checkScroll(),is_left_rail_ad_expandable&&($ad_spacer=get_$ad_left_rail_placeholder($ad_placeholder_id.data("ad_placeholder_id")),$ad_spacer.addClass("hide-ad"),update_left_rail_ads_pos())},hide_pushdown_ad_callback=function(){Time.application.sizeContent(),Time.application.checkScroll(!0),is_left_rail_ad_expandable&&update_left_rail_ads_pos()},hide_sub_ad_callback=function(){return Time.application.sizeContent(),Time.application.checkScroll(),is_left_rail_ad_expandable&&update_left_rail_ads_pos(),!1},adCallbackFunction=function(ad_placeholder_id){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);if($ad_placeholder_id.hasClass("hide-ad")||$ad_placeholder_id.length<=0)return console.log("adCallbackFunction for "+ad_placeholder_id+" but the ad is hidden or is no longer there"),!1;if($ad_placeholder_id.css({height:"auto"}),console.log("adCallbackFunction for "+ad_placeholder_id),-1!==ad_placeholder_id.indexOf("ad-unit-"))setTimeout(function(){left_rail_ad_callback(ad_placeholder_id)},50);else if(-1!==ad_placeholder_id.indexOf("pushdown-ad"))pushdown_ad_callback(ad_placeholder_id);else{if(-1===ad_placeholder_id.indexOf("sub-ad"))return"function"==typeof Time.trigger&&Time.trigger("dfpAdManager:callback",ad_placeholder_id),!1;setTimeout(function(){sub_ad_callback(ad_placeholder_id)},50)}},update_left_rail_ads_pos=function(){var prop,left_rail_placeholder_id_rect,$the_ad_id,$left_rail_placeholder_id,left_rail_placeholder_el,ad_left;if(is_left_rail_ad_expandable)for(prop in $ad_left_rail_placeholders)$ad_left_rail_placeholders.hasOwnProperty(prop)&&($the_ad_id=get_$ad_el_div(prop+"_ad"),$left_rail_placeholder_id=$ad_left_rail_placeholders[prop],left_rail_placeholder_el=$ad_left_rail_placeholders[prop].get(0),$the_ad_id&&$left_rail_placeholder_id&&left_rail_placeholder_el&&!$left_rail_placeholder_id.hasClass("collapsed")?(left_rail_placeholder_id_rect=left_rail_placeholder_el.getBoundingClientRect(),left_rail_placeholder_id_rect.height&&(ad_left=$the_ad_id.width()>301?0:11,ad_left=Time.application.model.get("isRailOpen")?ad_left:-3360,$the_ad_id.css({top:left_rail_placeholder_id_rect.top+10,left:ad_left}))):console.log("will not update_left_rail_ads_pos left_rail_placeholder or left_rail_ad for "+prop))},hide_left_rail_ads=function($arr_ad_divs){var prop,$the_ad_id,i,l,active_rail;if(active_rail=get_active_rail(),is_left_rail_ad_expandable)if($arr_ad_divs&&$.isArray($arr_ad_divs))for(l=$arr_ad_divs.length,i=0;l>i;i+=1)$arr_ad_divs[i].css({left:"-3360px"});else for(prop in $left_rail_ad_el_divs)-1!==prop.indexOf("ad-unit-")&&($the_ad_id=get_$ad_el_div(prop),$the_ad_id.css({left:"-3360px"}))},update_left_rail_all_el_pos=function(){is_left_rail_ad_expandable&&update_left_rail_ads_pos()},update_iframe_dimension=function(ad_placeholder_id,width,height){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id),h=parseInt(height,10),w=parseInt(width,10);$ad_placeholder_id.find("iframe:first").attr("width",w).attr("height",h)},update_sponsor_ad_position=function(ad_placeholder_id,top,left){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);top=parseInt(top,10),left=parseInt(left,10),top&&$ad_placeholder_id.css({top:top}),left&&$ad_placeholder_id.css({left:left})};if(TimeAdFactory.isInitialAdPageLoad=function(){return initial_ad_page_load},TimeAdFactory.isInitialAppLoad=function(){return initial_app_load},TimeAdFactory.getAdSizes=function(device){return ad_sizes[device]},TimeAdFactory.getAdSize=function(key){return size[key]},TimeAdFactory.getFactoryInstance=function(){return adFactory},TimeAdFactory.getInitialLeftRailLoad=function(){return initial_left_rail_load},TimeAdFactory.getLeftRailAds=function(){var ads=[],active_rail=get_active_rail();if(!Time.application.model.get("isRailOpen"))return[];var $visibleLeftRailAds=active_rail.view.getAdsInViewport(),isRailCollapsed=$(document).hasClass("collapsed");return $.each($visibleLeftRailAds,function(index,$el){$el instanceof jQuery||($el=$($el));var id=$el.attr("id"),isAdUnit=-1!==id.indexOf("ad-unit"),ad_placeholder_id=is_left_rail_ad_expandable&&isAdUnit?id+"_ad":id;isAdUnit&&!isRailCollapsed&&ads.push(ad_placeholder_id)}),"article"!==current_page_type&&"popular"!==current_page_type&&"videos"!==current_page_type||"mobile"===device?"section"===current_page_type&&ads.push("section-sub-ad"):ads.push("sub-ad"),ads},TimeAdFactory.getFactoryData=get_adFactory_data,TimeAdFactory.setGlobalFactory=function(newFactory){return adFactory=newFactory},TimeAdFactory.setGlobalAdZone=function(newZone){return newZone||(newZone=""),console.debug("setGlobalAdZone",newZone),current_ad_zone=newZone},TimeAdFactory.setGlobalAdSizes=function(newSizes){return size=newSizes},TimeAdFactory.setInitialAdPageLoad=function(isInitialAdPageLoad){initial_ad_page_load=isInitialAdPageLoad},TimeAdFactory.setNativoRerenderable=function(isRerenderable){can_re_render_nativo=isRerenderable},TimeAdFactory.init=init,TimeAdFactory.render_left_rail_ad=render_left_rail_ad,TimeAdFactory.render_content_well_ad=render_content_well_ad,TimeAdFactory.render_list_ad=render_list_ad,TimeAdFactory.render_homepage_left_rail_ad=render_homepage_left_rail_ad,TimeAdFactory.render_mobile_homepage_sub_ad=render_mobile_homepage_sub_ad,TimeAdFactory.render_pushdown_ad=render_pushdown_ad,TimeAdFactory.set_initial_left_rail_load=set_initial_left_rail_load,TimeAdFactory.set_initial_app_load=set_initial_app_load,TimeAdFactory.get_initial_left_rail_load=get_initial_left_rail_load,TimeAdFactory.can_left_rail_ad_expand=can_left_rail_ad_expand,TimeAdFactory.clear_left_rail_bind_events=clear_left_rail_bind_events,TimeAdFactory.clear_left_rail_timeouts=clear_left_rail_timeouts,TimeAdFactory.remove_left_rail_ads=remove_left_rail_ads,TimeAdFactory.remove_ads=remove_ads,TimeAdFactory.activate_ads=activate_ads,TimeAdFactory.activate_left_rail_ads=activate_left_rail_ads,TimeAdFactory.activate_homepage_ads=activate_homepage_ads,TimeAdFactory.activate_vertical_homepage_ads=activate_vertical_homepage_ads,TimeAdFactory.activate_special_article_ads=activate_special_article_ads,TimeAdFactory.update_left_rail_all_el_pos=update_left_rail_all_el_pos,TimeAdFactory.hide_left_rail_ads=hide_left_rail_ads,TimeAdFactory.reload_left_rail_ads=reload_left_rail_ads,TimeAdFactory.update_left_rail_ads_pos=update_left_rail_ads_pos,TimeAdFactory.reset_nativo_placement=reset_nativo_placement,TimeAdFactory.get_nativo_placement_rate=get_nativo_placement_rate,TimeAdFactory.get_nativo_initial_tile_placement=get_nativo_initial_tile_placement,TimeAdFactory.render_nativo_tile=render_nativo_tile,TimeAdFactory.initNativo=init_nativo,TimeAdFactory.in_content_well_viewport=in_content_well_viewport,TimeAdFactory.display_ads=display_ads,TimeAdFactory.get_active_article_id=get_active_article_id,TimeAdFactory.get_active_rail=get_active_rail,TimeAdFactory.ad_content_rail_binded_events=ad_content_rail_binded_events,TimeAdFactory.ad_left_rail_binded_events=ad_left_rail_binded_events,TimeAdFactory.$content_rail_ad_el_divs=$content_rail_ad_el_divs,TimeAdFactory.$left_rail_ad_el_divs=$left_rail_ad_el_divs,TimeAdFactory.$ad_left_rail_placeholders=$ad_left_rail_placeholders,TimeAdFactory.get_$ad_left_rail_placeholder=get_$ad_left_rail_placeholder,TimeAdFactory.page_type=page_type,TimeAdFactory.left_rail_ad_timeout=left_rail_ad_timeout,TimeAdFactory.get_current_page_type=function(){return current_page_type},TimeAdFactory.get_can_have_pushdown_ad=function(){return can_have_pushdown_ad},TimeAdFactory.get_current_sizes=function(){console.log(JSON.stringify(size,null," "))},TimeAdFactory.delete_ad=delete_ad,TimeAdFactory.render_ad=render_ad,TimeAdFactory.display_ad_timeouts=display_ad_timeouts,TimeAdFactory.remove_pre_render_content_rail_ad_events=remove_pre_render_content_rail_ad_events,TimeAdFactory.adCallbackFunction=adCallbackFunction,TimeAdFactory.hide_ad_div=hide_ad_div,TimeAdFactory.update_iframe_dimension=update_iframe_dimension,TimeAdFactory.update_sponsor_ad_position=update_sponsor_ad_position,IS_ADS_DISABLED)for(var key in TimeAdFactory)TimeAdFactory.hasOwnProperty(key)&&(TimeAdFactory[key]=function(){return!1
});window.TimeAdFactory=TimeAdFactory}(jQuery);;
var last_taboola_article_id=!1,$last_taboola_divider=!1;window.Time=window.Time||{},window.Time.taboola=function($){"use strict";var Time=window.Time||{},sumElementsHeight=function(context){var height=0,elements=context.find(".landscape, .portrait, .video-wrapper");return elements.each(function(){var $el=$(this);$el.length>0&&(height+=$el.height())}),height},module={};return module.renderModules=function(){var article_id,$divider,$prev_divider,$next_divider,$last_article,$modules,$spacer,visibility,$article=$(".full-article.active");if($article.length&&(article_id=$article[0].id,article_id!==last_taboola_article_id)){if($modules=$article.find(".taboola:visible"),$next_divider=$article.next(".divider-taboola").find(".taboola"),$prev_divider=$article.prev(".divider-taboola").find(".taboola"),$divider=$next_divider.length?$next_divider:$prev_divider,$spacer=$(".rr-taboola-spacer"),last_taboola_article_id&&($last_article=$("#"+last_taboola_article_id),$last_article.find(".taboola").each(function(){$(this).html("").attr("class","taboola")}),$divider.length&&$last_taboola_divider&&$last_taboola_divider.html("").attr("class","taboola"),visibility=$modules.length?!0:!1,_taboola.push({notify:"newPageLoad"}),_taboola.push({article:article_id,url:Time.application.model.get("activeArticle").get("url")})),$modules.each(function(){var actualMode,actualPlacement,$self=$(this),$articleBody=$self.closest(".article-body");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"right-rail-bottom"===$self.data("placement")?(actualMode="mobile-thumbs-1r",actualPlacement="mobile-below-article-thumbs","time"!==Time.branding&&(actualPlacement="money-mobile-below-article-thumbs")):(actualMode=$self.data("mode"),actualPlacement=$self.attr("placement"),"time"!==Time.branding&&(actualPlacement="money-right-rail-bottom")),_taboola.push({mode:actualMode,container:$self.attr("id"),placement:actualPlacement,target_type:$self.data("type"),height:$articleBody.height()-sumElementsHeight($articleBody)})}),$divider.length&&(_taboola.push({mode:"thumbs-1r",container:$divider.attr("id"),placement:"mid-page"}),$last_taboola_divider=$divider),$spacer.length){var taboola_height=1.2*$spacer.width();$spacer.height($article.find("p:last").height()-taboola_height)}last_taboola_article_id=article_id}},module}(jQuery);;
!function($){Backbone.View.prototype.destroy=function(){return this.trigger("view:destroy"),this.unbind(),$(this.el).remove(),this.$el.remove(),this.remove(),this};var Time;Time=window.Time||(window.Time={}),_(Time).extend({modules:{},components:{},views:{},models:{},collections:{}});var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.modules.AdMediator=function(){function AdMediator(options){this.app=options.app,Time.listenToOnce(Time,"application:initialized",function(_this){return function(){return _this.initialize()}}(this))}return AdMediator.prototype.ARTICLE_GROUPS=["contentWell","dividers","gallery","leftRail","listAds","pushdown","rightRail","top","mobileTopAd"],AdMediator.prototype.GALLERY_GROUPS=["gallery","leftRail","top"],AdMediator.prototype.NATIVO_DISABLED_PAGETYPES=["collection","videos","nativo","magazine","sponsor","topic"],AdMediator.prototype.adapters={},AdMediator.prototype.rules=null,AdMediator.prototype.addPeers=function(peers){_.extend(this.adapters,peers)},AdMediator.prototype.initialize=function(){return this.rules={"dfpAdManager:removeAds":{listener:Time,handlers:{tgx:function(_this){return function(){_this.removeAds()}}(this)}},"application:resize":{listener:Time,handlers:{tgx:function(_this){return function(){"tablet"===Time.device&&("portrait"===_this.app.model.get("orientation")&&_this.onPortrait(),"landscape"===_this.app.model.get("orientation")&&_this.onLandscape()),_this.adapters.tgx.setTopBannerHeight()}}(this)}},"is-beneath-breakpoint-medium":{listener:Time,handlers:{tgx:function(_this){return function(){var subAd;subAd=_this.adapters.tgx.adCollection.get("sub-ad"),null!=subAd&&subAd.set("isActive",!1)}}(this)}},"is-above-breakpoint-medium":{listener:Time,handlers:{tgx:function(_this){return function(){var subAd;subAd=_this.adapters.tgx.adCollection.get("sub-ad"),null!=subAd&&subAd.set("isActive",!0)}}(this)}},"nativo:render":{listener:Time,handlers:{tgx:function(_this){return function(){_this.adapters.tgx.adCollection.remove("nativo-trigger"),_this.adapters.tgx.activateAd(null,{id:"nativo-trigger",size:_this.adapters.tgx.adSize("nativo"),position:_this.adapters.nativo.totalTiles,isTrigger:!0,group:"nativo"}),_this.adapters.tgx.loadNativoTrigger(null,["nativo-trigger"]),_this.adapters.nativo.totalTiles++,_this.adapters.nativo.isTriggerRenderable=!1}}(this)}},"leftRail:tile:rendered":{listener:Time,handlers:{nativo:function(_this){return function(tileView){var collection;_this.isNativoDisabled()||(collection=tileView.model.collection,collection.real_article_index%_this.adapters.nativo.FREQUENCY===_this.adapters.nativo.INITIAL_SPOT_INDEX&&(_this.adapters.nativo.isTriggerRenderable?Time.trigger("nativo:render"):setTimeout(function(){return Time.trigger("nativo:render")},_this.adapters.nativo.RETRY_DELAY)))}}(this),tgx:function(tileView){var collection,rail;collection=tileView.model.collection,rail=collection.view,collection.real_article_index%rail.AD_FREQUENCY===rail.AD_OFFSET&&rail.injectAdPlaceholderAfter(tileView),collection.length<5&&collection.real_article_index===collection.length&&"popular"!==collection.active_env&&rail.injectAdPlaceholders(tileView.$el)}}},"leftRail:flush":{listener:Time,handlers:{tgx:function(_this){return function(){_this.app.model.set("isNewLeftRail",!0),_this.removeAds()}}(this),nativo:function(_this){return function(){_this.adapters.nativo.reset()}}(this)}},"leftRail:placeholder:injected":{listener:Time,handlers:{tgx:function(){}}},"leftRail:opened":{listener:Time,handlers:{tgx:function(_this){return function(){var leftRailAds;leftRailAds=_this.adapters.tgx.adCollection.where({group:"leftRail"}),_.each(leftRailAds,function(adModel){return adModel.set({isActive:!0}),_this.adapters.tgx.getAdEl(adModel).show()}),Tether.position()}}(this)}},"leftRail:closing":{listener:Time,handlers:{tgx:function(_this){return function(){var leftRailAds;leftRailAds=_this.adapters.tgx.adCollection.where({group:"leftRail"}),_.each(leftRailAds,function(adModel){return adModel.set({isActive:!1}),_this.adapters.tgx.getAdEl(adModel).hide()})}}(this)}},"leftRail:ad:render":{listener:Time,handlers:{tgx:function(){}}},"leftRail:ads:refresh":{listener:Time,handlers:{tgx:function(){}}},"leftRail:topicHeader:render":{listener:Time,handlers:{tgx:function(){}}},"leftRail:scrolled":{listener:Time,handlers:{tgx:function(){return function(){Tether.position()}}(this)}},"homepage:initialized":{listener:Time,handlers:{tgx:function(_this){return function(){var ads;ads=["ad-unit-1"],"desktop"===Time.device&&(_this.adapters.tgx.activateAd(null,{id:"pushdown-ad",size:_this.adapters.tgx.adSize("push-down"),position:1,group:"pushdown",renderOnce:!0}),ads.push("pushdown-ad")),"mobile"!==Time.device?(_this.adapters.tgx.activateAd(null,{id:"home-banner-ad",size:_this.adapters.tgx.adSize("homepage-cm-banner"),position:"globalheader",type:"tout",group:"cmBanner",isCmAd:!0}),ads.push("home-banner-ad")):_this.app.model.get("isRailOpen")&&(_this.adapters.tgx.activateAd(null,{id:"sub-ad-head",size:_this.adapters.tgx.adSize("homepage-cm-banner"),position:"globalheader",type:"tout",group:"cmBanner",isCmAd:!0}),ads.push("sub-ad-head")),_this.adapters.tgx.displayAds(ads)}}(this)}},"homepage:activateAd":{listener:Time,handlers:{tgx:function(_this){return function(adId,data){_this.adapters.tgx.activateAd(null,{id:adId,size:_this.adapters.tgx.adSize("left-rail"),position:data.pos,group:"leftRail",subgroup:"homepage"})}}(this)}},"special:ads:activate":{listener:Time,handlers:{tgx:function(){}}},"vertical:ads:activate":{listener:Time,handlers:{tgx:function(){}}},"article:offscreen":{listener:Time,handlers:{tgx:function(_this){return function(articleView){var id,list_ads,model,paid,_ref;model=articleView.model,id=model.get("id"),list_ads=null!=model.list_ads?model.list_ads:[],_.each(list_ads,function(adId){var $ad;return $ad=get_$ad_el_div(adId),$ad.length?($ad.css("height",$ad.height()),this.adapters.tgx.adCollection.remove(adId)):void 0}),paid=null!=(_ref=model.get("paid"))?_ref:{"true":!1},paid&&1!==Time.authenticated&&(articleView.$el.addClass("rendered-cm-ad-module-removed"),_this.adapters.tgx.adCollection.remove("magazine-cm-module-"+id))}}(this)}},"article:onscreen":{listener:Time,handlers:{tgx:function(_this){return function(articleView){return _this.tgxArticleOnscreen(articleView)}}(this)}},"article:activated":{listener:Time,handlers:{taboola:function(){Time.taboola.renderModules()},tgx:function(_this){return function(articleView){_this.onArticleActivated(articleView)}}(this)}},"article:deactivated":{listener:Time,handlers:{tgx:function(_this){return function(articleView){_this.onArticleDeactivated(articleView)}}(this)}},"gallery:slide:activated gallery:slides:loadedMore":{listener:Time,handlers:{tgx:function(_this){return function(galleryModel,articleView){_this.adapters.tgx.onChangeGallerySlide(galleryModel,articleView)}}(this)}},"router:notFirst":{listener:Time,handlers:{tgx:function(){$("#article-top-ad").remove()}}},"application:ready":{listener:Time,handlers:{tgx:function(_this){return function(){_this.adapters.tgx.onApplicationReady(),_this.app.$pushDown.outerHeight(!0)>0&&(_this.app.$notHeader.scrollTo(_this.app.$pushDown.outerHeight(!0)),_this.app.$notHeader.addClass("stick"))}}(this)}},"readingPane:scrolled":{listener:Time,handlers:{tgx:function(_this){return function(){_this.adapters.tgx.onReadingPaneScrolled()}}(this)}}},this.bindRules(),this},AdMediator.prototype.bindRules=function(){return _.each(this.rules,function(_this){return function(settings,event){return _.each(settings.handlers,function(handler,adapter){_.has(_this.adapters,adapter)&&(settings.listener||(settings.listener=Time),Time.listenTo(settings.listener,event,function(){return console.debug("adMediator ",event," for ",adapter)}),Time.listenTo(settings.listener,event,handler))})}}(this)),this},AdMediator.prototype.onArticleActivated=function(articleView){var articleAdIds,articleModel;articleModel=articleView.model,this.adapters.tgx.model.maybeResetFactory(articleModel),this.adapters.tgx.activateCmAds(articleView),this.activateDividerAd(articleView),this.app.model.get("isNewLeftRail")&&this.tgxCreateTetheredLeftRailAds(),this.tgxRenderLeftRailAds(),articleAdIds=this.adapters.tgx.adCollection.getIds({isActive:!0,groups:this.ARTICLE_GROUPS}),this.adapters.tgx.displayAds(articleAdIds)},AdMediator.prototype.onArticleDeactivated=function(articleView){var dividerId,dividerModel,dividerView,rightRailAdModel;return this.adapters.tgx.setAdParams({group:"leftRail"},{etype:""}),rightRailAdModel=this.adapters.tgx.adCollection.where({group:"rightRail"}),this.adapters.tgx.adCollection.remove(rightRailAdModel),null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId"),dividerId&&this.adapters.tgx.adCollection.remove(dividerId)),this},AdMediator.prototype.removeAds=function(where){var oldArticleAds;return null==where&&(where={groups:this.ARTICLE_GROUPS}),console.debug("DfpAdManagerView heard dfpAdManager:removeAds or readingPane:reset"),console.debug("-- clearing display queue"),_.each(this.adapters.tgx.displayQueue,function(timeout){return clearTimeout(timeout)}),this.adapters.tgx.displayQueue=[],oldArticleAds=this.adapters.tgx.adCollection.getIds(where),console.debug("-- removing",oldArticleAds),_.each(oldArticleAds,function(_this){return function(id){return _this.adapters.tgx.adCollection.remove(id)}}(this)),this},AdMediator.prototype.galleryResync=function(articleModel,adDivIds,callback){var galleryGroups,isImmediate;return null==this.app.active_rail||this.app.model.get("isFullscreen")||(galleryGroups=this.adapters.tgx.adCollection.getIds({groups:this.GALLERY_GROUPS}),adDivIds=_.union(adDivIds,galleryGroups)),isImmediate="function"!=typeof callback?callback:!1,this.adapters.tgx.displayAds(adDivIds,isImmediate),"function"==typeof callback&&callback(),this},AdMediator.prototype.isNativoDisabled=function(){return _.contains(this.adapters.nativo_DISABLED_PAGETYPES,this.app.model.get("pagetype"))},AdMediator.prototype.onTgxAfterRefresh=function(adDivIds){var afterAction,_ref;return afterAction=_.each(adDivIds,function(_this){return function(id){var adModel,flags;adModel=_this.adapters.tgx.adCollection.get(id),flags={isRendered:!0},adModel.get("renderOnce")&&(flags.isActive=!1),adModel.set(flags)}}(this)),__indexOf.call(adDivIds,"pushdown-ad")>=0&&(console.debug("-- displayAds -- deactivating pushdown ad so it only renders once"),null!=(_ref=this.adapters.tgx.adCollection.get("pushdown-ad"))&&_ref.set("isActive",!1)),this.adapters.tgx.isLeftRailAdsIncluded(adDivIds)&&(console.debug("-- displayAds -- found left rail ads"),this.app.model.set("isNewLeftRail",!1)),this.adapters.tgx.model.get("isInitialAdCycle")?__indexOf.call(adDivIds,"nativo-trigger")>=0?(console.debug("-- displayAds - nativo-trigger now renderable"),this.adapters.nativo.isTriggerRenderable=!0,console.debug("-- displayAds -- nativo-trigger trigger loaded, restore refresh_oop_slot to true"),window.TGX_SITE_CONFIG.refresh_oop_slot=!0,console.debug("-- END OF NATIVO CYCLE",adDivIds),this):(this.afterInitialAdsRefreshed(adDivIds),this):__indexOf.call(adDivIds,"nativo-trigger")>=0?(console.debug("-- displayAds - nativo tile only"),this):void 0},AdMediator.prototype.onPortrait=function(){var topAds;this.adapters.tgx.model.set("adSizes",window.Time.adSizes("mobile")),topAds=this.adapters.tgx.adCollection.where({group:"top"}),_.invoke(topAds,"set",{isActive:!1})},AdMediator.prototype.onLandscape=function(){var topAds;this.adapters.tgx.model.set("adSizes",window.Time.adSizes("tablet")),topAds=this.adapters.tgx.adCollection.where({group:"top"}),_.invoke(topAds,"set",{isActive:!1})},AdMediator.prototype.activateDividerAd=function(articleView){var articleModel,dividerId,dividerModel,dividerView,params;null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId"),dividerId&&(articleModel=articleView.model,params={id:dividerId,position:1,group:"dividers"},params.size=this.adapters.tgx.adSize("ad-divider"),params.subgroup="advertisement",-1!==dividerId.indexOf("300x600")&&(params.size=this.adapters.tgx.adSize("in-article"),params.subgroup="article"),"collection"===this.app.active_route&&(params.size=this.adapters.tgx.adSize("collection-ad-divider"),params.subgroup="collection"),this.adapters.tgx.activateAd(articleModel,params)))},AdMediator.prototype.tgxArticleOnscreen=function(articleView){var articleModel,id,list_ad_data,list_ads,right_rail_ad_id,_ref,_ref1;articleModel=articleView.model,id=articleModel.get("id"),list_ads=null!=articleModel.list_ads?articleModel.list_ads:[],list_ad_data={id:id},this.adapters.tgx.model.get("isNewLeftRail")||_.each(list_ads,function(adId){var $list_ad_placeholder_id;return tgxDo.slots[adId]?void 0:($list_ad_placeholder_id=get_$ad_el_div(adId),list_ad_data.pos=$list_ad_placeholder_id.attr("pos"),list_ad_data.ad_placeholder_id=adId)}),right_rail_ad_id="right-rail-ad-"+id,"mobile"!==Time.device&&-1!==(null!=(_ref=articleModel.get("omniture"))&&null!=(_ref1=_ref.modules)?_ref1.indexOf("rr-ad"):void 0)},AdMediator.prototype.tgxGetVisiblePlaceholdersInLeftRail=function(){var $adEls,adsInViewport;if(null!=this.app.active_rail&&!this.app.model.get("isFullscreen"))return $adEls=$(".ad-unit"),adsInViewport=$adEls.filter(function(_this){return function(i,el){var isCollapsed,isInViewport;return isInViewport=_this.app.active_rail.view.isElInViewport(el,!0),isCollapsed=$(el).hasClass("collapsed"),isInViewport&&!isCollapsed}}(this))},AdMediator.prototype.tgxRenderLeftRailAds=function(){var $placeholders;null==this.app.active_rail||this.app.model.get("isFullscreen")||($placeholders=this.tgxGetVisiblePlaceholdersInLeftRail(),$placeholders.each(function(_this){return function(i,el){var $placeholder,adId,adModel,hasZone,isAdUnit,isDifferentZone,isNewLeftRail,placeholderId,pos,zone,_ref;return $placeholder=$(el),placeholderId=el.id,(isAdUnit=-1!==placeholderId.indexOf("ad-unit"))?(adId="desktop"===Time.device?placeholderId+"_ad":placeholderId,adModel=_this.adapters.tgx.adCollection.get(adId),zone=null!=adModel&&null!=(_ref=adModel.get("adInstance"))?_ref.zone:void 0,pos=$placeholder.attr("pos"),hasZone=_this.adapters.tgx.model.get("zone"),isDifferentZone=hasZone&&zone!==_this.adapters.tgx.model.get("zone"),isNewLeftRail=_this.adapters.tgx.model.get("isNewLeftRail"),!isNewLeftRail&&isDifferentZone&&(console.debug("-- deleting ad from old zone"),_this.adapters.tgx.adCollection.remove(adId)),_this.adapters.tgx.activateAd(null,{id:adId,size:_this.adapters.tgx.adSize("left-rail"),position:pos,group:"leftRail",isTethered:!0,tetherTo:"#"+placeholderId})):void 0}}(this)))},AdMediator.prototype.tgxCreateTetheredLeftRailAds=function(){var $adUnits,$placeholders,adUnitData;if("mobile"!==Time.device)return $adUnits=$(),adUnitData=[],$placeholders=$("body").find(".ad-unit"),$placeholders.each(function(){var $adUnit,$placeholder,adUnitId,placeholderId,pos;return $placeholder=$(this),placeholderId=$placeholder.attr("id"),pos=$placeholder.attr("pos"),adUnitId=placeholderId+"_ad",$adUnit=$("<div />",{id:adUnitId,"class":"left-rail-ad","data-ad_placeholder_id":placeholderId,"data-cb-ad-id":"left-rail-ad"}).appendTo("body")}),this},AdMediator}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.modules.NativoAdapter=function(_super){function NativoAdapter(options){return this.app=options.app,this.reset(),this.injectScript(),this}return __extends(NativoAdapter,_super),NativoAdapter.prototype.nativo=null,NativoAdapter.prototype.RETRY_DELAY=2500,NativoAdapter.prototype.FREQUENCY=10,NativoAdapter.prototype.INITIAL_SPOT_INDEX=5,NativoAdapter.prototype.isTriggerRenderable=!0,NativoAdapter.prototype.totalTiles=1,NativoAdapter.prototype.spotIndex=5,NativoAdapter.prototype.tileId=1e3,NativoAdapter.prototype.injectScript=function(){var articleUUID,rand,root,script,_base;return rand=1e9*Math.random(),(_base=window.top).Nativo||(_base.Nativo={}),this.nativo=window.top.Nativo,this.nativo.pageURL="http://time.com",script=document.createElement("script"),script.type="text/javascript",root=document.body.getElementsByTagName("script")[0],articleUUID=getParameterByName("ntv_a"),""!==articleUUID?(script.src="http://adserve.postrelease.com/index.js?async=true&prx_url="+this.nativo.pageURL+"&ntv_a="+articleUUID+"&rand="+rand,window.Nativo.onArticlesReady=this.initOnArchiveReady):(script.src="http://adserve.postrelease.com/init.js?async=true&ntv_m=3&prx_url="+this.nativo.pageURL+"&rand="+rand,window.Nativo.onArticlesReady=this.initOnToutsReady),root.parentNode.insertBefore(script,root),this},NativoAdapter.prototype.reset=function(){this.spotIndex=this.INITIAL_SPOT_INDEX,this.totalTiles=1},NativoAdapter.prototype.initOnToutsReady=function(response){var article,data;article=null!=response.articles?response.articles[0]:{},data=this.getArticleData(article),!_.isEmpty(data)&&this.app.getActiveRail()&&(data.placement=this.app.getActiveRail().at(0).get("sponsor")?nativo_tile_placement-1:nativo_tile_placement,data.is_nativo_page=!1,this.app.getActiveRail().add(data)),this.updateNativoSpot()},NativoAdapter.prototype.initOnArchiveReady=function(response){var articles;articles=_.map(response.articles,function(article){var data;return data=this.getArticleData(article),data.is_nativo_page=!0,data}),this.app.getActiveRail()&&(this.app.getActiveRail().add(articles),this.app.getActiveRail().reached_page_limit())},NativoAdapter.prototype.getArticleData=function(data){var advertiser_logo,advertiser_name,advertiser_slug_name,advertiser_url,content,date,encoded_title,encoded_url,headline,id,key,pretty_time,preview_image,preview_text,published_date,relative_url,result,time,title,url,url_article_slug;return result={},_.isEmpty(data)||(title=data.article_title,headline=data.preview_headline,content=data.article,id=data.article_id,key=data.article_key,preview_image=data.preview_image,preview_text=data.preview_text,relative_url=data.article_relative_url,advertiser_url=data.advertiser_url,advertiser_logo=data.advertiser_logo,advertiser_name=data.advertiser_name,time=data.article_time,date=data.article_date,this.tileId&&(id="s"+this.tile_id),this.tile_id+=1,advertiser_name&&(advertiser_slug_name=clean_ad_key_value(advertiser_name)),title&&(encoded_title=encodeURIComponent(title)),id&&relative_url&&advertiser_slug_name&&(url_article_slug=relative_url.split("/").splice(2).join("/"),url=Time.home_url+"content-from/"+advertiser_slug_name+"/"+id+"/"+url_article_slug,encoded_url=encodeURIComponent(url)),date&&time&&(pretty_time=date+" "+time,published_date=date+" "+time),result.title=title,result.short_title=headline,result.content=content,result.id=id,result.format="article",result.email_title="nativo_headline",result.email_body=preview_text,result.nativo_key=key,result.nativo_preview_image=preview_image,result.nativo_preview_text=preview_text,result.twitter_text=headline,result.encoded_shortlink=url,result.url=url,result.twitter_via=Time.branding.toUpperCase(),result.encoded_url=encoded_url,result.encoded_title=encoded_title,result.is_nativo=!0,result.sponsor={url:advertiser_url,name:advertiser_name,color:"",slug:advertiser_slug_name,thumbnail:advertiser_logo},result.time={pretty:pretty_time,published:published_date,updated:"",minute:"","short":""}),result},NativoAdapter.prototype.updateNativoSpot=function(){return this.spotIndex+=this.FREQUENCY,this.spotIndex},NativoAdapter}(Backbone.Events);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.modules.TgxAdapter=function(_super){function TgxAdapter(options){return null==options&&(options={}),TgxAdapter.__super__.constructor.apply(this,arguments),this.app=options.app,Time.Ad=window.TimeAdFactory,this.ENABLED=options.enabled||!0,"undefined"==typeof TiiAdConfig?(console.error("-- init -- TiiAdConfig/TGX not defined"),this.ENABLED=!1,this):"true"===localStorage.noads?(console.error("-- init -- noads is set"),this.ENABLED=!1,this):this.ENABLED?(this.PRESERVED_AD_PARAMS=["pos","cmpos","ad_div","cmtyp","etype","slide"],this.DISPLAY_DELAY_CONSTANT=!1,this.DISPLAY_DELAY=500,this.DISPLAY_DELAYS={mobile:300,tablet:300,desktop:300},this.DISPLAY_DELAY_MAX=900,this.displayQueue=[],this.isRefreshAdsEnqueued=!1,this.adCollection=new Time.collections.DfpAds,this.model=new Time.models.DfpAdManager({},{app:this.app}),this.TOP_BANNER_HEIGHT=null,this.setTopBannerHeight(),$("html").toggleClass("debugads","1"===("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugads:void 0)),$("body").addClass("hasAd"),"desktop"===Time.device&&$("body").addClass("expandable-ad-enable"),this.bindListeners(),this):(console.error("-- init -- ads disabled"),this)}return __extends(TgxAdapter,_super),TgxAdapter.prototype.setTopBannerHeight=function(){return this.TOP_BANNER_HEIGHT=$("body").find(".top-banner").eq(0).height(),this.TOP_BANNER_HEIGHT},TgxAdapter.prototype.bindListeners=function(){return this.listenTo(Time,"dfpAdManager:syncWithLeftRail",function(_this){return function(articleModel,adDivIds,callback){null==callback&&(callback=!1),console.debug("DfpAdManagerView heard dfpAdManager:syncWithLeftRail on Time",articleModel,adDivIds),_this.syncWithLeftRail(articleModel,adDivIds,callback)}}(this)),this.listenTo(Time,"dfpAdManager:refreshAds",function(_this){return function(articleModel,adDivIds,callback){null==callback&&(callback=!1),console.debug("DfpAdManagerView heard dfpAdManager:refreshAds on Time",articleModel,adDivIds),_this.refreshAds(articleModel,adDivIds,callback)}}(this)),this.listenTo(Time,"dfpAdManager:displayTrigger",function(_this){return function(articleModel,adDivIds){_this.onDisplayTrigger(articleModel,adDivIds)}}(this)),this.listenTo(Time,"dfpAdManager:setAdParams",function(_this){return function(query,params){console.debug("DfpAdManagerView heard dfpAdManager:setAdParams on Time",query,params),_this.setAdParams(query,params)}}(this)),this.listenTo(Time,"dfpAdManager:activateAd",function(_this){return function(articleModel,params,callback){null==params&&(params={}),null==callback&&(callback=!1),console.debug("DfpAdManagerView heard dfpAdManager:activateAd on Time, article:",null!=articleModel?articleModel.id:void 0," params:",params),_this.activateAd(articleModel,params),"function"==typeof callback&&callback(),callback===!0&&(console.debug("-- dfpAdManager:activateAd - trigger dfpAdManager:refreshAds on Time"),_this.refreshAds(articleModel,[params.id]))}}(this)),this.listenTo(Time,"dfpAdManager:deactivateAd",function(_this){return function(id){console.debug("DfpAdManagerView heard dfpAdManager:deactivateAd on Time, ad id:"+id),_this.deactivateAd(id)}}(this)),this.listenTo(Time,"dfpAdManager:deleteAd",function(_this){return function(id){console.debug("DfpAdManagerView heard dfpAdManager:deleteAd on Time, ad id:"+id),_this.deleteAd(id)}}(this)),this.listenToOnce(Time,"router:notFirst",function(){$("#article-top-ad").remove()}),this.listenTo(Time,"application:ready",function(_this){return function(){_this.onApplicationReady()}}(this)),this.listenTo(Time,"readingPane:scrolled",function(_this){return function(){_this.onReadingPaneScrolled()}}(this)),this.listenTo(Time,"dfpAdManager:removeAds",function(_this){return function(){_this.onRemoveAds()}}(this)),this.listenTo(Time,"article:activated",function(_this){return function(articleView){var adDivIds,ads,articleModel,factoryInstance,leftRailAds,leftRailNonvisible,leftRailVisible;console.debug("DfpAdManagerView heard article:activated on Time -- AD CYCLE start"),articleModel=articleView.model,factoryInstance=_this.model.getFactory(),_this.model.maybeResetFactory(factoryInstance,articleModel),"section-front"===articleModel.attributes.format&&_this.renderSectionFrontAd(articleModel),_this.activateDividerAd(articleView),Time.application.active_rail&&(ads=Time.Ad.activate_ads(articleModel)),adDivIds=_this.adCollection.getIds({isActive:!0,isTrigger:!1}),adDivIds=_.union(adDivIds,ads),leftRailAds=_this.adCollection.getIds({group:"leftRail"}),leftRailVisible=Time.Ad.getLeftRailAds(),leftRailNonvisible=_.difference(leftRailAds,leftRailVisible),adDivIds=_.difference(adDivIds,leftRailNonvisible),_this.refreshAds(articleModel,adDivIds)}}(this)),this.listenTo(Time,"article:deactivated",function(_this){return function(articleView){_this.onDeactivateArticle(articleView)}}(this)),this.listenTo(Time,"gallery:slide:activated gallery:slides:loadedMore",function(_this){return function(galleryModel,articleView){_this.onChangeGallerySlide(galleryModel,articleView)}}(this)),this.listenTo(Time,"article:deactivated",function(_this){return function(){_this.setAdParams({group:"leftRail"},{etype:""})}}(this)),this.listenTo(Time,"leftRail:opened",function(){Time.Ad.activate_left_rail_ads()}),this.listenTo(Time,"leftRail:closed",function(){Time.Ad.update_left_rail_all_el_pos()}),this.listenTo(Time,"dfpAdManager:callback",function(_this){return function(id){var adModel;adModel=_this.adCollection.findWhere({id:id}),console.debug("dfpAdManager heard dfpAdManager:callback on Time with",id,adModel)}}(this)),this},TgxAdapter.prototype.onApplicationReady=function(){var isArticleList;isArticleList="rail"===Time.application.active_route,"mobile"===Time.device&&isArticleList},TgxAdapter.prototype.onReadingPaneScrolled=function(){var activeArticle,fourthItemOffset,listItems,offsetPadding;activeArticle=this.model.get("activeArticle"),"list"===(null!=activeArticle?activeArticle.get("format"):void 0)&&(listItems=activeArticle.get("list_items"),offsetPadding=70,fourthItemOffset=$("#"+listItems[3].id).offset(),fourthItemOffset.top>offsetPadding&&fourthItemOffset.top-offsetPadding<this.$notHeader.get(0).scrollTop&&Time.Ad.reload_left_rail_ads())},TgxAdapter.prototype.onDisplayTrigger=function(articleModel,adDivIds){return console.debug("DfpAdManagerView heard dfpAdManager:displayTrigger on Time -- NATIVO CYCLE start",articleModel,adDivIds),adDivIds=adDivIds||this.adCollection.getIds({isTrigger:!0}),adDivIds.length?void this.displayAds(articleModel,adDivIds):void console.debug("-- dfpAdManager:displayTrigger - no triggers to refresh",arguments)},TgxAdapter.prototype.onRemoveAds=function(){var $els,oldArticleAds;console.debug("DfpAdManagerView heard dfpAdManager:removeAds or readingPane:reset"),console.debug("-- removing old article ads (content well, right rail, etc)"),oldArticleAds=this.adCollection.getIds({groups:["contentWell","dividers","gallery","leftRail","listAds","pushdown","rightRail"]}),console.debug("-- removing",oldArticleAds);try{$els=this.getJqueryObjsByIds(oldArticleAds),$els.remove()}catch(_error){}return _.each(oldArticleAds,function(_this){return function(id){var adModel;return adModel=_this.adCollection.get(id),null!=adModel&&adModel.set("adInstance",null),_this.adCollection.remove(id),adModel=null}}(this)),this},TgxAdapter.prototype.initialAdsRefreshed=function(allDivIds){var pushdownAds;return console.debug("INITIAL ADS - ads refreshed - ",allDivIds),pushdownAds=this.adCollection.where({group:"pushdown"}),_.each(pushdownAds,function(_this){return function(ad){return _this.adCollection.remove(ad)}}(this)),Time.Ad.set_initial_app_load(!1),console.debug("-- END OF INITIAL APP ADS CYCLE, initial_app_load is false",allDivIds),this},TgxAdapter.prototype.onDeactivateArticle=function(articleView){var articleId,articleModel,dividerId,dividerModel,dividerView;if(null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId")))return articleModel=articleView.model,articleId=articleModel.id,this.deleteAd(dividerId),this},TgxAdapter.prototype.onChangeGallerySlide=function(galleryModel,articleView){var adDivIds;if(!(articleView.model.get("galleriesRendered")<articleView.galleriesCollection.size()))return adDivIds=this.adCollection.getIds({isActive:!0,isTrigger:!1,groups:["gallery"]}),this.syncWithLeftRail(articleView.model,adDivIds),this},TgxAdapter.prototype.prioritizeGroups=function(adDivIds){var divGroups,prioritizedDivIds,priority;return priority=["mobileTopAd","leftRail"],divGroups=_.groupBy(adDivIds,function(_this){return function(id){var adModel,group;return(adModel=_this.adCollection.get(id))?(group=adModel.get("group"),_.contains(priority,group)?group:"others"):"others"}}(this)),prioritizedDivIds=[],_.each(priority,function(group){return null!=divGroups[group]?prioritizedDivIds=prioritizedDivIds.concat(divGroups[group]):void 0}),null!=divGroups.others&&(prioritizedDivIds=prioritizedDivIds.concat(divGroups.others)),prioritizedDivIds},TgxAdapter.prototype.setAdParams=function(query,params){var adModels;adModels=this.adCollection.where(query),_.each(adModels,function(adModel){var adInstance,key,value,_results;adInstance=adModel.get("adInstance"),_results=[];for(key in params)value=params[key],_results.push(adInstance.setParam(key,value));return _results})},TgxAdapter.prototype.activateAd=function(articleModel,params){var adInstance,adModel,factoryInstance,modelParams;if(console.debug("DfpAdManagerView -- activateAd",articleModel,params),tgxDo.slots[params.id]){if("nativo-trigger"===params.id)return console.debug("-- already triggered nativo once"),!1;console.debug("-- deleting old ad before activation"),this.deleteAd(params.id)}return null!=params.position&&(params.position=params.position+""),modelParams=_.extend({},params),(null!=articleModel?articleModel.id:void 0)&&(console.debug("-- this is an article ad"),modelParams.articleId=articleModel.id),console.debug("-- adding adModel to adCollection",modelParams),adModel=this.adCollection.push(modelParams),adInstance=adModel.get("adInstance"),adInstance||(factoryInstance=this.model.getFactory(),this.model.maybeResetFactory(factoryInstance,articleModel),adInstance=this.getAd(factoryInstance,params),adModel.set("adInstance",adInstance)),adInstance&&(this.writeAd(factoryInstance,adInstance,params),adModel.set("isActive",!0)),adModel},TgxAdapter.prototype.activateDividerAd=function(articleView){var articleId,articleModel,dividerId,dividerModel,dividerView,params;if(null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId")))return articleModel=articleView.model,articleId=articleModel.id,console.debug("activateDividerAd",dividerId),params={id:dividerId,position:"1",group:"dividers"},params.size=Time.Ad.getAdSize("ad-divider"),params.subgroup="advertisement",-1!==dividerId.indexOf("300x600")&&(params.size=Time.Ad.getAdSize("in-article"),params.subgroup="article"),"collection"===Time.application.active_route&&(params.size=Time.Ad.getAdSize("collection-ad-divider"),params.subgroup="collection"),this.activateAd(articleModel,params),this},TgxAdapter.prototype.deactivateAd=function(id){var $el,adModel,error;if(adModel=this.adCollection.get(id),!adModel)return void console.warn("-- deactivateAd -- Ad "+id+" not in collection for deactivation");adModel.set("isActive",!1),adModel.set("adInstance",null),$el=$("#"+id),$el.removeData(["zone","pos"]),$el.find("iframe").each(function(){return $(this).attr("src","about:blank")}),$el.empty();try{delete tgxDo.slots[id]}catch(_error){error=_error,console.warn("-- deactivateAd -- could not delete ad id "+id+" from tgxDo")}},TgxAdapter.prototype.deleteAd=function(id){var $el,adModel,error;if($el=$("#"+id),$el.removeData(["zone","pos"]),$el.find("iframe").each(function(){return $(this).attr("src","about:blank")
}),$el.length&&$el.css({"min-height":90,height:$el.height()}),$el.empty(),adModel=this.adCollection.get(id),!adModel)return void console.warn("-- deleteAd -- Ad "+id+" not in collection for delete");adModel.set("adInstance",null),this.adCollection.remove(id);try{delete tgxDo.slots[id]}catch(_error){error=_error,console.warn("-- deleteAd -- could not delete ad id "+id+" from tgxDo")}console.debug("-- deleteAd -- "+id+" deleted")},TgxAdapter.prototype.hasAd=function(id){var result,_ref;return result=("undefined"!=typeof tgxDo&&null!==tgxDo&&null!=(_ref=tgxDo.slots)?_ref[id]:void 0)?!0:!1},TgxAdapter.prototype.getAd=function(factory,params){var ad,dim,error;if(this.hasAd(params.id))return console.error("DfpAdManagerView getAd - already got ad",params),null;if(!params.hasOwnProperty("id"))return console.error("-- getAd params needs an id",params),null;if(!params.hasOwnProperty("size")||"object"!=typeof params.size)return console.error("-- getAd params needs a size array of strings",params),null;dim=params.size[0].split("x");try{return ad=factory.getAd(dim[0],dim[1])}catch(_error){return error=_error,console.error("-- getAd could not get ad with params ",params),null}},TgxAdapter.prototype.getAdEl=function(id){var $el,selector;return selector="#"+id,$el=$(selector),$el.length||console.error("DfpAdManagerView - getAdEl - couldn't find element in DOM",selector),$el},TgxAdapter.prototype.writeAd=function(factory,ad,params){var $el,error;if(console.debug("DfpAdManagerView - writeAd",ad,params),$el=this.getAdEl(params.id),!$el.length)return console.error("-- writeAd - couldn't find element in DOM",params.id),ad;(null!=factory?factory.zone:void 0)&&$el.data("zone",factory.zone),$el.data("pos",params.position);try{params.size.length>1&&ad.setParam("sz",params.size.join(",")),ad.setParam("pos",params.position),ad.setParam("ad_div",params.id),null!=(null!=params?params.group:void 0)&&"gallery"===params.group?(ad.setParam("etype","gallery"),null!=(null!=params?params.slide:void 0)&&ad.setParam("slide",params.slide)):(ad.setParam("etype",""),ad.setParam("slide","")),console.debug("-- writeAd - ad.write"),ad.write(params.id)}catch(_error){error=_error,console.error("-- writeAd - could not write ad",ad,params,error)}return ad},TgxAdapter.prototype.isAdWritten=function(adDivId){return tgxDo.slots.hasOwnProperty(adDivId)},TgxAdapter.prototype.syncWithLeftRail=function(articleModel,adDivIds,callback){var leftRailAds,_ref;return null==(null!=(_ref=Time.application)?_ref.active_rail:void 0)||Time.application.model.get("isFullscreen")||(leftRailAds=Time.Ad.getLeftRailAds(),adDivIds=_.union(adDivIds,leftRailAds),console.debug("-- refreshAds - adding left rail ads to div ids",leftRailAds)),this.refreshAds(articleModel,adDivIds,callback),this},TgxAdapter.prototype.refreshAds=function(articleModel,adDivIds,callback){var isImmediate;return console.debug("-- refreshAds called with ",adDivIds),(null!=adDivIds?adDivIds.length:void 0)?(adDivIds=this.prioritizeGroups(adDivIds),adDivIds.length?(isImmediate="function"!=typeof callback?callback:!1,console.debug("-- refreshAds with divs:",adDivIds),this.displayAds(articleModel,adDivIds,isImmediate),"function"==typeof callback&&callback(),this):void console.debug("-- refreshAds - no ads to refresh",arguments)):void console.error("-- refreshAds needs ad div ids")},TgxAdapter.prototype.prepFactoryForDisplay=function(articleModel){var factoryInstance;return factoryInstance=this.model.getFactory(),null==factoryInstance?(console.error("-- displayAds -- needs a valid factory",articleModel),this):(this.model.maybeResetFactory(factoryInstance,articleModel),this.model.setFactorySegments(factoryInstance),factoryInstance)},TgxAdapter.prototype.getJqueryObjsByIds=function(ids){var nodes;return nodes=_.map(ids,function(i){return document.getElementById(i)}),$(nodes)},TgxAdapter.prototype.displayAds=function(articleModel,adDivIds,isImmediate){var $els,timeoutDelay,timeoutKey,_ref;return null==isImmediate&&(isImmediate=!1),adDivIds=adDivIds||this.adCollection.getIds({isActive:!0,isTrigger:!1}),console.debug("DfpAdManager view - displayAds",adDivIds),adDivIds.length?($els=this.getJqueryObjsByIds(adDivIds),(null!=(_ref=Time.application.model.get("activeArticle"))?_ref.get("galleriesRendered"):void 0)?(console.debug("-- setting etype of gallery"),this.setAdParams({group:"leftRail"},{etype:"gallery"})):(console.debug("-- clearing custom etype"),this.setAdParams({group:"leftRail"},{etype:""})),timeoutKey=adDivIds.toString(),isImmediate?timeoutDelay=0:this.DISPLAY_DELAY_CONSTANT?timeoutDelay=this.DISPLAY_DELAY:(timeoutDelay=this.DISPLAY_DELAYS[Time.device]*adDivIds.length,timeoutDelay>this.DISPLAY_DELAY_MAX&&(timeoutDelay=this.DISPLAY_DELAY_MAX)),console.debug("-- displayAds -- displaying in "+timeoutDelay+"ms"),Time.Ad.display_ad_timeouts[timeoutKey]=setTimeout(function(_this){return function(){var factoryInstance;return console.debug("-- displayAds -- in timeout"),factoryInstance=_this.prepFactoryForDisplay(articleModel),_this._deferredDisplayAds(factoryInstance,adDivIds),$els?$els.removeClass("hide-ad"):void 0}}(this),timeoutDelay),this):(console.debug("-- displayAds -- no ads to display"),this)},TgxAdapter.prototype.isLeftRailAdsIncluded=function(adDivIds){var leftRailAds;return leftRailAds=_.find(adDivIds,function(id){var isLeftRailAd;return isLeftRailAd=-1!==id.indexOf("ad-unit")}),null!=leftRailAds?leftRailAds.length:void 0},TgxAdapter.prototype.removeIdsOfUnwrittenAds=function(adDivIds){var id,index,_i,_len,_ref;for(index=_i=0,_len=adDivIds.length;_len>_i;index=++_i)id=adDivIds[index],("undefined"!=typeof tgxDo&&null!==tgxDo&&null!=(_ref=tgxDo.slots)?_ref.hasOwnProperty(id):void 0)||(adDivIds.splice(index,1),console.error("-- removeIds... -- "+id+" is not in tgxDo for some reason"));return console.debug("-- removeIds... -- error checked left",adDivIds,adDivIds.length),adDivIds},TgxAdapter.prototype.beforeDeferredDisplayAds=function(adDivIds){return Time.Ad.isInitialAdPageLoad()?__indexOf.call(adDivIds,"nativo-trigger")>=0?(window.TGX_SITE_CONFIG.refresh_oop_slot=!1,console.debug("-- beforeDisplayAds - nativo trigger on initial page load"),console.debug("-- beforeDisplayAds - TGX_SITE_CONFIG.refresh_oop_slot set to false so trigger can load")):console.debug("-- beforeDisplayAds - INITIAL AD CYCLE -- oop MUST be TRUE"):(console.debug("-- beforeDisplayAds - clearRefresh for REGULAR AD CYCLE"),console.debug("-- beforeDisplayAds - not initial page load")),this},TgxAdapter.prototype._deferredDisplayAds=function(factoryInstance,adDivIds){var disableIds,error,_ref;if(adDivIds=this.removeIdsOfUnwrittenAds(adDivIds),0===adDivIds.length)return void console.error("-- deferredDisplayAds -- no div ids to refresh");this.beforeDeferredDisplayAds(adDivIds),console.debug("-- _deferredDisplayAds -- clearRefreshAds with",adDivIds,"OOP:",window.TGX_SITE_CONFIG.refresh_oop_slot);try{factoryInstance.clearRefreshAds(adDivIds,this.PRESERVED_AD_PARAMS)}catch(_error){error=_error,console.error("-- _deferredDisplayAds -- could not clearRefreshAds",adDivIds,error)}if(disableIds=_.each(adDivIds,function(_this){return function(id){var adModel;adModel=_this.adCollection.get(id),(null!=adModel?adModel.get("renderOnce"):void 0)&&adModel.set("isActive",!1)}}(this)),__indexOf.call(adDivIds,"pushdown-ad")>=0&&(console.debug("-- displayAds -- deactivating pushdown ad so it only renders once"),null!=(_ref=this.adCollection.get("pushdown-ad"))&&_ref.set("isActive",!1)),Time.Ad.isInitialAdPageLoad()){if(__indexOf.call(adDivIds,"nativo-trigger")>=0)return console.debug("-- displayAds - nativo-trigger now renderable"),Time.Ad.setNativoRerenderable(!0),console.debug("-- displayAds -- nativo-trigger trigger loaded, restore refresh_oop_slot to true"),window.TGX_SITE_CONFIG.refresh_oop_slot=!0,console.debug("-- END OF NATIVO CYCLE",adDivIds),this;if("desktop"!==Time.device||this.isLeftRailAdsIncluded(adDivIds))return console.debug("-- displayAds -- found left rail ads -- set initialAdPageLoad false"),console.debug("-- displayAds -- set final TGX_SITE_CONFIG.refresh_oop_slot set to false"),Time.Ad.setInitialAdPageLoad(!1),window.TGX_SITE_CONFIG.refresh_oop_slot=!1,this.initialAdsRefreshed(adDivIds),this}return __indexOf.call(adDivIds,"nativo-trigger")>=0?(console.debug("-- displayAds - nativo tile only"),this):this},TgxAdapter.prototype.renderSectionFrontAd=function(){return this.activateAd(null,{id:"section-front-ad",size:["300x250"],position:1,group:"contentWell",subgroup:"section"})},TgxAdapter}(Backbone.View),Time.component.Dropdown=function(){function Dropdown(elSelector,options){return this.$el=$(elSelector),this.opts=$.extend(!0,{},this.opts,options),this.$el.on("touchend.dropdown-"+this.opts.classToAdd+" click.dropdown-"+this.opts.classToAdd,function(_this){return function(evt){return _this.toggle(evt)}}(this)),this}return Dropdown.prototype.opts={parentSelector:"body",classToAdd:"show-nav",menuSelector:".main-nav",handleClickOutside:!0},Dropdown.isShowing=!1,Dropdown.prototype.$html=$("html"),Dropdown.prototype.show=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).addClass(this.opts.classToAdd),this.isShowing=!0,this.opts.handleClickOutside&&this.bindClose(evt),$(this.opts.menuSelector).trigger("shown"),$(".scroll-for-more").hide(),this.$el},Dropdown.prototype.hide=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).removeClass(this.opts.classToAdd),$(this.opts.menuSelector).trigger("hidden"),this.isShowing=!1,Time.application.model.get("isRailOpen")&&($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),this.$el},Dropdown.prototype.bindClose=function(e){return $("html").on("click.dropdown-"+this.opts.classToAdd,function(_this){return function(){var $targ,targetIsNotDropdown,targetsNotAChildOfDropdown;return $targ=$(e.target||window.event.srcElement),targetIsNotDropdown=!$targ.is(_this.opts.menuSelector),targetsNotAChildOfDropdown=0===$(_this.opts.menuSelector).has($targ).length,targetIsNotDropdown&&targetsNotAChildOfDropdown?($("html").off(".dropdown-"+_this.opts.classToAdd),_this.hide()):void 0}}(this)),this},Dropdown.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.$el.trigger("clicked-close"),this.hide(evt)):(this.$el.trigger("clicked-open"),this.show(evt))},Dropdown.prototype.destroy=function(){return this.$el.off("dropdown-"+this.opts.classToAdd),$.removeData(this.$el,"Dropdown Navigation MobileNavigation"),$("html").off("dropdown-"+this.opts.classToAdd)},Dropdown}(),Time.component.Gallery=function(){function Gallery(){}return Gallery.prototype.initComponent=function(index){var that;return this.curr_index=index?index:0,this.max_index=this.$items.length-1,this.$counter_total&&this.setCounterTotal(),that=this,Modernizr.touch&&(this.$el.touchwipe({wipeLeft:$.proxy(that.advance,that),wipeRight:$.proxy(that.recede,that),min_move_x:6,min_move_y:6,preventDefaultEvents:!1}),this.$el.click(that.advance,that)),this.updatePositionalClasses(!0),this.trigger("gallery:initComponent")},Gallery.prototype.auto_play=function(milliseconds){return null==milliseconds&&(milliseconds=500),this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(_this){return function(){return _this.advance()}}(this),milliseconds)},Gallery.prototype.advance=function(e){e&&e.preventDefault(),this.curr_index++,this.curr_index>this.max_index?this.circular?(this.curr_index=0,this.updatePositionalClasses()):this.handle_end():this.updatePositionalClasses()},Gallery.prototype.recede=function(e){e&&e.preventDefault(),this.curr_index--,this.curr_index<0?this.circular?(this.curr_index=this.max_index,this.updatePositionalClasses()):this.handle_beginning():this.updatePositionalClasses()},Gallery.prototype.goto_index=function(index){return this.curr_index=index,this.updatePositionalClasses()},Gallery.prototype.goto_start=function(){return this.goto_index(0)},Gallery.prototype.goto_end=function(){return this.goto_index(this.max_index)},Gallery.prototype.handle_end=function(){return this.trigger("gallery:max_limit"),this.goto_end()},Gallery.prototype.handle_beginning=function(){return this.trigger("gallery:min_limit"),this.goto_start()},Gallery.prototype.updatePositionalClasses=function(){var $el,i,_i,_len,_ref;for(this.trigger("gallery:beforeUpdatePositionalClasses",this),"undefined"!=typeof console&&null!==console&&console.log("Gallery component - update positional classes"),_ref=this.$items,i=_i=0,_len=_ref.length;_len>_i;i=++_i)$el=_ref[i],i<this.curr_index&&$el.addClass("passed").removeClass("current upcoming"),i===this.curr_index&&$el.addClass("current").removeClass("passed upcoming").trigger("isCurrent"),i>this.curr_index&&$el.addClass("upcoming").removeClass("passed current");return this.trigger("gallery:afterUpdatePositionalClasses",this),this.curr_index===this.max_index?this.trigger("gallery:last"):void 0},Gallery.prototype.getCurrentItem=function(){return this.$items[this.curr_index]},Gallery.prototype.getCurrentIndex=function(){return this.curr_index},Gallery.prototype.setCounterTotal=function(index){return this.$counter_total.text(index?index+1:this.max_index+1)},Gallery.prototype.setCounterCurrent=function(index){return this.$counter_current.text(index?index+1:this.curr_index+1)},Gallery}();var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Time.component.InfiniteScroll=function(){function InfiniteScroll($viewport,$content,threshold,down_callback,up_callback,context){null==context&&(context=window),this.on_scroll=__bind(this.on_scroll,this),this.$viewport=$viewport,this.$content=$content,this.threshold=threshold,this.down_callback=down_callback,this.context=context,this.position=$viewport.scrollTop(),null!=up_callback&&(this.up_callback=up_callback),_.defer(function(_this){return function(){return _this.bind()}}(this))}return InfiniteScroll.prototype.bind=function(){return this.$viewport.off("scroll.infinite_scroll"),this.$viewport.on("scroll.infinite_scroll",this.on_scroll)},InfiniteScroll.prototype.unbind=function(){return this.$viewport.off("scroll.infinite_scroll")},InfiniteScroll.prototype.on_scroll=function(){return $(window).trigger("time-infinite-scroll"),this.handle_scroll()},InfiniteScroll.prototype.handle_scroll=_.debounce(function(){return!this.paused&&this.$viewport.scrollTop()<=this.threshold&&this.up_callback&&this.position>this.$viewport.scrollTop()?this.up_callback.call(this.context):!this.paused&&this.$viewport.height()+this.$viewport.scrollTop()+this.threshold>=this.$content.height()&&this.down_callback.call(this.context),this.position=this.$viewport.scrollTop(),this.position},50),InfiniteScroll.prototype.pause=function(){return this.paused=!0},InfiniteScroll.prototype.resume=function(){return this.paused=!1},InfiniteScroll}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.component.MobileNavigation=function(_super){function MobileNavigation(){var $doc,$header,posTop;MobileNavigation.__super__.constructor.apply(this,arguments),$doc=$(document),posTop=0,$header=$(".main-header"),$(this.opts.menuSelector).on("shown",function(){var headerHeight,viewportHeight,viewportWidth;return posTop=$doc.scrollTop(),headerHeight=$header.outerHeight(),viewportHeight=Time.util.getHeight(),viewportWidth=Time.util.getWidth()}),$(this.opts.menuSelector).on("hidden",function(_this){return function(){return Modernizr.touch&&$doc.scrollTop(posTop),Time.util.enable_scrolling(),$(_this.opts.menuSelector).removeProp("style")}}(this)),$(this.opts.parentSelector).find(".main-nav a:not(.login-nav-item)").on("click",function(_this){return function(){return _this.hide()}}(this))}return __extends(MobileNavigation,_super),MobileNavigation}(Time.component.Dropdown);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.component.Navigation=function(_super){function Navigation(){var scrolled_pos;Navigation.__super__.constructor.apply(this,arguments),scrolled_pos=!1,this.$el.on("clicked-open",function(){return scrolled_pos=$(".rail-articles-scroll").scrollTop()}),$(this.opts.menuSelector).on("hidden",function(){return _.defer(function(){return $(".rail-articles-scroll").scrollTop(scrolled_pos)}),Time.Ad.update_left_rail_all_el_pos()}),$(this.opts.parentSelector).find(".main-nav a:not(.login-nav-item)").on("click",function(_this){return function(){return _this.hide()}}(this))}return __extends(Navigation,_super),Navigation}(Time.component.Dropdown);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.component.RailSearch=function(_super){function RailSearch(){return RailSearch.__super__.constructor.apply(this,arguments)}return __extends(RailSearch,_super),RailSearch.prototype.opts={parentSelector:"body",classToAdd:"show-search",menuSelector:".tabs-inner",handleClickOutside:!0,formSelector:".search-form",fieldSelector:".search-field"},RailSearch.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.handleEnter(),this.exitSearch(evt)):this.enterSearch(evt)},RailSearch.prototype.enterSearch=function(evt){return this.show(evt),this.placeholderShim(),$(".search-field").focus(),$("body").on("keydown.rail-search-"+this.opts.classToAdd,function(_this){return function(e){return _this.handleKeydown(e)}}(this))},RailSearch.prototype.handleKeydown=function(e){var key;return key=e.which||e.keyCode,this.isEnter(key)?this.handleEnter():this.isESC(key)?this.exitSearch():void 0},RailSearch.prototype.handleEnter=function(){var value;return value=$(this.opts.fieldSelector).val(),value!==$(this.opts.fieldSelector).attr("placeholder")&&value.length&&!/\s+/.test(value)?$(this.opts.formSelector).submit():void 0},RailSearch.prototype.exitSearch=function(evt){return $("body").off("keydown.rail-search-"+this.opts.classToAdd),this.hide(evt)},RailSearch.prototype.isEnter=function(key){return 13===parseInt(key)?!0:!1},RailSearch.prototype.isESC=function(key){return 27===parseInt(key)?!0:!1},RailSearch.prototype.placeholderShim=function(){var field,placeholder;return field=$(this.opts.fieldSelector),placeholder=field.attr("placeholder"),field.val()!==placeholder&&field.val(placeholder),field.focus(function(){return this.value===placeholder?(this.setSelectionRange(0,0),field.addClass("empty")):void 0}),field.blur(function(){return""===this.value?this.value=placeholder:void 0}),$("body").on("keydown.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyDown(e,field,placeholder)}}(this)),$("body").on("keyup.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyUp(e,field,placeholder)}}(this))},RailSearch.prototype.placeholderShimKeyDown=function(e,field,placeholder){return field.val()===placeholder?field.val(field.val().replace(placeholder,"")).removeClass("empty"):void 0},RailSearch.prototype.placeholderShimKeyUp=function(e,field,placeholder){return""===field.val()?field.setSelectionRange(0,0).val(placeholder).addClass("empty"):void 0},RailSearch}(Time.component.Dropdown),Time.component.Ticker=function(){function Ticker(){}return Ticker.prototype.initComponent=function(index){var that;return this.curr_index=index?index:0,this.max_index=this.$items.length-1,this.$counter_total&&this.setCounterTotal(),that=this,Modernizr.touch&&(this.$el.touchwipe({wipeLeft:$.proxy(that.advance,that),wipeRight:$.proxy(that.recede,that),min_move_x:6,min_move_y:6,preventDefaultEvents:!1}),this.$el.click(that.advance,that)),this.updatePositionalClasses(!0),this.trigger("ticker:initComponent")},Ticker.prototype.auto_play=function(milliseconds){return null==milliseconds&&(milliseconds=500),this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(_this){return function(){return _this.advance()}}(this),milliseconds)},Ticker.prototype.advance=function(e){e&&e.preventDefault(),this.curr_index++,this.curr_index>this.max_index?this.circular?(this.curr_index=0,this.updatePositionalClasses()):this.handle_end():this.updatePositionalClasses()},Ticker.prototype.recede=function(e){e&&e.preventDefault(),this.curr_index--,this.curr_index<0?this.circular?(this.curr_index=this.max_index,this.updatePositionalClasses()):this.handle_beginning():this.updatePositionalClasses()},Ticker.prototype.goto_index=function(index){return this.curr_index=index,this.updatePositionalClasses()},Ticker.prototype.goto_start=function(){return this.goto_index(0)},Ticker.prototype.goto_end=function(){return this.goto_index(this.max_index)},Ticker.prototype.handle_end=function(){return this.trigger("ticker:max_limit"),this.goto_end()},Ticker.prototype.handle_beginning=function(){return this.trigger("ticker:min_limit"),this.goto_start()},Ticker.prototype.updatePositionalClasses=function(){var $el,i,_i,_len,_ref;for(this.trigger("ticker:beforeUpdatePositionalClasses",this),"undefined"!=typeof console&&null!==console&&console.log("ticker component - update positional classes"),_ref=this.$items,i=_i=0,_len=_ref.length;_len>_i;i=++_i)$el=_ref[i],i<this.curr_index&&$el.addClass("passed").removeClass("current upcoming"),i===this.curr_index&&$el.addClass("current").removeClass("passed upcoming").trigger("isCurrent"),i>this.curr_index&&$el.addClass("upcoming").removeClass("passed current");return this.trigger("ticker:afterUpdatePositionalClasses",this),this.curr_index===this.max_index?this.trigger("ticker:last"):void 0},Ticker.prototype.getCurrentItem=function(){return this.$items[this.curr_index]},Ticker.prototype.getCurrentIndex=function(){return this.curr_index},Ticker.prototype.setCounterTotal=function(index){return this.$counter_total.text(index?index+1:this.max_index+1)},Ticker.prototype.setCounterCurrent=function(index){return this.$counter_current.text(index?index+1:this.curr_index+1)},Ticker}(),Time.util={getWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||screen.width},getHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||screen.height},disable_scrolling:function(){return $("body").attr("style","overflow: hidden; position: fixed;")},enable_scrolling:function(){return $("body").css({overflow:"",position:""})},is_android_lte_23:function(){var i,match,uaMatches,_i,_len;if(uaMatches=navigator.userAgent.match(/Android ([0-9]+)/),null==uaMatches||!uaMatches.length)return!1;for(i=_i=0,_len=uaMatches.length;_len>_i;i=++_i)if(match=uaMatches[i],3.1>=parseFloat(match.replace("Android ","")))return!0;return!1},is_native_android_browser:function(){var nua;return nua=navigator.userAgent,nua.indexOf("Mozilla/5.0")>-1&&nua.indexOf("Android ")>-1&&nua.indexOf("AppleWebKit")>-1&&!(nua.indexOf("Chrome")>-1)},getDayOfYear:function(){var firstDay,today;return today=new Date,firstDay=new Date(today.getFullYear(),0,1),Math.round((today-firstDay)/1e3/60/60/24+.5,0)},waitFor:function(reference,referenceType,callback,interval,maxCallCount){return null==callback&&(callback=!1),null==interval&&(interval=500),null==maxCallCount&&(maxCallCount=12),0===maxCallCount?!1:(maxCallCount-=1,setTimeout(function(){return typeof reference===referenceType?callback():Time.util.waitFor(reference,referenceType,callback,interval,maxCallCount)},interval))}},Time.component.make=function(componentName,selector,config){return $(selector).each(function(){var tempObj;return $.data(this,componentName)?void 0:(tempObj=new Time.component[componentName](selector,config),$.data(this,componentName,tempObj))})},Time.component.Modal=function(){function Modal(elSelector,config){this.opts=$.extend(!0,{},this.defaults,config),this.$el=$(elSelector),this.bind()}return Modal.prototype.defaults={closeSelector:".close-button",buttonSelector:".modal-button",interiorSelector:".modal",classToShow:"active",isShowing:!1,handleResize:!1,$html:$("html")},Modal.prototype.bind=function(){return this.opts.$html.delegate(this.opts.buttonSelector,{"click.smart-modal":function(_this){return function(e){return _this.show(e)}}(this)})},Modal.prototype.show=function(e){var shownEvt;return e&&e.preventDefault(),this.opts.isShowing?this.$el:(shownEvt=$.extend(!0,e,{type:"shown"}),this.isShowing=!0,this.opts.$html.css("overflow","hidden"),this.bindClose(),this.$el.addClass(this.opts.classToShow).trigger(shownEvt))},Modal.prototype.hide=function(e){return e&&e.preventDefault(),this.opts.isShowing=!1,this.unbindClose(),this.opts.$html.css("overflow","visible"),this.$el.removeClass(this.opts.classToShow).trigger("hidden")},Modal.prototype.bindClose=function(){return this.opts.$html.on({"click.smart-modal-close":function(_this){return function(e){var $targ,isCloseBtn,isNotModal;return $targ=$(e.target||event.sourceElement),isCloseBtn=$targ.is(_this.opts.closeSelector||$(_this.opts.closeSelector).has($targ).length>0),isNotModal=!$(_this.opts.interiorSelector).has($targ).length>0&&!$(_this.opts.interiorSelector).is($targ),isNotModal||isCloseBtn?(e.preventDefault(),_this.hide()):void 0}}(this)})},Modal.prototype.unbindClose=function(){return this.opts.$html.off(".smart-modal-close")},Modal.prototype.destroy=function(){return this.opts.$html.off(".smart-modal .smart-modal-close"),this.$el.off(".smart-modal").removeData(".smart-modal")},Modal}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Gallery=function(_super){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return __extends(Gallery,_super),Gallery.prototype.defaults={isPrimary:!1,photos:[],hasAds:!0,adfrequency:null,view:null,slideIndex:0},Gallery.prototype.url=function(){return this.base_url+this.id+"/"},Gallery.prototype.initialize=function(){return this.base_url="/api/gallery/",_.bindAll(this,"url"),this.syncing=!1,this.listenTo(this,"change:isPrimary",function(model,value){value&&Time.trigger("article:primaryGallery:found",this)}),this.listenToOnce(this,"sync:error",function(){"undefined"!=typeof console&&null!==console&&console.error("GalleryModel "+this.id+" could not sync")}),this.listenToOnce(this,"gallery:dataReady",function(){this.get("adfrequency")||this.set("adfrequency","vertical"===this.get("size")?4:6)}),this},Gallery.prototype.getData=function(){return this.get("photos").length?this.trigger("gallery:dataReady"):(this.listenToOnce(this,"sync:complete",function(){this.trigger("gallery:dataReady")}),this.fetch()),this},Gallery.prototype.parse=function(response){return response.gallery},Gallery.prototype.fetch=function(opts){var complete_callback,success_callback,_ref;return null==opts&&(opts={}),complete_callback=opts.complete,success_callback=opts.success,(null!=(_ref=this.collection.get_from_cache(this.id))?_ref.get("photos"):void 0)?(this.set(this.collection.get_from_cache(this.id)),null!=complete_callback&&complete_callback.call(this),null!=success_callback&&success_callback.call(this),void this.trigger("sync:success")):this.syncing?!1:(this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.complete=function(_this){return function(response){return _this.trigger("sync:complete"),_this.syncing=!1,null!=complete_callback?complete_callback.call(model,response,options):void 0}}(this),opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null==response.error&&null!=success_callback?success_callback.call(model,response,options):void 0)}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},Gallery.prototype.getView=function(){return null!=this.view?this.view:(this.view=new Time.views.GalleryVertical({model:this}),this.view)},Gallery.prototype.getSlideIndex=function(){return parseInt(this.get("slideIndex"),10)},Gallery.prototype.getTotalSlides=function(){var _ref;return null==(null!=(_ref=this.view)?_ref.slidesCollection.length:void 0)?0:this.view.slidesCollection.length},Gallery}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Application=function(_super){function Application(){return Application.__super__.constructor.apply(this,arguments)}return __extends(Application,_super),Application.prototype.defaults={activeArticle:null,activeGallery:null,isFullscreen:!1,isInitialRoute:!0,isNewLeftRail:!0,isRailToggleable:!1,isRailUserOpen:!1,isRailOpen:!0},Application.prototype.initialize=function(){return this.listenTo(Time,"router:route",function(_this){return function(){_this.get("isInitialRoute")?(Time.trigger("router:first"),_this.set("isInitialRoute",!1)):Time.trigger("router:notFirst")}}(this)),this.listenToOnce(Time,"article:navigated",function(articleModel){var _ref,_ref1;"undefined"!=typeof console&&null!==console&&console.info("Time heard article:navigated for first time"),(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.single_article)?_ref1.id:void 0)===articleModel.id&&articleModel.set("isSingleOnPageload",!0)}),this.listenTo(Time,"article:navigated",function(articleModel){var _ref;"undefined"!=typeof console&&null!==console&&console.info("Time heard article:navigated, setting activeArticle"),(null!=(_ref=this.get("activeArticle"))?_ref.id:void 0)!==articleModel.id&&this.deactivateArticle(),this.set("activeArticle",articleModel)}),this.listenTo(this,"change:activeArticle",function(model,value){"undefined"!=typeof console&&null!==console&&console.info("Time heard change:activeArticle"),(null!=value&&"function"==typeof value.get?value.get("isActive"):void 0)&&$(window).trigger("time-article-active")}),this.listenToOnce(Time,"article:primaryGallery:found",function(_this){return function(galleryModel){_this.set("activeGallery",galleryModel)}}(this)),this},Application.prototype.deactivateArticle=function(articleModel){return null==articleModel&&(articleModel=this.get("activeArticle")),null!=articleModel&&articleModel.set("isActive",!1),this},Application.prototype.getActiveGallery=function(){var activeArticle,activeArticleView,activeGalleryModel,galleriesCollection,topBannerHeight,windowTop,_ref;return this.has("activeArticle")?(activeArticle=this.get("activeArticle"),activeArticleView=null!=activeArticle&&null!=(_ref=activeArticle.views)?_ref.singleView:void 0,null==activeArticleView?null:(galleriesCollection=activeArticleView.galleriesCollection,(null!=galleriesCollection?galleriesCollection.size():void 0)?(windowTop=$(window).scrollTop(),topBannerHeight=Time.application.$top_banner.height(),activeGalleryModel=galleriesCollection.find(function(gallery){var galleryTop,_ref1;return(null!=(_ref1=gallery.view)?_ref1.$el:void 0)?gallery.get("isFullscreen")?!0:(galleryTop=gallery.view.$el.position().top,galleryTop>=windowTop+topBannerHeight?!0:void 0):!1}),null!=activeGalleryModel?(this.set("activeGallery",activeGalleryModel),activeGalleryModel):null):null)):null},Application}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);
return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Article=function(_super){function Article(){return Article.__super__.constructor.apply(this,arguments)}return __extends(Article,_super),Article.prototype.defaults={isActive:!1,visible:!1,hasHeroImage:!1,isSingleOnPageload:!1,eventsToBeFiredArray:[],galleriesRendered:0,initialized:!1},Article.prototype.initialize=function(){return this.views={},this.listenTo(this,"change:isActive",function(model,value){"undefined"!=typeof console&&null!==console&&console.info("--------------------------------------------------------------------------------"),"undefined"!=typeof console&&null!==console&&console.info("article model ",this.id," heard change:isActive",value),value&&this.maybeNavigateTo()}),null!=this.collection&&this.listenTo(this.collection,"flush",function(_this){return function(){return _this.set("isActive",!1)}}(this)),this},Article.prototype.hasComponent=function(component){var _ref;if(this.get("isSingleOnPageload")){if(null==(null!=(_ref=Time.bootstrap.single_article)?_ref[component]:void 0))return!1}else if(!this.get(component))return!1;return!0},Article.prototype.url=function(){return Time.api_url+"post/"+this.get("id")+"/"},Article.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;return null==opts&&(opts={}),this.syncing?void 0:((null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null!=fn_success?fn_success(model,response,options):void 0)}}(this),fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){return _this.trigger("sync:complete"),_this.syncing=!1,null!=fn_complete?fn_complete(model,response,options):void 0}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response,options){return _this.trigger("sync:error"),fn_error?fn_error(model,response,options):void 0}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},Article.prototype.create_tile_view=function(){if(this.get("is_nativo"))return this.views.tile_view=new Time.views.NativoArticleTile({model:this});switch(this.collection.active_env){case"magazine":return this.views.tile_view=new Time.views.ArticleMagazineTile({model:this});case"collection":return this.views.tile_view=new Time.views.ArticleCollectionsTile({model:this});default:return this.views.tile_view=new Time.views.ArticleTile({model:this})}},Article.prototype.createSingleView=function(){return this.views.singleView=new Time.views.ReadingPaneArticle({model:this}),this.views.singleView},Article.prototype.hasSingleView=function(){return null!=this.views.singleView},Article.prototype.has_tile_view=function(){return null!=this.views.tile_view},Article.prototype.is_in_content_well=function(){return Time.application.$viewport.find(".full-article[data-article='"+this.id+"']").length},Article.prototype.getBrandedTitle=function(){var title;return title=this.get("title"),/money_collection|money_collectionpost|money_article/.test(this.get("post_type"))?title+" | Money.com":title+" | TIME"},Article.prototype.maybeNavigateTo=function(){return null!=this.collection&&(this.collection.freeze_url||this.collection.freeze_url_once)?this.collection.freeze_url_once=!1:this.navigateTo(),"undefined"!=typeof console&&null!==console&&console.info("article model triggering article:navigated on Time"),Time.trigger("article:navigated",this),this},Article.prototype.navigateTo=function(){var relative_url;relative_url=Time.application.sanitize_url(this.get("url")),Time.application.router.navigate(relative_url,!1),Time.taboola_counter++;try{Time.taboola.renderModules()}catch(_error){}return this},Article}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.BrightcoveVideo=function(_super){function BrightcoveVideo(){return BrightcoveVideo.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideo,_super),BrightcoveVideo.prototype.defaults={state:"stopped",experience:null,videoPlayer:null,adPlayer:null,isPrimary:null},BrightcoveVideo.prototype.initialize=function(){return this},BrightcoveVideo}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.DfpAd=function(_super){function DfpAd(){return DfpAd.__super__.constructor.apply(this,arguments)}return __extends(DfpAd,_super),DfpAd.prototype.defaults={adInstance:null,isCmAd:!1,isActive:!0,isTrigger:!1,isWritten:!1,isRendered:!1,isTethered:!1,tetherTo:null,group:"",subgroup:"",size:null,position:1},DfpAd.prototype.initialize=function(){return this},DfpAd}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.DfpAdManager=function(_super){function DfpAdManager(){return DfpAdManager.__super__.constructor.apply(this,arguments)}return __extends(DfpAdManager,_super),DfpAdManager.prototype.defaults={zone:"",factory:null,adSizes:[],isInitialAdCycle:!0},DfpAdManager.prototype.initialize=function(attributes,options){var authors,error,i,the_authors,the_authors_length,_ref,_ref1,_ref2;if(null==attributes&&(attributes={}),null==options&&(options={}),null!=options.app&&(this.app=options.app),window.TGX_SITE_CONFIG={gpt_sync_mode:"async",refresh_oop_slot:!0},the_authors_length=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.single_article)&&null!=(_ref2=_ref1.authors)?_ref2.length:void 0)||0,authors=[],the_authors_length){for(the_authors=Time.bootstrap.single_article.authors,i=0;the_authors_length>i;)authors.push(the_authors[i].name),i++;authors=authors.join()}window._sf_async_config={uid:3088,domain:"time.com",useCanonical:!0,scrollElement:!0,sections:null!=TIME_DFP.zone?TIME_DFP.zone:"",zone:null!=TIME_DFP.zone?TIME_DFP.zone:"",authors:authors},this.bindListeners(),this.adSizes=[],this.factoryConfig=this.createConfig(),this.factoryData=TIME_DFP,this.factoryZone=this.getFactoryZone(this.factoryData),this.factoryInstance=this.createFactory(this.factoryConfig,this.factoryZone),this.setDefaultFactoryParams(this.factoryInstance),this.setInitialFactoryParams(this.factoryInstance,this.factoryData);try{Time.Ad.setGlobalAdZone(this.factoryZone),Time.Ad.setGlobalFactory(this.factoryInstance),Time.Ad.setGlobalAdSizes(this.adSizes),Time.Ad.init(),Time.Ad.initNativo()}catch(_error){error=_error,console.error("DfpAdManager -- could not init Time.Ad",error)}return this},DfpAdManager.prototype.bindListeners=function(){return console.debug("DfpAdManager -- bindListeners"),this.listenTo(Time,"dfpAdManager:factory:setDefaultParams",function(_this){return function(factoryInstance){console.debug("DfpAdManager heard dfpAdManager:refreshAds on Time",factoryInstance),_this.setDefaultFactoryParams(factoryInstance)}}(this)),this.listenTo(Time,"dfpAdManager:factory:maybeReset",function(_this){return function(factoryInstance,articleModel){console.debug("Time heard dfpAdManager:factory:maybeReset for article:",null!=articleModel?articleModel.id:void 0),_this.maybeResetFactory(factoryInstance,articleModel)}}(this)),this.listenTo(Time,"dfpAdManager:factory:reset",function(_this){return function(params){console.debug("Time heard dfpAdManager:factory:reset"),_this.resetFactory(_this.getFactory(),params)}}(this)),this},DfpAdManager.prototype.createConfig=function(){var adConfig,error;console.debug("DfpAdManager - createConfig");try{return"mobile"===Time.device?(this.sitename="3475.tim_mobile",this.adSizes=Time.Ad.getAdSizes("mobile")):"tablet"===Time.device?(this.sitename="3475.tim_tablet",this.adSizes=Time.Ad.getAdSizes("tablet"===Time.device&&$(window).width()<$(window).height()?"mobile":"tablet")):(this.sitename="3475.tim",this.adSizes=Time.Ad.getAdSizes("desktop")),console.debug("-- createConfig with sitename and use these adSizes",this.sitename,this.adSizes),adConfig=new TiiAdConfig(this.sitename),adConfig.setCmSitename("cm.tim"),adConfig.setRevSciTracking(!0),adConfig.setdisableInitLoad(!0),adConfig}catch(_error){return error=_error,console.error("-- createConfig - couldn't create a config",error),null}},DfpAdManager.prototype.getConfig=function(){var error;console.debug("DfpAdManager - getConfig"),this.factoryConfig=null;try{this.factoryConfig=Time.Ad.getFactoryConfig()}catch(_error){return error=_error,console.error("-- getConfig - couldn't get ad factory config",error),null}return this.factoryConfig},DfpAdManager.prototype.getFactoryZone=function(factoryData){var vertical,zone;return zone="",console.debug("DfpAdManager -- getFactoryZone"),(null!=factoryData?factoryData.zone:void 0)?(zone=factoryData.zone,(factoryData.params.subch||"collection"===factoryData.params.ptype)&&(vertical=window.history&&history.pushState?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],zone="collections/"+factoryData.zone,vertical.match(/money/)&&(zone="money/"+zone)),zone=zone.toLowerCase().replace(/\./g,"")):(console.debug("-- no zone in factoryData",factoryData),"")},DfpAdManager.prototype.getFactory=function(){return this.factoryInstance=Time.Ad.getFactoryInstance(),this.factoryInstance},DfpAdManager.prototype.createFactory=function(factoryConfig,factoryZone){return console.debug("DfpAdManager - createFactory with config ",factoryConfig),factoryConfig=factoryConfig||this.getConfig(),null==factoryConfig?(console.error("-- createFactory -- missing factory config"),null):factoryZone?new TiiAdFactory(factoryConfig,factoryZone):new TiiAdFactory(factoryConfig)},DfpAdManager.prototype.sanitizeFactoryParamsZone=function(zone){return zone.toLowerCase().replace(/\./g,"")},DfpAdManager.prototype.sanitizeFactoryParamsPath=function(url){var path;return path=url.split("/"),path=path.slice(3,path.length-1)},DfpAdManager.prototype.flattenParams=function(params){var k,v;for(k in params)__hasProp.call(params,k)&&(v=params[k],_.isObject(v)&&!_.isArray(v)&&(_.extend(params,v),delete params[k]));return params},DfpAdManager.prototype.sanitizeFactoryParams=function(params){var key,sanitizedParams,value;sanitizedParams={},null!=(null!=params?params.url:void 0)&&(sanitizedParams.path=this.sanitizeFactoryParamsPath(params.url)),sanitizedParams.dcove="d",params=this.flattenParams(params);for(key in params)value=params[key],sanitizedParams[key]="topic"===key||"tags"===key?value.replace(/[^\w,]/g,"").toLowerCase():"string"==typeof value?value.toLowerCase():value;return sanitizedParams},DfpAdManager.prototype.wipeFactoryParams=function(factoryInstance){var key,value,_ref;_ref=factoryInstance.params;for(key in _ref)__hasProp.call(_ref,key)&&(value=_ref[key],console.debug("-- wipeFactoryParam",key),factoryInstance.clearParam(key));return factoryInstance},DfpAdManager.prototype.setFactoryParams=function(factoryInstance,params){var key,value;for(key in params)__hasProp.call(params,key)&&(value=params[key],console.debug("-- setFactoryParams",key,value),factoryInstance.setParam(key,value));return factoryInstance},DfpAdManager.prototype.setInitialFactoryParams=function(factoryInstance,factoryData){var $topic,params;return params={},factoryData.url=document.location.href,params=this.sanitizeFactoryParams(factoryData),$topic=$("body").find(".left-rail-topper").eq(0).find("#topic"),$topic.length&&$topic.hasClass("active")&&(params.ptype="topic"),console.debug("DfpAdManager - setInitialFactoryParams",params),this.setFactoryParams(factoryInstance,params),this},DfpAdManager.prototype.setDefaultFactoryParams=function(factoryInstance){var defaultParams,test;return console.debug("DfpAdManager - setDefaultFactoryParams on ",factoryInstance),defaultParams={rdsn:"yes"},null!=$.cookie("time_visit")&&(console.debug("-- setDefaultFactoryParams setting rvisit to yes"),defaultParams.rvisit=!0),null!=document.referrer&&document.referrer&&(defaultParams.rhost=document.referrer.split("/")[2],console.debug("-- setDefaultFactoryParam setting rhost to "+defaultParams.rhost)),test=("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.testads:void 0)||"",console.debug("-- setDefaultFactoryParams with ?testads = "+test),defaultParams.test=test,this.setFactoryParams(factoryInstance,defaultParams)},DfpAdManager.prototype.maybeResetFactory=function(factoryInstance,articleModel){var params,_ref;return null==factoryInstance?(console.error("-- maybeResetFactory in ",this," needs a valid factoryInstance.",factoryInstance),this):null==articleModel?this:articleModel.id===(null!=factoryInstance&&null!=(_ref=factoryInstance.params)?_ref.aid:void 0)?this:(params=Time.Ad.getFactoryData(articleModel),this.resetFactory(factoryInstance,params),this)},DfpAdManager.prototype.resetFactory=function(factoryInstance,params){var sanitizedParams,zone;return null==factoryInstance?(console.error("DfpAdManager resetFactory in ",this," needs a valid factoryInstance."),this):(console.debug("DfpAdManager reset factory ----------------------------------------"),this.wipeFactoryParams(factoryInstance),zone="",null!=(null!=params?params.zone:void 0)&&(zone=this.sanitizeFactoryParamsZone(params.zone)),Time.Ad.setGlobalAdZone(zone),factoryInstance.setZone(zone),this.setDefaultFactoryParams(factoryInstance),sanitizedParams=this.sanitizeFactoryParams(params),this.setFactoryParams(factoryInstance,sanitizedParams),console.debug("---------------------------------------- reset factory"),factoryInstance)},DfpAdManager.prototype.setFactorySegments=function(factoryInstance){var quantSegs,revSciSegments;return window.TiiAdGetRevSciSegments&&(revSciSegments=window.TiiAdGetRevSciSegments(),factoryInstance.setParam("rsseg",revSciSegments)),window.TiiAdGetQuantcastSegments&&(quantSegs=window.TiiAdGetQuantcastSegments(),factoryInstance.setParam("qc",quantSegs)),factoryInstance},DfpAdManager}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GalleryLightbox=function(_super){function GalleryLightbox(){return GalleryLightbox.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightbox,_super),GalleryLightbox.prototype.defaults=_.extend({},Time.models.Gallery.prototype.defaults,{lastSlideIndex:0,prerenderCount:3,isFullscreen:!1,isCaptionTruncated:!1,isCaptionExpanded:!0,isInitialSlide:!0,isAdvanceable:!1,isSwappable:!1}),GalleryLightbox.prototype.initialize=function(){return GalleryLightbox.__super__.initialize.apply(this,arguments),this},GalleryLightbox.prototype.getView=function(){return null!=this.view?this.view:(this.view=new Time.views.GalleryLightbox({model:this}),this.view)},GalleryLightbox.prototype.currentSlide=function(){var _ref;return null!=(_ref=this.view)?_ref.slidesCollection.at(this.get("slideIndex")):void 0},GalleryLightbox.prototype.isAtEnd=function(){return 0===this.getTotalSlides()?!0:this.getSlideIndex()===this.getTotalSlides()-1},GalleryLightbox.prototype.goSlide=function(index){return this.getSlideIndex()===index?this:0>index?this:index>this.getTotalSlides()-1?this:(this.set("slideIndex",index),this)},GalleryLightbox.prototype.goNextSlide=function(){var currentIndex,isAtSecondToLastSlide;return currentIndex=this.getSlideIndex(),isAtSecondToLastSlide=this.getTotalSlides()>=2?this.getTotalSlides()-2:0,"endless"===this.get("type")&&this.get("next_gallery")&&currentIndex===isAtSecondToLastSlide?($(".gallery__viewport").empty(),$(".gallery__viewport").addClass("loading-overlay"),window.location.href=this.get("next_gallery").url,this):(this.isAtEnd()?this.trigger("gallery:pastEnd"):this.set("slideIndex",currentIndex+1),this)},GalleryLightbox.prototype.goPrevSlide=function(){var currentIndex;return currentIndex=this.getSlideIndex(),0===currentIndex?this.trigger("gallery:swapPrev"):this.set("slideIndex",currentIndex-1),this},GalleryLightbox}(Time.models.Gallery);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GallerySlide=function(_super){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return __extends(GallerySlide,_super),GallerySlide.prototype.defaults={slideType:"default",isActive:!1,title:"Untitled Image",slug:"",caption:"",credit:"",alt:"",width:0,height:0,orientation:"landscape",url:"",encoded_shortlink:"",galleryTitle:"Untitled Gallery",twitterVia:"Time",twitterText:"",facebookText:"",emailText:""},GallerySlide.prototype.initialize=function(){switch(this.get("slideType")){case"endless":this.view=new Time.views.GallerySlideLightboxEndless({model:this});break;case"related":this.view=new Time.views.GallerySlideLightboxRelated({model:this});break;default:this.view=new Time.views.GallerySlide({model:this})}return this},GallerySlide.prototype.getEncodedGalleryTitle=function(){return encodeURIComponent(this.get("galleryTitle"))},GallerySlide.prototype.getEncodedUrl=function(){return encodeURIComponent(this.get("url"))},GallerySlide.prototype.getShareMail=function(){var emailBody,lineBreak;return lineBreak="%0D%0A%0D%0A",emailBody=this.get("emailText"),emailBody=emailBody?emailBody+lineBreak:"",emailBody=this.getEncodedGalleryTitle()+lineBreak+emailBody+this.getEncodedUrl(),"mailto:?subject="+this.getEncodedGalleryTitle()+"&body="+emailBody},GallerySlide.prototype.getShareTwitter=function(){var twitterText,twitterUrl;return twitterText=this.get("twitterText")||this.getEncodedGalleryTitle(),twitterUrl="https://twitter.com/intent/tweet",twitterUrl+="?url="+this.get("encoded_shortlink"),twitterUrl+="&text="+twitterText,twitterUrl+="&via="+this.get("twitterVia")},GallerySlide.prototype.getShareGplus=function(){return"https://plus.google.com/share?url="+this.getEncodedUrl()},GallerySlide.prototype.getShareLinkedIn=function(){return"http://www.linkedin.com/shareArticle?mini=true&url="+this.getEncodedUrl()+"&title="+this.getEncodedGalleryTitle()},GallerySlide.prototype.getShareFacebook=function(){var fbUrl;return fbUrl="http://facebook.com/sharer.php?s=100",fbUrl+="&p[title]="+this.getEncodedGalleryTitle(),fbUrl+="&p[url]="+this.getEncodedUrl()},GallerySlide}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GallerySlideAd=function(_super){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideAd,_super),GallerySlideAd.prototype.defaults={slideType:"ad",index:0,adIndex:1,isActive:!1,adModelId:""},GallerySlideAd.prototype.initialize=function(attributes,options){var size,templates,_ref;return null==attributes&&(attributes={}),null==options&&(options={}),this.galleryModel=options.galleryModel,this.set("adModelId","gallery__ad--"+this.getAdPosition()),size="vertical"===(null!=(_ref=this.galleryModel)?_ref.get("size"):void 0)?"vertical":"lightbox",templates={lightbox:"gallery-slide-lightbox-ad",vertical:"gallery-slide-vertical-ad"},this.view=new Time.views.GallerySlideAd({template:Time.templates[templates[size]],collection:this.collection,model:this}),this},GallerySlideAd.prototype.getAdPosition=function(){var articleId,articleModel,articleView,galleries,galleryId,slideIndex,_ref,_ref1;return galleryId=(null!=(_ref=this.galleryModel)?_ref.id:void 0)||"",slideIndex=this.get("index")||"",galleries=(null!=(_ref1=this.galleryModel)?_ref1.collection:void 0)||null,articleView=(null!=galleries?galleries.article:void 0)||null,articleModel=(null!=articleView?articleView.model:void 0)||null,articleId=(null!=articleModel?articleModel.id:void 0)||"","a"+articleId+"g"+galleryId+"s"+slideIndex},GallerySlideAd}(Backbone.Model),Time.models.MarketData=Backbone.Model.extend({initialize:function(){return{model:this}}}),Time.models.SpecialPage=Backbone.Model.extend({initialize:function(){return this}}),Time.models.Divider=Backbone.Model.extend({defaults:{type:"",divId:null},initialize:function(){return this.index=Time.models.Divider.index++,this.setType(),this},setType:function(){var activeEnv,_ref;if(activeEnv=null!=(_ref=Time.application.active_rail)?_ref.active_env:void 0,"collection"===activeEnv){if(0===this.index)return void this.set("type","empty");if(this.index%2===0)return void this.set("type","advert");this.set("type","empty")}else{if("mobile"===Time.device)return void this.set("type","advert");if("desktop"===Time.device)return this.index%7===6?void this.init_articles():void this.set("type","advert");this.index%2===0?this.set("type","advert"):this.init_articles()}return this},init_articles:function(){return this.set("type","articles"),null!=Time.bootstrap.dividers&&(this.set("articles_html",Time.bootstrap.dividers[Time.models.Divider.bootstrap_index]),Time.models.Divider.bootstrap_index++,Time.models.Divider.bootstrap_index>=Time.bootstrap.dividers.length)?Time.models.Divider.bootstrap_index=0:void 0},init_taboola:function(){return this.set("type","taboola")}}),Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,Time.models.TickerHeadline=Time.models.Article.extend({initialize:function(){return this.view=new Time.views.TickerHeadline({model:this})}}),Time.collections.Rail=Backbone.Collection.extend({model:Time.models.Article,adFrequency:10,adOffset:4,syncing:!1,page:1,endpoint:"latest",active_env:"trending",real_article_index:0,article_index:0,sponsored_article_index:0,sponsored_article_cycles:0,ad_in_left_rail:0,freeze_url:!1,freeze_url_once:!1,branding:Time.branding,initialize:function(){var TimerRef,_ref;return TimerRef=!1,Time.application.load_ticker(),Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,(null!=(_ref=Time.bootstrap.single_article)?_ref.sponsor:void 0)&&Time.bootstrap.sponsors[0].id===Time.bootstrap.single_article.id&&Time.bootstrap.sponsors.push(Time.bootstrap.sponsors.shift()),this.view=new Time.views.Rail({collection:this}),this.listenTo(this,"add",function(_this){return function(model){var post_type;return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view(),null!=Time.bootstrap.sponsors&&_this.real_article_index%10===6&&_this.add_sponsored_article(),post_type=model.get("post_type")}}(this)),this},getIdFromUrl:function(){var id,matches,route;return route=Backbone.history.fragment,id=null,matches=/^money\/([0-9]+)\/?/.exec(route),matches&&(id=matches[1]),id||(id=route.substring(0,route.indexOf("/"))),isNaN(id)||(id=parseInt(id,10)),id},moveArticleFirst:function(article,articles){var id;return null==article&&(article=null),(null!=articles?articles.length:void 0)?(article||(id=this.getIdFromUrl(),article=this.getArticleFromBootstrap(id)),article?(articles=_.reject(articles,function(a){return a.id===article.id}),this.firstArticle=article,articles.unshift(article),articles):(console.info("moveArticleFirst needs an article to move first"),articles)):(console.error("moveArticleFirst -- No articles to prioritize"),null)},load_articles:function(){var article,articles,_ref;return null!=(null!=(_ref=Time.bootstrap.latest)?_ref.articles:void 0)?(console.log("_rail -- load_articles -- using bootstrap"),article=Time.bootstrap.single_article?Time.bootstrap.single_article:null,articles=this.moveArticleFirst(article,Time.bootstrap.latest.articles),void this.add(articles)):(console.log("_rail -- load_articles -- using xhr"),void(Time.application.railXHR=this.fetch()))},load_section_header:function(data){var html;return null!=data.menu&&data.menu.items.length>0?(html=Time.templates["section-menu"].render(data),$(".topic-banner").html(html)):void 0},url:function(){var url;return url=null!=this.view.vertical?Time.api_url+this.view.vertical+"/"+this.endpoint+"/":Time.api_url+this.endpoint+"/",this.page>1&&(url+="page/"+this.page+"/"),url},fetch:function(opts){var fn_complete,fn_error,fn_success;return null==opts&&(opts={}),this.syncing?void 0:((null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.next_page&&this.page++,fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){_this.syncing=!1,_this.trigger("sync:complete"),null!=fn_complete&&fn_complete(model,response,options)}}(this),fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):void _this.fetchSuccess(fn_success,model,response,options)}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response){_this.reached_ceiling=!0,$(".scroll-for-more").hide(),_this.trigger("sync:error"),null!=fn_error&&fn_error(model,response,options)}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},fetchSuccess:function(originalCallback,model,response,options){var hasReadAndOrSharedArrays,isLoadedLessThanRequested,noArticles,noMoreToLoad,_ref,_ref1,_ref2;return this.trigger("sync:success"),"function"==typeof originalCallback&&originalCallback(model,response,options),isLoadedLessThanRequested=(null!=response&&null!=(_ref=response.articles)?_ref.length:void 0)<Time.posts_per_page,hasReadAndOrSharedArrays=(null!=response&&null!=(_ref1=response.read)?_ref1.length:void 0)>0||(null!=response&&null!=(_ref2=response.shared)?_ref2.length:void 0)>0,noArticles=response.error||response.articles===!1,noMoreToLoad=null==response||noArticles||isLoadedLessThanRequested,(noMoreToLoad||hasReadAndOrSharedArrays)&&this.reached_page_limit(),this},freezeIfSlug:function(slug,articleModel){var _ref,_ref1;return null!=slug?(this.freeze_url_once=!0,"gallery"===(null!=articleModel?articleModel.get("format"):void 0)?Time.initial_gallery_slug=slug:null!=articleModel&&null!=(_ref=articleModel.views)&&null!=(_ref1=_ref.singleView)&&_ref1.jump_to_item(slug),Time.application.hide_loader(Time.application.$viewportWrapper)):Time.application.reset_scroll(),this},getArticleFromBootstrap:function(articleId){var article,_ref;return article=!1,articleId===(null!=(_ref=Time.bootstrap.single_article)?_ref.id:void 0)?Time.bootstrap.single_article:null!=Time.bootstrap.latest?article=_.find(Time.bootstrap.latest,function(a){return articleId===a.id}):!1},load_single_article:function(article_id,item_slug){var articleData,article_model;return null!=this.get(article_id)?("undefined"!=typeof console&&null!==console&&console.info("article exists in collection, syncing instead of fetching"),this.synchronize(article_id,item_slug)):(article_model=new Time.models.Article({id:article_id}),article_model.createSingleView(),this.listenToOnce(article_model,"change:title",function(_this){return function(){return _this.listenToOnce(article_model,"article:rendered",function(){return Time.application.hide_loader(Time.application.$viewportWrapper),_this.listenToOnce(_this,"viewport_filled",function(){return _this.freezeIfSlug(item_slug,article_model),"undefined"!=typeof console&&null!==console&&console.info("rail load_single_article setting isActive on article model"),article_model.set("isActive",!0)}),_this.fill_viewport()}),_this.set_visible_article(article_model),"undefined"!=typeof console&&null!==console&&console.info("rail load_single_article heard article model change:title, rendering single view"),article_model.views.singleView.render()}}(this)),articleData=this.getArticleFromBootstrap(article_id),null!=articleData?article_model.set(articleData):this.movedArticle?article_model.set(this.movedArticle):article_model.fetch()),article_model},parse:function(response){return console.log("collections/_rail -- parse",response),null==response?(console.error("collections/_rail -- parse -- no response"),this.reached_ceiling=!0,$(".scroll-for-more").hide(),null):response.articles?(response.articles=this.moveArticleFirst(null,response.articles),"videos"===this.active_env&&_.each(response.articles,function(article){return article.display_hero=null!=article.hero}),response.articles):(console.info("collections/_rail -- parse -- no articles in response:",response),this.reached_ceiling=!0,$(".scroll-for-more").hide(),null)},set_visible_article:function(model){return this.visible_article=model},get_visible_article:function(){return this.get(this.visible_article)},get_previous_article:function(){var activeArticleIndex,activeArticleModel,previousModel;if(Time.application.model.get("activeArticle"))return activeArticleModel=Time.application.model.get("activeArticle"),activeArticleIndex=this.indexOf(activeArticleModel),previousModel=this.at(activeArticleIndex-1),null!=previousModel?previousModel:!1},get_next_article:function(){var model;return model=this.at(this.indexOf(this.get_visible_article())+1),null!=model?model:!1},show_previous_article:function(){var previous_article;return previous_article=this.get_previous_article(),previous_article&&!previous_article.is_in_content_well()?(previous_article.hasSingleView()||previous_article.createSingleView(),previous_article.views.singleView.render({method:"prepend"})):void 0},show_next_article:function(){var next_article,_ref;return next_article=this.get_next_article(),next_article?(next_article.is_in_content_well()||(next_article.hasSingleView()||next_article.createSingleView(),null!=next_article.get("cover")?(null!=Time.application.active_rail&&Time.application.model.get("activeArticle")&&null!=(_ref=Time.application.model.get("activeArticle"))&&_ref.set("isActive",!1),Time.application.arr_article_views.length=0,next_article.views.singleView.render(),next_article.views.tile_view.model.set("isActive",!0)):next_article.views.singleView.render({method:"append"})),this.set_visible_article(next_article)):this.fetch_next_page()},fetch_next_page:function(){return this.reached_ceiling?void 0:this.fetch({next_page:!0,remove:!1})},reached_page_limit:function(){return this.reached_ceiling=!0,$(".scroll-for-more").hide(),this.view.scroll_limit_message(),Time.application.$viewport.removeClass("loading")},synchronize:function(article_id,item_slug){var article_model;return"undefined"!=typeof console&&null!==console&&console.info("collections/_rail -- synchronize",article_id,item_slug),this.trigger("flush"),null==article_id&&(article_id=this.at(0).cid),article_model=this.get(article_id),null==article_model.views.singleView&&article_model.createSingleView(),this.listenToOnce(article_model,"article:rendered",function(_this){return function(){return _this.freezeIfSlug(item_slug,article_model),article_model.set("isActive",!0),_this.fill_viewport()}}(this)),this.set_visible_article(article_model),"undefined"!=typeof console&&null!==console&&console.info("rail synchronize rendering single view"),article_model.views.singleView.render()
},fill_viewport:function(){var bodyHeight;"undefined"!=typeof console&&null!==console&&console.log("_rail -> fill_viewport = content",this),bodyHeight=Time.application.$window.height()-Time.application.$main_header.height(),!this.reached_ceiling&&0!==Time.application.$viewport.get(0).scrollHeight&&Time.application.$viewport.get(0).scrollHeight<=bodyHeight?(this.show_next_article(),window.setTimeout(function(_this){return function(){return _this.fill_viewport()}}(this),100)):this.trigger("viewport_filled")},add_sponsored_article:function(){var error,sponsored_article;if(this.sponsored_article_index+1>Time.bootstrap.sponsors.length&&(this.sponsored_article_index=0,this.sponsored_article_cycles++),null==Time.bootstrap.sponsors[this.sponsored_article_index])return!1;this.rail_index=this.article_index+this.sponsored_article_index+Time.bootstrap.sponsors.length*this.sponsored_article_cycles,Time.bootstrap.sponsors[this.sponsored_article_index].id=parseInt(this.sponsored_article_cycles.toString()+Time.bootstrap.sponsors[this.sponsored_article_index].id.toString()),this.add(Time.bootstrap.sponsors[this.sponsored_article_index],{silent:!0,at:this.rail_index}),sponsored_article=this.at(this.rail_index);try{return sponsored_article.create_tile_view(),this.sponsored_article_index++,this.trigger("rail:added_sponsored_article")}catch(_error){error=_error}},move_model:function(model,toIndex){var fromIndex;if(fromIndex=this.indexOf(model),-1===fromIndex)throw new Error("Can't move a model that's not in the collection");return this.models.splice(toIndex,0,this.models.splice(fromIndex,1)[0])},load_tabs:function(label){var href,new_tab_data,sub;return new_tab_data=Time.tab_data["default"],href="/"+this.active_env+"/"+this.sub+"/",sub=this.sub,new_tab_data.tabs[0]={label:null!=this.label?this.label:label,omniture:this.is_collection?"nav-collection":"nav-"+this.sub,env:this.active_env,sub:null!=this.sub?this.sub:sub,href:null!=this.href?this.href:href},Time.application.load_tabs(new_tab_data),Time.application.tabs_view.set_active(0)}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.BrightcoveVideos=function(_super){function BrightcoveVideos(){return BrightcoveVideos.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideos,_super),BrightcoveVideos.prototype.model=Time.models.BrightcoveVideo,BrightcoveVideos.prototype.initialize=function(){return this},BrightcoveVideos.prototype.getOthers=function(id){var otherPlayers;return otherPlayers=this.reject(function(otherPlayer){return otherPlayer.id===id})},BrightcoveVideos}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.DfpAds=function(_super){function DfpAds(){return DfpAds.__super__.constructor.apply(this,arguments)}return __extends(DfpAds,_super),DfpAds.prototype.model=Time.models.DfpAd,DfpAds.prototype.initialize=function(){return console.debug("DfpAds -- init"),this.listenTo(Time,"dfpAdManager:getAd",this.getOrCreate),this},DfpAds.prototype.getIds=function(options){var adModels,ids,_ref;if(null==options&&(options=!1),options){if(null!=(_ref=options.groups)?_ref.length:void 0)return console.debug("-- getting div ids for "+options.groups.toString()),ids=[],_.each(options.groups,function(_this){return function(group){var groupIds,newOptions;return newOptions=_.omit(options,"groups"),newOptions.group=group,groupIds=_this.getIds(newOptions),ids=ids.concat(groupIds)}}(this)),ids;adModels=this.where(options)}else adModels=this.models;return ids=_.pluck(adModels,"id")},DfpAds}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.Galleries=function(_super){function Galleries(){return Galleries.__super__.constructor.apply(this,arguments)}return __extends(Galleries,_super),Galleries.prototype.model=function(attributes,options){switch(null!=attributes?attributes.size:void 0){case"vertical":return new Time.models.Gallery(attributes,options);default:return new Time.models.GalleryLightbox(attributes,options)}},Galleries.prototype.initialize=function(models,options){return null==options&&(options={}),this.cache={},options.article?(this.article=options.article,this.listenTo(this,"add, change",function(model){return this.addToCache(model.toJSON(),model.id)}),this.listenTo(this,"gallery:replace",function(oldId,newId){var _ref;return null==oldId&&(oldId=null!=(_ref=Time.activeGallery)?_ref.id:void 0),this.replaceGallery(oldId,newId)})):(console.error("Galleries collection needs an article",options),null)},Galleries.prototype.replaceGallery=function(oldId,newId){var $galleryViewParent,newGalleryModel,oldGalleryModel,_ref;return null==oldId&&(oldId=null!=(_ref=Time.activeGallery)?_ref.id:void 0),oldGalleryModel=this.get(oldId),newGalleryModel=this.get(newId),null==newGalleryModel&&(this.add({id:newId}),newGalleryModel=this.get(newId)),$galleryViewParent=oldGalleryModel.view.$el.parent(),this.listenTo(newGalleryModel,"sync:success",function(){var galleryView,html;return oldGalleryModel.view.remove(),galleryView=newGalleryModel.getView({model:newGalleryModel}),html=galleryView.render().el,$galleryViewParent.html(html),$galleryViewParent.attr("data-gallery",newId),Time.application.model.set("activeGallery",newGalleryModel),galleryView.trigger("gallery:rendered")}),newGalleryModel.get("photos")?newGalleryModel.trigger("sync:success"):newGalleryModel.fetch()},Galleries.prototype.addToCache=function(data,id){return null==id&&(id=null),null==id&&(id=data.id),null==this.cache[id]&&(this.cache[id]=data),this},Galleries.prototype.get_from_cache=function(id){return null!=this.cache[id]?this.cache[id]:null},Galleries}(Backbone.Collection);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.GallerySlides=function(_super){function GallerySlides(){return this.model=__bind(this.model,this),GallerySlides.__super__.constructor.apply(this,arguments)}return __extends(GallerySlides,_super),GallerySlides.prototype.model=function(attributes,options){switch(null==attributes&&(attributes={}),null==options&&(options={}),options.collection=this,options.galleryView=this.galleryView||null,options.galleryModel=this.galleryModel||null,null!=attributes?attributes.slideType:void 0){case"ad":return new Time.models.GallerySlideAd(attributes,options)}return new Time.models.GallerySlide(attributes,options)},GallerySlides.prototype.initialize=function(models,options){return null==models&&(models=[]),null==options&&(options={}),console.info("GallerySlides collection -- init",models,options),null==options.gallery?(console.error("GallerySlides collection needs to be attached to a gallery",options),null):(this.galleryView=options.gallery,this.galleryModel=this.galleryView.model,_.map(models,function(_this){return function(model){return model.galleryTitle=_this.galleryModel.get("title")||"Untitled Gallery",model.twitterVia=_this.galleryModel.get("twitter_via")||"Time",model.twitterText=_this.galleryModel.get("twitter_text"),model.facebookText=_this.galleryModel.get("fb_text"),model.emailText=_this.galleryModel.get("email_body")}}(this)),this.galleryModel.get("hasAds")&&this.addAds(models,this.galleryModel.get("adfrequency")),"endless"===this.galleryModel.get("type")&&this.galleryModel.get("next_gallery")?this.addEndless(models,this.galleryModel.get("next_gallery")):this.galleryModel.get("galleries")&&this.addRelated(models,this.galleryModel.get("galleries")),this.listenTo(this.galleryModel,"change:slideIndex",function(_this){return function(){var newActiveSlideIndex,newActiveSlideModel,oldActiveModel;console.info("gallery "+_this.galleryModel.id+" slides collection heard change:slideIndex toggling slide isActive states"),oldActiveModel=_this.findWhere({isActive:!0}),null!=oldActiveModel&&oldActiveModel.set("isActive",!1),newActiveSlideIndex=_this.galleryModel.get("slideIndex"),newActiveSlideModel=_this.at(newActiveSlideIndex),newActiveSlideModel.set({isActive:!0})}}(this)),this.listenTo(this,"gallery:slides:flush",function(){console.info("gallery "+this.galleryModel.id+" slides collection - flush isRendered for slides"),this.invoke("set",{isRendered:!1})}),this)},GallerySlides.prototype.addAds=function(models,frequency){var adsAdded,adsToAd,index,regularSlides;for(null==models&&(models=[]),null==frequency&&(frequency=6),regularSlides=models.length,console.info("gallery slides collection -- adding ads every "+frequency+" slide"),adsToAd=Math.floor(regularSlides/(frequency-1)),adsAdded=0;adsToAd>adsAdded;){if(index=(adsAdded+1)*frequency-1,index>=models.length)return this;models.splice(index,0,{slideType:"ad",index:index,adIndex:adsAdded+1}),adsAdded++}return this},GallerySlides.prototype.addEndless=function(models,nextGallery){return null==models&&(models=[]),null!=this.galleryModel&&this.galleryModel.id===nextGallery.id||"vertical"===this.galleryModel.get("size")||null==nextGallery?void 0:(models.push({slideType:"endless",nextGallery:nextGallery}),this)},GallerySlides.prototype.addRelated=function(models,galleries){return null==models&&(models=[]),"vertical"!==this.galleryModel.get("size")&&(null!=this.galleryModel&&(galleries=_.filter(galleries,function(_this){return function(gallery){return gallery.id!==_this.galleryModel.id}}(this))),null!=galleries?galleries.length:void 0)?(models.push({slideType:"related",galleries:galleries}),this):void 0},GallerySlides}(Backbone.Collection),Time.collections.MarketData=Backbone.Collection.extend({model:Time.models.MarketData,url:"http://www.fortune.idmanagedsolutions.com/money/index/index-quotes-json",parse:function(response){return response},sync:function(method,model,options){var params;return params=_.extend({type:"GET",dataType:"jsonp",url:this.url,processData:!1},options),$.ajax(params)}}),_.extend(Time.collections.MarketData.prototype,Backbone.Events),Time.collections.Author=Time.collections.Rail.extend({active_env:"author",endpoint:"author",initialize:function(models,opts){var TimerRef;return TimerRef=!1,this.freeze_url_once=!0,this.sub=opts.sub,this.endpoint+="/"+this.sub,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors?_this.add_sponsored_article():void 0}}(this)),this},load_articles:function(){return null!=Time.bootstrap.author&&null!=Time.bootstrap.author[this.sub]?(Time.application.render_top_banner(Time.bootstrap.author[this.sub].author),this.add(Time.bootstrap.author[this.sub].articles),this.view.render_author_header(Time.bootstrap.author[this.sub].author)):this.fetch({success:function(_this){return function(collection,response){return Time.application.render_top_banner(response.author),_this.view.render_author_header(response.author)}}(this)})}}),Time.collections.Collection=Time.collections.Rail.extend({initialize:function(models,opts){var TimerRef,_ref,_ref1,_ref2,_ref3;return this.active_env="collection",TimerRef=!1,this.is_collection=!0,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,this.sub=opts.sub,this.label=null!=Time.bootstrap.collection?Time.bootstrap.collection.left_rail_title:!1,this.href=null!=Time.bootstrap.collection?Time.bootstrap.collection.url:!1,this.view=new Time.views.Rail({collection:this}),Time.bootstrap.collection.hide_hub_nav||Time.application.render_collection_banner(Time.bootstrap.collection),null!=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.collection)?_ref1.left_rail_top_ad:void 0)&&Time.bootstrap.collection.left_rail_top_ad&&this.view.$el.prepend('<div class="ad-unit" id="ad-unit-0" pos="0"></div>'),null!=(null!=(_ref2=Time.bootstrap)&&null!=(_ref3=_ref2.collection)?_ref3.template:void 0)&&(this.view.$el.prepend('<div class="ad-unit" id="ad-unit-0" pos="0"></div>'),"best_colleges"===Time.bootstrap.collection.template&&Modernizr.load({load:Time.template_uri+"/js/dist/time-best-colleges.js"}),"best_places"===Time.bootstrap.collection.template&&Modernizr.load({load:Time.template_uri+"/js/dist/best-places.js"})),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"undefined"!=typeof console&&null!==console&&console.log("collection: add"),_this.real_article_index++,model.id&&$("#article-tile-"+model.id).length>0?model.create_tile_view():void 0}}(this)),this.reached_page_limit(),this},url:function(){var url;return url=Time.api_url+"collection/"+this.sub+"/","time"!==Time.branding&&(url=Time.api_url+Time.branding+"/collection/"+this.sub+"/"),url},load_articles:function(){return Time.bootstrap.collection?("undefined"!=typeof console&&null!==console&&console.log("using bootstrap"),this.add(this.parse(Time.bootstrap.collection)),"undefined"!=typeof console&&null!==console&&console.log("collection collection -> load articles -> @: ",this),this.load_tabs(this.sub,".rail-tabs"),this):void 0},fill_viewport:function(){var that,_ref;"undefined"!=typeof console&&null!==console&&console.log("_rail -> fill_viewport = content",this),that=this,!(null!=(_ref=Time.application.model.get("activeArticle"))?_ref.get("last_article"):void 0)&&0!==Time.application.$viewport.get(0).scrollHeight&&Time.application.$viewport.get(0).scrollHeight<=Time.application.$window.height()-Time.application.$main_header.height()?(this.show_next_article(),setTimeout(function(){return that.fill_viewport()},100)):this.trigger("viewport_filled")},render_ads:function(){var $current,ad_index,ad_placeholder_id,data,i,index,num_article,rail_articles;for(rail_articles=this.view.$scroll_container.find(".collection-rail-article"),num_article=rail_articles.length,ad_index=1,data={},i=0;num_article>i;)index=i+1,index%5===0&&index%10!==0&&($current=$(rail_articles[i]),ad_placeholder_id="ad-unit-"+ad_index,$("<div/>",{"class":"ad-unit",id:ad_placeholder_id,pos:ad_index}).insertBefore($current),Time.Ad.render_left_rail_ad(ad_placeholder_id),ad_index+=1),i+=1},parse:function(response){var article,articles,hub,hubs,_i,_j,_len,_len1,_ref;if("undefined"!=typeof console&&null!==console&&console.log("parse(response): ",response),hubs=null!=response?response.hubs:!1,"undefined"!=typeof console&&null!==console&&console.log("hubs: ",hubs),articles=[],null!=response.intro_post&&(response.intro_post.format="collection_intro",articles.push(response.intro_post)),null!=hubs&&hubs.length)for(_i=0,_len=hubs.length;_len>_i;_i++)if(hub=hubs[_i],null!=hub.articles)for(_ref=hub.articles,_j=0,_len1=_ref.length;_len1>_j;_j++)article=_ref[_j],articles.push(article);return"undefined"!=typeof console&&null!==console&&console.log("collection articles: ",articles),articles}}),Time.collections.Magazine=Time.collections.Rail.extend({active_env:"magazine",endpoint:"magazine",initialize:function(models,opts){var TimerRef,full_title;return this.freeze_url_once=!0,TimerRef=!1,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.region=null!=opts.sub?opts.sub:"us",this.endpoint+=null!=Time.curRoute.magazine_id?"/issue/"+Time.curRoute.magazine_id:"/region/"+this.region,$(".top-banner").html(""),full_title=$("[data-region='"+this.region+"']").html(),$(".toggle-magazine-region-dropdown").html(full_title),Time.application.$body.addClass("has-section-menu"),this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),_this.real_article_index++,model.create_tile_view()}}(this)),this},parse:function(response){var articles,key,val;if(articles=response.articles,null!=articles&&articles.length){articles[0].cover=1,articles[0].magazine={};for(key in response)val=response[key],"articles"!==key&&(articles[0].magazine[key]=val)}return"undefined"!=typeof console&&null!==console&&console.log("magazine articles: ",articles),articles},load_articles:function(){return null!=Time.bootstrap.magazine&&Time.bootstrap.magazine[this.region]?this.add(this.parse(Time.bootstrap.magazine[this.region])):this.fetch(),this}}),Time.collections.Money_magazine=Time.collections.Rail.extend({active_env:"money_magazine",endpoint:"magazine",initialize:function(models,opts){var TimerRef;return TimerRef=!1,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.sub=opts.sub,this.href=Time.home_url+"/money/magazine/",this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenToOnce(this,"add reset",function(){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(_this){return function(){return _this.trigger("tiles-rendered")}}(this),1e3)}),this.listenTo(this,"add",function(_this){return function(model){return _this.real_article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors?_this.add_sponsored_article():void 0}}(this)),this},load_articles:function(){var money_magazine_data;return null!=Time.bootstrap.publication&&null!=Time.bootstrap.publication["time-publication-money-magazine"]?(money_magazine_data=Time.bootstrap.publication["time-publication-money-magazine"],null!=money_magazine_data.articles&&(this.add(money_magazine_data.articles),money_magazine_data.name&&this.load_tabs(money_magazine_data.name)),Time.application.render_top_banner(money_magazine_data)):this.fetch({success:function(_this){return function(model,response){return Time.application.render_top_banner(response),response.name?_this.load_tabs(response.name):void 0}}(this)})}}),Time.collections.Nativo=Time.collections.Rail.extend({active_env:"nativo",initialize:function(){var TimerRef;return TimerRef=0,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.view=new Time.views.Rail({collection:this}),this.listenToOnce(this,"article:rendered",function(){return Time.Tracking.article_view(Time.application.model.get("activeArticle").toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),_this.real_article_index++,model.create_tile_view()}}(this)),this},load_articles:function(){return!1}}),Time.collections.Popular=Time.collections.Rail.extend({active_env:"popular",endpoint:"popular",initialize:function(){var TimerRef;return this.freeze_url_once=!0,TimerRef=!1,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,Time.application.load_ticker(),this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view()}}(this)),Time.application.tabs_view.set_active("popular"),this},load_articles:function(){return Time.application.railXHR=this.fetch({success:function(_this){return function(collection,response){return _this.view.render_header("10 Most Read"),_.each(response.read,function(item){return _this.add(new Time.models.Article(item))}),_this.view.render_header("10 Most Shared"),_.each(response.shared,function(item){return _this.add(new Time.models.Article(item))})}}(this)})}}),Time.collections.Section=Time.collections.Rail.extend({active_env:"section",endpoint:"section",initialize:function(models,opts){var TimerRef;return TimerRef=!1,this.freeze_url_once=!0,$("body").addClass("tax-time_section"),Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.sub=opts.sub,this.endpoint+="/"+this.sub,this.section_tag=opts.section_tag,this.view=new Time.views.Rail({collection:this}),this.section_tag?(this.load_tabs(this.sub,".rail-tabs"),$("body").addClass("tax-time-section-tag")):$("body").hasClass("tax-time-section-tag")&&$("body").removeClass("tax-time-section-tag"),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors?_this.add_sponsored_article():void 0}}(this)),this},load_articles:function(){var articles,initialArticle,_ref,_ref1;if(null!=(null!=(_ref=Time.bootstrap.section)?_ref[this.sub]:void 0))null!=Time.bootstrap.section[this.sub].articles&&this.add(this.parse(Time.bootstrap.section[this.sub])),Time.application.render_section_header(Time.bootstrap.section[this.sub]),this.view.render_section_header(Time.bootstrap.section[this.sub]),this.listenToOnce(Time.application,"load_section_menu",function(_this){return function(){return Time.application.active_rail.load_section_header(Time.bootstrap.section[_this.sub])}}(this)),this.load_tabs(this.sub,".rail-tabs");else{if(null!=(null!=(_ref1=Time.bootstrap.latest)?_ref1.articles:void 0))return console.log("_rail -- load_articles -- using bootstrap",articles),initialArticle=Time.bootstrap.single_article||null,articles=this.moveArticleFirst(initialArticle,Time.bootstrap.latest.articles),void this.add(articles);this.fetch({success:function(_this){return function(collection,response){return _this.section_tag?Time.application.load_ticker():(Time.application.render_section_header(response),_this.listenToOnce(Time.application,"load_section_menu",function(){return Time.application.active_rail.load_section_header(response)}))}}(this)})}},load_tabs:function(label,el_selector){var href,new_tab_data,vertical;return vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],new_tab_data=Time.tab_data["default"],"us"===label&&(label="U.S."),href=vertical.match(/money/)?"/"+vertical+"/"+this.sub+"/":"/"+this.sub+"/",new_tab_data.tabs[0]={label:label.replace("-"," "),omniture:"nav-"+this.sub,env:this.active_env,sub:this.sub,href:href},Time.application.load_tabs(new_tab_data,el_selector),Time.application.tabs_view.set_active(0)},parse:function(response){var articles;return null!=response.lineup?(articles=response.articles,response.format="section-front",response.title="Today in "+response.name,articles.unshift(response),articles):response.articles}}),Time.collections.Sponsor=Time.collections.Rail.extend({active_env:"sponsor",endpoint:"/sponsor",initialize:function(models,opts){var TimerRef;return TimerRef=0,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),_this.real_article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors?_this.add_sponsored_article():void 0}}(this)),this.sponsor=opts.sub,this.endpoint+="/"+this.sponsor,this},load_articles:function(){return null==Time.bootstrap.sponsor||null==Time.bootstrap.sponsor[this.slug]?this.fetch():null!=Time.bootstrap.sponsor[this.slug].articles?this.add(Time.bootstrap.sponsor[this.slug].articles):void 0}}),Time.collections.Tag=Time.collections.Rail.extend({active_env:"tag",endpoint:"tag",initialize:function(models,opts){var TimerRef;return this.freeze_url_once=!0,TimerRef=!1,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.sub=opts.sub,this.endpoint+="/"+this.sub,this.view=new Time.views.Rail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenToOnce(this,"add reset",function(){"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(_this){return function(){return _this.trigger("tiles-rendered")}}(this),1e3)}),this.listenTo(this,"add",function(_this){return function(model){model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors&&_this.add_sponsored_article()}}(this)),this},load_articles:function(){var _ref;return null!=(null!=(_ref=Time.bootstrap.tag)?_ref[this.sub]:void 0)?(null!=Time.bootstrap.tag[this.sub].articles&&(this.add(Time.bootstrap.tag[this.sub].articles),Time.bootstrap.tag[this.sub].name&&this.load_tabs(Time.bootstrap.tag[this.sub].name)),Time.application.render_top_banner(Time.bootstrap.tag[this.sub])):this.fetch({success:function(_this){return function(model,response){return Time.application.render_top_banner(response),response.name?_this.load_tabs(response.name):void 0}}(this)})}}),Time.collections.Topic=Time.collections.Rail.extend({active_env:"topic",endpoint:"topic",initialize:function(models,opts){var TimerRef,vertical,_ref;return this.freeze_url_once=!0,TimerRef=!1,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,this.sub=opts.sub,this.endpoint+="/"+this.sub,vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],this.href=vertical.match(/money/)?"/"+vertical+"/topic/"+this.sub+"/":"/topic/"+this.sub+"/",this.view=new Time.views.Rail({collection:this}),this.view.unbind=function(_this){return function(){return null!=_this.$topic_embed?_this.$topic_embed.trigger("embed.destroy"):void 0}}(this),null!=(null!=(_ref=Time.bootstrap.topic)?_ref[this.sub]:void 0)&&(this.load_tabs(Time.bootstrap.topic[this.sub].left_rail_title),null!=Time.bootstrap.topic[this.sub].intro&&this.load_intro(Time.bootstrap.topic[this.sub])),this.listenToOnce(Time,"change:activeArticle",function(model,value){var active_article_attributes;active_article_attributes=value?value.toJSON():Time.bootstrap.single_article,Time.Tracking.article_view(active_article_attributes)}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),model.get("is_nativo")||_this.real_article_index++,_this.article_index++,model.create_tile_view(),_this.real_article_index%10===6&&null!=Time.bootstrap.sponsors?_this.add_sponsored_article():void 0}}(this)),this},load_topic_embed:function(topic_embed){var d,embed_id,embed_script,n,_ref;return embed_id=$(topic_embed).attr("id"),!(null!=(_ref=$("#"+embed_id))?_ref.length:void 0)||Time.application.hasPushstate?(this.view.render_topic_header_embed(topic_embed),this.$topic_embed=$("#"+embed_id),embed_script=this.$topic_embed.data("script"),null!=embed_script&&(d=new Date,n=d.getMilliseconds(),Modernizr.load({load:Time.template_uri+embed_script+"?"+n})),Time.application.scrollRedraw(Time.application.$articleListScroll.get(0))):void 0},load_articles:function(){var _ref,_ref1;return console.info("topic collection -- load_articles"),null!=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.topic)?_ref1[this.sub]:void 0)?this.loadArticlesFromBootstrap():(console.info("-- load_articles -- fetch"),void this.fetch({success:function(_this){return function(collection,response){return Time.application.render_top_banner(response),_this.view.render_topic_header(response),_this.load_tabs(response.left_rail_title),null!=response.embed?(_this.view.render_topic_header_embed(response.embed),_this.load_topic_embed(response.embed)):void 0}}(this)}))},load_intro:function(topic){var topicIntro;return"undefined"!=typeof console&&null!==console&&console.log("rendering topic intro"),topicIntro=Time.templates["topic-intro"].render(topic),$(topicIntro).prependTo(Time.application.$viewport)},loadArticlesFromBootstrap:function(){var articles,initialArticle,topicObject,_ref;topicObject=Time.bootstrap.topic[this.sub],console.info("-- loadArticlesFromBootstrap ",topicObject),articles=topicObject.articles,null!=articles?(initialArticle=(null!=(_ref=Time.bootstrap)?_ref.single_article:void 0)||null,articles=this.moveArticleFirst(initialArticle,articles),this.add(articles)):console.warn("load_articles -- No articles in topic! How did you get here..."),this.view.render_topic_header(topicObject),"undefined"!=typeof console&&null!==console&&console.info("collection topic -> load articles -> @ : ",this),Time.application.render_top_banner(topicObject),null!=topicObject.embed&&this.load_topic_embed(topicObject.embed)}}),Time.collections.Videos=Time.collections.Rail.extend({active_env:"videos",endpoint:"videos",initialize:function(){var TimerRef;return this.freeze_url_once=!0,TimerRef=!1,Time.trigger("leftRail:flush"),Time.Ad.set_initial_left_rail_load(!0),Time.Ad.reset_nativo_placement(),Time.application.arr_article_views.length=0,Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,Time.application.load_ticker(),this.view=new Time.views.Rail({collection:this}),Time.application.tabs_view.set_active("videos"),Time.trigger("leftRail:load:videos"),this.listenToOnce(Time,"article:activated",function(){Time.Tracking.article_view(Time.application.model.get("activeArticle").toJSON())
}),this.listenTo(this,"add",function(_this){return function(model){return"number"==typeof TimerRef&&clearTimeout(TimerRef),TimerRef=setTimeout(function(){return _this.trigger("tiles-rendered")},1e3),_this.real_article_index++,model.create_tile_view()}}(this)),this},load_articles:function(){return Time.application.railXHR=this.fetch({complete:function(){}})}}),Time.collections.Ticker=Backbone.Collection.extend({model:Time.models.TickerHeadline,load_headlines:function(){return null!=Time.bootstrap.ticker?(this.add(Time.bootstrap.ticker),this.trigger("reset")):this.fetch({reset:!0})},url:function(){return"money"===Time.branding?Time.api_url+"money_skybox/":Time.api_url+"skybox/"},get_$items:function(){var $items;return $items=[],_.each(this.models,function(this_model){return $items.push(this_model.view.$el)}),$items}}),_.extend(Time.collections.Ticker.prototype,Backbone.Events);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlidesView=function(_super){function GallerySlidesView(){return GallerySlidesView.__super__.constructor.apply(this,arguments)}return __extends(GallerySlidesView,_super),GallerySlidesView.prototype.initialize=function(options){return null==options&&(options={}),console.info("GallerySlidesView init ",options),this.galleryView=options.gallery,this.listenTo(this,"view:destroy",function(){var _ref;console.info("GallerySlidesView heard view:destroy, destroying",this),null!=(_ref=this.collection)&&_ref.invoke("set",{isRendered:!1,isActive:!1}),this.collection=null,this.galleryView=null}),this},GallerySlidesView}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Gallery=function(_super){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return __extends(Gallery,_super),Gallery.prototype.initialize=function(options){var slidesData,startingIndex,startingSlide;return null==options&&(options={}),this.model=null||options.model,this.$parent=null||options.$parent,this.$slides=null,this.slidesView=null,slidesData=this.model.get("photos").slice(0),this.slidesCollection=new Time.collections.GallerySlides(slidesData,{gallery:this}),this.listenTo(this,"view:destroy",function(){var _ref;console.info("GalleryView (super) heard view:destroy, destroying @slidesView"),null!=(_ref=this.slidesView)&&"function"==typeof _ref.destroy&&_ref.destroy(),this.slidesView=null,this.slidesCollection=null,this.model=null}),Time.initial_gallery_slug&&(startingSlide=this.slidesCollection.findWhere({slug:Time.initial_gallery_slug}),startingSlide&&(startingIndex=this.slidesCollection.indexOf(startingSlide),this.model.set({slideIndex:startingIndex},{silent:!0})),Time.initial_gallery_slug=null),this},Gallery}(Backbone.View),Time.views.Rail=Backbone.View.extend({className:"article-list",events:{mouseenter:"freeze_scroll",mouseleave:"release_scroll","click .rail-article-title a":"onClickTile","click .collection-hub .content":"toggle_expand_hub"},jump_to_active_tiles:!0,setVertical:function(){var vertical;return vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],vertical.match(/money/)&&(this.vertical=vertical),this},initialize:function(){return Time.application.model.get("isRailOpen")&&$(".rail-articles-scroll")[0].scrollHeight!==$(".rail-articles-scroll").innerHeight()&&$(".scroll-for-more").show(),$(".scroll-for-more").appendTo("body"),this.$scroll_container=$(".rail-articles-scroll"),this.$magazine_nav=$(".magazine-region-header"),this.setVertical(),null!=this.collection&&this.initCollection(),this.jump_to_active_tiles&&($(".left-rail-header .main-nav").on("shown",function(_this){return function(){return $(".left-rail-header .header-nav-button").attr("data-event","nav-expose"),_this.jump_to_active_tiles=!1}}(this)),$(".left-rail-header .main-nav").on("hidden",function(_this){return function(){return $(".left-rail-header .header-nav-button").removeAttr("data-event"),_this.jump_to_active_tiles=!0}}(this))),this.bind_scroll(),this},bind_scroll:function(){return $(".rail-articles-scroll").scroll(function(){return $(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight?$(".scroll-for-more").hide():"none"===$(".scroll-for-more").css("display")&&Time.application.model.get("isRailOpen")?($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()):void 0})},onClickTile:function(e){var $tile,articleId,isVideoTile,tile;return tile=e.target,$tile=$(tile),isVideoTile=$tile.closest(".format-video").length>0,articleId=$tile.closest(".rail-article").data("article"),Time.application.arr_article_views.length=0,"mobile"===Time.device&&(Time.application.$notHeader.removeClass("show-articles-beneath-medium"),Time.application.model.set("isRailOpen",!1)),isVideoTile&&Time.trigger("rail:clicked:videoTile",articleId),this},resetCollection:function(){var old_env;return null!=this.collection.active_env&&(old_env=this.$scroll_container.data("env"),null!=old_env&&this.$scroll_container.removeClass(old_env),this.$scroll_container.data("env",this.collection.active_env),this.$scroll_container.addClass(this.collection.active_env)),this.empty(),this},initCollection:function(){return this.resetCollection(),this.listenTo(Time.application,"application:ready",function(_this){return function(){return _this.fill_viewport(),Time.application.$pushDown.outerHeight(!0)>0&&(Time.application.$notHeader.scrollTo(Time.application.$pushDown.outerHeight(!0)),Time.application.$notHeader.addClass("stick")),Time.application.hide_loader(Time.application.$viewportWrapper)}}(this)),this.listenTo(this.collection,"sync:syncing",function(_this){return function(){return"undefined"!=typeof console&&null!==console&&console.log("views/rail -- heard syncing"),_this.show_loader(),_this.collection.models.length?void 0:Time.application.show_loader(Time.application.$viewportWrapper)}}(this)),this.listenTo(this.collection,"sync",function(_this){return function(){return"undefined"!=typeof console&&null!==console&&console.log("views/rail -- heard sync"),Time.application.model.get("isRailOpen")&&$(".rail-articles-scroll")[0].scrollHeight!==$(".rail-articles-scroll").innerHeight()&&$(".scroll-for-more").show(),$(".scroll-for-more").appendTo("body"),_this.hide_loader()}}(this)),this.listenTo(this.collection,"sync:error",function(_this){return function(){return"undefined"!=typeof console&&null!==console&&console.log("views/rail -- heard sync:error"),_this.hide_loader(),_this.show_loader_error(),Time.application.hide_loader(Time.application.$viewportWrapper)}}(this)),this.listenToOnce(this.collection,"add reset",function(_this){return function(){return"undefined"!=typeof console&&null!==console&&console.log("views/rail -- heard add or reset - init infinite scroll, add loading, set ads"),_this.infinite_scroll=new Time.component.InfiniteScroll(_this.$scroll_container,_this.$el,20,_this.collection.fetch_next_page,null,_this.collection),Time.application.$viewport.addClass("loading")}}(this)),this.render(),this},clearRail:function(){return $(".article-list").length&&$(".article-list").remove(),this},render:function(){return"undefined"!=typeof console&&null!==console&&console.log("views/rail -- render",this),null!=this.collection.active_env&&"collection"===this.collection.active_env?this.setElement(".article-list"):this.clearRail(),this.$el.prependTo(".rail-articles-scroll"),Time.application.$articleList=this.$el,Time.application.load_tabs(Time.tab_data["default"]),Time.application.tabs_view.set_active(0),Time.application.set_left_rail_bounds(),null!=this.collection.active_env&&(this.$el.parents("#rail-articles").toggleClass("magazine_rail","magazine"===this.collection.active_env),this.$el.parents("#rail-articles").toggleClass("collection_rail","collection"===this.collection.active_env)),Time.application.checkScroll(!0),this},fill_viewport:function(){return Time.application.$articleListScroll.get(0).scrollHeight<=Time.application.$window.height()-Time.application.$main_header.height()?(this.collection.fetch_next_page(),setTimeout(function(_this){return function(){return _this.fill_viewport()}}(this),100)):this.trigger("viewport_filled"),this},empty:function(){return this.$el.html(""),this.trigger("empty"),this},scroll_limit_message:function(){var $message;if(0===$(".response-eot").length)return $message=$("<a />",{"class":"meta response-eot"}),"magazine"===Time.curRoute.env?$message.attr("href","http://content.time.com/time/magazine/").html("Read more articles in the "+Time.curRoute.env+" archive"):"money"===Time.branding?$message.attr("href","/money/").html("Get the latest news on Money.com's home page"):$message.attr("href","/").html("Get the latest news on TIME's home page"),$message.appendTo(this.$el),this},show_loader:function(){return this.$scroll_container.addClass("fetching"),this},hide_loader:function(){return this.$scroll_container.removeClass("fetching"),this},show_loader_error:function(){var $load_error,$manual_fetch;return $load_error=$("<p></p>").addClass("meta response-error").html("The requested content could not be loaded.").appendTo(this.$el),$manual_fetch=$("<a></a>").addClass("manual-fetch").html("Try now").attr("href","javascript:void(0)").one("click",function(_this){return function(){return _this.collection.fetch()}}(this)).appendTo($load_error),this.listenToOnce(this.collection,"sync:syncing",this.remove_loader_error),this},remove_loader_error:function(){return $(".response-error").remove(),this},freeze_scroll:function(){return this.scroll_freeze=!0,this},release_scroll:function(){return this.scroll_freeze=!1,this},getAdsInViewport:function(){var $adEls,$adsInViewport;return Time.tgxAdapter.ENABLED?($adEls=$(".ad-unit").add("#sub-ad"),$adsInViewport=_.filter($adEls,function(_this){return function($el){return _this.isAdInViewport($el,!0)}}(this))):[]},isAdInViewport:function($el,isAllowPartial){var rect,_ref;return $el instanceof jQuery||($el=$($el)),Time.application.model.get("isRailOpen")?$el.length<=0?!1:$el.height()<0?!1:(rect=(null!=(_ref=$el.get(0))?_ref.getBoundingClientRect():void 0)||{bottom:0,height:0,left:0,right:0,top:0,width:0},this.isHorizontallyVisible(rect.left)?isAllowPartial?this.isFullyVisible(rect.top,rect.bottom)||this.isPartiallyVisible(rect.top,rect.bottom):this.isFullyVisible(rect.top,rect.bottom):!1):!1},isHorizontallyVisible:function(val){return val>=0},isFullyVisible:function(elTop,elBottom){return this.isBelowViewportTop(elTop)&&this.isAboveViewportBottom(elBottom)},isPartiallyVisible:function(elTop,elBottom){return this.isTopCutOff(elTop,elBottom)||this.isBottomCutOff(elTop,elBottom)},isTopCutOff:function(elTop,elBottom){return this.isAboveViewportTop(elTop)&&this.isBelowViewportTop(elBottom)},isBottomCutOff:function(elTop,elBottom){return this.isAboveViewportBottom(elTop)&&this.isBelowViewportBottom(elBottom)},isAboveViewportTop:function(val){return val<Time.application.left_rail_top},isAboveViewportBottom:function(val){return val<=Time.application.left_rail_bottom},isBelowViewportTop:function(val){return val>=Time.application.left_rail_top},isBelowViewportBottom:function(val){return val>Time.application.left_rail_bottom},render_author_header:function(data){var $html,template;return null==data&&(data={}),template=Time.templates["rail-header-author"],$html=$(template.render(data)),$html.prependTo(this.$el)},render_section_header:function(data){var $html,template;return null==data&&(data={}),template=Time.templates["section-description"],$html=$(template.render(data)),$html.prependTo(this.$el)},render_topic_header:function(data){var $html,template;return null==data&&(data={}),template=Time.templates["rail-header-topic"],$html=$(template.render(data)),$html.prependTo(this.$el)},render_topic_header_embed:function(embed){return $(embed).prependTo(this.$el),null!=Time.application.active_rail.view.$el.find("#ad-unit-0")&&(Time.application.dfpAdManagerView.ENABLED&&Time.Ad.render_left_rail_ad("ad-unit-0"),"desktop"!==Time.device)?setTimeout(function(){null!=Time.application.active_rail&&Time.application.active_rail.view.$scroll_container.trigger("scroll")},500):void 0},render_collection_header:function(data){var html;return null==data&&(data={}),"undefined"!=typeof console&&null!==console&&console.log("views/rail -- render collection header: ",data),html=Time.templates["top-header"].render(data),Time.application.$top_banner.html(html)},render_header:function(copy,tile_position){var $header_el;return null==copy&&(copy="Most Read"),null==tile_position&&(tile_position=0),$header_el=$("<h3/>",{"class":"rail-list-heading"}).text(copy),null!=this.models&&this.models[tile_position]?$header_el.insertBefore(this.collection.models[tile_position].views.tile_view.$el):$header_el.appendTo(this.$el)},toggle_expand_hub:function(e){var $el,hub_id;return"undefined"!=typeof console&&null!==console&&console.log("expand hub"),$el=$(e.currentTarget).parents("article"),hub_id=$el.data("hub"),$el.hasClass("expanded")?(this.hide_hub(hub_id),Time.application.model.get("isRailOpen")&&$(".rail-articles-scroll")[0].scrollHeight!==$(".rail-articles-scroll").innerHeight()?$(".scroll-for-more").show():$(".scroll-for-more").hide()):this.show_hub(hub_id),Time.application.dfpAdManagerView.ENABLED?Time.Ad.update_left_rail_ads_pos():void 0},hide_hub:function(hub_id){var $hub_container,$hub_header;return $hub_header=$("#article-tile-"+hub_id),$hub_container=$hub_header.next(),Time.application.dfpAdManagerView.ENABLED&&Time.Ad.hide_left_rail_ads($hub_container.find(".ad-unit")),$hub_header.removeClass("expanded"),$hub_container.removeClass("expanded")},show_hub:function(hub_id){return $("#article-tile-"+hub_id).addClass("expanded").next().addClass("expanded"),this.$scroll_container.trigger("scroll")},annihilate:function(){this.infinite_scroll.unbind(),this.destroy()}}),Time.views.ArticleTile=Backbone.View.extend({template:Time.templates["article-tile"],initialize:function(){return this.$container=this.model.collection.view.$el,this.$scroll_container=this.model.collection.view.$scroll_container,this.nativo_placement_rate=Time.Ad.get_nativo_placement_rate(),this.nativo_initial_tile_placement=Time.Ad.get_nativo_initial_tile_placement(),this.listenTo(this.model,"change:isActive",function(_this){return function(){var isActive,_ref,_ref1;return isActive=_this.model.get("isActive"),_this.$el.toggleClass("active",isActive),isActive&&(null!=(_ref=_this.model.collection)&&null!=(_ref1=_ref.view)?_ref1.jump_to_active_tiles:void 0)?_this.make_visible():void 0}}(this)),this.listenTo(this.model,"article:tile-rendered",function(_this){return function(){var collection,collectionLength;return collection=_this.model.collection,collectionLength=collection.length,collection.real_article_index%collection.adFrequency===collection.adOffset&&_this.insert_ad_after(),collection.real_article_index%_this.nativo_placement_rate===_this.nativo_initial_tile_placement&&Time.Ad.render_nativo_tile(),5>collectionLength&&collection.real_article_index===collectionLength&&"popular"!==collection.active_env?_this.insert_ad_after():void 0}}(this)),this.render()},render:function(){var html;return this.setElement(this.$container.find("[data-article='"+this.model.id+"']")),this.$el.length||(this.set_template(),this.adjust_data(),html=this.template.render(this.model.toJSON()),this.setElement($(html)),this.$el.appendTo(this.$container)),this.model.trigger("article:tile-rendered"),this.$el},set_template:function(){return null!=this.model.get("sponsor")&&(this.model.get("sponsor")&&"vsp"===this.model.get("sponsor").slug&&this.model.set("sponsor_timestamp",(new Date).getTime()),this.template=Time.templates["article-tile-sponsored"]),null!=this.model.get("tax")&&(this.template=Time.templates["article-tile-section-front"]),this.template},adjust_data:function(){return this.model.set("articleType",this.set_type_class())},set_type_class:function(){return this.model.get("isVideo")?"time-icons-video":this.model.get("isPhoto")?"time-icons-photo":this.model.get("isLocked")?"time-icons-key":""},make_visible:function(){var container_outerheight,container_padding_top,container_scroll_y,el_bottom_y,el_top_y;0===this.$el.length&&this.setElement($("#article-"+this.model.id)),this.$el.position().top<0?(el_top_y=this.$el.position().top,container_scroll_y=this.$scroll_container.scrollTop(),container_padding_top=parseInt(this.$container.css("paddingTop")),this.$scroll_container.scrollTop(el_top_y+container_scroll_y-container_padding_top),this.$container.trigger("rail:scrolled-up")):this.$el.position().top>this.$scroll_container.height()-this.$el.outerHeight()-$(".scroll-for-more").outerHeight()&&(el_bottom_y=this.$el.position().top+this.$el.outerHeight()+$(".scroll-for-more").outerHeight()+10,container_scroll_y=this.$scroll_container.scrollTop(),container_outerheight=this.$scroll_container.height(),this.$scroll_container.scrollTop(el_bottom_y+container_scroll_y-container_outerheight),this.$container.trigger("rail:scrolled-down")),Time.Ad.update_left_rail_all_el_pos()},insert_ad_after:function(){var ad;return ad=this.create_advert(),ad.insertAfter(this.$el),this.model.collection.length<=5&&$(".rail-articles-scroll").addClass("limited-articles"),Time.Ad.render_left_rail_ad(ad.attr("id")),ad},create_advert:function(){var $el,index;return this.model.collection.ad_in_left_rail+=1,index=this.model.collection.ad_in_left_rail,$el=$("<div/>",{"class":"ad-unit",id:"ad-unit-"+index,pos:index})}}),Time.views.error404=Backbone.View.extend({initialize:function(){return this.rail_view=new Time.views.Rail,$(".scroll-for-more").hide(),Time.Ad.set_initial_app_load(!1),Time.application.load_tabs(Time.tab_data["default"]),Time.application.tabs_view.set_active(0),this.listenToOnce(Time.application,"application:ready",function(){return $(".site-footer").remove(),$("body").removeClass("error404")}),Time.application.router.is_initial_route=!1}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.views.Application=function(_super){function Application(){return Application.__super__.constructor.apply(this,arguments)}return __extends(Application,_super),Application.prototype.el=document,Application.prototype.events={"click a":"route","click a.popup":"open_popup","click #Sign_In":"clickedSignin","click .rail-tab":"load_tab","click .toggle-magazine-region-dropdown":"toggle_magazine_region_dropdown","click .magazine-region":"toggle_magazine_region_dropdown","click .ie-message-modal":"hide_ie8_message","click .article-list a":"hide_article_list","click .toggle-comments":"toggle_comments","click .expand-share":"clickedExpandShare","click body":"clickedBody","click .collection-intro-video":"render_collection_video"},Application.prototype.title=$("title").text(),Application.prototype.$window=$(window),Application.prototype.$body=$("body"),Application.prototype.$main_header=$(".main-header"),Application.prototype.$notHeader=$("#notTheHeader"),Application.prototype.$notHeaderWrapper=$("#notTheHeader>.wrapper"),Application.prototype.$viewport=$(".article-viewport"),Application.prototype.$viewportWrapper=$(".article-viewport>.wrapper"),Application.prototype.$magazineCover=$(".magazine-cover:first"),Application.prototype.$pushDown=$("#pushdown-ad"),Application.prototype.$left_rail=$(".left-rail"),Application.prototype.$articleListScroll=$(".rail-articles-scroll"),Application.prototype.$articleList=$(".article-list"),Application.prototype.$tabs=$(".left-rail-topper"),Application.prototype.$top_banner=$(".top-banner"),Application.prototype.$admin_bar=$("#wpadminbar"),Application.prototype.sizes={},Application.prototype.skipNextScroll=!1,Application.prototype.initialChartbeat=!0,Application.prototype.mobileSafari=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),Application.prototype.isIphone=!1,Application.prototype.mobileSafariViewportOffset=0,Application.prototype.throttleSpeed=100,Application.prototype.last_route="",Application.prototype.root=location.protocol+"//"+location.host,Application.prototype.arr_article_views=[],Application.prototype.hasPushstate=!(!window.history||!history.pushState),Application.prototype.orientationEvent=__indexOf.call(window,"onorientationchange")>=0?"orientationchange":"resize",Application.prototype.is_homepage=!1,Application.prototype.breakpoints={small:{name:"small",size:400,is_beneath:!1},medium:{name:"medium",size:800,is_beneath:!1},large:{name:"large",size:1024,is_beneath:!1}},Application.prototype.initialize=function(){return this.isIphone=/iphone/i.test(navigator.userAgent.toLowerCase()),this.isIphone&&(this.mobileSafariOffset=60),this.model=new Time.models.Application,this.model.set("isRailOpen",this.isRailVisible()),this.model.set("pageType",this.getPageType()),this.sponsor_index=0,this.sponsor_arr=Time.bootstrap.sponsors?Time.bootstrap.sponsors:null,this.sponsor_length=this.sponsor_arr?this.sponsor_arr.length:0,Time.taboola_counter=0,this.listenTo(Time,"article:activated",function(){return Time.taboola.renderModules()}),this.dfpAdManagerView=Time.tgxAdapter=new Time.modules.TgxAdapter({app:this}),this.brightcoveVideos=new Time.views.BrightcoveVideos,this.readingPane=new Time.views.ReadingPane,this.$window.on("resize.application",function(_this){return function(){Time.trigger("application:resize"),_this.sizeContent(),_this.handle_resize(),_this.set_left_rail_bounds(),"mobile"===Time.device&&Time.util.is_native_android_browser()&&setTimeout(function(){return this.$main_header.css("width",this.$window.outerWidth())},200)}}(this)),this.$window.on("orientationchange",function(){return function(){return window.innerWidth>window.innerHeight?Time.application.$body.scrollTo(0,0):void 0}}(this)),this.listenTo(Time,"is-beneath-breakpoint-medium is-above-breakpoint-medium",function(_this){return function(){_this.enter_medium()}}(this)),this.listenTo(this.model,"change:isRailOpen",function(_this){return function(model,value){value?_this.openLeftRail():_this.closeLeftRail()}}(this)),this.listenTo(this.model,"change:isRailToggleable",function(_this){return function(model,value){return value===!0?_this.model.set("isRailOpen",_this.model.get("isRailUserOpen")):_this.model.set("isRailOpen",!0)}}(this)),this.listenToOnce(Time,"article:activated",function(_this){return function(articleView){"undefined"!=typeof console&&null!==console&&console.info("application view heard first article:activated on Time with article",articleView.model.id),_this.bindKeyboardEvents()}}(this)),this.listenTo(Time,"article:activated",function(_this){return function(articleView){"undefined"!=typeof console&&null!==console&&console.info("application view heard article:activated on Time with article",articleView.model.id),_this.set_title(articleView.model.getBrandedTitle()),$("body").trigger("newImages")}}(this)),this.listenTo(Time,"gallery:isFullscreen",function(_this){return function(galleryModel,isFullscreen){var _ref,_ref1;_this.model.set("isFullscreen",isFullscreen),$("html").toggleClass("fullscreenmode",isFullscreen),$(".wrapper").hide().show(0),isFullscreen||(null!=galleryModel&&null!=(_ref=galleryModel.collection)&&null!=(_ref1=_ref.article)?_ref1.$el:void 0)&&_this.$viewport.scrollTo(galleryModel.collection.article.$el)}}(this)),this.setTabHref(),Time.trigger("application:initialized"),this},Application.prototype.bindKeyboardEvents=function(){return $("body").on("keydown.gallery-arrows",function(_this){return function(e){var galleryModel,_ref;return(galleryModel=_this.model.getActiveGallery()||null)?(null!=(_ref=galleryModel.view)&&_ref.trigger("gallery:keyboardEvent",e),e):e}}(this)),this},Application.prototype.checkLogin=function(){var logoutUrl,signOutDiv;return document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g,function(){var decode,urlPath;return decode=function(s){return decodeURIComponent(s.split("+").join(" "))},Time.$_GET[decode(arguments[1])]=decode(arguments[2]),Time.$_GET.loginfailure?(urlPath=document.URL.split("?")[0],this.hasPushstate&&window.history.pushState({html:"",pageTitle:""},"",urlPath),$("#Sign_In_Modal_Error").removeClass("hidden"),$(function(){return $(".login-nav-wrapper .sign-in").trigger("click")})):void 0}),null!=$.cookie&&null!=$.cookie("TimeIAT")?(logoutUrl="https://auth.time.com/logout.php",signOutDiv='<a href="'+logoutUrl+"?turl="+window.location+'/">Sign Out</a>',$("span.signedin-wrap").prepend(signOutDiv)):void 0},Application.prototype.clickedSignin=function(e){var trimmedURL;return e.preventDefault(),trimmedURL=document.URL.split("?"),trimmedURL=trimmedURL[0],$("#rurl").val(trimmedURL+"?loginfailure=true"),$("#turl").val(trimmedURL),$("#sign-in-form").submit()},Application.prototype.clickedExpandShare=function(e){return e.preventDefault(),this.toggle_share_tooltip(e),!0},Application.prototype.clickedBody=function(e){return this.trigger("body:clicked"),$(e.target).hasClass("expand-share")?void 0:this.toggle_share_tooltip("close")},Application.prototype.render=function(){var debouncedHandleScroll;$("html").addClass(Time.device),this.autoshow_ie8_modal(),this.hasPushstate||this.set_branding(),Time.components.main_modal=new Time.component.Modal("#Sign_In_Modal",{buttonSelector:'.sign-sub-wrap a[href="#signin"], .subscribe a[href="#signin"], .login-nav-wrapper .sign-in'}),this.init_plugins(),this.getSizes(!0),this.sizeContent(),this.checkScroll(),this.$window.on("scroll",function(_this){return function(){return _this.checkScroll("window")}}(this)),debouncedHandleScroll=_.debounce(function(_this){return function(){return _this.handle_scroll()}}(this),50),this.$viewport.on("scroll",function(_this){return function(e){debouncedHandleScroll(),_this.checkScroll(e),e.stopPropagation()}}(this)),this.$notHeader.on("scroll",function(_this){return function(e){return _this.checkScroll(e),e.stopPropagation()}}(this)),this.handle_resize(!0),Modernizr.touch&&this.touchUnfocus(),Modernizr.svg||this.application.svgFallback()},Application.prototype.touchUnfocus=function(){return this.$body.on("blur","input, textarea",function(){setTimeout(function(){var h;h=$(document).scrollTop(),$(document).scrollTop(h+1)},750)})},Application.prototype.setTabHref=function(){var i,l,tabs,_results;if("time"!==Time.branding){for(tabs=Time.tab_data["default"].tabs,l=tabs.length,i=0,_results=[];l>i;)tabs[i].href="/"+Time.branding+tabs[i].href,_results.push(i+=1);return _results}},Application.prototype.svgFallback=function(){return $('img[src$=".svg"]').each(function(i,el){var $el,fallback,src;return $el=$(el),fallback=$el.attr("data-fallback"),src=$el.attr("src"),$el.attr("src",fallback||src.replace(".svg",".png"))})},Application.prototype.handle_scroll=function(){var activeArticle;this.model.get("isFullscreen")||(_.each(this.arr_article_views,function(_this){return function(articleView){var articleModel;return articleModel=articleView.model,articleModel.get("check_scroll")&&_this.setArticleVisibilityAndCheckScroll(articleView),_this.readingPane.setActiveArticle(articleView)}}(this)),activeArticle=this.model.get("activeArticle"),"list"===(null!=activeArticle?activeArticle.get("format"):void 0)&&(this.article_item=activeArticle.get("list_items"),this.article_item_offsetpadding=70,$("#"+this.article_item[3].id).offset().top>this.article_item_offsetpadding&&$("#"+this.article_item[3].id).offset().top-this.article_item_offsetpadding<this.$notHeader.get(0).scrollTop&&Time.Ad.reload_left_rail_ads()),Time.trigger("readingPane:scrolled"))},Application.prototype.setArticleVisibilityAndCheckScroll=function(articleView){var $el,articleAbove,articleBelow,articleModel,article_position,id;$el=articleView.$el,articleModel=articleView.model,id=articleModel.get("id"),articleAbove=this.readingPane.getArticleAbove(articleView),articleBelow=this.readingPane.getArticleBelow(articleView),article_position=this.article_position($el),"above"===article_position||"below"===article_position?articleModel.get("visible")&&(this.hide_images($el),$el.addClass("offScreen"),Time.trigger("article:offscreen",articleView),this.$window.trigger("offscreen",articleView),articleModel.set("visible",!1),"above"===article_position&&(i>0&&null!=articleAbove&&articleAbove.model.set("check_scroll",!1),null!=articleBelow&&articleBelow.model.set("check_scroll",!0)),"below"===article_position&&(null!=articleAbove&&articleAbove.model.set("check_scroll",!0),null!=articleBelow&&articleBelow.model.set("check_scroll",!1))):articleModel.get("visible")||(this.show_images($el),$el.removeClass("offScreen"),Time.trigger("article:onscreen",articleView),this.$window.trigger("onscreen",articleView),articleModel.set("visible",!0),i>0&&null!=articleAbove&&articleAbove.model.set("check_scroll",!0),null!=articleBelow&&articleBelow.model.set("check_scroll",!0))},Application.prototype.article_position=function($el,thresh){var position,rect,threshhold,winHeight;return position="in",winHeight=$(window).height(),threshhold=thresh||1,rect=$el.get(0).getBoundingClientRect(),rect.bottom<=-(winHeight*threshhold)&&(position="above"),rect.top>winHeight+winHeight*threshhold&&(position="below"),position},Application.prototype.hide_images=function($el){var images;return images=$el.find("img"),images.each(function(){var $this;return $this=$(this),$this.css({height:$this.height()}).attr({"old-src":$this.attr("src"),src:""})})},Application.prototype.show_images=function($el){var images;return images=$el.find("img"),images.each(function(){var $this;return $this=$(this),$this.attr({src:$this.attr("old-src")}).css({height:""})})},Application.prototype.destroy_article=function($el){var height,model;return model=this.active_rail.get($el.data("article")),height=$el.height(),model.destroy(),$el.remove(),this.$viewportWrapper.scrollTop(this.$viewportWrapper.get(0).scrollTop-height)},Application.prototype.toggle_share_tooltip=function(e){var $targ,is_showing;if("close"===e)$(".expand-share").removeClass("expanded");else if($targ=$(e.target),is_showing=$targ.hasClass("expanded"),$(".expand-share").removeClass("expanded"),!is_showing)return $targ.addClass("expanded")},Application.prototype.getSizes=function(init){return init&&(this.sizes.window={},this.sizes.window.width=this.$window.width(),this.sizes.window.height=this.$window.height()),Time.sizes},Application.prototype.sizeContent=function(){var contentHeight,headerHeight,isIpad,isIphone,mobileSafariOffset;return headerHeight=this.$main_header.outerHeight(!0),contentHeight=this.$window.height()-headerHeight,this.$admin_bar.length&&(contentHeight-=this.$admin_bar.height()),isIphone=this.mobileSafari&&/iphone/i.test(navigator.userAgent.toLowerCase()),isIpad=this.mobileSafari&&/ipad/i.test(navigator.userAgent.toLowerCase()),mobileSafariOffset=0,isIphone&&(mobileSafariOffset=60),this.$notHeader.height(contentHeight+mobileSafariOffset),this.$viewport.height(contentHeight),this.$left_rail.height(contentHeight),this.$articleListScroll.css({top:this.$tabs.outerHeight(),bottom:$(".scroll-for-more").outerHeight()}),!0},Application.prototype.checkScroll=function(init){var isFirstArticleActive,_ref,_ref1,_ref2,_ref3;if(null==init&&(init=!1),!this.model.get("isFullscreen")){if("window"===init&&(this.scrollRedraw(this.$articleListScroll.get(0)),this.$notHeader.removeClass("stick")),init===!0&&(this.$notHeader.scrollTop(0),this.$notHeader.removeClass("stick"),this.active_rail&&this.$pushDown.outerHeight(!0)>0&&$("body").hasClass("collection-template")&&0!==(null!=(_ref=Time.application.model.get("activeArticle"))?_ref.views.tile_view.$el.index(".collection-rail-article"):void 0)&&(this.$notHeader.scrollTo(this.$pushDown.outerHeight(!0)),this.$notHeader.addClass("stick"))),this.$magazineCover.outerHeight(!0)+this.$pushDown.outerHeight(!0)>0){if(this.skipNextScroll)return this.skipNextScroll=!1,!0;
this.$notHeader.hasClass("stick")?(isFirstArticleActive=0===(null!=(_ref1=this.model.get("activeArticle"))&&null!=(_ref2=_ref1.views.tile_view)?_ref2.$el.index():void 0),(this.is_homepage||isFirstArticleActive)&&this.$viewport.scrollTop()<=0&&(this.$pushDown.height()>0||this.$magazineCover.height()>0)&&(this.$notHeader.removeClass("stick"),"object"==typeof init&&(this.skipNextScroll=!0)),$("body").hasClass("collection-template")&&0===(null!=(_ref3=Time.application.model.get("activeArticle"))?_ref3.views.tile_view.$el.index(".collection-rail-article"):void 0)&&this.$viewport.scrollTop()<=0&&(this.$pushDown.height()>0||this.$magazineCover.height()>0)&&(this.$notHeader.removeClass("stick"),"object"==typeof init&&(this.skipNextScroll=!0))):this.$notHeader.height()+this.$notHeader.get(0).scrollTop>=this.$notHeader.get(0).scrollHeight&&(this.$notHeader.addClass("stick"),"object"==typeof init&&(this.skipNextScroll=!0))}else this.$notHeader.addClass("stick");return this}},Application.prototype.load_ticker=function(){return null==this.ticker||"mobile"===Time.device?this.ticker=new Time.views.TickerModule:this.ticker.render()},Application.prototype.redraw=function(el){var disp,n;return this.mobileSafari?(el||(el=$("body").get(0)),n=document.createTextNode(" "),disp=el.style.display,el.appendChild(n),el.style.display="inline-block",setTimeout(function(){return el.style.display=disp,n.parentNode.removeChild(n)},20)):void 0},Application.prototype.scrollRedraw=function(el){var $el;return"undefined"==typeof el?$el=this.$body:($el=$(el),$el.css("overflow","hidden").height(),$el.css("overflow",""))},Application.prototype.userToggleLeftRail=function(){return this.model.set("isRailUserOpen",!this.model.get("isRailOpen")),this.model.set("isRailOpen",!this.model.get("isRailOpen")),!1},Application.prototype.openLeftRail=function(){var isEntireRailVisible;return $("body").addClass("left-rail-open").removeClass("left-rail-closed"),this.$notHeader.addClass("show-articles-beneath-medium"),isEntireRailVisible=$(".rail-articles-scroll")[0].scrollHeight===$(".rail-articles-scroll").innerHeight(),isEntireRailVisible||$(".scroll-for-more").css({transform:"translateX(0)",transition:"transform 0.3s ease"}).appendTo("body").show(),omniTrackEv("mobi-expose"),window.setTimeout(function(){return Time.trigger("leftRail:opened")},300),!0},Application.prototype.closeLeftRail=function(){return $("body").addClass("left-rail-closed").removeClass("left-rail-open"),Time.trigger("leftRail:closing"),this.$notHeader.removeClass("show-articles-beneath-medium"),omniTrackEv("mobi-close"),$(".scroll-for-more").hide(),Time.trigger("leftRail:closed"),!0},Application.prototype.init_plugins=function(){this.$notHeader.on("click",".article-permalink",function(_this){return function(){_this.model.set("isRailOpen",_this.isRailVisible())}}(this)),this.$viewport.on("click",".read-video-article",function(e){var $shareTools,$this,$videoContent;e.preventDefault(),$this=$(e.target),$videoContent=$this.parent().find(".video-content"),$shareTools=$this.parent().parent().find(".article-footer"),$this.toggleClass("show"),$this.hasClass("show")?($videoContent.children(":not(aside:not(:last-child))").show(),$this.text("- HIDE ARTICLE")):($videoContent.children(":not(aside:not(:last-child))").hide(0,"",function(){return $videoContent.children("aside:last-child").show()}),$this.text("+ READ ARTICLE"))}),this.$notHeader.find(".rail-handle").on("touchend click",function(_this){return function(e){e.preventDefault(),e.stopPropagation(),_this.userToggleLeftRail()}}(this))},Application.prototype.init_degraded_rail_left_rail=function(){return this.$window.on("scroll.degraded-rail",function(){var scrolled,topPos,viewportHeight;return topPos=$(".left-rail-header").outerHeight(),viewportHeight=Time.util.getHeight(),scrolled=$(document).scrollTop()})},Application.prototype.sanitize_url=function(url){var sanitized_url;return null==url&&(url=""),/^\/[^/]/.test(url)?sanitized_url=url.substr(1,url.length):-1!==url.indexOf(this.root)&&(sanitized_url=url.substr(this.root.length,url.length)),sanitized_url},Application.prototype.reset_scroll=function(scrolltop){return null==scrolltop&&(scrolltop=1),null!=this.infinite_scroll&&this.infinite_scroll.pause(),_.defer(function(_this){return function(){return _this.$viewport.scrollTop(scrolltop),window.setTimeout(function(){var _ref;return null!=(_ref=_this.infinite_scroll)?_ref.resume():void 0},500),_this.trigger("application:ready"),$("body").removeClass("hidden"),$(".wpcom-protected-iframe").length&&(window.TIMEContentLoaded=document.createEvent("Event"),window.TIMEContentLoaded.initEvent("DOMContentLoaded",!0,!0),window.document.dispatchEvent(TIMEContentLoaded)),_this.checkScroll(),_this.sizeContent()}}(this)),this},Application.prototype.route=function(e){var $clicked_el,href,sanitized_url,should_bypass,should_trigger;return href=e.currentTarget.href,$clicked_el=$(e.currentTarget),sanitized_url=this.sanitize_url(href),should_bypass=$clicked_el.is("[data-bypass]")||"collection"===$clicked_el.attr("id")||this.$body.hasClass("page-template-pagespage-special-story-php")||this.$body.hasClass("home")&&this.hasPushstate||this.$body.hasClass("nativo-template")&&!$clicked_el.hasClass("article-permalink"),!should_bypass&&this.is_internal(href)&&this.should_route(href)&&"nav-latest"!==$clicked_el.data("event")?(should_trigger=!$clicked_el.is("[data-silent]"),e.preventDefault(),this.router.navigate(sanitized_url,should_trigger)):href&&this.is_internal(href)?(e.preventDefault(),window.location.href=href):void 0},Application.prototype.should_route=function(url){var isMoney,is_money_special_article,match,routes,sanitize_url,sectionRoutes;return routes=/^\/($|(author\/)|(magazine)|(money\/)|(collection\/)|(topic\/)|(([0-9]+)\/)|(tag\/)|(content\-from\/)|(right-now\/)|(popular\/)|(videos\/))/,sectionRoutes=/^\/(business|culture|living|entertainment|health|ideas|newsfeed|opinion|politics|science|sports|style|tech|us|world)\/?$/,sanitize_url=this.sanitize_url(url),isMoney=/^\/money\//,is_money_special_article=/^\/money\/page\//.test(sanitize_url),"money"===Time.branding&&!isMoney.test(sanitize_url)||"time"===Time.branding&&isMoney.test(sanitize_url)?!1:match=routes.test(sanitize_url)&&!is_money_special_article||sectionRoutes.test(sanitize_url)&&sanitize_url.indexOf(Time.curRoute.sub)>-1},Application.prototype.is_internal=function(url){var is_internal;return is_internal=url.substr(0,this.root.length)===this.root||-1===url.indexOf("//")},Application.prototype.open_popup=function(e){var clicked_el,height,href,options,width;return e.preventDefault(),clicked_el=e.currentTarget,href=$(clicked_el).data("href")||$(clicked_el).attr("href"),width=550,height=420,options="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+width+",height="+height,window.open(href,"Share",options),!1},Application.prototype.getPageType=function(){var pageType;return this.isTopicPage()?"topic":(pageType=null!=this.active_route?this.active_route:void 0,"rail"===pageType&&(pageType="article"),pageType)},Application.prototype.isTopicPage=function(){var $leftRailTopper,$topic;return $leftRailTopper=$("body").find(".left-rail-topper").eq(0),$topic=$leftRailTopper.find("#topic"),$topic.length&&$topic.hasClass("active")},Application.prototype.isRailVisible=function(){return $(".left-rail").offset().left>=0},Application.prototype.setOrientation=function(){return this.$window.width()<this.$window.height()?this.model.set("orientation","portrait"):this.model.set("orientation","landscape"),this},Application.prototype.setIsRailOpen=function(){var hasRailHandle;hasRailHandle="block"===$(".rail-handle").css("display"),this.model.set("isRailToggleable",hasRailHandle)},Application.prototype.set_title=function(new_title){return this.title=this.html_decode(new_title),document.title=this.title},Application.prototype.handle_resize=function(init){var this_breakpoint,win_wid,_results;this.setIsRailOpen(),brightcove.createExperiences(),win_wid=Time.util.getWidth(),_results=[];for(this_breakpoint in this.breakpoints)(!this.breakpoints[this_breakpoint].is_beneath||null!=init&&init)&&win_wid<=this.breakpoints[this_breakpoint].size&&(Time.trigger("is-beneath-breakpoint-"+this.breakpoints[this_breakpoint].name),this.breakpoints[this_breakpoint].is_beneath=!0),(this.breakpoints[this_breakpoint].is_beneath||null!=init&&init)&&win_wid>this.breakpoints[this_breakpoint].size?(Time.trigger("is-above-breakpoint-"+this.breakpoints[this_breakpoint].name),_results.push(this.breakpoints[this_breakpoint].is_beneath=!1)):_results.push(void 0);return _results},Application.prototype.html_encode=function(str){return document.createElement("a").appendChild(document.createTextNode(str)).parentNode.innerHTML},Application.prototype.html_decode=function(str){var a_el;return a_el=document.createElement("a"),a_el.innerHTML=str,a_el.textContent},Application.prototype.loadChartbeat=function(url,title,sections,zone,authors){Time.tgxAdapter.ENABLED&&(null!=sections&&"money"===Time.branding&&(sections=_.map([sections],function(name){return"Money-"+name.charAt(0).toUpperCase()+name.slice(1)}),sections.unshift("Money"),JSON.stringify(sections),window._sf_async_config.sections=sections),yepnope([{test:window.pSUPERFLY,nope:"http://static.chartbeat.com/js/chartbeat_pub.js",complete:function(_this){return function(){var path;return window.pSUPERFLY&&!_this.initialChartbeat&&(path=url.replace(Time.home_url,""),path="/"+path,window._sf_async_config.sections=sections,window._sf_async_config.zone=zone,window._sf_async_config.authors=authors,pSUPERFLY.virtualPage(path,title)),_this.initialChartbeat=!1}}(this)}]))},Application.prototype.enter_medium=function(){return null!=this.$nav_component&&null!=this.$nav_component.data("Navigation")&&(this.$nav_component.data("Navigation").destroy(),this.$nav_component=null),this.$nav_component=Time.component.make("MobileNavigation",".header-nav-button",{menuSelector:".left-rail-header .main-nav",handleClickOutside:!1})},Application.prototype.exit_medium=function(){return null!=this.$nav_component&&null!=this.$nav_component.data("MobileNavigation")&&(this.$nav_component.data("MobileNavigation").destroy(),this.$nav_component=null),this.$nav_component=Time.component.make("Navigation",".header-nav-button",{menuSelector:".main-nav",handleClickOutside:!1,scroller:".rail-articles-scroll"})},Application.prototype.render_section_header=function(data){var html;return html=Time.templates["top-header"].render(data),this.$top_banner.html(html),this.active_rail.load_tabs(this.active_rail.sub,".rail-tabs")},Application.prototype.render_top_banner=function(data){var html;return html=Time.templates["top-header"].render(data),this.$top_banner.html(html)},Application.prototype.swipe_hide_collection_banner=function(){return this.$collection_banner_wrapper.addClass("hide"),this.$viewport.css({"margin-top":""}),this.$viewportWrapper.css({"padding-bottom":""})},Application.prototype.swipe_render_collection_banner=function(){return this.$collection_banner_wrapper.removeClass("hide"),this.$viewport.css({"margin-top":this.banner_height}),this.$viewportWrapper.css({"padding-bottom":this.banner_height})},Application.prototype.render_collection_banner=function(data){var $collection_ul,added_1,html,width,_this;return 0===$("#collection_hub_banner_wrapper").length?(html=Time.templates["collections-banner"].render(data),this.$main_header.after(html),this.$collection_banner_wrapper=$("#collection_hub_banner_wrapper"),this.banner_height=this.$collection_banner_wrapper.outerHeight(),_this=this,"desktop"!==Time.device&&(width=10,added_1=!1,this.$collection_banner_wrapper.css("width",this.$window.outerWidth()-10),this.$collection_banner_wrapper.find("li").each(function(){width+=$(this).outerWidth()}),$collection_ul=this.$collection_banner_wrapper.find("ul"),$collection_ul.css("width",width),this.$window.on(this.orientationEvent+".collection_banner_wrapper",function(){var $collection_banner_wrapper,banner_height;$collection_banner_wrapper=_this.$collection_banner_wrapper,$collection_banner_wrapper.find("ul").css("width",width),banner_height=this.banner_height,_this.$viewport.css({"margin-top":banner_height}),_this.$viewportWrapper.css({"padding-bottom":banner_height}),$collection_banner_wrapper.css("width",_this.$window.outerWidth()-10),_this.mobileSafari&&($collection_ul.hide(),setTimeout(function(){return $collection_ul.show()},100)),_this.swipe_render_collection_banner()}),Modernizr.touch&&"mobile"===Time.device&&this.$viewportWrapper.touchwipe({wipeUp:function(_this){return function(){return _this.swipe_render_collection_banner()}}(this),wipeDown:function(_this){return function(){return _this.swipe_hide_collection_banner()}}(this),min_move_x:6,min_move_y:6,preventDefaultEvents:!1})),this.$viewport.css({"margin-top":this.banner_height}),this.$viewportWrapper.css({"padding-bottom":this.banner_height})):void 0},Application.prototype.remove_collection_banner=function(){var viewportWrapper_ref;return this.$collection_banner_wrapper=$("#collection_hub_banner_wrapper"),this.$window.off(this.orientationEvent+".collection_banner_wrapper"),this.$collection_banner_wrapper.remove(),Modernizr.touch&&(viewportWrapper_ref=this.$viewportWrapper.get(0),viewportWrapper_ref.removeEventListener("touchstart",viewportWrapper_ref.onTouchStart_ref),viewportWrapper_ref.removeEventListener("touchmove",viewportWrapper_ref.onTouchMove_ref)),this.$viewport.css({"margin-top":""}),this.$viewportWrapper.css({"padding-bottom":""})},Application.prototype.render_collection_video=function(e){var $figure,$videoFigure,$videoHtml;return e.preventDefault(),$videoFigure=$(e.target).closest("[data-video]"),$videoHtml=$videoFigure.data("video"),$figure=$videoFigure.addClass("home-video-wrapper").html($videoHtml),$figure.siblings(".image-caption").css("visibility","hidden"),$figure.find(".BrightcoveExperience").length?brightcove.createExperiences():void 0},Application.prototype.twitter_share_url=function(url,text,via){var intent;return intent="https://twitter.com/intent/tweet?",null!=url&&(intent+="&url="+url),null!=text&&(intent+="&text="+text),null!=via&&(intent+="&via="+via),intent},Application.prototype.show_loader=function($container){return $container.addClass("loading-overlay"),$container},Application.prototype.hide_loader=function($container){return $container.removeClass("loading-overlay loading-error")},Application.prototype.show_loader_error=function($container,message,duration){var loader_timeout;return null==message&&(message="Sorry, the requested content could not be loaded"),null==duration&&(duration=3e3),$container.attr("data-error",message),$container.addClass("loading-error"),duration&&(loader_timeout=window.setTimeout(function(_this){return function(){return _this.hide_loader($container)}}(this),duration)),$container},Application.prototype.load_tabs=function(tabs,el_selector){return null==tabs&&(tabs=Time.tab_data["default"]),null==el_selector&&(el_selector=!1),null!=this.tabs_view&&this.remove_tabs(),this.tabs_view=new Time.views.Tabs(tabs,el_selector),this.last_tabs=tabs,this.init_search()},Application.prototype.remove_tabs=function(){return null!=this.tabs_view&&this.tabs_view.destroy(),this.tabs_view=null,$(".rail-tabs").empty()},Application.prototype.filter=function(list,id){return list=_.filter(list,function(article){return article.id!==id})},Application.prototype.init_search=function(){return this.$search_component&&(this.$search_component=null,delete this.$search_component),this.$search_component=Time.component.make("RailSearch",".main-nav-search-icon",{})},Application.prototype.destroyRailEnv=function(){return this.exit_env(),this.abort_railXHR(),this.destroy_rail()},Application.prototype.sanitizeRailParams=function(params){var sanitizedParams,_ref,_ref1;return sanitizedParams=$.extend(!0,{},params),sanitizedParams.env=(null!=(_ref=sanitizedParams.env)?_ref.toLowerCase():void 0)||"rail",sanitizedParams.sub=(null!=(_ref1=sanitizedParams.sub)?_ref1.toLowerCase():void 0)||null,sanitizedParams.section_tag=sanitizedParams.section_tag||null,sanitizedParams},Application.prototype.uppercaseFirstLetter=function(word){return word.charAt(0).toUpperCase()+word.slice(1)},Application.prototype.load_rail_env=function(params){var old_env,railParams,rail_class;return this.remove_collection_banner(),null!=Time.homepage_refresh&&clearInterval(Time.homepage_refresh),null!=Time.marketdata_refresh&&clearInterval(Time.marketdata_refresh),this.destroyRailEnv(),Time.curRoute=params,railParams=this.sanitizeRailParams(params),rail_class=null,railParams.env&&(rail_class=this.uppercaseFirstLetter(railParams.env),old_env=$("body").data("env"),this.$body.removeClass(old_env+"-template")),console.info("-- load_rail_env -- using rail: "+rail_class),this.$body.data("env",railParams.env).addClass(railParams.env+"-template"),this.active_rail=new Time.collections[rail_class]([],{sub:railParams.sub,section_tag:railParams.section_tag}),this.listenToOnce(this.active_rail,"add",function(_this){return function(model){return console.info("-- load_rail_env -- added first article"+model.id),_this.init_infinite_scroll(),_.defer(function(){var item_slug;return null!=params.article_id?(item_slug=null!=params.item_slug?params.item_slug:null,_this.active_rail.load_single_article(params.article_id,item_slug)):null!=params.sync_article_id?_this.active_rail.synchronize(params.sync_article_id):_this.active_rail.synchronize()})}}(this)),this.active_rail.load_articles(),this.active_template=railParams.sub,this.active_route=railParams.env,"section"===Time.curRoute.env&&(Time.components.contributor_modal=new Time.component.Modal("#contributor-modal",{buttonSelector:".contributor-signup"})),null!=railParams.open_rail&&this.model.set("isRailOpen",!0),this.active_rail},Application.prototype.exit_env=function(){return $("body").removeClass("has-section-menu tax-time_section home money-home")},Application.prototype.abort_railXHR=function(){return null!=this.railXHR&&"object"==typeof this.railXHR?(this.railXHR.readyState<4&&this.railXHR.abort(),this.railXHR=null,delete this.railXHR):void 0},Application.prototype.destroy_rail=function(){var _ref;return null==this.active_rail?!1:(_.each(this.active_rail.models,function(model){var _ref,_ref1;return null!=(_ref=model.views.tile_view)&&_ref.destroy(),model.views.tile_view=null,null!=(_ref1=model.views.singleView)&&_ref1.destroy(),model.views.singleView=null}),null!=(_ref=this.infinite_scroll)&&_ref.unbind(),this.infinite_scroll=null,this.active_rail.reset(),this.active_rail.view.annihilate(),this.active_rail=null,this)},Application.prototype.init_infinite_scroll=function(){return this.infinite_scroll=new Time.component.InfiniteScroll(this.$viewport,this.$viewport.find(".wrapper"),400,this.active_rail.show_next_article,this.active_rail.show_previous_article,this.active_rail),this},Application.prototype.cleanArticleId=function(articleId){return/^[^s]/.test(articleId)&&(articleId=parseInt(articleId,10)),articleId},Application.prototype.load_article=function(articleId,item_slug){var articleModel,currentActiveArticle,_ref,_ref1;return articleId=this.cleanArticleId(articleId),"undefined"!=typeof console&&null!==console&&console.info("ApplicationView -- load_article"),articleId?(currentActiveArticle=this.model.get("activeArticle"),null!=currentActiveArticle&&currentActiveArticle.set("isActive",!1),console.info("-- load_article -- in active_rail?",this.active_rail),null!=(null!=(_ref=this.active_rail)?_ref.get(articleId):void 0)?(console.info("---- was in rail, synchronizing"),this.active_rail.synchronize(articleId)):(articleModel=new Time.models.Article({id:articleId}),this.listenToOnce(articleModel,"change",function(_this){return function(){console.info("-- load_article hard change on articleModel",articleModel.id," - loading rail env"),_this.loadArticleRail(articleModel,articleId,item_slug)}}(this)),articleId===(null!=(_ref1=Time.bootstrap.single_article)?_ref1.id:void 0)?(console.info("-- load_article -- from bootstrap",Time.bootstrap.single_article),articleModel.set(Time.bootstrap.single_article)):articleModel.fetch()),this.active_template="article",this.active_route="article",this):("undefined"!=typeof console&&null!==console&&console.error("-- load_article -- Invalid article ID",articleId),!1)},Application.prototype.loadArticleRail=function(articleModel,articleId,itemSlug){var section,topic;return null!=articleModel.get("topic")?(topic=articleModel.get("topic").slug,console.info("-- load_article load rail for topic",topic),this.load_rail_env({env:"topic",sub:topic,article_id:articleId,item_slug:itemSlug}),this):null!=articleModel.get("section")&&"money"===Time.branding?(section=articleModel.get("section").slug,console.info("-- load_article load rail for section",section),this.load_rail_env({env:"section",sub:section,section_tag:!0,article_id:articleId,item_slug:itemSlug}),this):(console.info("-- load_article load default rail"),this.load_rail_env({article_id:articleId,item_slug:itemSlug}),this)},Application.prototype.toggle_magazine_region_dropdown=function(){return $(".magazine-region-header").toggleClass("open")},Application.prototype.set_left_rail_bounds=function(){var $left_rail_topper;return $left_rail_topper=$(".left-rail-topper"),$left_rail_topper.length?(this.left_rail_top=$left_rail_topper.height()+this.$top_banner.height(),this.left_rail_bottom=this.$window.height(),void(this.left_rail_height=this.left_rail_bottom-this.left_rail_top)):!1},Application.prototype.placeholderPolyfill=function(formSelector,fieldSelector){var field,form,placeholder;return form=$(formSelector),field=$(fieldSelector),placeholder=field.attr("placeholder"),""===field.val()&&(field.val(placeholder),field.addClass("empty")),field.focus(function(){return this.value===placeholder?(field.val(""),field.removeClass("empty")):void 0}),field.blur(function(){return""===this.value?(field.val(placeholder),field.addClass("empty")):void 0}),form.submit(function(){return field.val()===placeholder||/\s+/.test(field.val())?!1:void 0})},Application.prototype.localStoragePolyfill=function(){return window.localStorage={getItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(nKeyId){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[nKeyId])},setItem:function(sKey,sValue){return sKey?(document.cookie=escape(sKey)+"="+escape(sValue)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length):void 0},length:0,removeItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?(document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--):void 0},hasOwnProperty:function(sKey){return new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}}},Application.prototype.autoshow_ie8_modal=function(){var saved_day,this_day_of_year;return $(".lt-ie9").length?(window.localStorage||this.localStoragePolyfill(),window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length,this_day_of_year=Time.util.getDayOfYear(),saved_day=localStorage.getItem("last_day"),null!=saved_day&&parseInt(saved_day)===parseInt(this_day_of_year)?!1:($(".ie-message-modal").show(),localStorage.setItem("last_day",this_day_of_year))):!1},Application.prototype.hide_ie8_message=function(e){$(e.target).is("a")||$(".ie-message-modal").hide()},Application.prototype.toggle_comments=function(e){var $article,$el,footer_pos,id,title,url,_ref;return $el=$(e.target),$article=$el.parents("article").eq(0),$el.removeAttr("data-event"),$el.parents(".article-sub-headline").length&&$el.parents("article").find(".article-footer").length&&((null!=(_ref=Time.application.model.get("activeArticle"))?_ref.views.singleView.$el.is(":last-child"):void 0)&&this.active_rail.show_next_article(),footer_pos=$el.parents("article").find(".article-footer").offset().top-this.$viewport.offset().top+Math.abs(this.infinite_scroll.position),this.reset_scroll(footer_pos),$article.hasClass("comments-shown"))?void 0:$article.hasClass("comments-shown")?(this.hide_comments($article),$article.removeClass("comments-shown")):($article.addClass("loading-comments"),id=$el.data("lf-article-id"),url=$el.data("url"),title=$el.data("title"),this.show_comments($article,id,url,title))},Application.prototype.show_comments=function($article,id,url,title){return yepnope([{test:window.fyre,nope:["http://zor.livefyre.com/wjs/v3.0/javascripts/livefyre.js","http://time.ep.livefyre.com/media/dGltZS5lcC5saXZlZnlyZS5jb20=/javascripts/customprofiles.js"],complete:function(_this){return function(){var cfg,el,lf_config,lf_site_id,post_id;return $article.hasClass("comments-rendered")?($article.find(".livefyre-comment").show(),$article.addClass("comments-shown")):($article.addClass("comments-rendered"),_this.authDelegate=_this.authDelegate||new fyre.conv.SPAuthDelegate({engage:{app:"time.auth.fyre.co"}}),lf_site_id=314099,post_id=id,el="livefyre-"+post_id,url=url,title=title,lf_config={collectionMeta:{articleId:post_id,url:url,title:title},signed:!1,siteId:lf_site_id,el:el,articleId:post_id,app:"main",postToButtons:["tw","fb","li"]},cfg={network:"time.fyre.co",authDelegate:_this.authDelegate,string:{follow:"+Follow Conversation"}},fyre.conv.load(cfg,[lf_config],function(){return $article.addClass("comments-shown"),!1})),!1}}(this)}]),!1},Application.prototype.hide_comments=function($article){return $article.find(".livefyre-comment").hide()},Application.prototype.set_branding=function(){return this.$body.addClass(Time.branding+"-branding")},Application}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.BrightcoveVideos=function(_super){function BrightcoveVideos(){return BrightcoveVideos.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideos,_super),BrightcoveVideos.prototype.autoplay=!0,BrightcoveVideos.prototype.activePlayer=null,BrightcoveVideos.prototype.IS_OMNI_ENABLED=!0,BrightcoveVideos.prototype.initialize=function(){return this.players=new Time.collections.BrightcoveVideos,this.userPaused=!1,this.bindAutoplayListeners(),this.listenTo(Time,"brightcove:template:load",function(_this){return function(experienceId){console.info("Brightcove -- template loaded",experienceId),_this.onTemplateLoad(experienceId)}}(this)),this.listenTo(Time,"brightcove:template:ready",function(_this){return function(e){console.info("Brightcove -- template ready",arguments),_this.onTemplateReady(e)}}(this)),this.listenTo(Time,"readingPane:scrolled",function(_this){return function(e){_this.onScroll(e)}}(this)),this.listenTo(Time,"article:deactivated",function(_this){return function(){_this.stopOtherPlayers(null,!0)}}(this)),this},BrightcoveVideos.prototype.bindAutoplayListeners=function(){return this.listenTo(Time,"rail:clicked:videoTile",function(_this){return function(){_this.autoplay=!0}}(this)),this.listenTo(Time,"leftRail:load:videos",function(_this){return function(){_this.autoplay=!0}}(this)),this.listenTo(Time,"article:found:noPrimaryBrightcove",function(_this){return function(){_this.autoplay=!1}}(this)),this},BrightcoveVideos.prototype.maybeAutoplay=function(playerModel){return playerModel.get("isPrimary")&&this.autoplay?(this.autoplay=!1,this.apiPlay(playerModel),playerModel):void 0},BrightcoveVideos.prototype.getPlayerEl=function(id){return $("#"+id)},BrightcoveVideos.prototype.isPrimary=function(experienceId){return this.getPlayerEl(experienceId).closest(".primary-video-wrapper").length>0},BrightcoveVideos.prototype.isVisible=function(playerModel){var $el,$playerWrapper,playerBottom,playerOffset,playerTop,viewport,viewportBottom,viewportTop;return playerModel?(viewport=$("#notTheHeader"),viewportTop=viewport.scrollTop(),viewportBottom=viewportTop+viewport.height(),$el=this.getPlayerEl(playerModel.id),$playerWrapper=$el.parent(),$playerWrapper.length?(playerOffset=$playerWrapper.offset(),playerTop=playerOffset.top,playerBottom=playerTop+$playerWrapper.innerHeight(),playerTop>=viewportTop&&viewportBottom>=playerBottom):!1):!1},BrightcoveVideos.prototype.onScroll=function(e){if(!this.activePlayer)return e;if(this.isVisible(this.activePlayer)){if(this.userPaused)return e;if("ad"===this.activePlayer.get("media"))return e;this.apiPlay(this.activePlayer)}else this.apiStop(this.activePlayer,!0);return e},BrightcoveVideos.prototype.onTemplateLoad=function(experienceId){var $article,$player,adPlayer,api,articleId,experience,oldPlayer,playerModel,videoPlayer;$player=this.getPlayerEl(experienceId),$article=$player.closest(".full-article").eq(0),articleId=$article.length?parseInt($article.data("article"),10):null,null!=Time.bootstrap.popularVideos&&Time.bootstrap.popularVideos.length>0&&this.loadPopularVideos(experienceId);try{experience=brightcove.api.getExperience(experienceId)||null,api=brightcove.api.modules.APIModules||null,videoPlayer=experience.getModule(api.VIDEO_PLAYER),adPlayer=experience.getModule(api.ADVERTISING),this.IS_OMNI_ENABLED&&omni_myTemplateLoaded(experienceId)}catch(_error){}oldPlayer=this.players.get(experienceId),this.players.remove(oldPlayer),playerModel=this.players.push({id:experienceId,state:"stopped",experience:experience,videoPlayer:videoPlayer,adPlayer:adPlayer,isPrimary:this.isPrimary(experienceId)})},BrightcoveVideos.prototype.onTemplateReady=function(e){var adPlayer,adPolicy,experienceId,playerModel,videoPlayer,_ref,_ref1;try{this.IS_OMNI_ENABLED&&omni_onTemplateReady(e)}catch(_error){}return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),videoPlayer=playerModel.get("videoPlayer"),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.BEGIN,function(_this){return function(event){return _this.onBegin(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE,function(_this){return function(event){return _this.onComplete(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.PLAY,function(_this){return function(event){return _this.onPlay(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.STOP,function(_this){return function(event){return _this.onStop(event)}}(this)),videoPlayer.addEventListener("click",function(_this){return function(event){return _this.onClick(event)}}(this)),adPlayer=playerModel.get("adPlayer"),null!=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.collection)?_ref1.intro_post:void 0)&&(adPolicy=adPlayer.getAdPolicy(),adPolicy.playAdOnLoad=!1,adPlayer.setAdPolicy(adPolicy)),adPlayer.addEventListener(brightcove.api.events.AdEvent.START,function(_this){return function(event){return _this.onAdStart(event)}}(this)),adPlayer.addEventListener(brightcove.api.events.AdEvent.COMPLETE,function(_this){return function(event){return _this.onPlay(event)}}(this)),adPlayer.addEventListener("click",function(_this){return function(event){return _this.onClick(event)}}(this)),this.maybeAutoplay(playerModel),e},BrightcoveVideos.prototype.onAdStart=function(e){var experienceId;return experienceId=e.target.experience.id,this.activePlayer=this.players.get(experienceId),this.activePlayer.set("media","ad"),this.onPlay(e)},BrightcoveVideos.prototype.onBegin=function(e){var experienceId,playerModel;return experienceId=e.target.experience.id,this.stopOtherPlayers(experienceId),playerModel=this.players.get(experienceId),this.activePlayer=playerModel,this.activePlayer.set("media","video"),this.userPaused=!1,e},BrightcoveVideos.prototype.onComplete=function(e){var experienceId,playerModel,videoPlayer;return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),videoPlayer=playerModel.get("videoPlayer"),this.popularVideos.length>0?videoPlayer.loadVideoByID(this.popularVideos.shift()):(this.activePlayer=null,this.userPaused=!1),e
},BrightcoveVideos.prototype.onClick=function(e){var experienceId,_ref,_ref1,_ref2;return console.info("Brightcove heard click",e),experienceId=null!=e&&null!=(_ref=e.target)&&null!=(_ref1=_ref.experience)?_ref1.id:void 0,this.stopOtherPlayers(experienceId),(null!=(_ref2=this.activePlayer)?_ref2.id:void 0)===experienceId?"stopped"===this.activePlayer.get("state")&&(this.userPaused=!0):(null!=this.activePlayer&&this.apiStop(this.activePlayer),this.activePlayer=this.players.get(experienceId)),e},BrightcoveVideos.prototype.onPlay=function(e){var experienceId;return experienceId=e.target.experience.id,this.stopOtherPlayers(experienceId),experienceId=e.target.experience.id,this.activePlayer=this.players.get(experienceId),this.activePlayer.set("state","playing"),this.userPaused=!1,clearInterval(Time.homepage_refresh),e},BrightcoveVideos.prototype.onStop=function(e){var experienceId,playerModel;return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),this.players.get(experienceId).set("state","stopped"),e},BrightcoveVideos.prototype.stopOtherPlayers=function(id,isUserPaused){return null==isUserPaused&&(isUserPaused=!1),_.each(this.players.getOthers(id),function(_this){return function(player){return _this.apiStop(player,isUserPaused)}}(this)),id},BrightcoveVideos.prototype.apiStop=function(playerModel,isScroll){var _ref,_ref1,_ref2;null==isScroll&&(isScroll=!1),isScroll||(null!=(_ref=this.activePlayer)?_ref.id:void 0)!==playerModel.id||(this.userPaused=!0);try{null!=(_ref1=playerModel.get("videoPlayer"))&&"function"==typeof _ref1.pause&&_ref1.pause(!0),null!=(_ref2=playerModel.get("adPlayer"))&&"function"==typeof _ref2.pause&&_ref2.pause(!0)}catch(_error){}return playerModel},BrightcoveVideos.prototype.apiPlay=function(playerModel){var _ref;try{null!=(_ref=playerModel.get("videoPlayer"))&&"function"==typeof _ref.play&&_ref.play(),this.activePlayer=playerModel}catch(_error){}return playerModel},BrightcoveVideos.prototype.loadPopularVideos=function(experienceId){var currentVideo,index,shuffledVideos;for(currentVideo=parseInt(experienceId.replace("bc-video-","").slice(0,-2)),this.popularVideos=Time.bootstrap.popularVideos,index=this.popularVideos.indexOf(currentVideo),index>0&&this.popularVideos.splice(index,1),shuffledVideos=this.popularVideos;this.popularVideos.join()===shuffledVideos.join();)shuffledVideos=_.shuffle(shuffledVideos);return this.popularVideos=shuffledVideos},BrightcoveVideos}(Backbone.View),Time.views.ArticleCollectionsTile=Time.views.ArticleTile.extend({template:Time.templates["article-tile-collection"],initialize:function(){return this.$container=this.model.collection.view.$el,this.$scroll_container=this.model.collection.view.$scroll_container,this.listenTo(this.model,"change:isActive",function(_this){return function(){var $hub_container,isActive,_ref,_ref1;isActive=_this.model.get("isActive"),_this.$el.toggleClass("active",isActive),isActive&&($hub_container=_this.$el.parents(".hub-rail-container"),$hub_container.hasClass("expanded")||Time.application.active_rail.view.show_hub(_this.$el.data("hub")),(null!=(_ref=_this.model.collection)&&null!=(_ref1=_ref.view)?_ref1.jump_to_active_tiles:void 0)&&_this.make_visible()),_this.model.get("last_article")&&Time.application.$viewport.toggleClass("loading",!isActive)}}(this)),this.listenTo(this.model,"article:tile-rendered",function(_this){return function(){var collection;Time.Ad.get_initial_left_rail_load()&&(collection=_this.model.collection,collection.real_article_index%collection.adFrequency===collection.adOffset&&_this.insert_ad_after())}}(this)),this.render()},set_template:function(){return this.template=Time.templates["article-tile-collection"],this.template},create_advert:function(){var $el,index;return this.model.collection.ad_in_left_rail+=1,index=this.model.collection.ad_in_left_rail,$el=$("<div/>",{"class":"ad-unit",id:"ad-unit-"+index,pos:index})},render:function(){return this.setElement($("#article-tile-"+this.model.get("id"))),0===this.$el.length&&(this.set_template(),this.adjust_data(),this.setElement($(this.template.render(this.model.attributes))),this.$el.appendTo($("#hub-"+this.model.attributes.hub_id)),this.model.get("isActive")&&this.model.maybeNavigateTo()),this.model.trigger("article:tile-rendered")}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Divider=function(_super){function Divider(){return Divider.__super__.constructor.apply(this,arguments)}return __extends(Divider,_super),Divider.prototype.initialize=function(options){return null==options&&(options={}),this.articleView=options.article,this.articleModel=this.articleView.model,this.articleId=this.articleModel.get("id"),this.model=new Time.models.Divider,console.info("---- DIVIDER",this,this.model.attributes),this},Divider.prototype.render=function(){var $el,$html,$inner;switch(this.model.get("type")){case"advert":this.model.set("divId","ad-below-"+this.articleId),$html=$("<div />",{"class":"divider-"+this.model.get("type"),id:"ad-below-"+this.articleId,"data-cb-ad-id":"ad-below"}).data("cb-ad-id","ad-below"),this.setElement($html);break;case"articles":this.model.set("divId","divider-300x600-"+this.articleId),$el=$("<div />",{"class":"divider-"+this.model.get("type")}),$el.html(this.model.get("articles_html")),$el.find(".divider-300x600").eq(0).attr("id",this.model.get("divId")),this.setElement($el);break;case"empty":this.setElement(null);break;case"taboola":$el=$("<div />",{"class":"divider-"+this.model.get("type")}),$inner=$("<div />",{id:"taboola-mid-page-"+Time.taboola_counter,"class":"taboola"}),$el.html($inner),this.setElement($el)}return this},Divider}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideLightboxEndless=function(_super){function GallerySlideLightboxEndless(){return GallerySlideLightboxEndless.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideLightboxEndless,_super),GallerySlideLightboxEndless.prototype.template=Time.templates["gallery-slide-lightbox-endless"],GallerySlideLightboxEndless.prototype.events={"click [data-gallery-link]":"clickedTile"},GallerySlideLightboxEndless.prototype.initialize=function(){return this},GallerySlideLightboxEndless.prototype.render=function(){var nextGallery,_ref,_ref1,_ref2;return(nextGallery=this.model.get("nextGallery"))?(this.setElement(this.template.render(nextGallery,Time.partials)),this.gallery=null!=(_ref=this.model)&&null!=(_ref1=_ref.collection)?_ref1.gallery:void 0,(null!=(_ref2=this.gallery)?_ref2.get("isAdvanceable"):void 0)&&this.listenTo(this.gallery,"gallery:pastEnd",function(){return this.swapGallery(nextGallery.id)}),this):void 0},GallerySlideLightboxEndless.prototype.clickedTile=function(e){var $galleryThumbnail,galleryId;return e.stopPropagation(),null!=this.gallery&&this.gallery.get("isSwappable")?(e.preventDefault(),$galleryThumbnail=$(e.currentTarget),galleryId=$galleryThumbnail.data("gallery-link"),this.swapGallery(galleryId)):void 0},GallerySlideLightboxEndless.prototype.swapGallery=function(galleryId){var _ref,_ref1;if(null!=galleryId)return Time.initial_gallery_slug=!1,null!=(_ref=this.gallery)&&null!=(_ref1=_ref.collection)&&_ref1.trigger("gallery:replace",this.gallery.id,galleryId),this},GallerySlideLightboxEndless}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideLightboxRelated=function(_super){function GallerySlideLightboxRelated(){return GallerySlideLightboxRelated.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideLightboxRelated,_super),GallerySlideLightboxRelated.prototype.template=Time.templates["gallery-slide-lightbox-related"],GallerySlideLightboxRelated.prototype.events={"click [data-gallery-link]":"clickedTile"},GallerySlideLightboxRelated.prototype.initialize=function(){return this},GallerySlideLightboxRelated.prototype.render=function(){var data,_ref,_ref1;return data={galleries:this.model.get("galleries")},this.setElement(this.template.render(data,Time.partials)),this.gallery=null!=(_ref=this.model)&&null!=(_ref1=_ref.collection)?_ref1.gallery:void 0,this},GallerySlideLightboxRelated.prototype.clickedTile=function(e){var $galleryThumbnail,galleryId;return e.stopPropagation(),null!=this.gallery&&this.gallery.get("isSwappable")?(e.preventDefault(),$galleryThumbnail=$(e.currentTarget),galleryId=$galleryThumbnail.data("gallery-link"),this.swapGallery(galleryId)):void 0},GallerySlideLightboxRelated.prototype.swapGallery=function(galleryId){var _ref,_ref1;if(null!=galleryId)return Time.initial_gallery_slug=!1,null!=(_ref=this.gallery)&&null!=(_ref1=_ref.collection)&&_ref1.trigger("gallery:replace",this.gallery.id,galleryId),this},GallerySlideLightboxRelated}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryLightboxSlides=function(_super){function GalleryLightboxSlides(){return GalleryLightboxSlides.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightboxSlides,_super),GalleryLightboxSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryLightboxSlides.__super__.initialize.apply(this,arguments),this.render(),this},GalleryLightboxSlides.prototype.render=function(){var startAt,_ref;return console.info("GalleryLightboxSlidesView render"),startAt=(null!=(_ref=this.galleryView.model)?_ref.get("slideIndex"):void 0)||0,this.renderAround(startAt),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryLightboxSlides.prototype.reallyRender=function(models){var renderedViews;return renderedViews=_.map(models,function(_this){return function(slideModel){return _this.renderSlideView(slideModel)}}(this)),this.$el.html(renderedViews),this},GalleryLightboxSlides.prototype.renderSlideView=function(model){return null!=model?(model.set("isRendered",!0),model.view.render().el):void 0},GalleryLightboxSlides.prototype.renderAround=function(index,around){var end,models,start;return null==index&&(index=0),null==around&&(around=3),start=index-around,end=index+around,0>start&&(start=0),end>this.collection.size()&&(end=this.collection.size()),this.collection.invoke("set",{isActive:!1,isRendered:!1}),models=this.collection.slice(start,end+1),console.info("GalleryLightboxSlidesView rendering slides from "+start+" to "+end,models),this.reallyRender(models),this},GalleryLightboxSlides.prototype.renderAt=function(index,append){var model,renderedView;return null==index&&(index=0),null==append&&(append=!0),0>index?this:index>this.collection.size()?this:(model=this.collection.at(index))?("undefined"!=typeof console&&null!==console&&console.info("renderAt",index,append,model),model.get("isRendered")?this:(renderedView=this.renderSlideView(model),append?$(renderedView).appendTo(this.$el):$(renderedView).prependTo(this.$el),this)):this},GalleryLightboxSlides.prototype.cleanAround=function(index,around){var derender,end,start;return null==around&&(around=3),start=index-around,end=index+around,0>start&&(start=0),end>this.collection.size()&&(end=this.collection.size()),derender=this.collection.filter(function(slide,index){return start>index||index>end}),_.each(derender,function(slide){return slide.view.$el.remove(),slide.set("isRendered",!1)}),derender},GalleryLightboxSlides}(Time.views.GallerySlidesView);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryLightbox=function(_super){function GalleryLightbox(){return GalleryLightbox.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightbox,_super),GalleryLightbox.prototype.events={"click .galleryLightbox__meta":"closeCaption","click .galleryLightbox__slides":"clickedSlide",'click [data-gallery-action="next"]':"goNextSlide",'click [data-gallery-action="prev"]':"goPrevSlide",'click [data-gallery-action="restart"]':"goFirstSlide","click .galleryLightbox__caption__wrapper.truncated":"toggleCaption",'click [data-gallery-action="toggleFullscreen"]':"toggleFullscreen"},GalleryLightbox.prototype.template=Time.templates["gallery-module-lightbox"],GalleryLightbox.prototype.initialize=function(options){return null==options&&(options={}),this.IS_SIDE_CLICKING_ENABLED=!1,this.$caption=null,this.$captionWrapper=null,this.captionMoreTemplate='<button data-gallery-action = "toggleCaption">MORE</button>',this.captionCloseTemplate='<button data-gallery-action = "toggleCaption">CLOSE</button>',this.$restart=null,this.$shareDiv=null,this.$shareToggle=null,this.$counterCurrent=null,this.$counterTotal=null,this.$shareEmail=null,this.$shareTwitter=null,this.$shareGooglePlus=null,this.$shareLinkedIn=null,this.$shareFacebook=null,this.$fullscreenToggle=null,this.$prevButton=null,this.$nextButton=null,this.bindListeners(),GalleryLightbox.__super__.initialize.apply(this,arguments),this},GalleryLightbox.prototype.bindListeners=function(){return this.listenTo(Time,"body:clicked",function(_this){return function(){_this.resetCaption()}}(this)),this.listenToOnce(this,"gallery:slides:rendered",function(){this.bindTouchEvents(),this.bindResizeEvents()}),this.listenTo(this,"gallery:slides:rendered",function(){var activeSlide,articleView,_ref;this.setSlideClasses(),this.setMeta(),activeSlide=this.slidesCollection.at(this.model.getSlideIndex()),activeSlide.set("isActive",!0),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),articleView=null!=(_ref=this.model.collection)?_ref.article:void 0,articleView.trigger("gallery:slides:rendered",this)}),this.listenTo(this,"gallery:keyboardEvent",function(e){this.doKeyboardEvent(e)}),this.listenTo(this.model,"change:isCaptionExpanded",function(_this){return function(model,value){var captionText,_ref;value?(captionText=null!=(_ref=_this.model.currentSlide())?_ref.get("caption"):void 0,_this.$captionWrapper.html(captionText+_this.captionCloseTemplate),_this.$captionWrapper.trigger("destroy.dot"),_this.$captionWrapper.addClass("expanded")):(_this.$captionWrapper.removeClass("expanded"),_this.setCaption())}}(this)),this.listenTo(this.model,"change:isFullscreen",function(_this){return function(model,value){_this.$el.toggleClass("fullscreen",value),Time.trigger("gallery:isFullscreen",_this.model,value)}}(this)),this.listenTo(this.model,"change:slideIndex",function(_this){return function(){var slideIndex,threeSlidesAfter,threeSlidesBefore;console.info("gallery view heard change:slideIndex on model"),_this.model.set("lastSlideIndex",_this.model.previous("slideIndex")),slideIndex=_this.model.get("slideIndex"),0===slideIndex||slideIndex===_this.model.getTotalSlides()-1?_this.renderOnly():(_this.model.previous("slideIndex")>slideIndex?(threeSlidesBefore=slideIndex-_this.model.get("prerenderCount"),_this.slidesView.renderAt(threeSlidesBefore,!1)):(threeSlidesAfter=slideIndex+_this.model.get("prerenderCount")-1,_this.slidesView.renderAt(threeSlidesAfter,!0)),_this.slidesView.cleanAround(slideIndex)),Time.Tracking.article_view(Time.application.model.get("activeArticle").toJSON()),_this.setSlideClasses(),_this.resetCaption(),_this.setMeta()}}(this)),this},GalleryLightbox.prototype.render=function($parent){return null==$parent&&($parent=null),console.info("GalleryLightboxView render into ",$parent),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.$counterCurrent=this.$(".current-slide"),this.$counter=this.$(".galleryLightbox__counter"),this.$credit=this.$(".galleryLightbox__credit"),this.$caption=this.$(".galleryLightbox__caption"),this.$captionWrapper=this.$(".galleryLightbox__caption__wrapper"),this.$restart=this.$(".galleryLightbox__restart"),this.$shareDiv=this.$(".gallery__shareLinks"),this.$shareEmail=this.$(".time-icons-mail"),this.$shareTwitter=this.$(".time-icons-tw"),this.$shareGooglePlus=this.$(".time-icons-gplus"),this.$shareLinkedIn=this.$(".time-icons-linkedin"),this.$shareFacebook=this.$(".time-icons-fb"),this.$prevButton=this.$('.time-icons[data-gallery-action="prev"]'),this.$nextButton=this.$('.time-icons[data-gallery-action="next"]'),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryLightbox__slides"),this.slidesView=new Time.views.GalleryLightboxSlides({el:this.$slides,gallery:this,collection:this.slidesCollection}),this.setTotal(),this},GalleryLightbox.prototype.renderOnly=function(){return this.slidesCollection.trigger("gallery:slides:flush"),this.$slides.html(this.slidesView.render().el),this.slidesView.renderAround(this.model.get("slideIndex"),this.model.get("prerenderCount")),this},GalleryLightbox.prototype.setMeta=function(){var adSlides,slideType,_ref;return adSlides=0,this.setCredit(),slideType=null!=(_ref=this.model.currentSlide())?_ref.get("slideType"):void 0,this.$counter.css("ad"===slideType?{visibility:"hidden"}:{visibility:"visible"}),this.model.getSlideIndex()+1>=6&&(adSlides=Math.floor((this.model.getSlideIndex()+1)/6),this.model.getTotalSlides()===this.model.getSlideIndex()+1&&this.model.getTotalSlides()%6===0&&(adSlides-=1)),this.$counterCurrent.text(this.model.getSlideIndex()+1-adSlides),this.$el.attr("data-slideType",slideType),this.setCaption(),"default"===slideType&&this.setShare(this.model.currentSlide()),this.setControlClasses(),this},GalleryLightbox.prototype.setTotal=function(){var adSlideCount;return adSlideCount=0,this.$counterTotal=this.$(".total-slides"),adSlideCount=this.model.getTotalSlides()%6>0?Math.floor(this.model.getTotalSlides()/6):Math.floor(this.model.getTotalSlides()/6)-1,this.$counterTotal.text(this.model.getTotalSlides()-adSlideCount),this},GalleryLightbox.prototype.setCredit=function(text){var _ref;return null==text&&(text=""),text=null!=(_ref=this.model.currentSlide())?_ref.get("credit"):void 0,text||(text="&nbsp;"),this.$credit.html(text),this},GalleryLightbox.prototype.setCaption=function(text){var _ref;return null==text&&(text="&nbsp;"),this.$captionWrapper.trigger("destroy.dot"),text=null!=(_ref=this.model.currentSlide())?_ref.get("caption"):void 0,text?this.$captionWrapper.html(text+this.captionMoreTemplate).dotdotdot({ellipsis:"...",after:"button",watch:!0,callback:function(_this){return function(isTruncated,originalContent){return _this.truncateCaptionCallback(isTruncated,originalContent)}}(this)}):(text="&nbsp;",this.$captionWrapper.html(text)),this},GalleryLightbox.prototype.truncateCaptionCallback=function(isTruncated){return this.model.set("isCaptionTruncated",isTruncated),this.$captionWrapper.toggleClass("truncated",isTruncated)},GalleryLightbox.prototype.setShare=function(slideModel){return this.$(".time-icons-mail").attr("href",slideModel.getShareMail()),this.$(".time-icons-tw").data("href",slideModel.getShareTwitter()),this.$(".time-icons-gplus").attr("href",slideModel.getShareGplus()),this.$(".time-icons-linkedin").attr("href",slideModel.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",slideModel.getShareFacebook()),this},GalleryLightbox.prototype.setControlClasses=function(currentIndex){var disableNextButton,_ref;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),this.$prevButton.toggleClass("disabled",0===currentIndex),disableNextButton=this.model.isAtEnd(),this.model.get("isMovePastToNextGalleryEnabled")&&(disableNextButton=disableNextButton&&"endless"!==(null!=(_ref=this.model.currentSlide())?_ref.get("slideType"):void 0)),this.$nextButton.toggleClass("disabled",disableNextButton),this},GalleryLightbox.prototype.setSlideClasses=function(currentIndex,currentSlide){var passedEls,passedModels,upcomingEls,upcomingModels;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),null==currentSlide&&(currentSlide=this.model.currentSlide()),null!=currentSlide&&currentSlide.view.$el.addClass("current").removeClass("passed upcoming"),passedModels=this.slidesCollection.first(currentIndex),passedEls=_.map(passedModels,function(slideModel){return slideModel.view.el}),$(passedEls).addClass("passed").removeClass("current upcoming"),upcomingModels=this.slidesCollection.rest(currentIndex+1),upcomingEls=_.map(upcomingModels,function(slideModel){return slideModel.view.el}),$(upcomingEls).addClass("upcoming").removeClass("passed current"),this},GalleryLightbox.prototype.resetCaption=function(){return this.model.set("isCaptionTruncated",!1),this.model.set("isCaptionExpanded",!1)},GalleryLightbox.prototype.toggleCaption=function(e){return null!=e&&e.stopPropagation(),this.model.get("isCaptionTruncated")?(Time.application.toggle_share_tooltip("close"),this.model.set("isCaptionExpanded",!this.model.get("isCaptionExpanded")),this):this},GalleryLightbox.prototype.toggleFullscreen=function(toggleOn){return null==toggleOn&&(toggleOn=!this.model.get("isFullscreen")),this.model.set("isFullscreen",toggleOn),this},GalleryLightbox.prototype.bindResizeEvents=function(){return this.listenTo(Time,"application:resize",function(_this){return function(){return _this.setCaption()}}(this))},GalleryLightbox.prototype.bindTouchEvents=function(){var _base;if(Modernizr.touch)return"function"==typeof(_base=this.$slides).touchwipe&&_base.touchwipe({preventDefaultEvents:!1,min_move_x:6,min_move_y:6,wipeLeft:function(_this){return function(){return _this.model.goNextSlide()}}(this),wipeRight:function(_this){return function(){return _this.model.goPrevSlide()}}(this)}),this},GalleryLightbox.prototype.doKeyboardEvent=function(e){return 27===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.toggleFullscreen(!1)),37===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goPrevSlide(e)),39===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goNextSlide(e)),69===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goLastSlide(e)),82===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goFirstSlide(e)),e},GalleryLightbox.prototype.clickedSlide=function(e){var slideMidpoint;return this.IS_SIDE_CLICKING_ENABLED?(slideMidpoint=e.currentTarget.clientWidth/2,e.offsetX<slideMidpoint?this.model.goPrevSlide():this.model.goNextSlide()):this.model.goNextSlide(),e},GalleryLightbox.prototype.goNextSlide=function(e){return e.stopPropagation(),this.model.goNextSlide()},GalleryLightbox.prototype.goPrevSlide=function(e){return e.stopPropagation(),this.model.goPrevSlide()},GalleryLightbox.prototype.goFirstSlide=function(){return this.model.goSlide(0)},GalleryLightbox.prototype.goLastSlide=function(){return this.model.goSlide(this.model.getTotalSlides()-1)},GalleryLightbox.prototype.closeCaption=function(){return this.model.get("isCaptionTruncated")?this.model.set("isCaptionExpanded",!1):this},GalleryLightbox}(Time.views.Gallery);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryParent=function(_super){function GalleryParent(){return GalleryParent.__super__.constructor.apply(this,arguments)}return __extends(GalleryParent,_super),GalleryParent.prototype.initialize=function(options){return null==options&&(options={}),console.info("galleryParentView init"),this.$el.length?(this.galleryId=this.$el.data("gallery"),this.galleryId?null==options.article?(console.error("GalleryParentView needs to be attached to an ReadingPaneArticle view",options),this.remove(),null):(this.articleView=options.article,null==options.galleries?(console.error("GalleryParentView needs to be attached to a Galleries collection",options),this.remove(),null):(this.galleriesCollection=options.galleries,this.galleryView=null,this.galleryModel=this.getGalleryModel(this.galleryId),this.listenTo(this,"view:destroy",function(){var _ref,_ref1;console.info("GalleryParentView in article "+articleModel.id+" heard view:destroy"),this.galleriesCollection=null,null!=(_ref=this.galleryView)&&_ref.destroy(),this.galleryView=null,null!=(_ref1=this.galleryModel)&&(_ref1.view=null),this.galleryModel=null,this.articleView=null}),null!=this.galleryModel&&this.render(),this)):(console.error("GalleryParentView couldn't get galleryId from el",this.$el),this.remove(),null)):(console.error("GalleryParentView needs to be instantiated with an el",options),this.remove(),null)},GalleryParent.prototype.render=function(){return console.info("galleryParentView render"),this.listenToOnce(this.galleryModel,"gallery:dataReady",function(_this){return function(){return console.info("GalleryParentView - render - heard gallery:dataReady on galleryModel "+_this.galleryModel.id),_this.galleryView=_this.galleryModel.getView(_this.articleView),null!=_this.articleView.model.collection&&_this.listenTo(Time,"readingPane:reset",function(){var _ref;console.info("GalleryParentView heard readingPane:reset on Time -- destroying GalleryView"),null!=(_ref=_this.galleryView)&&_ref.destroy(),_this.galleryView=null,_this.galleryModel.view=null,_this.$el.empty(),_this.stopListening(Time)}),_this.listenToOnce(_this.galleryView,"gallery:rendered",function(){console.info("GalleryParentView - render - heard gallery:rendered on galleryView "+_this.galleryModel.id),_this.articleView.trigger("gallery:rendered")}),_this.galleryView.render(_this.$el)}}(this)),this.galleryModel.getData(),this},GalleryParent.prototype.getGalleryModel=function(galleryId){var galleryModel,size;return(galleryId=parseInt(galleryId,10))?(galleryModel=this.galleriesCollection.get(galleryId),console.info("GalleryParentView looking for existing model in galleriesCollection",galleryId,"found:",null!=galleryModel),null!=galleryModel?galleryModel:(size=this.$el.data("size"))?(this.galleryModel=this.galleriesCollection.push({id:galleryId,size:size}),this.galleryModel):(console.error("GalleryParentView -- could not create a new gallery model",galleryId,size),null)):(console.error("GalleryParentView -- getGalleryModel -- invalid galleryId",galleryId),null)},GalleryParent}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideAd=function(_super){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideAd,_super),GallerySlideAd.prototype.initialize=function(options){return this.template=options.template,this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){value?_this.activate():_this.deactivate()}}(this)),this},GallerySlideAd.prototype.render=function(){return this.setElement(this.template.render()),this.$(".gallery__ad").attr("id",this.model.get("adModelId")),this},GallerySlideAd.prototype.activate=function(){var adSizes,articleModel,articleView,callback,galleriesCollection,galleryModel,gallerySize,params,slideModel,slidesCollection;return console.info("GallerySlideAdView activating",this),slideModel=this.model,slidesCollection=(null!=slideModel?slideModel.collection:void 0)||null,galleryModel=(null!=slidesCollection?slidesCollection.galleryModel:void 0)||null,galleriesCollection=(null!=galleryModel?galleryModel.collection:void 0)||null,articleView=(null!=galleriesCollection?galleriesCollection.article:void 0)||null,(articleModel=(null!=articleView?articleView.model:void 0)||null)?(gallerySize=galleryModel.get("size"),adSizes=["300x250"],"vertical"===gallerySize&&"mobile"!==Time.device&&adSizes.push("450x375"),params={id:this.model.get("adModelId"),size:adSizes,position:this.model.get("adIndex"),group:"gallery",subgroup:gallerySize,slide:slideModel.get("index")+1},callback="vertical"!==gallerySize,"vertical"!==gallerySize&&(callback=function(){var adDivIds;adDivIds=[params.id],Time.trigger("dfpAdManager:syncWithLeftRail",articleModel,adDivIds)}),Time.trigger("dfpAdManager:activateAd",articleModel,params,callback),this):(console.error("GallerySlideAd.activate - no articleModel",this.model),this)},GallerySlideAd.prototype.deactivate=function(){return console.info("GallerySlideAdView deactivating",this),Time.trigger("dfpAdManager:deactivateAd",this.model.get("adModelId")),this},GallerySlideAd.prototype.onActivated=function(){return console.info("GallerySlideAdView activated",this),this},GallerySlideAd}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlide=function(_super){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return __extends(GallerySlide,_super),GallerySlide.prototype.initialize=function(options){var _ref,_ref1,_ref2;return null==options&&(options={}),this.galleryModel=null!=(_ref=this.model)&&null!=(_ref1=_ref.collection)?_ref1.galleryModel:void 0,this.articleView=this.galleryModel.collection.article,this.articleModel=this.articleView.model,"vertical"===(null!=(_ref2=this.galleryModel)?_ref2.get("size"):void 0)?this.initVertical():this.initLightbox(),this},GallerySlide.prototype.initVertical=function(){return this.template=Time.templates["gallery-slide-vertical"],this},GallerySlide.prototype.initLightbox=function(){return this.template=Time.templates["gallery-slide-lightbox"],this.listenTo(this.model,"change:isActive",function(model,value){value&&this.activate()}),this},GallerySlide.prototype.activate=function(){return Time.trigger("gallery:slide:activated",this.galleryModel,this.articleView),this},GallerySlide.prototype.render=function(){return this.setElement(this.template.render(this.model.toJSON(),Time.partials)),this},GallerySlide.prototype.setShare=function(){return this.$(".time-icons-mail").attr("href",this.model.getShareMail()),this.$(".time-icons-tw").data("href",this.model.getShareTwitter()),this.$(".time-icons-gplus").attr("href",this.model.getShareGplus()),this.$(".time-icons-linkedin").attr("href",this.model.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",this.model.getShareFacebook()),this},GallerySlide}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryVerticalSlides=function(_super){function GalleryVerticalSlides(){return GalleryVerticalSlides.__super__.constructor.apply(this,arguments)}return __extends(GalleryVerticalSlides,_super),GalleryVerticalSlides.prototype.events={"click .galleryVertical__loadMore":"loadMore"},GalleryVerticalSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryVerticalSlides.__super__.initialize.apply(this,arguments),this.initialRenderLimit=options.initialRenderLimit||6,this
},GalleryVerticalSlides.prototype.render=function(){var initialModelsToRender;return initialModelsToRender=this.collection.first(this.initialRenderLimit),this.reallyRender(initialModelsToRender),this.collection.size()>this.initialRenderLimit&&(this.$el.append('<div class="galleryVertical__loadMore">Load More Photos</div>'),this.$loadMore=this.$(".galleryVertical__loadMore")),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryVerticalSlides.prototype.reallyRender=function(models){var html,_ref;return null==models&&(models=this.collection.models),html=_.map(models,function(slideModel){return slideModel.view.render().el}),(null!=(_ref=this.$el)?_ref.children().length:void 0)?this.$el.append(html):this.$el.html(html),_.invoke(models,"set",{isRendered:!0}),this},GalleryVerticalSlides.prototype.loadMore=function(){var remainingModelsToRender,_ref;return null!=(_ref=this.$loadMore)&&_ref.addClass("activated"),remainingModelsToRender=this.collection.rest(this.initialRenderLimit),this.reallyRender(remainingModelsToRender),this.galleryView.trigger("gallery:slides:loadedMore"),this},GalleryVerticalSlides}(Time.views.GallerySlidesView);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryVertical=function(_super){function GalleryVertical(){return GalleryVertical.__super__.constructor.apply(this,arguments)}return __extends(GalleryVertical,_super),GalleryVertical.prototype.template=Time.templates["gallery-module-vertical"],GalleryVertical.prototype.initialize=function(options){return null==options&&(options={}),GalleryVertical.__super__.initialize.apply(this,arguments),this.articleView=this.model.collection.article,this.articleModel=this.articleView.model,this.listenTo(this,"gallery:slides:rendered",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:rendered, activating slides"),_this.activateSlides(),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),_this.articleView.trigger("gallery:slides:rendered",_this)}}(this)),this.listenTo(this,"gallery:slides:loadedMore",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:loadedMore, activating slides"),_this.activateSlides(),Time.trigger("gallery:slides:loadedMore",_this,_this.articleView)}}(this)),this.listenTo(this.articleModel,"change:isActive",function(_this){return function(model,value){value===!1&&_this.deactivateSlides()}}(this)),this.slidesView=new Time.views.GalleryVerticalSlides({gallery:this,collection:this.slidesCollection}),this},GalleryVertical.prototype.render=function($parent){return null==$parent&&($parent=null),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryVertical__slides"),this.slidesView.setElement(this.$slides),this.slidesView.render(),this},GalleryVertical.prototype.activateSlides=function(){var renderedModels;return renderedModels=this.slidesCollection.where({isRendered:!0}),_.invoke(renderedModels,"set",{isActive:!0})},GalleryVertical.prototype.deactivateSlides=function(){return this.slidesCollection.invoke("set",{isActive:!1})},GalleryVertical}(Time.views.Gallery),Time.views.Homepage=Backbone.View.extend({el:".home",events:{"click a[data-video]":"render_homepage_video","click a[data-gallery]":"render_homepage_gallery","click .rail-article-title a":"mobile_click_event","click .read-more-divider-hero img":"trigger_promo_click"},homepage_galleries:[],initialize:function(){return Time.application.model.set("isRailOpen",$(".left-rail").offset().left>=0),Time.application.is_homepage=!0,this.rail_view=new Time.views.Rail,this.render_ads(),Time.application.set_left_rail_bounds(),this.render_slideshow(),Time.Ad.set_initial_app_load(!1),Time.application.router.is_initial_route=!1,Time.application.load_tabs(Time.tab_data["default"]),Time.application.tabs_view.set_active(0),Time.application.active_route="home",Time.application.hasPushstate||$("body").removeClass("hidden"),this.listenToOnce(Time.application,"application:ready",function(){$("body").removeClass("home"),Time.application.is_homepage=!1,$(".site-footer").remove()}),this.render_market_data(),Time.application.placeholderPolyfill(".quote-search",".quote-search-input"),Time.homepage_refresh=setInterval(function(){return Time.application.is_homepage?window.location=Time.home_url:void 0},48e4),$(window).on("blur focus",function(e){return"blur"===e.type?clearInterval(Time.homepage_refresh):Time.homepage_refresh=setInterval(function(){return Time.application.is_homepage?window.location=Time.home_url:void 0},48e4)}),Time.application.loadChartbeat()},img_html_to_gallery_slide:function($ref){var $img,$wrapped_img;return null==$ref&&($ref=this.$(".home-brief-hero")),$img=$ref.find("img").clone(),$wrapped_img=$(document.createElement("div").className="gallery__viewport").append($img),$(document.createElement("div").className="gallery__slide").append($wrapped_img)},render_homepage_video:function(e){var $figure,$videoFigure,$videoHtml;return $videoFigure=$(e.target).closest("[data-video]"),$videoHtml=$videoFigure.data("video"),$figure=$videoFigure.addClass("home-video-wrapper").html($videoHtml),$figure.siblings(".image-caption").css("visibility","hidden"),$figure.find(".BrightcoveExperience").length&&brightcove.createExperiences(),!1},render_homepage_gallery:function(e){var $galleryViewParent,galleryModel,gallery_id;return e.stopImmediatePropagation(),e.preventDefault(),$galleryViewParent=$(e.target).closest("[data-gallery]"),gallery_id=$galleryViewParent.attr("data-gallery"),this.galleriesCollection=new Time.collections.Galleries,galleryModel=this.galleriesCollection.push(new Time.models.Gallery({id:parseInt(gallery_id,10),$el:$galleryViewParent,template_string_ref:"gallery-module-home"})),this.listenToOnce(galleryModel,"sync:success",function(){var view;return view=galleryModel.createView().view,$galleryViewParent.html(view.render().el)}),galleryModel.fetch(),!1},render_market_data:function(){var marketDataView;return marketDataView=new Time.views.MarketDataView,Time.marketdata_refresh=setInterval(function(){return Time.application.is_homepage?marketDataView=new Time.views.MarketDataView:void 0},5e3)},render_ads:function(){var $current,ad_index,ad_placeholder_id,ads,data,homepage_rail_articles,i,index,num_article,sponsor_model;for(homepage_rail_articles=this.rail_view.$scroll_container.find(".rail-article"),num_article=homepage_rail_articles.length,ad_index=1,data={},i=0,ads=[];num_article>i;)index=i+1,index%3===0&&($current=$(homepage_rail_articles[i]),index%10===3&&Time.application.sponsor_length&&(sponsor_model=Time.application.sponsor_arr[Time.application.sponsor_index],sponsor_model.sponsor&&"vsp"===sponsor_model.sponsor.slug&&(sponsor_model.sponsor_timestamp=(new Date).getTime()),$(Time.templates["article-tile-sponsored"].render(sponsor_model)).insertAfter($current),Time.application.sponsor_index++,Time.application.sponsor_index=Time.application.sponsor_index+1>Time.application.sponsor_length?0:Time.application.sponsor_index)),3===index&&(ad_placeholder_id="ad-unit-"+ad_index,$("<div/>",{"class":"ad-unit",id:ad_placeholder_id}).insertBefore($current),data=function(this_ad_placeholder_id,this_rail){return{active_rail:this_rail,pos:ad_index}}(ad_placeholder_id,this.rail_view),Time.Ad.render_homepage_left_rail_ad(ad_placeholder_id,data),ads.push(ad_placeholder_id),ad_index+=1),i+=1;Time.Ad.activate_homepage_ads()},render_slideshow:function(){var i,key,opts,slideshow_div_id,slideshow_obj,slideshows_data;if(slideshows_data=Time.bootstrap.homepage?Time.bootstrap.homepage.slideshows:!1,this.slideshows=[],opts={},i=0,slideshows_data)for(key in slideshows_data)slideshow_obj=slideshows_data[key],slideshow_div_id="slideshow-"+key,opts={cycle:"1"===slideshow_obj.loop?!0:!1,isAutoPlay:"1"===slideshow_obj.autoplay?!0:!1,experience:Time.device},this.slideshows[i]=new Time.Slideshow(slideshow_obj.slides,slideshow_div_id,opts),this.slideshows[i].init(),i+=1},mobile_click_event:function(){"mobile"===Time.device&&(Time.application.$notHeader.removeClass("show-articles-beneath-medium"),Time.application.model.set("isRailOpen",!1))},trigger_promo_click:function(e){return $(e.target).closest(".read-more-divider-hero").find(".related-article").trigger("click")}}),Time.views.ArticleMagazineTile=Time.views.ArticleTile.extend({template:Time.templates["article-tile-magazine"],initialize:function(){return this.$container=this.model.collection.view.$el,this.$scroll_container=this.model.collection.view.$scroll_container,this.listenTo(this.model,"change:isActive",function(_this){return function(){var isActive;if("undefined"!=typeof console&&null!==console&&console.info("magazine_tile heard article:activated on model ",_this.model.id),isActive=_this.model.get("isActive"),_this.$el.toggleClass("active",isActive),isActive){if(_this.model.collection.view.scroll_freeze||_this.make_visible(),null!=_this.model.get("cover"))return _this.expand_issue(!0);if(!_this.$el.hasClass("expanded"))return _this.expand_issue()}}}(this)),this.listenTo(this.model,"article:tile-rendered",function(_this){return function(){var collection;Time.Ad.get_initial_left_rail_load()&&(collection=_this.model.collection,collection.real_article_index%collection.adFrequency===collection.adOffset&&_this.insert_ad_after()),_this.$el.on("click",".magazine_arrow",function(e){return _this.toggle_issue(e)})}}(this)),this.render()},set_template:function(){return this.template=null!=this.model.get("magazine")?Time.templates["article-tile-magazine-cover"]:Time.templates["article-tile-magazine"],this.template},magazine_items:!1,get_items:function(){return this.magazine_items||this.set_items(),this.magazine_items},set_items:function(){var mi,notCoverSelector;return notCoverSelector='[data-issue="'+this.model.get("magazine_id")+'"]:not(:first)',mi=$(notCoverSelector),this.magazine_items=mi,mi},toggle_issue:function(e){var article;return article=$(e.target).parents("article"),article.toggleClass("expanded"),"undefined"!=typeof console&&null!==console&&console.log(this.$el.index()),0===this.$el.index()&&(article.hasClass("expanded")?setTimeout(function(){return Time.Ad.update_left_rail_all_el_pos()},100):Time.Ad.hide_left_rail_ads()),this.get_items().toggleClass("collapsed expanded"),Time.application.active_rail.view.fill_viewport()},expand_issue:function(cover_tile){var firstTileSelector,mag_id;return cover_tile?("undefined"!=typeof console&&null!==console&&console.log("cover tile - expand it"),this.$el.addClass("expanded")):(mag_id=this.model.get("magazine_id"),firstTileSelector='article[data-issue="'+mag_id+'"]:first',"undefined"!=typeof console&&null!==console&&console.log(Time.application.$left_rail.find(firstTileSelector).find(".magazine_arrow").click())),this.get_items().addClass("expanded").removeClass("collapsed")},create_advert:function(){var $el,index;return this.model.collection.ad_in_left_rail+=1,index=this.model.collection.ad_in_left_rail,$el=$("<div/>",{"class":"ad-unit collapsed",id:"ad-unit-"+index,pos:index}).attr("data-issue",this.model.get("magazine_id"))}}),Time.views.NativoArticleTile=Time.views.ArticleTile.extend({template:Time.templates["article-tile-sponsored"],initialize:function(){return this.$container=this.model.collection.view.$el,this.$scroll_container=this.model.collection.view.$scroll_container,this.placement=this.model.get("placement"),this.listenTo(this.model,"activate",function(_this){return function(){return _this.$el.addClass("active"),_this.model.collection&&_this.model.collection.view.jump_to_active_tiles?_this.make_visible():void 0}}(this)),this.listenTo(this.model,"article:tile-rendered",function(_this){return function(){var collection,collectionLength;return Time.Ad.get_initial_left_rail_load()&&(collection=_this.model.collection,collectionLength=collection.size(),collection.real_article_index%collection.adFrequency===collection.adOffset&&_this.insert_ad_after()),5>collectionLength&&_this.model.collection.real_article_index===collectionLength?_this.insert_ad_after():void 0}}(this)),this.listenTo(this.model,"deactivate",function(_this){return function(){return _this.$el.removeClass("active")}}(this)),this.render()},render:function(){var $previous_tile,previous_model,previous_model_index,previous_tile_id,rail;return rail=this.model.collection,this.$el=$(this.template.render(this.model.attributes)),this.model.get("is_nativo_page")?(this.$el.appendTo(this.$container),this.model.trigger("article:tile-rendered")):($previous_tile=this.$container.find(".rail-article").eq(this.placement),previous_tile_id=$previous_tile.data("article"),$previous_tile.after(this.$el),previous_model=rail.get(previous_tile_id),previous_model_index=rail.indexOf(previous_model),rail.move_model(this.model,previous_model_index+1)),this.model.is_active&&this.model.set_active(),this.$el}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ReadingPaneArticle=function(_super){function ReadingPaneArticle(){return ReadingPaneArticle.__super__.constructor.apply(this,arguments)}return __extends(ReadingPaneArticle,_super),ReadingPaneArticle.prototype.template=Time.templates["article-single"],ReadingPaneArticle.prototype.el="<article></article>",ReadingPaneArticle.prototype.initialize=function(options){return null==options&&(options={}),this.visible=!1,this.model.set("check_scroll",!0),this.galleriesCollection=new Time.collections.Galleries([],{article:this}),this.collectPrimaryGallery(),this.collectGalleries(),this.collectListGalleries(),this.listenTo(this.model,"change:isActive",function(_this){return function(){"undefined"!=typeof console&&null!==console&&console.info("ReadingPaneArticleView heard change:isActive on model, isActive:",_this.model.get("isActive")),_this.model.get("isActive")?_this.activateView():_this.deactivateView()}}(this)),this},ReadingPaneArticle.prototype.collectPrimaryGallery=function(){var galleryData,galleryModel;return galleryData=this.model.get("gallery"),null!=galleryData?(this.galleriesCollection.add(galleryData),galleryModel=this.galleriesCollection.get(galleryData.id),galleryModel.set("isPrimary",!0),this):void 0},ReadingPaneArticle.prototype.collectGalleries=function(){var galleriesData;return galleriesData=this.model.get("galleries"),null!=galleriesData?(this.galleriesCollection.add(galleriesData),this):void 0},ReadingPaneArticle.prototype.collectListGalleries=function(){var li;return li=this.model.get("list_items"),null!=li?(_.each(li,function(_this){return function(item){var _ref;return(null!=(_ref=item.galleries)?_ref.length:void 0)?_.each(item.galleries,function(listItemGalleryModel){return _this.galleriesCollection.add(listItemGalleryModel)}):void 0}}(this)),this):void 0},ReadingPaneArticle.prototype.getTemplate=function(){return null!=this.model.get("cover")?this.template=Time.templates["article-single-cover"]:"list"===this.model.get("format")?this.template=Time.templates["article-single-list"]:"gallery"===this.model.get("format")?this.template=Time.templates["article-single-gallery"]:"video"===this.model.get("format")?this.template=Time.templates["article-single-video"]:"video"===this.model.get("format")?this.template=Time.templates["article-single-interactive"]:null!=this.model.get("sponsor")?this.template=Time.templates["article-single-sponsored"]:"collection_intro"===this.model.get("format")?this.template=Time.templates["collection-intro"]:"section-front"===this.model.get("format")&&(this.template=Time.templates["section-front"]),this.template},ReadingPaneArticle.prototype.render=function(opts){var html,viewport_article;return null==opts&&(opts={}),console.info("ReadingPaneArticleView -- render "+this.model.id+" --------------------"),viewport_article=Time.application.$viewportWrapper.find("#article-"+this.model.id),this.$el.html().length||(viewport_article.length&&""!==viewport_article.html()?(this.setElement(viewport_article),Time.application.arr_article_views.push(this.model.views.singleView)):(this.getTemplate(),html=this.template.render(this.model.toJSON(),Time.partials),this.setElement($(html)),this.model.get("last_article")&&!this.model.attributes.content&&this.$el.height(Time.application.$notHeader.height()))),null!=opts.method?"append"===opts.method?(Time.application.$viewportWrapper.append(this.$el),Time.application.arr_article_views.push(this.model.views.singleView)):"prepend"===opts.method&&(Time.application.$viewportWrapper.prepend(this.$el),Time.application.arr_article_views.push(this.model.views.singleView),Time.application.$viewport.scrollTop(this.$el.outerHeight())):(Time.application.$viewportWrapper.html(this.$el),Time.application.$viewport.scrollTop(1),Time.application.arr_article_views.push(this.model.views.singleView),Time.trigger("readingPane:reset",this.model)),"section-front"!==this.model.get("format")&&this.renderDivider(),"list"===this.model.get("format")&&this.renderLists(),this.model.trigger("article:rendered"),this},ReadingPaneArticle.prototype.renderHeroImage=function(){var recursive_count,this_img;return this_img=this.$el.find(".portrait img, .landscape img, .bleed img, .wide img"),recursive_count=0,this},ReadingPaneArticle.prototype.renderLists=function(){var $articleItem,ad_list_index,id,numArticleItem,_this;return this.model.list_ads=[],_this=this,ad_list_index=1,$articleItem=this.$el.find(".article-item"),numArticleItem=$articleItem.length,id=this.model.get("id"),$articleItem.each(function(i){var ad_placeholder_id,index;index=parseInt(i,10)+1,index%4===0&&numArticleItem>index&&(ad_placeholder_id="list_ad_"+id+"_"+ad_list_index,$('<li class="list_ad"><div class="list_ad_div" id="'+ad_placeholder_id+'" pos="'+ad_list_index+'"></div></li>').insertAfter($(this)),_this.model.list_ads.push(ad_placeholder_id),ad_list_index+=1)}),this},ReadingPaneArticle.prototype.renderBrightcoveVideos=function(){var renderDelay;return 0===this.$(".primary-video-wrapper").length&&Time.trigger("article:found:noPrimaryBrightcove"),renderDelay=$("body").hasClass("desktop")?0:3e3,this.brightcoveRenderTimeout=setTimeout(function(){try{return"undefined"!=typeof brightcove&&null!==brightcove?brightcove.createExperiences():void 0}catch(_error){}},renderDelay),this},ReadingPaneArticle.prototype.renderGalleries=function(){return this.$galleries=this.$("div[data-gallery]"),console.info("ReadingPaneArticleView -- renderGalleries "+this.$galleries.length),this.model.get("galleriesRendered")===this.$galleries.length?(console.info("ReadingPaneArticle - "+this.$galleries.length+" galleries already rendered"),this):(this.$galleries.each(function(_this){return function(i,el){var galleryParentView;return galleryParentView=new Time.views.GalleryParent({el:el,article:_this,galleries:_this.galleriesCollection})}}(this)),this)},ReadingPaneArticle.prototype.renderLiveFyre=function(){return yepnope([{test:window.LF,nope:"http://zor.livefyre.com/wjs/v1.0/javascripts/CommentCount.js",complete:function(){return window.LF?LF.CommentCount({replacer:function(element,count){return $(element).removeClass("livefyre-commentcount"),element.innerHTML=count}}):void 0}}]),this},ReadingPaneArticle.prototype.renderDivider=function(){return console.info("-- ReadingPaneArticleView -- renderDivider"),null!=this.divider&&(this.divider.destroy(),this.divider=null,delete this.divider),this.divider=new Time.views.Divider({article:this}),this.$el.append(this.divider.render().el),this},ReadingPaneArticle.prototype.deactivateView=function(){return this.stopListening(this.model,"change:componentsToRender"),this.$el.removeClass("active"),null!=this.brightcoveRenderTimeout&&clearTimeout(this.brightcoveRenderTimeout),this.brightcoveRenderTimeout=null,this.stopListening(this,"gallery:slides:rendered"),this.galleriesCollection.trigger("galleries:flush"),this.model.set("galleriesRendered",0),Time.trigger("article:deactivated",this),this},ReadingPaneArticle.prototype.activateView=function(){var $w,componentsToRender,_ref;return console.info("ReadingPaneArticleView -- activateView -- article "+this.model.id+"--------------------"),Time.application.trigger("load_section_menu"),Time.Tracking.article_view(this.model.toJSON()),this.$el.removeClass("offScreen"),this.$el.addClass("active"),$w=$(window),this.model.get("scripts")?Modernizr.load({load:this.model.get("scripts"),complete:function(_this){return function(){var i,l,scripts;return scripts=_this.model.get("scripts"),l=scripts.length,i=0,$w.trigger("post-load",{el:_this.$el})}}(this)}):$w.trigger("post-load",{el:this.$el}),this.loadChartbeat(),this.$el.find(".twitter-tweet").length&&"undefined"!=typeof twttr&&null!==twttr&&null!=(_ref=twttr.widgets)&&_ref.load(),this.renderHeroImage(),this.renderLiveFyre(),this.renderBrightcoveVideos(),this.model.set("componentsToRender",1),this.listenTo(this.model,"change:componentsToRender",function(){console.info("-- components left to render: ",this.model.get("componentsToRender")),0===this.model.get("componentsToRender")&&(this.stopListening(this.model,"change:componentsToRender"),Time.trigger("article:activated",this))}),this.renderComponent("galleriesRendered",this.galleriesCollection.size(),"gallery:slides:rendered")&&this.renderGalleries(),componentsToRender=this.model.get("componentsToRender"),this.model.set("componentsToRender",--componentsToRender),this},ReadingPaneArticle.prototype.renderComponent=function(counter,total,listener){return total?(this.model.set("componentsToRender",this.model.get("componentsToRender")+1),this.listenTo(this,listener,function(_this){return function(){var componentsToRender,newCount;newCount=_this.model.get(counter)+1,_this.model.set(counter,newCount),"undefined"!=typeof console&&null!==console&&console.info("-- ReadingPaneArticle - rendered ",newCount," out of ",total,listener," components"),newCount===total&&(_this.stopListening(_this,listener),componentsToRender=_this.model.get("componentsToRender"),_this.model.set("componentsToRender",--componentsToRender))}}(this)),!0):!1},ReadingPaneArticle.prototype.loadChartbeat=function(){var authors,i,sections,the_authors,the_authors_length,the_section,title,url,zone;if(the_section=this.model.get("section"),sections=the_section?the_section.slug:the_section,zone=sections,url=this.model.get("url"),title=this.model.get("title"),the_authors=this.model.get("authors"),the_authors_length=the_authors?the_authors.length:0){for(i=0,authors=[];the_authors_length>i;)authors.push(the_authors[i].name),i+=1;authors=authors.join()}return Time.application.loadChartbeat(url,title,sections,zone,authors),this},ReadingPaneArticle.prototype.unbind_events=function(){return $(window).off(".article-single-"+this.cid)},ReadingPaneArticle.prototype.jump_to_item=function(item_slug){var $item,item_offset_top;return $item=this.$("[data-item-slug='"+item_slug+"']"),$item.length?(item_offset_top=$item.offset().top,"complete"!==document.readyState?window.onload=function(){return Time.application.reset_scroll(item_offset_top)}:Time.application.reset_scroll(item_offset_top),$item):!1},ReadingPaneArticle}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ReadingPane=function(_super){function ReadingPane(){return ReadingPane.__super__.constructor.apply(this,arguments)}return __extends(ReadingPane,_super),ReadingPane.$debugLine=null,ReadingPane.prototype.initialize=function(){return this.activeLine=$(window).height()/4,this},ReadingPane.prototype.setActiveArticle=function(articleView){var $articleEl,articleBounds,articleEl,articleModel,isArticleAbove,isArticleBelow;return articleModel=articleView.model,$articleEl=articleView.$el,articleEl=articleView.el,$articleEl.length?(articleBounds=articleEl.getBoundingClientRect(),isArticleAbove=articleBounds.top<=this.activeLine,isArticleBelow=articleBounds.bottom>=this.activeLine,isArticleAbove&&isArticleBelow&&articleModel.set("isActive",!0),this):(articleModel.set("isActive",!1),this)},ReadingPane.prototype.debugShowActiveLine=function(){return null==this.$debugLine&&(this.$debugLine=$("<div>",{"class":"reading-pane-debug-line"}).appendTo("body")),this.$debugLine.css({position:"fixed",top:"400px",width:"100%",border:"1px red solid","z-index":"9999999"}),this.$debugLine},ReadingPane.prototype.getArticleIndex=function(articleView){var collection;return collection=Time.application.arr_article_views,_.chain(collection).pluck("cid").indexOf(articleView.cid).value()},ReadingPane.prototype.getArticleAbove=function(articleView){var articleIndex,collection;return collection=Time.application.arr_article_views,articleIndex=this.getArticleIndex(articleView),(articleIndex=0)?null:collection[articleIndex-1]},ReadingPane.prototype.getArticleBelow=function(articleView){var articleIndex,collection;return collection=Time.application.arr_article_views,articleIndex=this.getArticleIndex(articleView),(articleIndex=collection.length)?null:collection[articleIndex+1]},ReadingPane.prototype.isInViewport=function($el,isPartialAllowed){var bottom,el,elBottom,elRect,elTop,isFullyVisible,isTopCutOff,isTopVisible,top;return $el.length?(top=$("body").find(".top-banner").eq(0).height(),bottom=$(window).height(),(el=$el.get(0))?(elRect=el.getBoundingClientRect(),elTop=elRect.top-400,elBottom=elRect.bottom,isTopCutOff=top>elTop&&elBottom>top,isTopVisible=elTop>top&&bottom>=top,isFullyVisible=elTop>=top&&bottom>=elBottom,isFullyVisible?!0:isPartialAllowed?isTopCutOff||isTopVisible:!1):!1):!1},ReadingPane}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.SpecialPage=function(_super){function SpecialPage(){return SpecialPage.__super__.constructor.apply(this,arguments)}return __extends(SpecialPage,_super),SpecialPage.prototype.el=".page-template-pagespage-special-story-php",SpecialPage.prototype.events={"click .chapters ul a":"scroll_to_chapter"},SpecialPage.prototype.initialize=function(){var $bg_cover,$img,time_video;if(this.debugDontRenderGalleries=!1,this.model=new Time.models.SpecialPage,this.$win=$(window),this.$viewport=$(".article-viewport"),this.$before_viewport=$(".before-viewport"),this.$special_story=$(".special-story"),this.$nav=$(".article-navigation"),this.$sticky=$(".sticky"),this.$chapters=$(".chapters"),this.$open_chapters=$(".open-chapters"),this.$full_browser=$(".full-browser"),this.$time_video=$("#time_video"),this.header_height=$(".main-header").height(),this.banner_height=$(".top-banner").height(),this.sticky_height=$(".sticky").height(),this.galleriesCollection=new Time.collections.Galleries([],{article:this}),Time.trigger("leftRail:flush"),Time.application.model.set("isRailOpen",!1),Time.Ad.set_initial_left_rail_load(!1),Time.application.arr_article_views.length=0,Time.application.router.is_initial_route=!1,this.$nav.length>0&&this.$viewport.on("scroll",function(_this){return function(){_this.handle_scroll()}}(this)),this.$open_chapters.on("click",function(_this){return function(){_this.$chapters.toggleClass("active")}}(this)),$(".chapters ul a").on("click",function(_this){return function(){return _this.$chapters.removeClass("active")}}(this)),Modernizr.touch&&(this.$el.addClass("wipe-enabled"),this.$el.touchwipe({wipeUp:function(_this){return function(){return _this.hide_chapter_selector()}}(this),wipeDown:function(_this){return function(){return _this.show_chapter_selector()}}(this),min_move_x:6,min_move_y:6,preventDefaultEvents:!1}),this.$nav.appendTo(this.$before_viewport)),""!==window.location.hash&&this.$sticky.addClass("fixed"),this.renderGalleries(),this.$win.on("resize",function(_this){return function(){_this.resize_interactives()}}(this)),this.resize_interactives(),this.$full_browser.length>0)if(this.$win.on("resize",function(_this){return function(){_this.resize_video()}}(this)),this.resize_video(),time_video=document.getElementById("time_video"),$(".cue").on("click",function(_this){return function(){return _this.$viewport.scrollTo(_this.$viewport.height(),400)}}(this)),null!=time_video){if(!document.createElement("video").canPlayType)return;this.$time_video.on("play",function(){return $(".full-browser").animate({opacity:1},2e3)})}else $bg_cover=$(".bg-cover"),$img=$bg_cover.find("img"),$bg_cover.css({"background-image":"url("+$img.attr("src")+")"}),$img.remove(),$(".full-browser").animate({opacity:1},2e3);Time.trigger("special:ads:activate",this.$special_story.data("article")),Time.Ad.activate_special_article_ads(this.$special_story.data("article")),yepnope([{test:window.LF,nope:"http://zor.livefyre.com/wjs/v1.0/javascripts/CommentCount.js",complete:function(){return window.LF?LF.CommentCount({replacer:function(element,count){return $(element).removeClass("livefyre-commentcount"),element.innerHTML=count}}):void 0}}]),Time.application.loadChartbeat()},SpecialPage.prototype.resize_video=function(){return this.$full_browser.css({height:this.$viewport.height()})},SpecialPage.prototype.handle_scroll=function(){var fix,pos;return fix=this.$nav.offset().top,pos=this.banner_height,Time.application.admin_bar&&(pos+=Time.application.$admin_bar.height()),0>fix-pos?this.$sticky.addClass("fixed"):this.$sticky.removeClass("fixed")},SpecialPage.prototype.show_chapter_selector=function(){return this.$sticky.addClass("open"),this.$chapters.removeClass("active")},SpecialPage.prototype.hide_chapter_selector=function(){return this.$sticky.removeClass("open"),this.$chapters.removeClass("active")},SpecialPage.prototype.resize_interactives=function(){var iframes;return iframes=$(".wpcom-protected-iframe"),null!=iframes?_.each(iframes,function(_this){return function(iframe){var $iframe;return $iframe=$(iframe),$iframe.hasClass("time-relative-iframe")?$iframe.height(_this.$viewport.height()/2):void 0}}(this)):void 0},SpecialPage.prototype.scroll_to_chapter=function(e){var ofs;return e.preventDefault(),ofs=this.$sticky.hasClass("fixed")?0:-this.sticky_height,this.$viewport.scrollTo('a[name="'+$(e.target).attr("href").replace("#","")+'"]',400,{offset:ofs})},SpecialPage.prototype.renderGalleries=function(){return this.$galleries=this.$("div[data-gallery]"),console.info("SpecialPageView -- renderGalleries "+this.$galleries.length),this.model.get("galleriesRendered")===this.$galleries.length?(console.info("SpecialPageView - "+this.$galleries.length+" galleries already rendered"),this):(this.model.has("galleriesRendered")||this.model.set("galleriesRendered",0),this.$galleries.each(function(_this){return function(i,el){var galleryView;return galleryView=new Time.views.GalleryParent({el:el,article:_this,galleries:_this.galleriesCollection}),_this.listenTo(galleryView,"gallery:slides:rendered",function(){return _this.model.set("galleriesRendered",_this.model.get("galleriesRendered")+1),"undefined"!=typeof console&&null!==console?console.info("SpecialPageView - rendered ",_this.model.get("galleriesRendered")," out of ",_this.galleriesCollection.size()," galleries"):void 0})}}(this)),this)},SpecialPage}(Backbone.View),Time.views.Vertical=Backbone.View.extend({el:"body",initialize:function(opts){return this.vertical=opts.vertical,Time.application.model.set("isRailOpen",$(".left-rail").offset().left>=0),Time.application.is_homepage=!0,Time.application.is_money_homepage=!0,this.rail_view=new Time.views.Rail,this.render_ads(),Time.application.set_left_rail_bounds(),Time.Ad.set_initial_app_load(!1),Time.application.router.is_initial_route=!1,Time.application.load_tabs(Time.tab_data["default"]),Time.application.tabs_view.set_active(0),Time.application.active_route="home",Time.application.hasPushstate||$("body").removeClass("hidden"),Time.application.loadChartbeat(),this.render_market_data(),Time.application.placeholderPolyfill(".quote-search",".quote-search-input")
},render_ads:function(){return Time.Ad.activate_vertical_homepage_ads(this.vertical)},render_market_data:function(){var marketDataView;return marketDataView=new Time.views.MarketDataView,Time.marketdata_refresh=setInterval(function(){return Time.application.is_homepage?marketDataView=new Time.views.MarketDataView:void 0},5e3)}}),Time.views.Poll=Backbone.View.extend({template:Time.templates["poll-module"],events:{"click .user-poll-button-primary":"fetch_results","click .user-poll-button-secondary":"fetch_results"},initialize:function(){return this.render()},render:function(){var html;return html=this.template.render(this.model.toJSON()),this.setElement(html)},fetch_results:function(){return this.model.fetch_results(),!1},display_results:function(){return this.results||(this.results=new Time.models.PollResult({model:this.model.get("results")})),this.$el.append(this.results.view.$el).addClass("show-results")}}),Time.views.PollResult=Backbone.View.extend({template:Time.templates["poll-results"],events:{"click .return-to-poll":"show_options"},initialize:function(){return this.render(),this.animate_graphs()},render:function(){var html;return html=this.template.render(this.model.get("model")),this.setElement(html)},animate_graphs:function(){return setTimeout(function(_this){return function(){var graphs;return graphs=_this.$(".user-poll-graph-filled"),graphs.each(function(i,thisEl){return $(thisEl).css({width:_this.model.get("model").options[i].percentage+"%"})})}}(this),500)},show_options:function(){return this.$el.closest($(".show-results")).removeClass("show-results"),!1}}),Time.views.MarketDataView=Backbone.View.extend({el:".market-data-module",$el:$(this.el),template:Time.templates["market-data"],initialize:function(){var that;return _.bindAll(this,"render"),this.collection=new Time.collections.MarketData,that=this,this.collection.fetch({success:function(){return that.render()}})},render:function(){var date,day,days,html,marketData,marketDataArray,recentStockDateString,recentStockTimestamp,sortedStockList;return days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],marketDataArray=this.collection.toJSON(),-1===location.href.indexOf("/money")&&(marketDataArray=function(){var _i,_len,_results;for(_results=[],_i=0,_len=marketDataArray.length;_len>_i;_i++)marketData=marketDataArray[_i],"10-YR BOND"!==marketData.label&&_results.push(marketData);return _results}()),_.each(marketDataArray,function(mData,i){return mData.changePercent=parseFloat(mData.changePercent).toFixed(2),mData.change=parseFloat(mData.change).toFixed(2),marketDataArray[i]=mData}),html=$(this.template.render({marketdata:marketDataArray})),sortedStockList=_(marketDataArray).sortBy(function(x){return x.timestamp}).pop(),recentStockTimestamp=sortedStockList.timestamp,date=new Date(1e3*parseInt(recentStockTimestamp,10)),day=days[date.getDay()],recentStockDateString="As of "+day+" "+sortedStockList.dateTimeString,$(".market-data-module").html(html),$(".idc-timestamp").html(""),$(".idc-timestamp").html(recentStockDateString),this.bind_events()},bind_events:function(){return $(".idc-tablestyle tbody tr").each(function(){var perChange;return perChange=parseFloat($(this).find(".idc-td-perchange span").html(),10),perChange>0?($(this).find(".idc-td-perchange span").addClass("idc-changeup"),$(this).find(".idc-td-change span").addClass("idc-changeup")):0>perChange?($(this).find(".idc-td-perchange span").addClass("idc-changedown"),$(this).find(".idc-td-change span").addClass("idc-changedown")):($(this).find(".idc-td-perchange span").addClass("idc-changedown").addClass("idc-change-none"),$(this).find(".idc-td-change span").addClass("idc-changenone"))})}}),Time.views.Tabs=Backbone.View.extend({el:".rail-tabs",template:Time.templates["rail-tabs"],events:{click:"load_rail"},initialize:function(display_data,el_selector){return null!=el_selector&&el_selector&&!Time.application.breakpoints.medium.is_beneath&&(this.el=el_selector),this.render(display_data),this},render:function(display_data){return"undefined"!=typeof console&&null!==console&&console.dir(display_data),$(this.template.render(display_data)).appendTo(this.$el)},load_rail:function(e){var $el,env,pos,sub;return $el=$(e.target),$el.is(".rail-tab")?$el.hasClass("active")?!1:(pos=this.$el.index($el),env=$el.attr("id"),sub=$el.attr("data-sub"),this.set_active(env||0),null!=$el.data("event")?omniTrackEv($el.data("event")):void 0):e},set_active:function(env){return this.$(".rail-tab").removeClass("active"),"number"==typeof env?this.$(".rail-tab").eq(0).addClass("active"):this.$(".rail-tab#"+env).addClass("active"),this},destroy:function(){return this.undelegateEvents(),this.$el.removeData().unbind().empty(),this}}),Time.views.TickerHeadline=Backbone.View.extend({template:Time.templates["article-single-header-video"],events:{"click .ticker-tweet":"Time.application.open_popup"},initialize:function(){return this.render()},render:function(){var articles,recentVideo1,recentVideo2,videos,videosJsonArray;return articles=this.model.get("articles"),videos=_(articles).shuffle(),recentVideo1=videos[0],recentVideo2=videos[1],videosJsonArray={articles:[recentVideo1,recentVideo2]},this.setElement($(this.template.render(videosJsonArray))),this.bind_events(),this.$el},bind_events:function(){return this.$el.on("isCurrent",$.proxy(this.updateTweeterButton,this))},updateTweeterButton:function(){var tw_link;return tw_link=Time.application.twitter_share_url(this.model.get("encoded_shortlink"),this.model.get("twitter_text"),this.model.get("twitter_via")),$(".ticker-tweet").attr("href",tw_link)}}),Time.views.TickerModule=Backbone.View.extend({template:Time.templates["ticker-module"],el:".top-banner",$el:$(this.el),items:[],$items:[],$itemContainer:{},circular:!0,height:66,events:{"click .next":"advance","click .prev":"recede"},initialize:function(){return this.listenTo(this,"ticker:recalc",function(_this){return function(){return _this.on_recalc()}}(this)),this.$tweet_btn=this.$(".ticker-tweet"),this.items=new Time.collections.Ticker,this.listenTo(this.items,"reset",function(_this){return function(){return _this.render()}}(this)),this.items.load_headlines(),this},render:function(){return this.html=this.template.render({}),this.$el.html($(this.html)),this.$itemContainer=this.$(".headlines"),this.$items=this.items.get_$items(),this.$itemContainer.html(this.$items),this.$items.length>0?(this.init_ticker(),this.handle_scaling()):void 0},enter_large:function(){return this.handle_scaling()},exit_large:function(){return this.handle_scaling()},init_ticker:function(at){return this.$items=this.items.get_$items(),this.initComponent(at?at:0),this.auto_play(5e3)},handle_scaling:function(){return this},on_recalc:function(){var data;return data=this.items.models[this.getCurrentIndex()].toJSON(),this.$tweet_btn.data("href","https://twitter.com/intent/tweet?url="+encodeURIComponent(data.twitter_shortlink)+"&text="+data.twitter_text+"&via="+data.twitter_via),this.auto_play(5e3)}}),_.extend(Time.views.TickerModule.prototype,Time.component.Ticker.prototype,Backbone.Events);var Time;Time=window.Time||(window.Time={}),_(Time).extend(Backbone.Events),window.TIME_onTemplateLoad=function(id){console.log("BrightCove on Template ========================================"),Time.trigger("brightcove:template:load",id)},window.TIME_onTemplateReady=function(e){console.log("BrightCove on Ready ========================================"),Time.trigger("brightcove:template:ready",e)},Time.initial_gallery_slug=!1,Time.$_GET={},Time.taboola_counter=0,Time.application=new Time.views.Application,$(function(){var fragment;return Time.application.render(),Time.application.router=new Time.Router,Time.application.hasPushstate?Backbone.history.start({pushState:!0}):$(".page-template-pagespage-special-story-php, .money-home").length?Backbone.history.start({pushState:!1,hashChange:!1}):(Backbone.history.start({pushState:!1,hashChange:!0,silent:!0}),fragment=window.location.pathname.substr(Backbone.history.options.root.length),""===fragment?Backbone.history.navigate("index",{trigger:!0}):Backbone.history.navigate(fragment,{trigger:!0})),$(".error404").length?Time.application.page_view=new Time.views.error404:void 0}),Time.Router=Backbone.Router.extend({is_initial_route:!0,popped:!1,routes:{"(/)":"base","right-now/":"right_now","author/:author/":"author","magazine/(:region/)(:magazine_id/)(:magazine_slug/)":"magazine","tag/:tag/":"tag","topic/:topic/":"topic","popular/":"popular","videos/":"videos","content-from/:sponsor/(:article_id/)(:article_slug/)":"sponsored","time_homepage/:homepage/":"base",":special/":"special",index:"base","(:vertical)/homepage/(:money_homepage_slug/)":"vertical","money/magazine/":"money_magazine","money/popular/":"popular","money/videos/":"videos","money/topic/:topic/":"topic","money/page/:special/":"special"},initialize:function(){return Time.author=!1,Time.curRoute={env:"",sub:""},this.listenTo(this,"route",function(route,params){console.log(""),console.log(" new route ",route,params),console.log(""),Time.trigger("router:route",route,params)}),this.listenToOnce(this,"route",function(_this){return function(){_this.is_initial_route=!1}}(this)),this.route(/^([0-9]+)\/([a-z0-9-]+)?(\/(item|photo)\/([a-z0-9-_]+))?(\/)?/,"article"),this.route(/^(business|culture|history|living|entertainment|health|ideas|newsfeed|opinion|politics|science|sports|style|tech|us|world)\/?$/,"section"),this.route(/^collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^money\/([0-9]+)\/([a-z0-9-]+)?(\/(item|photo)\/([a-z0-9-_]+))?(\/)?/,"article"),this.route(/^money\/(retirement|everyday-money|real-estate|careers|family-finance|investing)\/?$/,"section"),this.route(/^money\/collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^(money)\/?$/,"vertical"),this},isPreview:function(url){var regexIsPreview;return regexIsPreview=/&preview=true/,regexIsPreview.test(url)},base:function(){return this.isPreview(window.location.href)?this.preview():this.is_initial_route?(Time.application.page_view=new Time.views.Homepage,this):void window.location.reload()},preview:function(){var isMoneyPage,isPage,matchesCollection,matchesMagazine,matchesPost,regexIsMoneyPage,regexIsPage,regexMatchesCollection,regexMatchesMagazine,regexMatchesPost;return regexIsMoneyPage=/money_page&p=([0-9]+)/,(isMoneyPage=regexIsMoneyPage.test(window.location.href))?this.special():(regexMatchesMagazine=/post_type=time_magazine&p=([0-9]+)/,matchesMagazine=regexMatchesMagazine.exec(window.location.href),(null!=matchesMagazine?matchesMagazine[1]:void 0)?this.magazine(null,matchesMagazine[1],null):(regexMatchesCollection=/post_type=time_collection&p=([0-9]+)/,matchesCollection=regexMatchesCollection.exec(window.location.href),(null!=matchesCollection?matchesCollection[1]:void 0)?this.collection(matchesCollection[1],null):(regexMatchesPost=/p=([0-9]+)/,matchesPost=regexMatchesPost.exec(window.location.href),(null!=matchesPost?matchesPost[1]:void 0)?this.article(matchesPost[1]):(regexIsPage=/page_id=([0-9]+)/,(isPage=regexIsPage.test(window.location.href))?this.special():void console.error("Unmatched &preview=true route!")))))},right_now:function(){return"undefined"!=typeof console&&null!==console&&console.info("right now"),Time.application.load_rail_env()},article:function(article_id,article_slug,item_slug_raw,item_type,item_slug){var _ref;console.info("load single article",article_id,article_slug),(null!=(_ref=Time.application.active_rail)?_ref.is_collection:void 0)||this.is_initial_route&&Time.bootstrap.collection?null!=article_id&&this.is_initial_route===!1?(Time.application.load_article(article_id,item_slug),Time.application.active_route="collection"):this.collection(Time.bootstrap.collection.collection_slug):Time.application.load_article(article_id,item_slug)},section:function(section){"undefined"!=typeof console&&null!==console&&console.info("section"),Time.application.load_rail_env({env:"section",sub:section,open_rail:!0})},author:function(author){"undefined"!=typeof console&&null!==console&&console.info("author"),Time.author=!0,Time.application.load_rail_env({env:"author",sub:author,open_rail:!0})},topic:function(topic){"undefined"!=typeof console&&null!==console&&console.info("router -- topic"),Time.application.load_rail_env({env:"topic",sub:topic,open_rail:!0})},tag:function(tag){"undefined"!=typeof console&&null!==console&&console.info("tag"),Time.application.load_rail_env({env:"tag",sub:tag,open_rail:!0})},magazine:function(region,magazine_id){return"undefined"!=typeof console&&null!==console&&console.info("magazine"),null!=magazine_id?void Time.application.load_rail_env({env:"magazine",sub:region,magazine_id:magazine_id}):void Time.application.load_rail_env({env:"magazine",sub:region})},popular:function(){return Time.application.load_rail_env({env:"popular"})},videos:function(){return"undefined"!=typeof console&&null!==console&&console.info("videos"),Time.application.load_rail_env({env:"videos"})},sponsored:function(sponsor,article_id){var ntv_a;return ntv_a=/\?ntv_a=(.*)/.exec(window.location.href),this.is_initial_route&&(null!=ntv_a?ntv_a[0]:void 0)?Time.application.load_rail_env({env:"nativo"}):("undefined"!=typeof console&&null!==console&&console.info("sponsored"),null!=article_id?Time.application.load_article(article_id):void Time.application.load_rail_env({env:"sponsor",sub:sponsor}))},special:function(){"undefined"!=typeof console&&null!==console&&console.info("special"),Time.application.page_view=new Time.views.SpecialPage},setHubArticle:function(hubArticle){Time.application.load_article(hubArticle.id)},initialCollection:function(collection){var _ref;Time.application.load_rail_env({env:"collection",sub:collection,sync_article_id:null!=(_ref=Time.bootstrap.collection)?_ref.initial_time_hub_article_id:void 0}),Time.application.active_rail.freeze_url=!1,Time.application.active_route="collection"},initialCollectionHub:function(hubSlug){var hub;hub=_.findWhere(Time.bootstrap.collection.hubs,{slug:hubSlug}),null!=hub?(Time.application.active_rail.freeze_url=!0,Time.application.active_route="collection",this.setHubArticle(hub.articles[0]),Time.application.active_rail.freeze_url=!1):window.location=Time.bootstrap.collection.url},collection:function(collection,hubSlug){return this.is_initial_route?this.initialCollection():null!=hubSlug?this.initialCollectionHub(hubSlug):null==Time.bootstrap.collection?window.location.reload():Time.bootstrap.collection.collection_slug!==collection?window.location.reload():this.setHubArticle(null!=Time.bootstrap.collection.intro_post?Time.bootstrap.collection.intro_post:Time.bootstrap.collection.hubs[0])},vertical:function(vertical){return this.is_initial_route?void(Time.application.page_view=new Time.views.Vertical({vertical:vertical})):window.location.reload()},money_magazine:function(){return Time.application.load_rail_env({env:"money_magazine",sub:"magazine",open_rail:!0})}})}(jQuery);;
