/* uverse - v6.2.0 - 
 * Copyright (c) 2014 AT&T. All rights reserved.
 */


!function(){ko.virtualElements.allowedBindings.bindIfExists=!0,ko.bindingHandlers.bindIfExists={init:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b()),g=f in d&&null!==d[f];return g?void 0:{controlsDescendantBindings:!0}}}}(),ko.virtualElements.allowedBindings.cardController=!0,ko.bindingHandlers.cardController={init:function(a,b,c,d,e){var f=b(),g=d;g.$index=e.$index();var h=f.createCardTemplate(g);return ko.virtualElements.prepend(a,h),f.addCard(h,g),{controlsDescendantBindings:!0}}},function(){function a(a,b){return"number"!=typeof a&&(a=a?0:1),b>a?a:b-1}ko.bindingHandlers.choose={init:function(a){return Browser.ie8&&$(a),{controlsDescendantBindings:!0}},update:function(b,c){var d=ko.utils.unwrapObservable(c()),e=b.retrieve("chooseOptions");e||(e=b.get("html").split("|"),b.store("chooseOptions",e));var f=a(d,e.length);b.set("html",e[f])}}}(),function(){function a(a,b){var c=a.clone();c.setStyles({position:"absolute","z-index":2}),a.grab(c,"before");var d;b.clone&&(d=b.clone.destroy(),d.start(c)),b.element&&(d=b.element,d.start(a))}function b(a,b){var c=a.clone();c.setStyles({position:"absolute","z-index":2}),b.cloneStyles&&c.setStyles(b.cloneStyles),b.cloneClass&&c.addClass(b.cloneClass),b.duration&&(c.set("tween",{duration:b.duration}),b.crossFade&&a.set("tween",{duration:b.duration})),b.transition&&(c.set("tween",{transition:b.transition}),b.crossFade&&a.set("tween",{transition:b.transition})),a.grab(c,"before"),c.fade("out").get("tween").chain(function(){c.destroy(),this.callChain()}),b.crossFade&&a.fade("hide").fade("in")}ko.bindingHandlers.cloneAndAnimate={init:function(b,c,d,e,f){Browser.ie8&&$(b);var g=Object.append({element:null,clone:null,subscribe:null},c());g.subscribe.subscribe(function(c){a(b,g)},null,"beforeChange")}},ko.bindingHandlers.cloneAndFade={init:function(a,c){Browser.ie8&&$(a);var d=c();if(ko.isObservable(d))d={subscribe:d};else if(!ko.isSubscribable(d.subscribe))throw Error("[ko.cloneAndFade] Must supply a subscribable option!");d.subscribe.subscribe(function(c){b(a,d)},null,"beforeChange")}}}(),function(){var a=1,b=3;ko.bindingHandlers.descendantsTitle={init:function(a){Browser.ie8&&$(a)},update:function(c,d){function e(c){var d=c.childNodes,f="";if(!d)return f;for(var g=null,h=d.length,i=0;h>i;){switch(g=d[i],g.nodeType){case b:f+=g.textContent;break;case a:Browser.ie8&&$(g),f+=g.isVisible()?e(g):""}i++}return f}function f(a){return a.replace(/[\s]+/g," ")}var g=d();ko.utils.unwrapObservable(g),setTimeout(function(){var a=f(e(c));c.set("title",a)},1)}}}(),function(){var a=null;ko.bindingHandlers.ellipsify={init:function(b,c){Browser.ie8&&$(b),a||(a=new Uverse.utils.Ellipsify({ellipsis:"...",truncateTo:"letter",cloneOriginal:!0,wrapChild:null,restoreOriginal:!1}))},update:function(b,c){var d=c();ko.isObservable(d)?d={enabled:ko.utils.unwrapObservable(d)}:"object"!=typeof d?d={enabled:!!d}:ko.isObservable(d.enabled)&&(d.enabled=ko.utils.unwrapObservable(d.enabled));var e=b.retrieve("$ellipsifyEnabledState");if(e!==d.enabled){b.store("$ellipsifyEnabledState",d.enabled),d.enabled===!1&&(d.restoreOriginal=!0);var f=a.ellipsifyElement(b,d);d.ellipsified&&d.ellipsified(f)}}}}(),function(){function a(a){var b={result:null,stripTags:function(a,c){return b.result||(b.result=c?a.stripTags():a),b.result}},c={rawText:"",textWithoutHTML:function(){},html:"",isHTML:!1};return a.text?(c.rawText=a.text,c.textWithoutHTML=b.stripTags.bind(this,a.text,!1),c.isHTML=!1):a.html?(c.rawText=a.html,c.textWithoutHTML=b.stripTags.bind(this,a.html,!0),c.html=a.html,c.isHTML=!0):c.textWithoutHTML=b.stripTags.bind(this,"",!1),c}function b(a){var b=0,c=null,d=a&&a.text&&a.url;return d&&(b=a.text.length,c=new Element("a",{text:a.text,href:a.url})),{exists:d,textLength:b,el:c}}var c=null,d="...";ko.bindingHandlers.ellipsifyText={init:function(a,b){Browser.ie8&&$(a),c||(c=new Uverse.utils.Ellipsify({ellipsis:d,truncateTo:"letter",cloneOriginal:!1,wrapChild:null,restoreOriginal:!1}))},update:function(e,f){var g=f();"object"!=typeof g&&(g={text:g}),ko.isObservable(g.text)&&(g.text=ko.utils.unwrapObservable(g.text)),ko.isObservable(g.html)&&(g.html=ko.utils.unwrapObservable(g.html));var h=a(g),i=!1;if("fixed"===g.truncateTo)if(h.isHTML&&Uverse.console.warn("Cannot truncate a string containing HTML using 'truncateTo=fixed'. Removing all HTML from string ("+h.textWithoutHTML().substr(0,20)+"...)"),h.textWithoutHTML().length>g.characterLimit){var j=b(g.showMoreLink),k=h.textWithoutHTML().substr(0,g.characterLimit+1-d.length-j.textLength)+d;e.set("text",k),j.exists&&e.adopt(j.el),i=!0}else e.set("text",h.textWithoutHTML());else{var l=e.retrieve("$ellipsifyText");if(l&&l===h.rawText)return;e.store("$ellipsifyText",h.rawText);var m=h.isHTML?"html":"text";e.set(m,h.rawText||""),i=c.ellipsifyElement(e,g)}g.setTitle&&i&&e.set("title",h.textWithoutHTML())}}}(),function(){ko.bindingHandlers.hover={init:function(a,b){Browser.ie8&&$(a);var c=b();"object"!=typeof c&&(c={hovered:c,exclude:null}),a.addEvents(c.exclude?{mouseover:function(a){var b=a.target,d=!!b.getClosest(c.exclude),e=!d;c.hovered(e)},mouseout:function(b){var d=b.relatedTarget;if(!d)return void c.hovered(!1);var e=!d.getClosest(a),f=!!d.getClosest(c.exclude),g=!(e||f);c.hovered(g)}}:{mouseenter:function(a){c.hovered(!0)},mouseleave:function(a){c.hovered(!1)}})}}}(),function(){function a(a,b){var c=a.getParent(),d={width:c.offsetWidth,height:c.offsetHeight},e={width:a.naturalWidth||a.width,height:a.naturalHeight||a.height},f=d.width/e.width>=d.height/e.height;switch(b){case"cover":a.setStyle(f?"width":"height","100%"),a.addClass("image-cover");break;case"contain":case!0:default:a.setStyle(f?"height":"width","100%"),a.addClass("image-contain")}}ko.bindingHandlers.image={init:function(a){Browser.ie8&&$(a)},update:function(b,c){var d=ko.utils.unwrapObservable(c());if(d.scaleToParent||d.fadeIn){d.fadeIn&&b.fade("hide");var e=function(){d.scaleToParent&&(b.setStyles({width:null,height:null}),a(b,d.scaleToParent)),d.fadeIn&&b.fade("in")},f=!d.src&&b.complete;f?e():(b.removeEvents("load"),b.addEvent("load:once",e))}if(d.src){var g=ko.utils.unwrapObservable(d.src);g&&(b.src=g)}}}}(),function(){ko.virtualElements.allowedBindings.local=!0,ko.bindingHandlers.local={init:function(a,b,c,d,e){var f=b();for(var g in f)if(f.hasOwnProperty(g)){"object"==typeof d&&g in d&&Uverse.console.error("[binding.local]",g," - Local variables should not have the same name as viewModel properties.");var h=ko.unwrap(f[g]);e[g]=ko.observable(h)}},update:function(a,b,c,d,e){var f=b();for(var g in f)if(f.hasOwnProperty(g)){var h=ko.unwrap(f[g]);e[g](h)}}}}(),function(){var a=new Class({Implements:[Options],Binds:["_validateLength","_handlePaste"],options:{},viewValue:null,initialize:function(a,b){this.el=a,this.setOptions(b),this._setupEvents()},_setupEvents:function(){this.el.addEvents({keyup:this._validateLength,keydown:this._validateLength,paste:this._handlePaste})},_totalChars:function(){return this.viewValue.length},_remainingChars:function(){return this.options.maxLength-this._totalChars()},updateModel:function(a){var b=null!=a?a:this.el.value,c=this.options;if(this.viewValue!==b){if(this.el.value=b,this.el.isVisible()){var d=this.el.getSelectedRange();this.el.setSelectionRange(d.start,d.start)}null==a&&c.modelValue(b),this.viewValue=b,c.totalChars&&c.totalChars(this._totalChars()),c.remainingChars&&c.remainingChars(this._remainingChars())}},_validateLength:function(a){var b=-1!==["up","end","home","left","right","pageup","delete","pagedown","backspace"].indexOf(a.key),c=a.meta||a.control,d=!!this.el.getSelectedText().length,e=c&&"z"===a.key;if(e)return this.trimText(),void a.stop();this.updateModel();var f=this._remainingChars()>0||b||c||d;f||a.stop()},_handlePaste:function(a){var b=a.getClipboardText();if(!b)return void this.dumbTrimText();var c=this.viewValue.split(""),d=this.el.getSelectedRange();c.splice(d.start,d.end-d.start,b),this.trimText(c.join("")),a.stop()},trimText:function(a){a=a||this.el.value;var b=this.options,c=a.slice(0,b.maxLength);if(c!==b.modelValue())b.modelValue(c),this.updateModel(c);else if(this.el.isVisible()){var d=this.el.getSelectedRange().end;this.el.setSelectionRange(d,d)}},dumbTrimText:function(){setTimeout(function(){this.trimText()}.bind(this),0)}});ko.bindingHandlers.maxLength={init:function(b,c){$(b);var d=c(),e=new a(b,{maxLength:d.maxLength,modelValue:d.modelValue,totalChars:d.totalChars,remainingChars:d.remainingChars});b.store("max-length",e)},update:function(a,b){var c=b(),d=ko.utils.unwrapObservable(c.modelValue),e=a.retrieve("max-length");e.updateModel(d),e.trimText()}}}(),ko.virtualElements.allowedBindings.merge=!0,ko.bindingHandlers.merge={init:function(a,b,c,d,e){var f=b();ko.merge(d,f)}},ko.bindingHandlers.mergeModelData={init:function(a,b,c,d,e){var f=b(),g;"string"==typeof f?(g=Uverse.loader.retrieveModelData(f),Uverse.loader.eliminateModelData(f)):g=Object.map(f,function(a){var b=Uverse.loader.retrieveModelData(a);return Uverse.loader.eliminateModelData(a),b}),ko.merge(d,g)}},ko.bindingHandlers.placeholder={init:function(a,b,c,d){if(!(d._supportsPlaceholder="placeholder"in document.createElement("input"))){var e=b(),f=d._placeholderText=a.get("placeholder"),g=d._placeholderClass="has-placeholder";a.value=e()||f,a.addEvents({focus:function(){(e()===f||""===e())&&(a.removeClass(g),a.set("value",""))},blur:function(){""===e()&&(a.addClass(g),a.set("value",f))}})}},update:function(a,b,c,d){if(!d._supportsPlaceholder){var e=b();""===e()&&document.activeElement!==a&&(a.addClass(d._placeholderClass),a.set("value",d._placeholderText))}}},function(){ko.bindingHandlers.positionSticky={init:function(a,b,c,d,e){Browser.ie8&&$(a);var f=a.getTop(),g=b(),h=f-g,i=!1;window.addEvent("scroll",function(b){i||(f=a.getTop(),h=f-g);var c=window.getScrollTop(),d=c>=h;d!==i&&(d?(a.style.position="fixed",a.style.top=g+"px"):(a.style.position="",a.style.top=""),i=!i)})}}}(),ko.bindingHandlers.read={init:function(a,b,c,d,e){Browser.ie8&&$(a);var f=b(),g={};Object.each(f,function(b,c){var e=void 0!==d[c];if(e){var f;f="string"==typeof b?a.get(b):b,g[c]=f}}),ko.merge(d,g)}},function(){function a(a,b,c){Browser.ie8&&$(a);var d=b();ko.isObservable(d)?d={visible:ko.utils.unwrapObservable(d)}:ko.isObservable(d.visible)&&(d.visible=ko.utils.unwrapObservable(d.visible));var e=a.retrieve("$visibleState"),f=!0;if(e!==d.visible){a.store("$visibleState",d.visible),null===e&&(f=!1);var g=c(d.visible),h={};d.transition&&(h.transition=d.transition),d.duration&&(h.duration=d.duration),h.props=Object.keys(g),h.keepStylesWhenDone=!0;var i=a.get("morph"),j=function(){a.setStyles(g)};a.setStyle("display",null),f?d.visible?a.transition(h,j):(a.transition(h,j),i.chain(function(){a.setStyle("display","none"),i.callChain()}),i.isRunning()||i.callChain()):(j(),d.visible||a.setStyle("display","none")),d.fullyVisible&&(d.visible?i.isRunning()?(d.fullyVisible(!1),i.chain(function(){d.fullyVisible(!0),i.callChain()})):d.fullyVisible(!0):d.fullyVisible(!1)),d.partiallyVisible&&(d.visible?d.partiallyVisible(!0):i.isRunning()?(d.partiallyVisible(!0),i.chain(function(){d.partiallyVisible(!1),i.callChain()})):d.partiallyVisible(!1))}}ko.bindingHandlers.reveal={update:function(b,c){var d=function(a){return{margin:a?null:0,padding:a?null:0,"border-width":a?null:0,height:a?null:0,width:a?null:0,opacity:a?null:0}};a(b,c,d)}},ko.bindingHandlers.fade={update:function(b,c){var d=function(a){return{opacity:a?1:0}};a(b,c,d)}},ko.bindingHandlers.slideDown={update:function(b,c){var d=function(a){return{"margin-top":a?null:0,"margin-bottom":a?null:0,"padding-top":a?null:0,"padding-bottom":a?null:0,height:a?null:0}};a(b,c,d)}},ko.bindingHandlers.slideRight={update:function(b,c){var d=function(a){return{"margin-left":a?null:0,"margin-right":a?null:0,"padding-left":a?null:0,"padding-right":a?null:0,width:a?null:0}};a(b,c,d)}}}(),ko.bindingHandlers.selectToggler={init:function(a,b,c,d){function e(a){h.removeEvent("click",f),setTimeout(function(){h.addEvent("click",f)},1),g(!g())}function f(a){g(!1),h.removeEvent("click",f)}var g=b(),h=document.body,i=a.getSiblings(".U2-select-select");i.addEvent("click",e)}},function(){var a=ko.utils.unwrapObservable,b=function(){},c=new Class({Implements:[Options],options:{activeIdx:null,autoStart:!0,pauseOnHover:!0,slideDuration:800,intervalValue:5e3},el:null,currentIdx:null,slideWidth:null,timer:null,_previousCallback:b,initialize:function(b,c){this.el=b,this.setOptions(c),this._setupElements(),this._setupEvents(),this._setupTween(),a(this.options.autoStart)&&this._startInterval()},updateModel:function(a){var b=this._activeIdx();return b>=this.totalSlides?this._slideLastToFirst():0>b?this._slideFirstToLast():void this._slideDefault(a)},_setupElements:function(){var a=this.el;this.slideEls=a.getChildren(),this.totalSlides=this.slideEls.length,this.totalSlides<2&&Uverse.console.error("[Slider]","There must be at least two slides to create a slider."),this.firstSlide=this.slideEls[0],this.lastSlide=this.slideEls[this.totalSlides-1],this.slideWidth=a.offsetWidth,this.sliderWidth=this.totalSlides*this.slideWidth,this.hoverTarget=this.el.parentElement,a.setStyle("width",this.sliderWidth+"px")},_setupEvents:function(){a(this.options.pauseOnHover)&&this.hoverTarget.addEvents({mouseenter:this._stopInterval.bind(this),mouseleave:this._startInterval.bind(this)})},_setupTween:function(){this.tween=new Fx.Tween(this.el,{duration:a(this.options.slideDuration),link:"cancel",property:"left"})},_startInterval:function(){var b=a(this.options.intervalValue);this.timer=setInterval(function(){this._activeIdx(this._activeIdx()+1)}.bind(this),b)},_stopInterval:function(){clearInterval(this.timer)},_slide:function(a,c){this.tween.isRunning()&&(this.tween.cancel(),this._previousCallback()),this._previousCallback=c||b,this.tween.start(a).chain(c)},_slideDefault:function(a){var b=this._getSlidePosition(this._activeIdx());this._slide(b,a)},_slideLastToFirst:function(){var a=this.el,b=0,c=this._getSlidePosition(this.totalSlides-1),d=this._getSlidePosition(this.totalSlides-2);a.appendChild(this.firstSlide),a.setStyle("left",d),this._activeIdx(b),this._slide(c,function(){a.insertBefore(this.firstSlide,this.slideEls[1]),a.setStyle("left",0)}.bind(this))},_slideFirstToLast:function(){var a=this.el,b=this.slideEls.length-1;a.insertBefore(this.lastSlide,this.firstSlide),a.setStyle("left",-this.slideWidth+"px"),this._activeIdx(b),this._slide(0,function(){a.appendChild(this.lastSlide),a.setStyle("left",this._getSlidePosition(b))}.bind(this))},_getSlidePosition:function(a){return-(a*this.slideWidth)+"px"},_activeIdx:function(a){var b=this.options.activeIdx;return null!=a?b(a):b()}});ko.bindingHandlers.slider={init:function(a){a.style.visibility="hidden"},update:function(a,b){Browser.ie8&&$(a);var d=a.retrieve("Slider"),e;if(!d){var f=b();d=new c(a,f),a.store("Slider",d);var g=d.tween.options.duration;d.tween.options.duration=10,e=function(){a.style.visibility="",d.tween.options.duration=g}}d.updateModel(e)}}}(),function(){ko.bindingHandlers.title={init:function(a,b){Browser.ie8&&$(a)},update:function(a,b){var c=b();c?(c=ko.utils.unwrapObservable(c)||"",a.set("title",c.stripTags())):a.set("title","")}}}(),function(){function a(a){return Object.map(a,function(a,b){return a===!0?null:a===!1?0:a})}ko.bindingHandlers.transition={init:function(a,b,c,d,e){Browser.ie8&&$(a)},update:function(b,c,d,e,f){var g=c(),h=b.retrieve("$transitionInitialized");if(h||b.store("$transitionInitialized",!0),g instanceof ko.AnimationQueue)return void(h?g.start(b):g.init(b));g=Object.append({styles:null,classes:null,props:null,duration:null,transition:null,onComplete:null},g);var i=function(){if(g.styles){var c=a(g.styles);b.setStyles(c)}g.classes&&Object.each(g.classes,function(a,c){b.toggleClass(c,a)})};if(!h)return void i();var j=Object.subset(g,["props","duration","transition"]);if(g.styles){var k=Object.keys(g.styles);j.props?Array.combine(j.props,k):j.props=k,j.keepStylesWhenDone=!0}if(b.transition(j,i),g.onComplete){var l=b.get("morph"),m=l.isRunning();m&&l.queue(g.onComplete,b)}}}}(),ko.bindingHandlers.ucontrol={init:function(a,b){var c=b(),d=Object.append({checked:null,value:null,disabled:!1,showError:!1,errorCode:0},c);return ko.applyBindingsToDescendants(d,a),{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.merge=!0,ko.bindingHandlers.widget={init:function(a,b,c,d,e){var f=b();return"object"!==typeOf(f)&&(f={widget:f,options:{}}),new f.widget(a,f.options,d),{controlsDescendantBindings:!0}}},ko.extenders.delay=function(a,b){"object"!=typeof b&&(b={duration:b});var c=ko.observable(a()),d=null,e=ko.computed({read:function(){return c()},write:function(a){var e=(a?b["in"]:b.out)||b.duration;clearTimeout(d),d=setTimeout(function(){c(a)},e)}});return a.subscribe(function(a){e(a)}),e},function(){function a(a,c){return ko.computed({read:c.read?function(){var d=a();return b(c.read,d),d}:a,write:c.write?function(d){return b(c.write,d),a(d)}:a,owner:a})}function b(a,b){switch(a.length){case 0:Uverse.console.log("[extenders.log]",b);break;case 1:Uverse.console.log("[extenders.log]",a[0],b);break;default:Uverse.console.log(a[0],Array.slice(a,1).join(" "),b)}}ko.extenders.log=function(b,c){return c=Array.from(c),a(b,{read:Array.clone(c).append(["Read"]),write:Array.clone(c).append(["Write"])})},ko.extenders.logRead=function(b,c){return c=Array.from(c),a(b,{read:c})},ko.extenders.logWrite=function(b,c){return c=Array.from(c),a(b,{write:c})}}(),ko.extenders.reset=function(a){var b=a();return a.reset=function(){a(b)},a},function(){ko.Anim={},Object.append(ko.Anim,{createAnimationFromStyles:function(){var a=Array.from(arguments),b=function(a){return a=ko.utils.unwrapObservable(a),a?b["in"]:b.out};return b["in"]={},b.out={},b.props=a,Array.each(a,function(a){b["in"][a]=null,b.out[a]=0}),b}}),Object.append(ko.Anim,{fade:ko.Anim.createAnimationFromStyles("opacity"),slideHorizontally:ko.Anim.createAnimationFromStyles("width","margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width","opacity"),slideVertically:ko.Anim.createAnimationFromStyles("height","margin-top","margin-bottom","padding-top","padding-bottom","border-top-width","border-bottom-width","opacity"),shrink:ko.Anim.createAnimationFromStyles("width","margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width","height","margin-top","margin-bottom","padding-top","padding-bottom","border-top-width","border-bottom-width","opacity")});var a=1;Object.append(ko.Anim,{helpers:{afterRender:function(a,b){var c=this.afterAdd(a,b),d=function(a,b){Array.each(a,function(a,d){c(a,d,b[d])})};return d},afterAdd:function(b,c){c||(c={}),c.props=b.props;var d=function(d,e,f){d.nodeType===a&&(d.setStyles(b.out),d.transition(c,function(){d.setStyles(b["in"])}))};return d},beforeRemove:function(b,c){c=Object.append({parentTransitionOptions:null,removeFromFlow:!1},c),c.props=b.props;var d=function(d,e,f){if(d.nodeType!==a)return void d.parentNode.removeChild(d);if(d.transition(c,function(){d.setStyles(b.out)}),d.get("morph").queue(function(){d.destroy()}),c.removeFromFlow){var g=function(){var a=d.getPosition();d.setStyles({position:"absolute"}),d.setPosition(a)};c.parentTransitionOptions?d.getParent().transition(c.parentTransitionOptions,g):g()}};return d}}}),Object.append(ko.Anim,{shuffle:function(b){var c={duration:1e3,transition:"quint:in:out"},d=ko.Anim.fade,e={transition:"quint:out",duration:500,removeFromFlow:!0,parentTransitionOptions:{duration:1e3,props:["height"],transition:"quint:in:out"}};return Object.append(b,{beforeMove:function(b,c,d){if(b.nodeType===a){var e=b.getPosition();b.store("$beforeMovePosition",e)}},afterMove:function(b,d,e){if(b.nodeType===a){var f=b.retrieve("$beforeMovePosition"),g=b.getPosition();b.setStyles({position:"relative"}),c&&b.set("morph",c),b.morph({top:[f.y-g.y,0],left:[f.x-g.x,0]})}},beforeRemove:ko.Anim.helpers.beforeRemove(d,e)}),b}})}(),function(){var a=new Class({initialize:function(a,b){this.command=a,this.previousAnimation=b,this.start=this.start.bind(this)},_queue:function(b){return new a(b,this)},call:function(a,b){return arguments.length>1&&(a=a.pass(Array.slice(arguments,1))),this._queue(function(b,c,d){a(b,c,d),c.callChain()})},init:function(a){this._startChain(a,!0)},start:function(a){this._startChain(a,!1)},_startChain:function(a,b){var c=this._retrieveCache("commands");if(!c){c=[];for(var d=this;d;)d.command&&c.unshift(d.command),d=d.previousAnimation;this._storeCache("commands",c)}var e=a.get("morph");e.cancel(),Array.each(c,function(c){e.chain(function(){c(a,e,b)})}),e.callChain()},_retrieveCache:function(a){if(this._cache){var b=Array.join(arguments,".");return this._cache[b]}return null},_storeCache:function(a,b){var c=Array.join(Array.slice(arguments,0,arguments.length-1),"."),d=arguments[arguments.length-1];this._cache||(this._cache={}),this._cache[c]=d}});a.implement({animate:function(a){return a.props||a.styles&&(a.props=Object.keys(a.styles)),a.keepStylesWhenDone=!0,a.ifEmptyCallChain=!0,this._queue(function(b,c,d){var e=function(){a.classes&&Object.each(a.classes,function(a,c){b.toggleClass(c,a)}),a.styles&&b.setStyles(a.styles),a.prepare&&a.prepare(b)};d?(e(),c.callChain()):b.transition(a,e)})},delay:function(a){var b=this._retrieveCache("delay",a);if(b)return b;var c=this._queue(function(b,c,d){d?c.callChain():setTimeout(function(){c.callChain()},a)});return this._storeCache("delay",a,c),c},set:function(a,b){var c=this._retrieveCache(a,b);if(c)return c;var d;switch(a){case"duration":d=this.call(function(a,c,d){c.setOptions({duration:b})});break;case"transition":d=this.call(function(a,c,d){c.setOptions({transition:b})});break;default:return Uverse.console.warn("[ko.Animation]","Cannot set unrecognized key: ",a),this}return this._storeCache(a,b,d),d}}),ko.AnimationQueue=a,ko.Animation=new ko.AnimationQueue(null)}(),function(){function a(a,b){var c=Object.map(b,function(){return null}),d=function(d,e){d===!0?d="in":d===!1&&(d="out");var f=this._retrieveCache(a,d);if(f)return f;var g;switch(d){case"in":g=c;break;case"show":g=c,e=!0;break;case"out":g=b;break;case"hide":g=b,e=!0}var h;return h=e?this.setStyles(g):this.animate({styles:g}),this._storeCache(a,d,h),h};return d}var b=ko.AnimationQueue;b.implement({fade:a("fade",{opacity:0}),shrinkUp:a("shrinkUp",{height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0,opacity:0}),shrinkLeft:a("shrinkLeft",{width:0,"margin-left":0,"margin-right":0,"padding-left":0,"padding-right":0,opacity:0})}),b.implement({slide:function(a,b){a===!0?a="in":a===!1&&(a="up");var c=this._retrieveCache("slide",a,b);if(c)return c;var d;switch(a){case"in":d={};break;case"show":d={},b=!0;break;case"up":d={top:-1};break;case"hide":d={top:-1},b=!0;break;case"down":d={top:1};break;case"left":d={left:-1};break;case"right":d={left:1}}var e={props:["top","left"],keepStylesWhenDone:!0,prepare:function(a){var b=a.retrieve("$slide-initialPosition");null==b&&(b={top:a.getStyle("top"),left:a.getStyle("left")},b.top.contains("px")||(b.top=0),b.left.contains("px")||(b.left=0),a.store("$slide-initialPosition",b));var c={top:d.top?d.top*a.getHeight():b.top,left:d.left?d.left*a.getWidth():b.left};a.setStyles(c)}},f;return f=b?this.call(function(a,b,c){e.prepare(a)}):this.animate(e),this._storeCache("slide",a,b,f),f},slideTo:function(a,b,c){"object"!=typeof b&&(b={top:b}),b=b||{};var d=this._retrieveCache("slideTo",a,b,c);if(d)return d;var e={props:["top","left"],keepStylesWhenDone:!0,prepare:function(c){var d=c.retrieve("$slide-initialPosition");null==d&&(d={top:c.getStyle("top"),left:c.getStyle("left")},d.top.contains("px")||(d.top=0),d.left.contains("px")||(d.left=0),c.store("$slide-initialPosition",d));var e={top:a?b.top:d.top,left:a?b.left:d.left};c.setStyles(e)}},f;return f=c?this.call(function(a,b,c){e.prepare(a)}):this.animate(e),this._storeCache("slideTo",a,b,c,f),f}})}(),function(){function a(a){return function(b){var c=Array.slice(arguments),d=this.call(function(b,d,e){b[a].apply(b,c)});return d}}var b=ko.AnimationQueue;b.implement({setStyles:a("setStyles"),setStyle:a("setStyle"),addClass:a("addClass"),removeClass:a("removeClass"),toggleClass:a("toggleClass"),dispose:a("dispose"),destroy:a("destroy"),show:function(){return this.display(!0)},hide:function(){return this.display(!1)},display:function(a){return a===!0?a=null:a===!1&&(a="none"),this.setStyles({display:a})}})}(),function(){ko.Help={};var a=1;Object.append(ko.Help,{afterAdd:function(b){var c=function(c,d,e){c.nodeType===a&&b()};return c},beforeRemove:function(b,c){var d=function(d,e,f){return d.nodeType!==a?void d.parentNode.removeChild(d):(b&&b(),d.destroy(),void(c&&c()))};return d},checkForOverflow:function(a,b){Browser.ie8&&$(a);var c=a.getParent(),d=function(){var d=a.getHeight()>c.getHeight();b(d)};return d}})}(),function(){function a(f,g){for(var h in g)if(g.hasOwnProperty(h)){var i=f[h],j=b(g[h]);switch(typeOf(i)){case"function":if(ko.isObservableArray(i)){if("array"!==typeOf(j))throw Error("[ko] Can't merge a non-array into an observable array");c(i,j)}else ko.isWriteableObservable(i)?d(i,j):f[h]=j;break;case"array":e(i,j);break;case"object":a(i,j);break;default:f[h]=j}}}function b(a){return"function"==typeof a&&ko.isObservable(a)?a():a}function c(a,b){var c=a.$mapping;a.removeAll(),Array.each(b,function(b){var d=c?ko.merge(c(),b):b;a.push(d)})}function d(a,b){a(b)}function e(a,b){a.empty(),Array.each(b,function(b){var c=b;a.push(c)})}ko.observableArray.fn.mergeMapping=function(a){return this.$mapping=a,this.push(a()),this},ko.isObservableArray=function(a){return ko.isObservable(a)&&"splice"in a},ko.merge=function(){var b=arguments[0],d=Array.slice(arguments,1),e=ko.isObservableArray(b)?c:a;if(!b||!d.length)throw Error("[ko.merge] You must have at least two arguments to merge.");return Array.each(d,function(a){e(b,a)}),b}}(),Object.append(ko.observableArray.fn,{append:function(a){this.push.apply(this,a)}}),Array.implement({minIndex:function(a,b,c){void 0===a&&(a=0);var d;if(d=void 0===b?this.length:a+b,c=c||0,0>a||a>=d)return null;for(var e=this[a],f=a;++a<d;)e>this[a]+c&&(e=this[a],f=a);return f},maxIndex:function(a,b){void 0===a&&(a=0);var c;if(c=void 0===b?this.length:a+b,0>a||a>=c)return null;for(var d=this[a],e=a;++a<c;)d<this[a]&&(d=this[a],e=a);return e},exclude:function(a){Array.each(a,function(a){this.erase(a)},this)},peek:function(){return this[this.length-1]},findIndex:function(a,b){b=Math.max(b||0,0);for(var c=b;c<this.length;c++)if(a(this[c]))return c;return-1},findLastIndex:function(a,b){b=Math.min(b||this.length-1,this.length-1);for(var c=b;c>=0;c--)if(a(this[c]))return c;return-1},first:function(a){var b=this;if(void 0===a)return b[0];for(var c=0,d=b.length;d>c;c++)if(a(b[c]))return b[c];return null}}),Array.diff=function(a,b,c){var d=c&&c.getKeyFunction||function(a){return a},e=c&&c.results||{oldItems:[],newItems:[],overlapItems:[]},f=a.map(d);if(b.each(function(b){var c=d(b),g=f.indexOf(c);g>-1?(e.overlapItems&&e.overlapItems.push(a[g]),f.splice(g,1)):e.newItems&&e.newItems.push(b)}),e.oldItems){var g=a.filter(function(a){var b=d(a);return f.contains(b)});e.oldItems.append(g)}return e},window.Callbacks=new Class({setCallbacks:function(a){if(Uverse.console.enabled){var b=[];if(this.callbacks){var c=Object.keys(a||{}),d=[];for(var e in this.callbacks)null!==this.callbacks[e]||a[e]?c.erase(e):d.push(e);d.length&&b.push("[Callbacks]","Required callbacks were not supplied (",d.join(", "),")"),c.length&&(b.push(b.length?", and ":"[Callbacks]"),b.push("Extra callbacks were supplied but not used (",c.join(", "),")"))}else Uverse.console.warn("[Callbacks]",'Could not find "this.callbacks".');b.length&&(Uverse.console.error.apply?Uverse.console.error.apply(Uverse.console,b):Uverse.console.error(b))}this.callbacks=Object.merge({},this.callbacks,a)}}),DOMEvent.implement({getMouseButton:function(){if("which"in this.event)switch(this.event.which){case 3:return"right";case 2:return"middle";case 1:default:return"left"}else switch(this.event.button){case 2:return"right";case 4:return"middle";case 1:case 0:default:return"left"}},isMouseButtonPressed:function(){return"buttons"in this.event?0!==this.event.buttons:"which"in this.event?0!==this.event.which:"button"in this.event?0!==this.event.button:void 0},wasDefaultPrevented:Browser.ie8||Browser.ie7?function(){return this.event.returnValue===!1}:function(){return this.event.$wasDefaultPrevented===!0},getClipboardText:function(){var a=this.event.clipboardData||window.clipboardData;return a?this.event.clipboardData?a.getData("text/plain"):window.clipboardData?a.getData("Text"):void 0:null}}),Browser.mouseMoveReportsWhichButton=!Browser.ie9,Class.refactor(DOMEvent,{preventDefault:Browser.ie8||Browser.ie7?function(){return this.previous()}:function(){return this.event.$wasDefaultPrevented=!0,this.previous()}}),Object.each({button:function(a,b,c){if(a.event.match(/^(click|mouse)/)){var d=c[0],e=d.getMouseButton(),f=a.value.split(" "),g=f.contains(e);if(!g)return}b.apply(this,c)}},function(a,b){DOMEvent.definePseudo(b,a)}),Class.refactor(Date,{format:function(a,b){if(!b)return this.previous(a);var c=this.getUTCForTimezone(b);return c.formatUTC(a)},getTimezone:function(){return(""+this).replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3").replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1")},getTimezoneOffset:function(a){if(a){var b=this,c=a.offset;return a.nextChange&&a.nextChange<=b&&(c=a.nextOffset),-c}return this.previous()},diff:function(a,b,c){if(c){var d=this.getUTCForTimezone(c),e=a.getUTCForTimezone(c);return d.diff(e,b)}return this.previous(a,b)}}),Date.implement({setExact:function(a,b,c){var d=this,e="";c&&(e="utc",d.increment("minute",-d.getTimezoneOffset(c)));var f=!1;return["milliseconds","seconds","minutes","hours","date","month","fullyear"].some(function(c){return c===a?(d.set(e+c,b),f=!0,!0):void d.set(e+c,"date"===c?1:0)}),f||Uverse.console.error("[Date]","Invalid Units ",a,", please make sure you spelled it correctly."),c&&d.increment("minute",d.getTimezoneOffset(c)),this},getLocalTimeFromTimezone:function(a){var b=this.getUTCForTimezone(a);return b.increment("minute",b.getTimezoneOffset()),b},getUTCForTimezone:function(a){var b=new Date(this);return b.increment("minute",-b.getTimezoneOffset(a)),b},isMidnight:function(a){var b=this;if(a){var c=b.getUTCForTimezone(a);return!(c.getUTCHours()||c.getUTCMinutes()||c.getUTCSeconds())}return!(b.getHours()||b.getMinutes()||b.getSeconds())},getMidnight:function(a){var b=new Date(this).setExact("hours",0,a);return b}}),["UTCAMPM"].each(function(a){Date.Methods[a.toLowerCase()]=a}),Date.implement({formatUTC:function(a){var b=function(a,c,d){return 1==c?a:a<Math.pow(10,c-1)?(d||"0")+b(a,c-1,d):a},c=this;return a.replace(/%([a-z%])/gi,function(a,d){switch(d){case"a":return Date.getMsg("days_abbr")[c.get("utcday")];case"A":return Date.getMsg("days")[c.get("utcday")];case"b":return Date.getMsg("months_abbr")[c.get("utcmonth")];case"B":return Date.getMsg("months")[c.get("utcmonth")];case"c":return c.formatUTC("%a %b %d %H:%M:%S %Y");case"d":return b(c.get("utcdate"),2);case"e":return b(c.get("utcdate"),2," ");case"H":return b(c.get("utchours"),2);case"I":return b(c.get("utchours")%12||12,2);case"j":return b(c.get("utcdayofyear"),3);case"k":return b(c.get("utchours"),2," ");case"l":return b(c.get("utchours")%12||12,2," ");case"L":return b(c.get("utcmilliseconds"),3);case"m":return b(c.get("utcmonth")+1,2);case"M":return b(c.get("utcminutes"),2);case"o":return c.get("utcordinal");case"p":return Date.getMsg(c.get("utcampm"));case"s":return Math.round(c/1e3);case"S":return b(c.get("utcseconds"),2);case"T":return c.formatUTC("%H:%M:%S");case"U":return b(c.get("utcweek"),2);case"w":return c.get("utcday");case"x":return c.formatUTC(Date.getMsg("shortDate"));case"X":return c.formatUTC(Date.getMsg("shortTime"));case"y":return(""+c.get("utcfullyear")).substr(2);case"Y":return c.get("utcfullyear");case"z":return c.get("GMTOffset");
case"Z":return c.get("Timezone");case"f":return c.get("utcdate");case"n":return c.get("utcmonth")+1}return d})},getUTCAMPM:function(){return this.get("utchours")<12?"AM":"PM"}});var Deferred=new Class({_resolvedArgs:null,_rejectedArgs:null,_thenCallbacks:null,_failCallbacks:null,resolve:function(a){return this._resolvedArgs=Array.slice(arguments),this._thenCallbacks&&(this._thenCallbacks.each(function(a){a.apply(this,this._resolvedArgs)},this),this._thenCallbacks=null,this._failCallbacks=null),this},reject:function(a){return this._rejectedArgs=Array.slice(arguments),this._failCallbacks&&(this._failCallbacks.each(function(a){a.apply(this,this._rejectedArgs)},this),this._thenCallbacks=null,this._failCallbacks=null),this},then:function(a){return this._resolvedArgs?a.apply(this,this._resolvedArgs):this._rejectedArgs||(this._thenCallbacks||(this._thenCallbacks=[]),this._thenCallbacks.push(a)),this},fail:function(a){return this._resolvedArgs||(this._rejectedArgs?a.apply(this,this._rejectedArgs):(this._failCallbacks||(this._failCallbacks=[]),this._failCallbacks.push(a))),this},always:function(a){return this.then(a).fail(a)},forget:function(a){return this._thenCallbacks&&this._thenCallbacks.erase(a),this._failCallbacks&&this._failCallbacks.erase(a),this}}).extend({from:function(a){return a instanceof Deferred||(a=(new Deferred).resolve(a)),a},delay:function(a,b){var c=new Deferred;return void 0===b&&(b=[]),setTimeout(c.resolve.pass(b,c),a),c}}),DeferredList=new Class({Extends:Deferred,_deferreds:null,initialize:function(a){this._deferreds=Array.map(arguments,Deferred.from)},then:function(a){if(!this._setupThen){this._setupThen=!0;var b=this,c=this._deferreds.clone(),d=null,e=function(){null===d?d=[]:d.append(arguments),c.length?c.shift().then(e):b.resolve.apply(b,d)};e()}return this.parent(a)},fail:function(a){if(!this._setupFail){this._setupFail=!0;var b=this,c=!1;this._deferreds.each(function(a){a.fail(function(){c||(c=!0,b.reject.apply(b,arguments))})})}return this.parent(a)}});Fx.implement({promise:function(){var a=this,b=new Deferred;if(a.isRunning()){var c={complete:function(){a.removeEvents(c),b.resolve.apply(b,arguments)},cancel:function(){a.removeEvents(c),b.reject.apply(b,arguments)}};a.addEvents(c)}else b.resolve();return b}}),Request.implement({promise:function(){var a=this,b=new Deferred;if(a.isRunning()){var c={success:function(){a.removeEvents(c),b.resolve.apply(b,arguments)},failure:function(){a.removeEvents(c),b.reject.apply(b,arguments)},cancel:function(){a.removeEvents(c),b.reject.apply(b,arguments)}};a.addEvents(c)}else b.resolve();return b}}),Element.extend({mergeInputValues:function(a,b){return Array.each(arguments,function(b,c){if(0!==c)for(var d in b)a[d]=d in a?Array.append(Array.from(a[d]),Array.from(b[d])):b[d]}),a}}),Element.implement({serializeInputs:function(){var a={};return this.getElements("input, select, textarea").each(function(b){var c=b.type;if(b.name&&!b.disabled&&"submit"!=c&&"reset"!=c&&"file"!=c&&"image"!=c){var d=b.serializeInput();Element.mergeInputValues(a,d)}}),a},serializeInput:function(){var a=this,b=a.type,c={};if(!a.name||"reset"==b||"file"==b)return c;var d="select"==a.get("tag")?a.getSelected().map(function(a){return document.id(a).get("value")}):"radio"!=b&&"checkbox"!=b||a.checked?[a.get("value")]:[];return d.length&&(c[a.name]=1===d.length?d[0]:d),c},deserializeInputs:function(a,b){this.getElements("input, select, textarea").each(function(c){c.deserializeInput(a,b)})},deserializeInput:function(a,b){var c=this,d=c.type;if(c.name&&"submit"!==d&&"reset"!==d&&"file"!==d&&"image"!==d&&(c.name in a||b)){var e=a[c.name];if("object"===typeOf(e)&&(e=Object.values(e)),e=Array.from(e),"select"===c.get("tag")){var f=c.getElements("option"),g=!1;f.each(function(a){var b=a.get("value"),c=e.contains(b);a.selected=c,c&&(g=!0)}),g||!f.length||c.multiple||(f[0].selected=!0)}else if("radio"===d||"checkbox"===d){var h=c.get("value");c.checked=e.contains(h)||e.contains(!0)}else c.set("value",e.join(""));c.store("lastValue",e.join(""))}},getClosest:function(a){for(var b=this;b&&!b.match(a);)b=b.getParent();return b},getScrollParent:function(){for(var a=function(a){var b=a.getStyle("overflow"),c=a.getStyle("overflow-y");return"scroll"===b||"auto"===b||"scroll"===c||"auto"===c},b=this;b&&!a(b);)b=b.getParent();return null==b||b===document.body||b===document.html?window:b},getOffsetTop:function(){for(var a=this,b=0;null!=a;)b+=a.offsetTop,a=a.offsetParent;return b},selectAll:function(){var a=this,b=a.get("value");a.selectRange(0,b&&b.length||0)},morphChain:function(a,b){b=b||this;var c=this.get("morph");return c.isRunning()?c.chain(function(){a.call(b),c.callChain()}):a.call(b),this},appendChildren:function(){var a=this,b,c=Array.flatten(arguments),d=c.length;d>1&&(a=b=document.createDocumentFragment());for(var e=0;d>e;e++){var f=c[e];a.appendChild(f)}return b&&this.appendChild(b),this}}),Class.refactor(Element,{fade:function(a,b){return b&&this.set("tween",{transition:b}),this.previous(a)}}),function(){function a(a,c,d,e,f){return Object.each(a,function(a,g){e=function(e){return function(){var h=new Elements(c.getElements(g).flatten());a=b(a),f&&(a=Object.append(f,a)),h.transition(a,e,d)}}(e)}),e}function b(a){switch(typeOf(a)){case"string":a={props:[a]};break;case"array":a={props:a}}return a}function c(a,b){b.each(function(b){a.setStyle(b,null)})}Element.implement({transition:function(a,b,c){var d=new Elements([this]);return d.transition(a,b,c),this}}),Elements.implement({transition:function(d,e,f){if(f=f||this,d=b(d),!d)return e.call(f),this;var g=this,h=null;(d.transition||d.duration)&&(h={},d.transition&&(h.transition=d.transition),d.duration&&(h.duration=d.duration),g.set("morph",h)),d.elements&&(e=a(d.elements,g,f,e,h));var i=d.props;if(!i||!i.length)return e.call(f),this;var j=Browser.ie8,k=[];return g.each(function(a){var b={};i.each(function(c){b[c]=a.getStyle(c)}),j&&1===b.opacity&&(b.opacity=.99),c(a,i),k.push(b)}),e.call(f),g.each(function(a,b){var e=k[b],f={},g=!0;i.each(function(b){var c=a.getStyle(b);e[b]!==c&&(f[b]=[e[b],c],g=!1)}),g?d.ifEmptyCallChain?a.get("morph").callChain():a.get("morph").cancel():(a.setStyles(e),a.morph(f),d.keepStylesWhenDone||a.get("morph").chain(function(){c(a,i),this.callChain()}))}),this}})}(),function(){this.Form||(this.Form={});var a="placeholder"in document.createElement("input");return"supportsPlaceholder"in this||this.supportsPlaceholder===!1||!a?(this.Form.Placeholder=new Class({Implements:Options,options:{placeholderClass:"has-placeholder",clearOnSubmit:!0},initialize:function(a,b){this.setOptions(b),this.element=$(a),this.placeholder=this.element.get("placeholder"),this.is_password="password"==this.element.get("type")?!0:!1,this.activatePlaceholder(),this.element.addEvents({focus:this.deactivatePlaceholder.bind(this),blur:this.activatePlaceholder.bind(this)}),this.element.getParent("form")&&this.options.clearOnSubmit&&this.element.getParent("form").addEvent("submit",function(a){this.element.get("value")==this.placeholder&&this.element.set("value","")}.bind(this))},activatePlaceholder:function(){""===this.element.get("value")&&(this.is_password&&this.element.set("type","text"),this.element.addClass(this.options.placeholderClass),this.element.set("value",this.placeholder))},deactivatePlaceholder:function(){""===this.element.get("value")&&(this.is_password&&this.element.set("type","password"),this.element.set("value",""),this.element.removeClass(this.options.placeholderClass))}}),void Class.refactor(Element,{get:function(a){var b=this.previous(a);return"value"===a&&""!==b&&this.match("input[placeholder]")&&b===this.get("placeholder")&&(b=""),b}})):void(this.Form.Placeholder=new Class({}))}(),Function.implement({pause:function(a,b){var c=this,d;return function(){clearTimeout(d),d=c.delay(a||250,b,arguments)}},pace:function(a,b){var c=this,d,e;return function(){d?e=arguments:(c.apply(b,arguments),e=null,d=setInterval(function(){null==e?d=clearInterval(d):(c.apply(b,e),e=null)},a||250))}},bindAndPassThis:function(a){var b=this;return function(){var c=Array.from(arguments);return c.unshift(this),b.apply(a,c)}}}),Fx.implement({options:{transition:"quint:out",link:"cancel"}}),Fx.implement({onFrame:function(a){this.$originalSet||(this.$originalSet=this.set),this.set=a?function(){a(),this.$originalSet.apply(this,arguments)}:this.$originalSet},queue:function(a,b){var c=this;return c.isRunning()?c.chain(function(){a.call(b||c),c.callChain()}):a.call(b||c),this}}),window.MemoryEvents=new Class({$memoryEvents:new Events,$memoryEventArgs:{},addMemoryEvent:function(a,b){var c=a;-1!=c.indexOf(":")&&(c=c.substr(0,c.indexOf(":")));var d=this.$memoryEventArgs[c];if(d){var e=new Events;e.addEvent(a,b),e.fireEvent(c,d);var f=this.$memoryEvents;Object.each(e.$events,function(a,b){var c=f.$events[b];c?a.each(function(a){c.push(a)}):f.$events[b]=a})}else this.$memoryEvents.addEvent(a,b)},addMemoryEvents:function(a){for(var b in a)this.addMemoryEvent(b,a[b])},fireMemoryEvent:function(a,b){b=Array.from(b),this.$memoryEventArgs[a]=b,this.$memoryEvents.fireEvent(a,b)},removeMemoryEvent:function(a,b){this.$memoryEvents.removeEvent(a,b)},clearMemoryEvent:function(a){delete this.$memoryEventArgs[a]}}),Object.extend({toQueryStringFlat:function(a,b){var c=[];return Object.each(a,function(a,d){if(null!=a){b&&(d=b+"."+d);var e;switch(typeOf(a)){case"object":e=Object.toQueryStringFlat(a,d);break;case"array":return void a.each(function(a,b){e=d+"="+encodeURIComponent(a),c.push(e)});default:e=d+"="+encodeURIComponent(a)}c.push(e)}}),c.join("&")},diff:function(a,b,c){var d=c&&c.results||{diffOld:{},diffNew:{},overlapOld:{},overlapNew:{}};return d.diffOld&&Object.append(d.diffOld,a),Object.each(b,function(b,c){c in a?(d.diffOld&&delete d.diffOld[c],d.overlapOld&&(d.overlapOld[c]=a[c]),d.overlapNew&&(d.overlapNew[c]=b)):d.diffNew&&(d.diffNew[c]=b)}),d},areEqual:function(a,b){return a===b||JSON.encode(a)===JSON.encode(b)}}),window.OptionsFromAttributes=new Class({Extends:Options,setOptionsFromAttributes:function(a){return this.setOptions(this.getOptionsFromAttributes(a))},getOptionsFromAttributes:function(a){a=Object.append({source:this.el,options:this.options,map:null},a);var b=a.source,c=a.options,d=a.map;if(!d){d={};for(var e in c)d[e]="data-"+e.hyphenate()}var f={};return Object.each(d,function(a,c){var d=b.get(a);null!==d&&(f[c]=d)}),f}}),Request.HTMLDeferred=new Class({Extends:Request.HTML,deferredResultsEnabled:!1,deferredResults:null,success:function(a){this.deferredResultsEnabled?this.deferredResults=a:this.parent(a)},deferResults:function(a){if(this.deferredResultsEnabled=a,!a&&null!==this.deferredResults){var b=this.deferredResults;this.deferredResults=null,this.success(b)}}}),Request.CrossDomain=new Class({Extends:Request,initialize:function(a){this.parent(a),delete this.headers["X-Requested-With"];var b="withCredentials"in this.xhr,c="undefined"!=typeof XDomainRequest;!b&&c&&(Uverse.console.log("[Request.CrossDomain]","Using XDomainRequest"),this.xhr=new XDomainRequest,this.xhr.onload=this._onLoad.bind(this),this.xhr.onerror=this._onError.bind(this),Object.each(this.headers,function(a,b){Uverse.console.error("[Request.CrossDomain]","Custom headers are not supported by XDomainRequest!",b,a)}))},_onLoad:function(){this.xhr.readyState=4,this.xhr.status=200,this.onStateChange()},_onError:function(){this.xhr.readyState=4,this.xhr.status=500,this.onStateChange()}}),Request.implement({options:{autoRetry:!1,autoRetryOptions:{retryMax:Number.MAX_VALUE,retryDelay:1e4,statusCodes:["unknown",502,503,504]}}}),Class.refactor(Request,{send:function(a){return this.check(a)?(this.options.autoRetry&&(this.autoRetryArgs=Array.slice(arguments),this.autoRetryTimer=null),this.previous.apply(this,arguments)):this},cancel:function(){return this.options.autoRetry&&(this.autoRetryCount=0,this.autoRetryArgs=null,this.autoRetryTimer&&(Uverse.console.log("[Request]","Auto Retry Cancelled"),clearTimeout(this.autoRetryTimer),this.autoRetryTimer=null)),this.previous.apply(this,arguments)},failure:function(){if(this.options.autoRetry){var a=this.options.autoRetryOptions,b=this.status;(100>b||b>599)&&(b="unknown");var c=a.statusCodes.contains(b);if(c){var d=this.autoRetryCount&&this.autoRetryCount>=a.retryMax;if(!d)return this.autoRetryCount=(this.autoRetryCount||0)+1,Uverse.console.warn("[Request]","Request failed (Code: ",this.status,") - Auto retry #",this.autoRetryCount," in ",a.retryDelay),this.fireEvent("autoRetry",this.autoRetryArgs),void(this.autoRetryTimer=setTimeout(this.send.pass(this.autoRetryArgs,this),a.retryDelay));this.autoRetryCount=0,Uverse.console.warn("[Request]","Request failed (Code: ",this.status,") - Retry limit exceeded; failing request")}}this.previous()},success:function(){return this.options.autoRetry&&(this.autoRetryCount=0,this.autoRetryArgs&&(Uverse.console.log("[Request]","Auto Retry Successful!"),this.autoRetryArgs=null)),this.previous.apply(this,arguments)}}),window.Timers=new Class({setTimer:function(a,b){Uverse.console.assert(b.timeout||b.interval,"Must supply either a 'timeout' or an 'interval'.");var c=b.alias||a;this.clearTimers(c),this.$timers||(this.$timers={methods:[],clearTimers:[],options:[]});var d=a.pass(b.args,b.bind||this),e;if(b.timeout){var f=setTimeout(function(){this.clearTimer(c),d()}.bind(this),b.timeout);e=function(){clearTimeout(f)}}else if(b.interval){var g=setInterval(d,b.interval);e=function(){clearInterval(g)}}this.$timers.methods.push(c),this.$timers.clearTimers.push(e),this.$timers.options.push(b)},clearTimer:function(a){this.clearTimers(a)},clearTimers:function(a){if(this.$timers){var b=arguments.length?arguments:this.$timers.methods.slice(0);Array.each(b,function(a){var b=this.$timers.methods.indexOf(a);if(-1!==b){var c=this.$timers.clearTimers[b];this.$timers.methods.splice(b,1),this.$timers.clearTimers.splice(b,1),this.$timers.options.splice(b,1),c&&c()}},this)}},resetTimer:function(a){if(this.hasTimer(a)){var b=this.$timers.methods.indexOf(a),c=this.$timers.options[b];this.clearTimer(a),this.setTimer(a,c)}},hasTimer:function(a){return!(!this.$timers||!this.$timers.methods.contains(a))}}),function(){function a(a,b){var d=k(a);a.store("lastValue",d);var i=e(a);c(a,i.normal,f),c(a,i.delayed,g),c(a,i.radio,h)}function b(a,b){a.eliminate("lastValue");var c=e(a);d(a,c.normal,f),d(a,c.delayed,g),d(a,c.radio,h)}function c(a,b,c){b.each(function(b){a.addEvent(b,c)})}function d(a,b,c){b.each(function(b){a.removeEvent(b,c)})}function e(a){var b=a.get("tag"),c=a.get("type"),d={normal:[],delayed:[],radio:[]};return"select"===b?d.normal.push("change","keyup","click"):"textarea"===b||"text"==c||"password"==c?(d.normal.push("change","keyup","blur"),d.delayed.push("cut","paste","input")):"checkbox"==c?d.normal.push("change","click"):"radio"==c?d.radio.push("change"):d.normal.push("change"),d}function f(a){j.apply(this,[a])}function g(a){j.delay(25,this,[a])}function h(a){var b=this,c=i(b);c.each(function(b){j.apply(b,[a])})}function i(a){var b=a.getParent("form")||document.body,c=b.getElements('input[type=radio][name="'+a.name+'"]');return c}function j(a){var b=this,c=k(b),d=b.retrieve("lastValue");c!==d&&(b.store("lastValue",c),b.fireEvent("changing",[a,b,c,d]))}function k(a){var b="select"==a.get("tag")?a.getSelected().map(function(a){return document.id(a).get("value")}):"radio"!=a.type&&"checkbox"!=a.type||a.checked?[a.get("value")]:[null];return b.join("|")}Object.append(Element.Events,{changing:{onAdd:function(b){a(this,b)},onRemove:function(a){b(this,a)}}})}(),function(){function a(a,c){var e=a.retrieve("scrollingOptions");e&&!e.persistOptions&&a.eliminate("scrollingOptions");var f=a.getScrollParent(),g=f.retrieve("$scrollWatcher",{initialized:!1});g.initialized===!1&&(Object.merge(g,{initialized:!0,watched:[],lastBottom:0,onScroll:function(){d(f)},onResize:function(){d(f)}}),f.addEvent("scroll:pace(100)",g.onScroll),window.addEvent("resize:pace(100)",g.onResize)),b(g,a,c,e)}function b(a,b,c,d){for(var e=null,f=0;f<a.watched.length;f++){var g=a.watched[f];if(g.el===b&&g.scrollingOptions===d){e=g;break}}null==e&&(e={el:b,scrollingOptions:d,lastPosition:"",handlers:[]},a.watched.push(e)),e.handlers.push(c)}function c(a,b){var c=a.getScrollParent(),d=c.retrieve("$scrollWatcher");if(d)for(var e=0,f=d.watched.length;f>e;e++){var g=d.watched[e];g.el===a&&g.handlers.erase(b)}}function d(a){var b=a.retrieve("$scrollWatcher");if(b){var c=f(a),d=c.bottom>=b.lastBottom?"up":"down";b.lastBottom=c.bottom;for(var e=0,h=b.watched.length;h>e;e++){var l=b.watched[e],m=g(l.el,a,l.scrollingOptions),n=i(c,m);if(l.lastPosition!==n){var o=j(l.lastPosition,n);k(l,[o,d,n,l.lastPosition]),l.lastPosition=n}}}}function e(a,b){var c=a.getScrollParent(),e=c.retrieve("$scrollWatcher");if(e)for(var h=0;h<e.watched.length;h++){var j=e.watched[h];if(j.el===a&&j.scrollingOptions===b)return d(c),j.lastPosition}var k=f(c),l=g(a,c,b),m=i(k,l);return m}function f(a){var b=a.getScrollTop(),c=b+a.getHeight();return{top:b,bottom:c}}function g(a,b,c){var d=h(a,b),e=d+a.getHeight();return c&&c.distance&&(c.distance.top&&(d-=c.distance.top),c.distance.bottom&&(e+=c.distance.bottom)),{top:d,bottom:e}}function h(a,b){if(b===window)return a.getOffsets().y;for(var c=0;a&&a!==b;)c+=a.offsetTop,a=a.getOffsetParent();return!a&&window.console&&window.console.warn&&window.console.warn("[event.scrolling]","Could not find the correct relative parent."),c}function i(a,b){return b.bottom<a.top?"above":b.top>a.bottom?"below":b.top<a.top?b.bottom>a.bottom?"inside":"top":b.bottom>a.bottom?"bottom":"inside"}function j(a,b){if(b===a||""===a)return[];b=m[b],a=m[a];for(var c=a>b?-1:1,d=[],e=a,f=b;e!=f;e+=c){var g=c>0?e:n.length-e;d.push(n[g])}return d}function k(a,b){for(var c=0,d=a.handlers.length;d>c;c++){var e=a.handlers[c];e.apply(a.el,b)}}function l(a,b,c){for(var d=0,e=a.length;e>1;){var f=Math.floor(e/2),g=c(a[d+f]);g>b?e=f:(d+=f,e-=f)}return d}Object.append(Element.Events,{scrolling:{onAdd:function(b){a(this,b)},onRemove:function(a){c(this,a)}}}),Object.each({action:function(a,b,c){if("scrolling"===a.event){var d=c[0],e=a.value.split(" "),f=d.some(function(a){return e.contains(a)});if(!f)return}b.apply(this,c)},direction:function(a,b,c){if("scrolling"===a.event){var d=c[1];if(a.value!==d)return}b.apply(this,c)},position:function(a,b,c){if("scrolling"===a.event){var d=c[2],e=a.value.split(" ");if(!e.contains(d))return}b.apply(this,c)}},function(a,b){DOMEvent.definePseudo(b,a)}),Element.implement({getScrollingPosition:function(a){return e(this,a)}});var m={above:4,top:3,inside:2,bottom:1,below:0},n=["scrollingIn","scrolledIn","scrollingOut","scrolledOut"]}();var Bugs={tests:[],runTest:function(a){this.tests.push(a),a.call(this,this)},runTestsAgain:function(){var a={};return this.tests.each(function(b){b.call(a,a)}),a}};!function(){var a="background-position",b="backgroundPosition",c=b+"X",d=b+"Y";Bugs.runTest(function(b){var c=new Element("div"),d=c.getStyle(a),e=c.setStyle(a,null).getStyle(a);b.failsToResetBackgroundPosition=d!==e,b.failsToReadCSSBackgroundPosition=b.failsToResetBackgroundPosition}),Bugs.failsToResetBackgroundPosition&&Class.refactor(Element,{setStyle:function(e,f){return f||e!==a&&e!==b?this.previous(e,f):(this.previous(c,f),this.previous(d,f))}}),Bugs.failsToReadCSSBackgroundPosition&&Class.refactor(Element,{getStyle:function(e){var f=this.previous(e);if(!f&&(e===a||e===b)){var g=this.previous(c),h=this.previous(d);g&&h&&(f=g+" "+h)}return f}})}(),function(){Bugs.runTest(function(a){var b=Object.hasOwnProperty.call(window,"ActiveXObject")&&!window.ActiveXObject&&"unknown"===Browser.name;"ie"!=Browser.name&&b&&(a.failsToDetectIE11=!0)}),Bugs.failsToDetectIE11&&(Browser.name="ie",Browser.version=11,Browser.ie11=!0,Browser.ie=!0)}(),function(){if(window.console){var a=Bugs.runTestsAgain(),b=[],c=[];Object.each(a,function(a,d){var e=Bugs[d];e&&(a?c.push(d):b.push(d))}),b.length,c.length&&window.console.error("[mootools.Bugs]","The following bugs were NOT fixed: ",c.join(", "))}}(),function(){function a(a,b,c){if(b._throttled)b._throttledArgs=c,b._throttledCount+=1;else{var d=this;b.apply(d,c),b._throttledArgs=null,b._throttledCount=0,b._throttled=setInterval(function(){0===b._throttledCount?(clearInterval(b._throttled),b._throttled=!1):(b.apply(d,b._throttledArgs),b._throttledArgs=null,b._throttledCount=0)},a.value||250)}}Events.definePseudo("pace",a),DOMEvent.definePseudo("pace",a)}(),window.addEvent("domready",function(){$(document).getElements(".cloak").removeClass("cloak");var a=Uverse.config.pageOptions;Uverse.page=new Uverse.PageControl(a),Uverse.page.initializePageObjects();var b=Uverse.loader.processQueue();b.load(),Uverse.loadedWidgets=b}),Uverse.Loader=new Class({queuedModules:[],loadedModules:[],modelData:{},initialize:function(){},load:function(a){var b=a.loadOptions||{},c=this._isModuleLoadErrorOrReturnElement(a.id);if(c){var module={loadOptions:b,name:a.moduleName,element:c,options:a.options};this.queuedModules.push(module)}},processQueue:function(a){var b=a&&a.preventLazyLoad,c=this.queuedModules.map(function(module){try{return this._createModuleObjOrLoadScriptAndCreateModuleObj(module.loadOptions,module.name,module.element,module.options,b)}catch(a){return Uverse.console.throwAway(a),null}},this);return this.queuedModules.empty(),this.loadedModules.empty(),new Uverse.utils.LoadableList(c)},storeModelData:function(a,b){a in this.modelData&&Uverse.console.error("[Loader]","storeModelData should use unique keys!",a,b),this.modelData[a]=b},retrieveModelData:function(a){return this.modelData[a]},eliminateModelData:function(a){delete this.modelData[a]},_createModuleObjOrLoadScriptAndCreateModuleObj:function(a,b,c,d,e){var f=b.split("."),g=this._createConstructorFromPackages(f);return g?(this._warnIfLazyLoadableScript(a,b,c),this._createModuleObj(g,c,d)):(this._warnIfNotLazyLoadableScript(a,b,c,e),this._lazyLoadScriptAndCreateModuleObj(f,c,d))},_lazyLoadScriptAndCreateModuleObj:function(a,b,c){var d=Uverse.config.scriptPath+a.join("/")+".js?cache="+Uverse.config.buildVersion,e={request:null,widget:null};return e.request=Asset.javascript(d,{onLoad:function(){var d=this._createConstructorFromPackages(a);e.widget=this._createModuleObj(d,b,c)}.bind(this)}),e},_warnIfNotLazyLoadableScript:function(a,b,c,d){a.lazyLoadAllowed?d&&Uverse.console.error("[Loader]","Lazy Loading is not allowed for Modal contents!"):Uverse.console.error("[Loader]","Lazy Loading is not allowed for this module ("+b+" for element: "+c.id+"). Please permanently add the module to the compiled script.")},_warnIfLazyLoadableScript:function(a,b,c){a.lazyLoadAllowed&&Uverse.console.error("[Loader]","Lazy Loading has been configured for this module ("+b+" for element: "+c.id+") but it's already compiled into the script")},_createModuleObj:function(a,b,c){return new a(b,c)},_createConstructorFromPackages:function(a){var b=window;try{return a.each(function(a){b=b[a]}),b}catch(c){throw Error("The package name ("+a.join(".")+") does not exist.")}},_isModuleLoadErrorOrReturnElement:function(a){var b=$(a);return this._isModuleAlreadyInitialized(a)||!this._doesModuleExistInDom(b,a)?null:(this.loadedModules.push(a),b)},_isModuleAlreadyInitialized:function(a){return this.loadedModules.contains(a)?(Uverse.console.error("[Loader]","Class for element ("+a+") has already been initialized. There are duplicate IDs."),!0):!1},_doesModuleExistInDom:function(a,b){return a?!0:(Uverse.console.error("[Loader]","Element (id: "+b+") does not exist in DOM"),!1)}}),Uverse.loader=new Uverse.Loader,Uverse.load=Uverse.loader.load.bind(Uverse.loader),Uverse.PageControl=new Class({Implements:[Options,MemoryEvents],options:{pageContainerId:null,modalManagerOptions:{modalContainerId:null,modalShadowId:null},pageWidthOptions:null},constantsCache:{},personalization:null,elves:null,dvr:null,favorite:null,notification:null,unsupportedBrowsers:null,clickTracking:null,playerModalManager:null,deepLink:null,history:null,toast:null,pageBlocker:null,liveTileExpire:null,userAgentDetection:null,liveEntitlement:null,digitalSmithsAPI:null,memoryEventDependencies:{},templates:{},templateIds:["notificationsModal","parentalControlsModal","tvNotesModal","tabletAppIntegrationModal","livePluginHelpModal","networkConnectionHelpModal","incompatibleInHomeLiveChannelsModal","livePlayerPluginRequirementsModal","configureLivePlayerPluginConfirmationModal","advancedOptionsModal","livePlayerPluginNoJavaModal","autoAuthenticationLearnMoreModal"],initialize:function(a){this.setOptions(a)},initializePageObjects:function(){this._createPersonalization(),this._createBookmarks(),this._createDvr(),this._createFavorites(),this._createNotification(),this._addWebtrends(),this._addForesee(),this._addGoogleAnalytics(),this._addAdobeAnalytics(),this._addComScore(),this._createClickTracking(),this._createPlayerModalManager(),this._addPlaceholders(),this._setupTemplates(),this._setupPageContainer(),this._setupPlayerLoader(),this._setupDeepLink(),this._setupHistory(),this._setupToast(),this._setupPageBlocker(),this._createUnsupportedBrowsersDetection(),this._setupUserAgentDetection(),this._addATTEcommerce()},_addPlaceholders:function(){var a="placeholder"in document.createElement("input");a||(Uverse.console.log("[PageControl]","Adding support for placeholders"),Object.each($$("input[placeholder]"),function(a){try{new Form.Placeholder(a)}catch(b){Uverse.console.log("[PageControl]","Could not add placeholder for "+a)}}))},_setupTemplates:function(){Array.each(this.templateIds,function(a){var b=$(a);this.templates[a]=b,b?b.dispose():Uverse.console.error("[PageControl]","Could not find the required template:",a)},this)},_setupPageContainer:function(){var a=this.options.pageContainerId,b=this.options.pageWidthOptions;new Uverse.widgets.PageWidth(a,b)},_createPersonalization:function(){this.personalization=new Uverse.utils.Personalization({userDataComplete:this._onPersonalizationUserDataComplete.bind(this),uverseDataComplete:this._onPersonalizationUverseDataComplete.bind(this)})},_onPersonalizationUserDataComplete:function(){var a=this.personalization.userData;this._processCommonLocalization(),this._updateBodyClassesForUser(a),this.fireMemoryEvent("Personalization-userData",a),this._addGoogleAnalyticsPersonalizationData(a)},_updateBodyClassesForUser:function(a){var b=a.isLoggedIn(),c=a.isUverse();document.body.toggleClass("is-logged-in",b).toggleClass("not-logged-in",!b).toggleClass("is-uverse-user",c).toggleClass("not-uverse-user",!c)},_onPersonalizationUverseDataComplete:function(){this._fireUverseDataLoggedInEvents(),this.fireMemoryEvent("Personalization-uverseData",this.personalization.uverseData),this.fireMemoryEvent("Notification-showList"),this.fireMemoryEvent("Notification-userEmail"),this.fireMemoryEvent("Favorite-assetList"),this.fireMemoryEvent("Bookmarks-ready")},_createBookmarks:function(){this.bookmarks=new Uverse.utils.BookmarksAPI},getVideoBookmark:function(a){return this.personalization.getVideoBookmark(a)},setVideoBookmark:function(a,b){this.personalization.setVideoBookmark(a,b),this.fireMemoryEvent("Bookmarks-ready")},_fireUverseDataLoggedInEvents:function(){this.personalization.isLoggedIn()&&this._fireDvrEvent()},isUserLoggedIn:function(){return this.personalization.isLoggedIn()},isUverseUser:function(){return this.personalization.isUverseUser()},getPersonalizationData:function(a){return this.personalization.getPersonalizationData(a)},_fireDvrEvent:function(){this.fireMemoryEvent("Personalization-dvr")},_createDvr:function(){this.dvr=new Uverse.utils.DvrAPI},_createFavorites:function(){this.favorites=new Uverse.utils.FavoriteAPI},getFavoriteStateForItem:function(a){return this.favorites.getFavoriteStateForItem(a)},favoriteAddItem:function(a){this.personalization.favoriteAddItem(a),this.fireMemoryEvent("Favorite-assetList")},favoriteRemoveItem:function(a){this.personalization.favoriteRemoveItem(a),this.fireMemoryEvent("Favorite-assetList")},updateUserSetting:function(a,b){this.personalization.setPersonalizationData(a,b),this.fireMemoryEvent("Personalization-uverseData",this.personalization.uverseData)},_createNotification:function(){this.notification=new Uverse.utils.NotificationAPI},getNotificationStateForItem:function(a){return this.notification.getNotificationStateForItem(a)},getNotificationUserEmail:function(){return this.notification.getUserEmail()},notificationUserEmailChanged:function(a){this.personalization.setNotificationUserEmail(a),this.fireMemoryEvent("Notification-userEmail")},notificationAddCategoryPath:function(a){this.personalization.notificationAddCategoryPath(a),this.fireMemoryEvent("Notification-showList")},_processCommonLocalization:function(){new Uverse.utils.CommonLocalization({userZip:this.personalization.getUserZip()})},getUserEntitlement:function(){return this.personalization.getUserEntitlement()},isLoggedIn:function(){return this.personalization.isLoggedIn()},isDSL:function(){return this.personalization.isDSL()},_addWebtrends:function(){Uverse.config.webtrends&&new Uverse.utils.WebtrendsAPI},_addForesee:function(){var a=Uverse.config.foresee;a&&new Uverse.utils.ForeseeAPI},splashScreenIsDone:function(a){var b=Uverse.config.foresee;b&&!a&&new Uverse.utils.ForeseeAPI},_addGoogleAnalytics:function(){Uverse.config.google_analytics&&(this.googleAnalytics=new Uverse.utils.GoogleAnalyticsAPI)},googleAnalyticsPush:function(a,b){Uverse.config.google_analytics&&this.googleAnalytics.api(a,b)},_addGoogleAnalyticsPersonalizationData:function(a){this.googleAnalyticsPush("_setCustomVar",[1,"User Type",a.isLoggedIn?a.isUverse()?"Uverse User":"Non-Uverse User":"Non-User",2]),this.googleAnalyticsPush("_setCustomVar",[2,"HSIA User",a.isHSIA()?"HSIA User":"Non-HSIA User",1]),this.googleAnalyticsPush("_setDomainName",["none"]),this.googleAnalyticsPush("_setAllowHash",[!1]),this.googleAnalyticsPush("_trackPageview")},_addAdobeAnalytics:function(){Uverse.config.adobeAnalytics&&new Uverse.utils.AdobeAnalyticsAPI},_addComScore:function(){Uverse.config.comscore&&(this.comScore=new Uverse.utils.ComScoreAPI,this.comScore.pageTag())},_createUnsupportedBrowsersDetection:function(){this.unsupportedBrowsers=new Uverse.utils.UnsupportedBrowsers;var a=Uverse.page.retrieveFromSession(Uverse.config.unsupportedBrowsersToast.cookie);Uverse.page.addMemoryEvent("UnsupportedBrowser",this._userHasUnsupportedBrowser.bind(this)),this.unsupportedBrowsers.unsupportedUserAgent&&!a&&Uverse.page.fireMemoryEvent("UnsupportedBrowser",[this.unsupportedBrowsers.unsupportedUserAgent,this.unsupportedBrowsers.clientUserAgent])},_userHasUnsupportedBrowser:function(a,b){this.unsupportedBrowsers.noToast||Uverse.page.showToast({alert:Uverse.config.unsupportedBrowsersToast.text,message:"",button:{text:Uverse.config.unsupportedBrowsersToast.buttonText,action:a.url},close:{action:function(){Uverse.page.storeToSession(Uverse.config.unsupportedBrowsersToast.cookie,"dismissed")}},timeout:0,display:Uverse.page.getConstant("toast","DISPLAY_TYPE.PUSHDOWN"),closeOnDocumentClick:!1})},_createClickTracking:function(){Uverse.config.clickTracking&&Uverse.config.clickTracking.enable&&(this.clickTracking=new Uverse.utils.ClickTracking)},clickTrack:function(a,b){if(a&&this.clickTracking){var c={callback:function(){},addCategory:null,addSubcategory:null,addAction:null,addLabel:null};this.clickTracking.track(a,Object.merge(c,b))}},updateClickTrackAttribute:function(a,b,c){a&&this.clickTracking&&b&&this.clickTracking.updateAttribute(a,b,c)},getConstant:function(a,b){if(this[a]){if(!this.constantsCache[a+"_"+b]){var c=this._iterateConstantPathToBuildVariable(a,b);this.constantsCache[a+"_"+b]=c}return this.constantsCache[a+"_"+b]}return null},_iterateConstantPathToBuildVariable:function(a,b){var c=b.split("."),d=this[a];return c.each(function(a){d=d[a]}),d},_createPlayerModalManager:function(){var a=this.options.modalManagerOptions,b={modalClosed:this._onModalClosed.bind(this)};this.playerModalManager=new Uverse.widgets.ModalManager(a,b)},_onModalClosed:function(){this.history.historyChanging||this.history.pushToHistory(null),this.fireMemoryEvent("modalClosed")
},loadPlayerModal:function(a){this.playerModalManager.loadModal(a),this.fireMemoryEvent("modalLoaded")},createAndLoadGenericModal:function(a,b){var c={modalClosed:this._onModalClosed.bind(this)},d=Object.merge({},Uverse.page.options.modalManagerOptions,b.managerOptions),e=new Uverse.widgets.GenericModalManager(d,c),f=new Uverse.widgets.GenericModal(a,b.modalOptions);return e.loadModal(f),this._addModalCallbacks(f,b.modalCallbacks),f},_addModalCallbacks:function(a,b){Object.each(b,function(b,c){a.addMemoryEvent(c,b.bind(this,a))})},closeCurrentModal:function(){this.playerModalManager.closeCurrentModal()},_setupPlayerLoader:function(){var a=document.id("playerTemplate");if(a){a.dispose();var b={},c={loadModal:this.loadPlayerModal.bind(this)};this.playerLoader=new Uverse.widgets.PlayerLoader(a,b,c)}},_playVideo:function(a){Uverse.page.addMemoryEvent("Personalization-userData",this._onPersonalization.bind(this,a))},_onPersonalization:function(a,b){this.isIpadTablet()===!0?this._setupTabletAppIntegrationModal():this._playVideoAction(a)},_playVideoAction:function(a){this.playerLoader&&this.playerLoader.playVideo(a),this.fireMemoryEvent("playVideo")},_showDetail:function(a){var b=new Uverse.widgets.epg.ShowDetailsModal(a);Uverse.page.loadPlayerModal(b)},_showParentalControlsSettings:function(){if(Uverse.page.isLoggedIn()){var a=this.templates.parentalControlsModal,b=this.createAndLoadGenericModal(a,{modalOptions:{useLoading:!0},modalCallbacks:{modalLoaded:this._onShowParentalControlsModalComplete.bind(this)}});null!=window.angular&&Uverse.config.parentalControls.newControls&&angular.bootstrap(b.modalContents,["uv"])}},_onShowParentalControlsModalComplete:function(a){new Uverse.widgets.ParentalControlsSettings(a,a.modalManager.modalContents)},_showNotificationsSettings:function(){this.createAndLoadGenericModal(this.templates.notificationsModal,{modalOptions:{useLoading:!0},modalCallbacks:{modalLoaded:this._onShowNotificationsModalComplete.bind(this)}})},_onShowNotificationsModalComplete:function(a){new Uverse.widgets.NotificationsSettings(a,a.modalManager.modalContents)},_showSearchAdvancedOptionsModal:function(){this.createAndLoadGenericModal(this.templates.advancedOptionsModal,{modalOptions:{useLoading:!0},modalCallbacks:{modalLoaded:this._onShowSearchAdvancedOptionsModalComplete.bind(this)}})},_onShowSearchAdvancedOptionsModalComplete:function(a){new Uverse.widgets.AdvancedSearchOptions(a,a.modalManager.modalContents)},showLivePluginHelp:function(a){a=!!a,this.createAndLoadGenericModal(this.templates.livePluginHelpModal,{managerOptions:{showByDeepLink:a},modalOptions:{useLoading:!1,showByDeepLink:a}})},showNetworkConnectionHelp:function(a){this.createAndLoadGenericModal(this.templates.networkConnectionHelpModal,{managerOptions:{showByDeepLink:a},modalOptions:{useLoading:!1,showByDeepLink:a}})},showIncompatibleInHomeLiveChannels:function(a){this.createAndLoadGenericModal(this.templates.incompatibleInHomeLiveChannelsModal,{managerOptions:{showByDeepLink:a},modalOptions:{useLoading:!1,showByDeepLink:a}})},_showAccountMenu:function(a){this.fireMemoryEvent("showAccountMenu",a)},_showTVNoteModal:function(){this.createAndLoadGenericModal(this.templates.tvNotesModal,{modalOptions:{useLoading:!0},modalCallbacks:{modalLoaded:this._onTVNotesLoaded.bind(this)}})},_showAutoAuthenticationModal:function(){var a=this.createAndLoadGenericModal(this.templates.autoAuthenticationLearnMoreModal,{modalOptions:{useLoading:!1}})},_onTVNotesLoaded:function(a){new Uverse.widgets.TVNotes(a,a.modalManager.modalContents)},_setGenre:function(a){this.addMemoryEvent("tileManagerInitialized",function(){this.fireMemoryEvent("setGenre",a)}.bind(this))},_setupDeepLink:function(){var a={deepLinkAction:this._onDeepLinkAction.bind(this)};this.deepLink=new Uverse.utils.DeepLink(a)},_onDeepLinkAction:function(a){switch(a.action){case"playVideo":var b=Object.merge({},a.data,a.historyData);this._playVideo(b);break;case"showDetail":var c=Object.merge({},a.data,a.historyData);this._showDetail(c);break;case"base":this.fireMemoryEvent("deepLinkChange","base"),this._setGenre("");break;case"parentalControlsSettings":this._showParentalControlsSettings();break;case"notificationsSettings":this._showNotificationsSettings();break;case"searchAdvancedOptions":this._showSearchAdvancedOptionsModal();break;case"livePluginHelp":this.showLivePluginHelp(!0);break;case"networkConnectionHelp":this.showNetworkConnectionHelp(!0);break;case"incompatibleInHomeLiveChannels":this.showIncompatibleInHomeLiveChannels(!0);break;case"showAccountMenu":this._showAccountMenu(a.hash);break;case"autoAuthenticationLearnMore":this._showAutoAuthenticationModal();break;case"sendTVNote":this._showTVNoteModal();break;case"genre":this._setGenre(a.data);break;default:Uverse.console.log("[PageControl]","This deep link information does not have a custom handler:",a),this.fireMemoryEvent("Generic_DeepLink",[a])}},_setupHistory:function(){var a={historyChanged:this._onHistoryChanged.bind(this)};this.history=new Uverse.utils.History(a),this.history.checkInitialUrl()},_onHistoryChanged:function(a,b){this.deepLink.processUrlInfo(a,b)},_setupToast:function(){this.toast=new Uverse.widgets.Toast},showToast:function(a){this.toast.showToast(a)},_setupPageBlocker:function(){this.pageBlocker=new Uverse.widgets.PageBlocker},_setupTabletAppIntegrationModal:function(){new Uverse.widgets.TabletAppIntegration},setupMemoryEvent:function(a,b){switch(a){case"epg-zipcode":this._setupZipCodeDetect()}this.addMemoryEvent(a,b)},_setupZipCodeDetect:function(){if(!this.zipCodeDetect){var a={zipCodeChanged:this._onZipCodeChanged.bind(this)};this.zipCodeDetect=new Uverse.utils.ZipCodeDetect(a)}},_onZipCodeChanged:function(a){this.fireMemoryEvent("epg-zipcode",a)},hasCustomZipCode:function(){return this.zipCodeDetect&&this.zipCodeDetect.hasCustomZipCode()},updateCustomZipCode:function(a){this.zipCodeDetect.updateZipCode(a)},loadDeepLink:function(a,b,c){var d=this.history.pushToHistory(a,b,c);this.deepLink.processUrlInfo(d,b)},reloadCurrentUrl:function(){this.history.reloadCurrentUrl()},storeToCache:function(a,b,c){var d=c?window.sessionStorage:window.localStorage;d.setItem(a,JSON.encode(b))},retrieveFromCache:function(a,b){var c=b?window.sessionStorage:window.localStorage;return JSON.decode(c.getItem(a))},eliminateFromCache:function(a,b){var c=b?window.sessionStorage:window.localStorage;c.removeItem(a)},storeToSession:function(a,b){Cookie.write(a,JSON.encode(b))},retrieveFromSession:function(a){return JSON.decode(Cookie.read(a))},eliminateFromSession:function(a){Cookie.dispose(a)},hidePrimaryScrollBars:function(){var a=this._getScrollBarSize(),b=document.getElement("html");this.currentScroll=b.getScroll(),b.setStyles({overflow:"hidden","padding-right":a.width}),b.scrollTo(this.currentScroll.x,this.currentScroll.y)},restoreScrollBars:function(){var a=document.getElement("html");a.setStyles({overflow:null,"padding-right":null}),a.scrollTo(this.currentScroll.x,this.currentScroll.y)},_getScrollBarSize:function(){if(this.scrollBarSize)return this.scrollBarSize;var a=new Element("div").setStyles({visibility:"hidden",position:"absolute",top:"0",height:"100px",width:"100px",overflow:"scroll"});document.getElement("body").adopt(a);var b=a.getScrollSize(),c=a.getSize();return a.dispose(),this.scrollBarSize={width:c.x-b.x,height:c.y-b.y},this.scrollBarSize},scrollToTop:function(){if(Fx.Scroll){var a=document.getElement("html"),b=new Fx.Scroll(a);b.toTop()}},setLiveTileExpire:function(){this.liveTileExpire||(this.liveTileExpire=new Uverse.utils.LiveTileExpire)},subscribeLiveAjaxManager:function(a,b){this.liveAjaxManager||(this.liveAjaxManager=new Uverse.utils.LiveAjaxManager),this.liveAjaxManager.subscribe(a,b)},unsubscribeLiveAjaxManager:function(a){this.liveAjaxManager||(this.liveAjaxManager=new Uverse.utils.LiveAjaxManager),this.liveAjaxManager.unsubscribe(a)},_setupPlugin:function(){this.inHomeApplet||(this.inHomeApplet=new Uverse.utils.InHomeApplet)},getInHomeApplet:function(){return this.inHomeApplet||(this.inHomeApplet=new Uverse.utils.InHomeApplet),this.inHomeApplet},unsubscribeInHomeStatus:function(a){this._setupPlugin(),this.inHomeApplet.setupApplet(),this.inHomeApplet.unsubscribe(a)},subscribeInHomeStatus:function(a){this._setupPlugin(),this.inHomeApplet.setupApplet(),this.inHomeApplet.subscribe(a)},recheckInHomeStatus:function(){this._setupPlugin(),this.inHomeApplet.setupApplet(),this.inHomeApplet.recheckInHomeStatus()},currentInHomeStatus:function(){return this._setupPlugin(),this.inHomeApplet.getCurrentStatus()},isInHomeInstalled:function(){return this._setupPlugin(),this.inHomeApplet.isInstalled()},getInHomeService:function(){return this.inHomeService||(this.inHomeService=new Uverse.services.InHomeService),this.inHomeService},forceInstallApplet:function(){this._setupPlugin(),this.inHomeApplet.setupApplet(),this.inHomeApplet.forceInstallApplet()},setUserBandwidth:function(a){this.fireMemoryEvent("userBandwidth-ready",a)},_setupUserAgentDetection:function(){this.userAgentDetection=new Uverse.utils.UserAgentDetection,this.fireMemoryEvent("DeviceInfoDetected",this.userAgentDetection.deviceInfo)},getLiveEntitlement:function(){return this.liveEntitlement||(this.liveEntitlement=new Uverse.utils.LiveEntitlement),this.liveEntitlement},compareOSVersion:function(a){return this.userAgentDetection.compareOSVersion(a)},compareBrowserVersion:function(a){return this.userAgentDetection.compareBrowserVersion(a)},isIpadTablet:function(){return this.userAgentDetection.isIpadTablet()},onSearchAdvancedOptionsSaved:function(a,b){b=b||{},Uverse.config.search.advancedSearch.currentDataValues=a,this.fireMemoryEvent("search-onAdvancedOptionsSaved",[a,b.firstPageLoad])},_addATTEcommerce:function(){Uverse.config.ATTEcommerce&&new Uverse.utils.ATTEcommerceAPI},getDigitalSmithsAPI:function(){return this.digitalSmithsAPI||(this.digitalSmithsAPI=new Uverse.utils.DigitalSmithsAPI),this.digitalSmithsAPI}}),function(){function a(){return d(b(),{enabled:!1,enable:function(a){if(a){var b=JSON.encode(a);i!==b&&(i=b,Cookie.write(h,b))}else i&&(Cookie.dispose(h),i=null);if(window.console){var e=window.console;a&&(e=c(a)),Uverse.console=d(e,{enabled:!0},g)}else Uverse.console=g},disable:function(){i&&(Cookie.dispose(h),i=null),Uverse.console=g},throwAway:function(a){setTimeout(function(){throw a},1)}})}function b(){return{log:function(a){},debug:function(a){},info:function(a){},warn:function(a){},error:function(a){},assert:function(a,b){},clear:function(){},dir:function(a){},dirxml:function(a){},trace:function(){},group:function(a){},groupCollapsed:function(a){},groupEnd:function(){},time:function(a){},timeEnd:function(a){},timeStamp:function(a){},profile:function(a){},profileEnd:function(){},count:function(a){},exception:function(a,b){},table:function(a,b){}}}function c(a){var b={filtered:!0,filterOptions:a};return Object.each(g,function(c,d){d in window.console&&window.console[d]!==g[d]&&(b[d]=function(){var b=arguments[0];if(e(a,d,b))return void(a.filterMessage&&window.console.log(a.filterMessage));if(window.console[d])if(window.console[d].apply)window.console[d].apply(window.console,arguments);else{var c=arguments;window.console[d](c[0]||"",c[1]||"",c[2]||"",c[3]||"",c[4]||"",c[5]||"",c[6]||"",c[7]||"",c[8]||"",c[9]||"")}})}),b}function d(){var a=arguments[0];return Array.each(arguments,function(b,c){0!==c&&Object.each(b,function(b,c){c in a||(a[c]=b)})}),a}function e(a,b,c){return a.include&&!f(a.include,c)?!0:a.exclude&&f(a.exclude,c)?!0:a.methods&&!f(a.methods,b)?!0:!1}function f(a,b){return a.some(function(a){return a.exec?!!a.exec(b):a===b})}var g=a(),h="UverseConsoleFilter",i=Cookie.read(h);if(Uverse.console=g,Uverse.config.consoleEnabled||i){var j=i?JSON.decode(i):null;Uverse.console.enable(j)}}(),function(){Object.append(Uverse.Enums,{DvrItemStates:{UNKNOWN:"unknown",CANNOT_BE_RECORDED:"cannotBeRecorded",CANNOT_BE_RECORDED_LOCAL:"cannotBeRecorded-local",CAN_BE_RECORDED:"canBeRecorded",RECORDED:{SINGLE:"recorded-single",SERIES:"recorded-series"},SET_TO_RECORD:{SINGLE:"setToRecord-single",SERIES:"setToRecord-series",SERIES_WITH_RERUNS:"setToRecord-seriesWithReruns"}},RecordingStatus:{RECORDED:"RECORDED",SCHEDULED:"SCHEDULED",NOW_RECORDING:"NOW_RECORDING",CONFLICTED:"CONFLICTED",UNKNOWN:"UNKNOWN"},RecordingType:{SERIES:"SERIES",SINGLE:"SINGLE",NONE:"NONE"},ScheduleIntention:{NEW:"NEW",MODIFY:"MODIFY"},EraseIntention:{DELETE:"DELETE",CANCEL:"CANCEL"},CardTagStates:{NONE:"",FREE:"free",WATCH:"watch"},FeatureCardType:{CATEGORY:"CATEGORY",STATIC:"STATIC",VIDEO:"VIDEO"},CollectionCardType:{VIDEO_ITEM:"VIDEO_ITEM",CATEGORY_ITEM:"CATEGORY_ITEM",NETWORK_ITEM:"NETWORK_ITEM"},CardLayout:{EMPTY:"empty",COLUMN:"column_based",ROW:"row_based",LIST:"list_based"},Orientation:{LANDSCAPE:"LANDSCAPE",PORTRAIT:"PORTRAIT"},CookieNames:{USERNAME:"NEXTGEN_NAME",ENTITLEMENT:"NEXTGEN_PACKAGES",ADDED_PACKAGES:"NEXTGEN_ADDED_PACKAGES",LOGINPORTAL:"ATTNETSSOCKSTR",LOGINPORTAL_NEW:"TATS-US-TokenID",UVERSE:"NEXTGEN_UVERSE",HSIA:"NEXTGEN_HSIA",ZIP:"NEXTGEN_ZIP",HAS_HD:"NEXTGEN_HD",DEVICE_TYPE:"device-type",DEVICE_NAME:"device-name"}});var a=Uverse.Enums.Entitlement={ALLOWED:"allowed",NEED_UPGRADE:"upgrade",NEED_ORDER:"order",NEED_LOGIN:"login",NEED_HDPREM:"hdprem",NEED_HDUPGRADE:"hdupgrade",GEO_RESTRICTED:"georestricted",BLACKED_OUT:"blackedout",APPLET_NOT_INSTALLED:"appletnotinstalled",JAVA_OUT_OF_DATE:"javaoutofdate",OUT_OF_HOME:"notathome",UNKNOWN:"unknown"},b=a.Priority={};b[a.GEO_RESTRICTED]=11,b[a.BLACKED_OUT]=10,b[a.NEED_LOGIN]=9,b[a.NEED_HDPREM]=8,b[a.NEED_HDUPGRADE]=7,b[a.NEED_UPGRADE]=6,b[a.NEED_ORDER]=5,b[a.APPLET_NOT_INSTALLED]=4,b[a.JAVA_OUT_OF_DATE]=3,b[a.OUT_OF_HOME]=2,b[a.ALLOWED]=1,b[a.UNKNOWN]=0}(),Uverse.controls.BaseControl=new Class({Implements:[OptionsFromAttributes],options:{},el:null,focusControl:null,checkState:function(){},getName:function(){var a=this.input||(this.el.match("input, select, textarea, button")?this.el:null);return a?a.get("name"):(a=this.el.getElements("input, select, textarea"),1===a.length?a[0].get("name"):a.length>1?a.get("name"):null)},serialize:function(){return this.el.serializeInputs()},setupBaseEventHandlers:function(a){function b(){d.addEvent("keydown:keys(space):once",function(a){e.setState("depressed",!0),c()})}function c(){d.getDocument().addEvent("keyup:keys(space):once",function(a){e.setState("depressed",!1),b(),e.onClick&&(d.match(a.target)||d.contains(a.target))&&e.onClick(a)})}if(["onClick","onMouseDown","onMouseUp","onKeyPress","onKeyDown","onKeyUp","onFocus","onBlur"].each(function(a){var b=a.substr(2).toLowerCase();this[a]&&(this[a]=this[a].bind(this),this.el.addEvent(b,this[a]))},this),a&&a.spacePerformsClick){var d=this.el,e=this;b()}},setupBaseStateHandlers:function(){var a=this.el,b=this;a.addEvents({mouseenter:function(a){b.setState("hovered",!0)},mouseleave:function(a){b.setState("hovered",!1)},focus:function(a){b.setState("focused",!0)},blur:function(a){b.setState("focused",!1)},mousedown:function(c){b.setState("depressed",!0),a.getDocument().addEvent("mouseup:once",function(a){b.setState("depressed",!1)})}})},setState:function(a,b){"disabled"!==a&&this.getState("disabled")===!0&&(b=!1),this.el.toggleClass(a,b)},getState:function(a){if(a)return this.el.hasClass(a);var b={};return["hovered","focused","depressed"].each(function(a){b[a]=this.el.hasClass(a)},this),b},submitForm:function(a){var b=this.el.getClosest("form");if(b){var c={prevented:!1,type:"submit",target:this.el,submitButton:a,stop:function(){this.prevented=!0},preventDefault:function(){this.prevented=!0},stopPropagation:function(){}};if(b.fireEvent("submit",[c]),!c.prevented)return b.submit(),!0}return!1}}),Uverse.controls.Button=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],Binds:["_onButtonClick"],options:{},callbacks:{changing:!1},el:null,initialize:function(a,b){this.el=$(a),this.setCallbacks(b),this.setupBaseEventHandlers({spacePerformsClick:!0}),this.setupBaseStateHandlers()},serialize:function(){return this.el.serializeInput()},onClick:function(a){a.preventDefault();var b=this.el,c=this.submitForm(b)}}),Uverse.controls.Calendar=new Class({Implements:[Callbacks,Options],options:{nowTime:null,timeZoneInfo:null,displayRange:"3 weeks",activeRange:"2 weeks",type:"range"},timezones:{"-1000":"HST","-0900":"ASKT","-0800":"PST","-0700":"MST","-0600":"CST","-0500":"EST","-0400":"AST"},els:{days:null,main:null,range:null},callbacks:{clickDay:null},initialize:function(a,b,c){this.el=a,this.setOptions(b),this.setCallbacks(c);var d=this.options.nowTime.getLocalTimeFromTimezone(this.options.timeZoneInfo);this.options.nowTime=d.getMidnight(),this._setupElements(),this._setupEvents(),this.generateCalendarData(),this.generateCalendarHeader(),this.generateCalendarPage()},_setupElements:function(){var a=this.el;this.els.main=a.getElement(".calendar-main"),this.els.range=a.getElement(".calendar-daterange"),this.rowTemplate=this.els.main.getElement(".calendar-row")},_setupEvents:function(){this.els.main.addEvent("click:relay(.calendar-day)",this._onClickDay.bind(this))},generateCalendarData:function(){var a={};return a.startDate=this.getDateData(this.options.nowTime),this.startDateObj=a.startDate.dateObj,a.activeRangeLimit=this._parseRange(this.startDateObj,this.options.activeRange),a.endDate=this.getDateData(a.activeRangeLimit.dateObj),a.pageStartDate=this._getFirstDate(a),a.displayRangeLimit=this._parseRange(a.pageStartDate.dateObj,this.options.displayRange),a.pageEndDate=this._getPageEndDate(a),a.days=this.generateDays(a),this.calData=a},generateCalendarHeader:function(){var a=this.calData.startDate,b=this.calData.endDate,c=a.year!==b.year?!0:!1,d=a.month!==b.month||c?!0:!1,e;d||c||(e=a.pretty.shortMonth+" "+a.pretty.longYear),d&&!c&&(e=a.pretty.shortMonth+" - "+b.pretty.shortMonth+" "+b.pretty.longYear),d&&c&&(e=a.pretty.shortMonth+" "+a.pretty.longYear+" - "+b.pretty.shortMonth+" "+b.pretty.longYear),this.els.range.set("text",e)},generateCalendarPage:function(){var a=this.els,b=[];a.main.empty();for(var c=0,d=this._getNumberOfWeeksToDisplay();d>c;c++){var e=this.rowTemplate.clone();0===c&&e.addClass("first-row"),b.push(e)}b=$$(b),this.els.days=b.getElements(".calendar-day").flatten(),this._setDateData(this.els.days),a.main.adopt(b)},generateDays:function(a){for(var b=[],c=a.pageStartDate,d=a.pageEndDate,e=1+c.dateObj.diff(d.dateObj,"day"),f=0;e>f;f++){var g=c.dateObj.clone().increment("day",f);g=g.increment("hour",12).getMidnight();var h=this.getDateData(g),i=a.startDate.time===h.time;h.currentDay=h.active=i;var j=h.time<a.startDate.time||h.time>a.endDate.time;h.disabled=j,b.push(h)}return b},_setDateData:function(a){a.each(function(a,b){var c=this.calData.days[b],d=c.date,e=10>d?"0"+d:d;c.currentDay&&a.addClass("active"),c.disabled&&a.addClass("disabled"),a.set("text",e),a.store("index",b)},this)},_parseRange:function(a,b){var c=b.match(/(\d{1,4})\s?(week|day|month|year)s?/i);if(null==c||3!==c.length)return Uverse.console.error("[Calendar]","Invalid range time period"),null;var d=parseInt(c[1],10),e=c[2],f=a.clone().increment(e,d).getMidnight().decrement("second",1);return this.getDateData(f)},setActive:function(a){var b=this.els.main.getElement(".active"),c=b.retrieve("index"),d=this.els.days[a];b.removeClass("active"),d.addClass("active"),this.calData.days[c].active=!1,this.calData.days[a].active=!0,this.activeDate=d},getActive:function(){for(var a=this.calData.days,b=0,c=a.length;c>b;b++){var d=a[b];if(d.active)return d}},getDateData:function(a){var b={dateObj:a,pretty:this.getPrettyData(a),time:a.getTime(),day:a.getDay(),date:a.getDate(),month:a.getMonth(),year:a.getFullYear()};return b},getPrettyData:function(a){var b=a.format("%a,%b,%y").split(","),c=a.format("%A,%B,%Y").split(","),d={shortDay:b[0],shortMonth:b[1],shortYear:b[2],longDay:c[0],longMonth:c[1],longYear:c[2],gmtoffset:a.get("gmtoffset"),timezone:this.timezones[a.get("gmtoffset")],shortDate:a.format("%a, %b %e%o '%y"),longDate:a.format("%A, %B %e%o %Y")};return d},_getPageEndDate:function(a){var b=this._getLastDate(a),c=35,d=this.startDateObj.diff(b.dateObj,"day");if(d>c){var e=this.startDateObj.clone().set("date",c);b=this.getDateData(e)}return b},_getFirstDate:function(a){var b="range"===this.options.type?a.startDate.date:1,c=new Date(this.startDateObj);return c.set("date",b).set("day",0),this.getDateData(c)},_getLastDate:function(a){var b="range"===this.options.type?a.activeRangeLimit.date:this.startDateObj.get("lastdayofmonth"),c=a.activeRangeLimit.dateObj.clone();return c.set("date",b),c.getTime()==a.endDate.time&&a.displayRangeLimit.time>a.activeRangeLimit.time&&c.increment("day",1),c.set("day",a.displayRangeLimit.day),this.getDateData(c)},_getNumberOfWeeksToDisplay:function(){var a=this.startDateObj,b=this.calData.displayRangeLimit.dateObj,c=Math.ceil(a.diff(b,"day")/7);return c>6?6:c},_onClickDay:function(a,b){var c=b.retrieve("index"),d=this.calData.days[c];return d.disabled||d.active?void a.preventDefault():(this.setActive(c),void this.callbacks.clickDay(a,b,d))}}),Uverse.controls.Checkbox=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],options:{},callbacks:{changing:null},transitions:{".control-favorites":{elements:{".U-control-checkbox-check":{props:["background-position"]}}}},el:null,input:null,initialize:function(a,b){this.el=$(a),this.input=this.el.getElement("input"),this.setCallbacks(b),this.setupBaseStateHandlers(),this.setupBaseEventHandlers({spacePerformsClick:!0}),this.checkState()},checkState:function(){this.setState("checked",this.input.checked)},setState:function(a,b){var c=null;Object.each(this.transitions,function(a,b){this.el.match(b)&&(c=a)},this),this.el.transition(c,function(){this.el[b?"addClass":"removeClass"](a)},this)},onClick:function(a){a.preventDefault(),this._toggle(a)},_toggle:function(a){this.input.checked=!this.input.checked,this.setState("checked",this.input.checked),this.callbacks.changing(a,this,this.input.checked,!this.input.checked)},onMouseDown:function(a){a.preventDefault()}}),Uverse.controls.DropDown=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],Binds:["_onLabelClick","_openDropDown","_closeDropDown","_onDocumentClick","_onControlsChanging","_onSelectionChanging"],options:{},callbacks:{changing:null},el:null,dropDownSelection:null,dropDownContainer:null,dropDownControls:null,dropDownIsOpen:!1,initialize:function(a,b){this.el=$(a),this.setCallbacks(b),this._setupSelection(),this._setupDropDownControls(),this.setupBaseEventHandlers({spacePerformsClick:!1}),this.setupBaseStateHandlers()},checkState:function(){this.dropDownControls.each(function(a){a.checkState()})},updateOption:function(a,b,c){this.dropDownControls.each(function(d){d.updateOption&&d.updateOption(a,b,c)}),this.checkState()},_setupSelection:function(){this.dropDownSelection=this.el.getElement(".U-control-dropdown-selection"),this.el.hasClass("controlBehavior-clickable")?this.dropDownSelection.addEvent("click",this._toggleDropDown.bind(this)):(this.dropDownSelection.addEvent("click",this._onLabelClick),this.el.addEvents({mouseenter:this._openDropDown,mouseleave:this._closeDropDown}))},_setupDropDownControls:function(){this.dropDownContainer=this.el.getElement(".U-control-dropdown-container");var a={changing:this._onControlsChanging,selectionChanging:this._onSelectionChanging},b=this.dropDownContainer.getChildren();this.dropDownControls=b.map(function(b){return Uverse.controls.Form.createControl(b,a)},this),this.dropDownContainer.fade("hide")},_onControlsChanging:function(a,b,c,d){this.callbacks.changing(a,this,c,d)},_onSelectionChanging:function(a,b){this.dropDownSelection.getElement(".contents-go-here").set("text",a),this.dropDownSelection.toggleClass("control-dropdown-selection-default",b),this._closeDropDown()},_onLabelClick:function(a){a.preventDefault(),this._openDropDown()},_onDocumentClick:function(a){var b=$(a.target);this.el.contains(b)||this._closeDropDown()},_toggleDropDown:function(){this.dropDownIsOpen?this._closeDropDown():this._openDropDown()},_openDropDown:function(){this.getState("disabled")||this.dropDownIsOpen||(this.dropDownIsOpen=!0,this.el.addClass("dropdown-open"),this.dropDownContainer.addClass("dropdown-container-open"),this.dropDownContainer.set("tween",{transition:"quad:out"}).fade("in"),this.el.getDocument().addEvent("click",this._onDocumentClick))},_closeDropDown:function(){!this.getState("disabled")&&this.dropDownIsOpen&&(this.dropDownIsOpen=!1,this.dropDownContainer.removeClass("dropdown-container-open"),this.dropDownContainer.set("tween",{transition:"quad:in"}).fade("out"),this.el.removeClass("dropdown-open"),this.el.getDocument().removeEvent("click",this._onDocumentClick))}}),Uverse.controls.Form=new Class({Implements:[Options,Callbacks],Binds:["_onControlChanging","_onFormSubmit"],callbacks:{changing:!1,submit:!1},options:{separator:null,filterEmpty:!1},formElement:null,controls:null,initialize:function(a,b,c){this.formElement=$(a),this.setCallbacks(b),this.setOptions(c),this._setupForm(),this._setupControls()},_setupForm:function(){Uverse.console.assert(this.formElement&&this.formElement.match("form"),"[Form]","A Form element is required!"),this.formElement.addEvent("submit",this._onFormSubmit)},_setupControls:function(){var a={changing:this._onControlChanging},b=this.formElement.getElements(".U-control");this.controls=b.map(function(b){return Uverse.controls.Form.createControl(b,a)},this)},_onControlChanging:function(a,b,c,d){this.callbacks.changing&&this.callbacks.changing(a,b,c,d)},_onFormSubmit:function(a){if(this.callbacks.submit){var b=this.getValues();if(a.submitButton){var c=a.submitButton.serializeInput();Element.mergeInputValues(b,c)}var d=this.callbacks.submit(a,b);d===!0||a.preventDefault()}},submit:function(){this.formElement.submit()},getValues:function(a){var b=this.formElement.serializeInputs();return a&&(a=Object.merge({},this.options,a),a.filterEmpty&&(b=Object.filter(b,function(a,b){return!!a||0===a})),a.separator&&(b=Object.map(b,function(b,c){return"array"===typeOf(b)?b.join(a.separator):b}))),b},setValue:function(a,b){var c={};c[a]=b,this.setValues(c,!1)},setValues:function(a,b){this.formElement.deserializeInputs(a,b),this.controls.each(function(a){a.checkState()})},focusFirst:function(){for(var a=0,b=this.controls.length;b>a;a++){var c=this.controls[a];if(c.focusControl){c.focusControl();break}}},updateDropdownOption:function(a,b,c,d){this.controls.each(function(e){e.getName()===a&&e.updateOption(b,c,d)})},getControlByName:function(a){var b=-1;return this.controls.each(function(c,d){c.getName()===a&&(b=d)}),b>-1?this.controls[b]:null}}).extend({createControl:function(a,b){return a.hasClass("U-control-dropdown")?new Uverse.controls.DropDown(a,b):a.hasClass("U-control-list")?new Uverse.controls.List(a,b):a.hasClass("U-control-checkbox")?new Uverse.controls.Checkbox(a,b):a.hasClass("U-control-radio")?new Uverse.controls.Radio(a,b):a.hasClass("U-control-button")?new Uverse.controls.Button(a,b):a.hasClass("U-control-textbox")?new Uverse.controls.Textbox(a,b):null}}),Uverse.controls.List=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],options:{},callbacks:{changing:null,selectionChanging:!1},el:null,input:null,initialize:function(a,b){this.el=$(a),this.input=this.el.getElement("select"),this.setCallbacks(b),this.setupBaseEventHandlers({spacePerformsClick:!1}),this.setupBaseStateHandlers(),this.checkState()},_getOptions:function(){return this.input.getElements("option")},_getListItems:function(){return this.el.getElements(".U-control-list-item")},updateOption:function(a,b,c){var d=this._getOptions();a=a||d.indexOf(d.filter('[value="'+b+'"]')[0]),d[a].set("value",b).set("text",c),this._getListItems()[a].set("text",c).set("data-clicktrack-label",c),this.checkState()},_getSelectedItem:function(){for(var a=this._getOptions(),b=0,c=a.length-1;c>=0;c--)if(a[c].selected){b=c;break}return this._getListItems()[b]},_getItemInfo:function(a){var b={isDisabled:a.hasClass("control-item-disabled"),isDefault:a.hasClass("control-item-default"),isSelected:a.hasClass("control-item-selected"),newValue:a.get("data-value"),oldValue:this.input.get("value"),displayText:a.get("text")};return b},checkState:function(){var a=this._getSelectedItem(),b=this._getItemInfo(a);b.isDisabled||(this._setSelectedValues(a,b),this._setSelectedText(a,b))},onClick:function(a){var b=$(a.target).getClosest(".U-control-list-item");if(b){var c=this._getItemInfo(b);if(c.isDisabled)return;c.isSelected||(this._setSelectedValues(b,c),this.callbacks.changing(a,this,c.newValue,c.oldValue)),this._setSelectedText(b,c)}},_setSelectedValues:function(a,b){var c=this._getListItems();c.removeClass("control-item-selected"),a.addClass("control-item-selected"),this.input.set("value",b.newValue)},_setSelectedText:function(a,b){this.callbacks.selectionChanging&&this.callbacks.selectionChanging(b.displayText,b.isDefault)}}),Uverse.controls.Radio=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],Binds:["_onRadioChanging"],options:{},callbacks:{changing:null},el:null,input:null,initialize:function(a,b){this.el=$(a),this.input=this.el.getElement("input"),this.setCallbacks(b),this.setupBaseStateHandlers(),this.setupBaseEventHandlers({spacePerformsClick:!0}),this._setupEvents(),this.checkState()},_setupEvents:function(){this.input.addEvent("changing",this._onRadioChanging)},_onRadioChanging:function(a,b,c,d){var e=""===c;e||this.callbacks.changing&&this.callbacks.changing(a,this,c,d),this.checkState()},checkState:function(){this.setState("checked",this.input.checked)},onMouseDown:function(a){a.preventDefault()},onClick:function(a){a.target.hasClass("track")||a.stopPropagation()}}),Uverse.controls.ScrollBar=new Class({Extends:Uverse.controls.BaseControl,Binds:["_onContentsScrolled","_onContentsMouseWheel","_onThumbDrag","_onTrackDrag","_onMouseUp"],options:{direction:null,elementId:"",repeatDelay:200},el:null,thumb:null,track:null,contents:null,scroller:null,vertical:!0,initialize:function(a,b){this.el=$(a),this.setOptions(b),this.vertical="vertical"===this.options.direction,this.setupBaseStateHandlers(),this.setupBaseEventHandlers(),this._setupElements(),this._setupContents(),this._updateThumbPosition()},_setupElements:function(){this.thumb=this.el.getElement(".U-control-scrollbar-thumb"),this.track=this.el.getElement(".U-control-scrollbar-track")},_setupContents:function(){this.contents=$(this.options.elementId),this.contents.addEvents({scroll:this._onContentsScrolled,mousewheel:this._onContentsMouseWheel}),this.scroller=new Fx.Scroll(this.contents,{wheelStops:!1})},onMouseDown:function(a){if("left"===a.getMouseButton()){if(this.thumb.contains(a.target))this.thumbDragStart=a.page,this.thumbDragPosition=this.thumb[this.vertical?"offsetTop":"offsetLeft"],document.addEvent("mousemove",this._onThumbDrag);else{if(!this.track.contains(a.target))return;this.trackDragStart=a.page;var b=function(){this._onTrackRepeat(),this.trackDragTimer=b.delay(this.options.repeatDelay)}.bind(this);b(),document.addEvent("mousemove",this._onTrackDrag)}a.preventDefault(),document.addEvent("mouseup",this._onMouseUp),$(document.html).addEvents({dragstart:this._returnFalse,selectstart:this._returnFalse})}},_onThumbDrag:function(a){var b=this.vertical?"y":"x",c=a.page[b]-this.thumbDragStart[b],d=this.track.getSize()[b],e=this.thumbDragPosition,f=(e+c)/d;this._setScrollPosition(f,!0)},_onTrackDrag:function(a){this.trackDragStart=a.page},_onTrackRepeat:function(){var a=this.vertical?"y":"x",b=this.trackDragStart,c=this.contents.getSize()[a],d=this.thumb.getOffsets()[a],e=this.thumb.getSize()[a],f=b[a]<d?-1:b[a]>d+e?1:0,g=.5;if(f){var h=f*g*c,i=!1;this._scrollDelta(h,i)}},_onMouseUp:function(a){document.removeEvent("mousemove",this._onThumbDrag),document.removeEvent("mousemove",this._onTrackDrag),document.removeEvent("mouseup",this._onMouseUp),$(document.html).removeEvents({dragstart:this._returnFalse,selectstart:this._returnFalse}),this.thumbDragStart=null,this.thumbDragPosition=null,this.trackDragTimer&&(clearTimeout(this.trackDragTimer),this.trackDragTimer=null,this.trackDragStart=null)
},_returnFalse:function(a){return!1},_onContentsScrolled:function(a){this._updateThumbPosition()},_onContentsMouseWheel:function(a){var b=-a.wheel,c=this.vertical?"y":"x",d=.5,e=this.contents,f=e.getSize()[c],g=b*f*d;this._scrollDelta(g,!1)&&a.preventDefault()},_scrollDelta:function(a,b){var c=this.vertical?"y":"x",d=this.contents,e=d.getScroll()[c],f=d.getSize()[c],g=d.getScrollSize()[c],h=e+a;return this.scroller.isRunning()&&(h=this.lastScrollPosition+a,this.scroller.cancel()),this.lastScrollPosition=h,0>h&&(h=0),h>g-f&&(h=g-f),h===e?!1:(this.scroller[b?"set":"start"](this.vertical?0:h,this.vertical?h:0),!0)},_updateThumbPosition:function(){var a=this.vertical?"y":"x",b=this.contents,c=b.getScroll()[a],d=b.getScrollSize()[a],e=b.getSize()[a],f={percent:c/d,size:e/d};this._setThumbPosition(f.percent,f.size)},_setThumbPosition:function(a,b){this.thumb.setStyle(this.vertical?"top":"left",(100*a).toFixed(1)+"%"),b&&(this.thumb.setStyle(this.vertical?"height":"width",(100*b).toFixed(1)+"%"),b>.999?this.el.addClass("hidden"):this.el.removeClass("hidden"))},_setScrollPosition:function(a,b){var c=this.vertical?"y":"x",d=this.contents,e=d.getScrollSize()[c],f=a*e;this.scroller[b?"set":"start"](this.vertical?0:f,this.vertical?f:0)}}).extend({scrollBarTemplate:null,attachScrollBarTo:function(a,b){b=Object.merge({elementId:a,direction:"vertical",addClass:""},b),this.scrollBarTemplate||(this.scrollBarTemplate=$("scrollBarTemplate"));var c=this.scrollBarTemplate.clone();return b.addClass&&c.addClass(b.addClass),c.addClass("vertical"===b.direction?"vertical":"horizontal"),a.grab(c,"after"),new Uverse.controls.ScrollBar(c,b)}}),Uverse.controls.Textbox=new Class({Extends:Uverse.controls.BaseControl,Implements:[Callbacks],Binds:["_onTextChanging"],options:{},callbacks:{changing:null},el:null,initialize:function(a,b){this.el=$(a),this.setCallbacks(b),this.input=this.el,this.setupBaseEventHandlers(),this.setupBaseStateHandlers(),this._setupEvents()},serialize:function(){return this.el.serializeInput()},_setupEvents:function(){this.input.addEvent("changing",this._onTextChanging)},_onTextChanging:function(a,b,c,d){this.callbacks.changing&&this.callbacks.changing(a,this,c,d)},focusControl:function(){this.el.focus(),this.el.selectAll()}}),Uverse.utils.ATTEcommerceAPI=new Class({options:{userType:"",nextgenUverseCookie:""},initialize:function(){Uverse.page.addMemoryEvent("Personalization-userData",this._initATTEcommerce.bind(this))},_initATTEcommerce:function(a){(a.isHSIA()||a.isDSL())&&(this.options.userType="HSIA",Asset.javascript(this._getComputedScriptUrl())),a.isUverse()&&(this.options.userType="UVS",a.getUverseValue()&&(this.options.nextgenUverseCookie="."+a.getUverseValue()),Asset.javascript(this._getComputedScriptUrl()))},_getComputedScriptUrl:function(){var a=Uverse.config.ATTEcommerce.url;return a.substitute(this.options)}}),Uverse.utils.AdobeAnalyticsAPI=new Class({metaTagsNames:{LOGGED_IN:"attanalytics.loggedin",USER_TYPE:"attanalytics.usertype",IS_HSIA:"attanalytics.hsia",USER_PACKAGE:"attanalytics.usertvpackage"},metaTagBooleanContents:{REGISTERED:1,LOGGED_IN:"Logged In",LOGGED_OUT:"Guest",USER_UVERSE:"U-verse",USER_ATT:"ATT.net",USER_HSIA:"HSIA",USER_NONHSIA:"Non-HSIA",USER_PACKAGE_NONE:""},initialize:function(){Uverse.page.addMemoryEvent("Personalization-userData",this._addMetaTags.bind(this))},_addMetaTags:function(a){if(a.isLoggedIn()){this._addMetaTagToPage({name:this.metaTagsNames.LOGGED_IN,content:this.metaTagBooleanContents.LOGGED_IN});var b=this._hasOnlyDSLPackage(a),c=a.isUverse()&&!(a.isDSL()&&b);this._addMetaTagToPage(c?{name:this.metaTagsNames.USER_TYPE,content:this.metaTagBooleanContents.USER_UVERSE}:{name:this.metaTagsNames.USER_TYPE,content:this.metaTagBooleanContents.USER_ATT})}else this._addMetaTagToPage({name:this.metaTagsNames.LOGGED_IN,content:this.metaTagBooleanContents.LOGGED_OUT});this._addMetaTagToPage(a.isHSIA()?{name:this.metaTagsNames.IS_HSIA,content:this.metaTagBooleanContents.USER_HSIA}:{name:this.metaTagsNames.IS_HSIA,content:this.metaTagBooleanContents.USER_NONHSIA}),this._addMetaTagToPage({name:this.metaTagsNames.USER_PACKAGE,content:this._getCleanedUverseValue(a)||this.metaTagBooleanContents.USER_PACKAGE_NONE}),this._startAdobeAnalytics()},_getCleanedUverseValue:function(a){return a.isUverse()?a.getUverseValue().replace(/"/g,""):null},_hasOnlyDSLPackage:function(a){var b=a.getUserEntitlement().list,c=[a.cookieValues.LOGGED_IN,a.cookieValues.EMPTY_PACKAGES],d=b.filter(function(a){return!c.contains(a)});return 1===d.length},_addMetaTagToPage:function(a){new Element("meta",{name:a.name,content:a.content}).inject(document.head)},_startAdobeAnalytics:function(){window._satellite.pageBottomFired||window._satellite.pageBottom()}}),Uverse.utils.Banner=new Class({Implements:[Options],options:{templatesPrefix:null,template:null},url:null,initialize:function(a,b,c){this.options.templatesPrefix=Uverse.config.templates.bannersPrefix,this.options.template="default",this.src=a,this.alt=b,this.setOptions(c),this.options.id||(this.options.id=String.uniqueID())},toHtml:function(){var a=Object.clone(this.options),b;return a.src=this.src,a.alt=this.alt,b=$(this.options.templatesPrefix+this.options.template).get("html"),b.substitute(a)},toElement:function(){return Elements.from(this.toHtml())},toString:function(){return this.toHtml()},getId:function(){return this.options.id}}),Uverse.utils.BannersManager=new Class({Implements:[Options],options:{defaultPositon:"bottom"},el:null,readOnly:!1,banners:{},initialize:function(a,b){Uverse.console.log("[BannersManager]","Initializing BannersManager"),this.el=$(a),this.setOptions(b)},clear:function(){return this.readOnly?void Uverse.console.log("[BannersManager]","Clear is not allowed on read only mode."):(this.banners=[],void this.el.empty())},add:function(a,b){if(this.readOnly)return void Uverse.console.log("[BannersManager]","Add is not allowed on read only mode.");if(a.getId()in this.banners)throw Error("Duplicate banner id");b=b||this.options.defaultPositon;var c=a.toElement();c.inject(this.el,b),this.banners[a.getId()]={banner:a,element:c}}}),Uverse.utils.BookmarksAPI=new Class({addRequest:null,removeRequest:null,addBookmarkUrl:"/bookmarks/set.html",removeBookmarkUrl:"/bookmarks/remove.html",addData:null,removeData:null,initialize:function(){this._setupAjaxRequests()},_setupAjaxRequests:function(){this.addRequest=new Request({url:this.addBookmarkUrl,method:"get",headers:Uverse.config.refreshUserSessionHeaders,onFailure:this._addRequestFailure.bind(this),timeout:3e3}),this.removeRequest=new Request({url:this.removeBookmarkUrl,method:"get",headers:Uverse.config.refreshUserSessionHeaders,onFailure:this._removeRequestFailure.bind(this),timeout:3e3})},_addRequestFailure:function(){Uverse.console.log("[BookmarksAPI]","Error adding bookmark"),this._showAddToast()},_removeRequestFailure:function(){Uverse.console.log("[BookmarksAPI]","Error removing bookmark"),this._showRemoveToast()},_showAddToast:function(){Uverse.page.showToast({alert:"",message:Uverse.config.bookmarkErrorToast.add,button:{text:Uverse.config.bookmarkErrorToast.button,action:this._sendAddRequest.bind(this)},timeout:0})},_showRemoveToast:function(){Uverse.page.showToast({alert:"",message:Uverse.config.bookmarkErrorToast.remove,button:{text:Uverse.config.bookmarkErrorToast.button,action:this._sendRemoveRequest.bind(this)},timeout:0})},addBookmark:function(a,b,c,d){if(!this.addRequest.isRunning()){this.addData={videoKey:a,position:c,totalTime:d};var e={position:c,totalTime:d,dateWatched:new Date};this._sendAddRequest(),Uverse.page.setVideoBookmark(b,e)}},removeBookmark:function(a,b){this.removeRequest.isRunning()||(this.removeData={videoKey:a},this._sendRemoveRequest(),Uverse.page.setVideoBookmark(b,null))},_sendAddRequest:function(){this.addRequest.get(this.addData)},_sendRemoveRequest:function(){this.removeRequest.get(this.removeData)}}),Uverse.utils.CardHelper=new Class({entitlementHelper:null,initialize:function(){this.entitlementHelper=new Uverse.utils.Entitlement},loadVideoPlayLink:function(a,b){var c=new DOMEvent(a),d=c.target.getClosest(".video-play-link");if(d&&d.get("href")){c.preventDefault();var e=d.get("href").replace("?","#"),f={windowTitle:b.videoTitle,replaceHistory:!1};Uverse.page.loadDeepLink(e,b,f)}},setCardEntitlement:function(a){var b=this.entitlementHelper.compareEntitlement(a.entitlementLevel());b==Uverse.Enums.Entitlement.ALLOWED&&a.tagState(Uverse.page.isLoggedIn()?Uverse.Enums.CardTagStates.WATCH:Uverse.Enums.CardTagStates.FREE)},dataDashFriendly:function(a){return"string"!=typeof a?"":this.htmlencode(a.replace(">","::"))},htmlencode:function(a){return a.replace(/[&<>"']/g,function(a){return"&"+{"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#39"}[a]+";"})},messageProperty:function(a,b){"array"!=typeOf(a)&&(a=[a]);for(var c=0;c<a.length;c++)b=b.replace("{"+c+"}",a[c]);return b},formatReleaseDate:function(a){var b="";return a.releaseDate>0&&("tv"===a.contentType?b=new Date(a.releaseDate).formatUTC("%b %f, %Y"):"movies"===a.contentType&&(b=new Date(a.releaseDate).format("%Y"))),b},formattedDuration:function(a){var b="",c="",d=a.contentType,e=a.duration;if("function"==typeof e&&(e=a.duration()),"function"==typeof d&&(d=a.contentType()),e>0)if("tv"==d||"music"==d||"sports"==d)if(60>e)b="00:"+(10>e?"0":"")+e;else{for(;e>=60;)c=e%60>9?"":"0",b=":"+c+e%60+b,e=Math.floor(e/60);b=e+b}else"movies"==d&&(b=Math.round(e/60));return b},formattedGenres:function(a){return a.genres&&"movies"!==a.contentType?a.genres.join(", "):""}}),Uverse.utils.ClickTracking=new Class({request:null,attributeMap:{prefix:"data-clicktrack-",names:{category:"category",subcategory:"subcategory",action:"action",label:"label"}},classNameMap:{prefix:"track-",names:{category:"hasCategory",subcategory:"hasSubcategory",action:"hasAction",label:"hasLabel"}},callback:null,initialize:function(){this._setupRequest(),this._addGlobalEvent()},_setupRequest:function(){this.request=new Request({url:Uverse.config.clickTracking.url,method:"POST",link:"chain",onComplete:this._onRequestComplete.bind(this)})},_onRequestComplete:function(a){if(this.callback){var b=this.callback();b===!0&&(this.isNavigatingAway=b),this.callback=null}},_addGlobalEvent:function(){$(document).addEvent("click:relay(.track)",this._onTrackElClicked.bind(this))},_onTrackElClicked:function(a,b){var c=b.get("href"),d=null;this._shouldFollowLinkAfterClickTrack(a,b)&&(a.preventDefault(),d={callback:function(){return Uverse.console.log("[ClickTracking]","Navigating to ",c),window.location=c,!0}.bind(this)}),this.track(b,d)},_shouldFollowLinkAfterClickTrack:function(a,b){var c=b.get("href"),d=!!c,e=c&&0===c.indexOf("#")?!0:!1,f="_blank"==b.get("target"),g="left"==a.getMouseButton(),h=a.wasDefaultPrevented(),i=a.shift||a.control;return!h&&d&&!e&&!f&&g&&!i},track:function(a,b){b&&b.callback&&(this.callback&&Uverse.console.log("[ClickTracking]","Replacing callback"),this.callback=b.callback),b&&this._updateAllAttributes(a,b.addCategory,b.addSubcategory,b.addAction,b.addLabel);var c=new Uverse.utils.ClickTracking.data(a,this.attributeMap,this.classNameMap);this._hasErrors(c)?this._onRequestComplete():this._readyToTrack(c)},_hasErrors:function(a){var b=!1;return a.hasValidData()?this.isNavigatingAway&&(b="Click tracking data: Cannot submit - browser is navigating away."):b="Click tracking could not be performed because trackingData is incomplete.",b&&Uverse.console.warn("[ClickTracking]",b,a.getData()),!!b},_readyToTrack:function(a){Uverse.config.clickTracking.canStartTrack||(Uverse.console.log("[ClickTracking]","Click tracking data: ",a.getData()),this.request.send({data:a.getData()})),Uverse.config.clickTracking.canStartTrack=!1},_updateAllAttributes:function(a,b,c,d,e){b&&this.updateAttribute(a,this.attributeMap.names.category,b),c&&this.updateAttribute(a,this.attributeMap.names.subcategory,c),d&&this.updateAttribute(a,this.attributeMap.names.action,d),e&&this.updateAttribute(a,this.attributeMap.names.label,e)},updateAttribute:function(a,b,c){a.set(this.attributeMap.prefix+b,c)}}),Uverse.utils.ClickTracking.data=new Class({el:null,data:{category:null,subcategory:null,action:null,label:null},attributeMap:{},classNameMap:{},initialize:function(a,b,c){this.el=a,this.attributeMap=b,this.classNameMap=c,this._getAllData()},_getAllData:function(){this.data.category=this._findDataAttributeByName(this.el,"category"),this.data.subcategory=this._findDataAttributeByName(this.el,"subcategory"),this.data.action=this._findDataAttributeByName(this.el,"action"),this.data.label=this._findDataAttributeByName(this.el,"label")},_findDataAttributeByName:function(a,b){if(!a)return null;var c=a.get(this._generateAttributeName(b));return c&&""!==c?c:this._findDataAttributeByName(this._getNextParent(a,b),b)},_getNextParent:function(a,b){return a.getParent("."+this._generateClassName(b))},_generateAttributeName:function(a){return this.attributeMap.prefix+this.attributeMap.names[a]},_generateClassName:function(a){return this.classNameMap.prefix+this.classNameMap.names[a]},hasValidData:function(){return this.data.category&&""!==this.data.category||this.data.subcategory&&""!==this.data.subcategory||this.data.action&&""!==this.data.action?!0:!1},getData:function(){return this.data},isALink:function(){return this.el.href?!0:!1}}),Uverse.utils.ComScoreAPI=new Class({initialize:function(){Uverse.console.log("[ComScoreAPI]","ComScore API enabled")},pageTag:function(){window._comscore=window._comscore||[];var a={c1:Uverse.config.comscore.c1,c2:Uverse.config.comscore.clientid,c3:"",c4:window.location.href};window._comscore.push(a),this.addScript(),Uverse.console.log("[ComScoreAPI]","ComScore page tag")},addScript:function(){if(!Uverse.page.comScore.scriptAdded){window._comscore=window._comscore||[];var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0,a.src=("https:"==document.location.protocol?"https://sb":"http://b")+".scorecardresearch.com/beacon.js",b.parentNode.insertBefore(a,b),Uverse.page.comScore.scriptAdded=!0}},sendTag:function(a){window.COMSCORE.beacon(a)}}),Uverse.utils.CommonLocalization=new Class({Implements:[Options],userZip:"",options:{userZip:"",cookieDomains:[],appname:""},initialize:function(a){this.setOptions(a),this._createZipCookies()},_createZipCookies:function(){if(Uverse.config.cltDomainList&&Uverse.config.cltAppName){var a={cookieDomains:App.storage.cltDomainList.split(","),appname:App.storage.cltAppName};null!=this.options.userZip&&""!==this.options.userZip&&(a.userZip=this.options.userZip,this._getClt())}},_getClt:function(){if(""===this.options.userZip)throw Error("userZip option must be specified");this._cookieExistsOnDomain()&&this._zipsMatch()||this._createCookies()},_getDomainUrls:function(){for(var a=this.options.cookieDomains,b,c=0;c<a.length;c++)a[c]="http://"+a[c]+"/loc/controller?appid="+this.options.appname+"&ltype=rev&zip="+this.options.userZip;return a},_cookieExistsOnDomain:function(){return null!==Cookie.read("attPersistantLocalization")},_zipsMatch:function(){return Cookie.read("attPersistantLocalization").indexOf("zip="+this.options.userZip)},_createCookies:function(){var a=this._getDomainUrls();a.each(function(a){$(document.body).adopt(new Element("iframe",{src:a,"class":"hidden"}))})}}),Uverse.utils.ConfigureLivePlayerPluginPage=new Class({Implements:[Options],el:null,viewModel:null,modalViewModel:null,userClickedInstallButton:!1,hasJava:!1,hasJavaMinVersion:!1,detectJava:null,focusEventAdded:!1,options:{stepsKey:"inHomeStepsKey",livePageUrl:null},initialize:function(a,b){this.el=a,this.setOptions(b),this._applyClickTrackingLabel(),this.stepsData=Uverse.loader.retrieveModelData(this.options.stepsKey),this._setupJavaDetect(),this._setupModalViewModel(),this._setupViewModel(),this._setupApplet(),ko.applyBindings(this.viewModel,a)},_setupJavaDetect:function(){this.detectJava=new Uverse.utils.DetectJavaVersion,this.hasJava=this.detectJava.isInstalled(),this.hasJavaMinVersion=this.detectJava.hasMinVersion(),this.hasJava&&!this.hasJavaMinVersion&&this._setFirstStepText()},_setFirstStepText:function(){for(var a in this.stepsData)this.stepsData[a][0].stepText=this.stepsData[a][0].javaUpdateText},_installJava:function(){return this.focusEventAdded||(window.addEvent("focus",this._windowFocused.bind(this)),this.focusEventAdded=!0),!0},_windowFocused:function(){this.detectJava.refresh();var a=this.detectJava.isInstalled(),b=this.detectJava.hasMinVersion();this.viewModel.hasJava(a),this.viewModel.hasJavaMinVersion(b),this.hasJava=a,this.hasJavaMinVersion=b},_setupModalViewModel:function(){var a={isAtHome:ko.observable(!1),cameFromModal:ko.observable(!1),returnUrl:ko.observable(this.options.livePageUrl)};this.modalViewModel=a},_setupViewModel:function(){function a(){var a={stepNumber:ko.observable(1),stepText:ko.observable(""),hasLink:ko.observable(!1),hasImage:ko.observable(!1),hasButton:ko.observable(!1),hasButtonLink:ko.observable(!1),hasButtonAlwaysVisible:ko.observable(!1),linkText:ko.observable(""),linkUrl:ko.observable(),imageSrc:ko.observable(),imageAlt:ko.observable(""),buttonText:ko.observable(""),buttonLinkUrl:ko.observable(),buttonLinkText:ko.observable(""),disabledButtonText:ko.observable(""),linkUnderButtonText:ko.observable(""),linkUnderButtonUrl:ko.observable()};return a.hasActiveButton=ko.computed(function(){return!e.isAppletInstalled()&&(a.hasButton()||a.hasButtonLink())||a.hasButtonAlwaysVisible()}),a.hasDisabledButton=ko.computed(function(){return e.isAppletInstalled()&&!a.hasActiveButton()&&(a.hasButton()||a.hasButtonLink())}),a}var b=/(win|mac)/i,c=/(chrome|safari|ie|firefox)/i,d=new Uverse.utils.LivePluginOsChecker,e={isAppletInstalled:ko.observable(!1),isIncompatible:ko.observable(d.isUserOnUnsupportedOS()),hasJava:ko.observable(this.hasJava),hasJavaMinVersion:ko.observable(this.hasJavaMinVersion),installJava:this._installJava.bind(this)};e.browserSteps={},ko.merge(e.browserSteps,this.stepsData),e.steps=ko.observableArray([]).mergeMapping(a),e.openRequirementsModal=function(a){this._openRequirementsModal()}.bind(this),e.platformOs=function(){var a=Browser.Platform.name;return b.test(a)?a:"other"},e.platformBrowser=function(){var a=Browser.name;return c.test(a)?a:"other"},e.platformKey=function(){return e.platformOs()+"-"+e.platformBrowser()},e.platformClass=ko.computed(function(){return e.platformKey()+" "+(e.isAppletInstalled()?"applet-installed":"")+" "+(e.isIncompatible()?"live-player-incompatible":"")}),e.installLivePlayerPlugin=function(){this.hasJavaMinVersion?(this.userClickedInstallButton=!0,Uverse.page.forceInstallApplet()):this._openNoJavaModal()}.bind(this),e.appletIsInstalled=ko.computed(function(){this._displayModalIfUserTriggeredAppletInstall();var a=e.browserSteps[e.platformKey()];return a&&ko.merge(e.steps,a),e.isAppletInstalled()},this),this.viewModel=e},_setupApplet:function(){Uverse.page.subscribeInHomeStatus(function(a){Uverse.console.log("[ConfigureLivePlayerPluginPage]","In Home Applet status: "+a),this.modalViewModel.isAtHome(a===Uverse.Enums.InHomeStatus.IN_HOME),this.viewModel.isAppletInstalled(Uverse.page.isInHomeInstalled())}.bind(this))},_displayModalIfUserTriggeredAppletInstall:function(){if(this.userClickedInstallButton){var a=new URI,b=a.getData("returnurl");this.userClickedInstallButton=!1,b&&(this.modalViewModel.cameFromModal(!0),this.modalViewModel.returnUrl(b));var c=Uverse.page.templates.configureLivePlayerPluginConfirmationModal;Uverse.page.createAndLoadGenericModal(c,{modalOptions:{useLoading:!1},modalCallbacks:{modalLoaded:this._modalLoaded.bind(this)}})}},_openRequirementsModal:function(){var a=Uverse.page.templates.livePlayerPluginRequirementsModal;Uverse.page.createAndLoadGenericModal(a,{modalOptions:{useLoading:!1,showByDeepLink:!1}})},_openNoJavaModal:function(){var a=Uverse.page.templates.livePlayerPluginNoJavaModal;Uverse.page.createAndLoadGenericModal(a,{modalOptions:{useLoading:!1,showByDeepLink:!1}})},_modalLoaded:function(a){a.applyBindings(this.modalViewModel,a.modalManager.modalContents)},_applyClickTrackingLabel:function(){var a=this.el.getElements(".buttonInstall");Uverse.page.updateClickTrackAttribute(a,Uverse.page.getConstant("clickTracking","attributeMap.names.label"),Browser.Platform.name+"-"+Browser.name),a.addClass("track-hasLabel")}}),Uverse.utils.DeepLink=new Class({Implements:[Callbacks],callbacks:{deepLinkAction:null},initialize:function(a){this.setCallbacks(a)},processUrlInfo:function(a,b){var c=null;a.search&&(c=Object.merge({},c,String.parseQueryString(a.search.substr(1)))),a.hash&&(c=Object.merge({},c,String.parseQueryString(a.hash.substr(1))));var d;if(null==c)d={action:"base",data:null,historyData:b};else if(c.play){var e={categoryPath:"/ng"+a.pathname.replace(/^\/uv\//,"/"),videoId:c.play};d={action:"playVideo",data:e,historyData:b}}else if(c.show){var f={show:c.show,seriesId:c.sid,programId:c.pid};d={action:"showDetail",data:f,historyData:b}}else d="show"===c.parentalControlsSettings?{action:"parentalControlsSettings"}:"show"===c.notificationsSettings?{action:"notificationsSettings"}:"show"===c.searchAdvancedOptions?{action:"searchAdvancedOptions"}:"show"===c.livePluginHelp?{action:"livePluginHelp"}:"show"===c.networkConnectionHelp?{action:"networkConnectionHelp"}:"show"===c.incompatibleInHomeLiveChannels?{action:"incompatibleInHomeLiveChannels"}:"show"===c.accountMenu?{action:"showAccountMenu",hash:"accountMenu=show"}:"show"===c.autoAuthenticationLearnMore?{action:"autoAuthenticationLearnMore"}:"show"===c.sendTVNote?{action:"sendTVNote"}:c.genre?{action:"genre",data:c.genre}:{action:"unknown",data:c,historyData:b};Uverse.console.log("[DeepLink]","Deep Link Action: ",d.action),this.callbacks.deepLinkAction(d)}}),Uverse.utils.DetectJavaVersion=new Class({Implements:[Options],options:{minVersion:"1.7.0_45"},hasMinVersionResult:{},splitNumRegex:/[\.\_,\-]/g,mimeRegExp:/^\s*application\/x-java-applet;jpi-version\s*=\s*(\d.*)$/i,initialize:function(a){this.setOptions(a)},refresh:function(){if(this.hasMinVersionResult={},this._supportsNavigatorPlugins())try{return void navigator.plugins.refresh(!1)}catch(a){}history.go(0)},isInstalled:function(){return this.hasMinVersion("0")},_isEnabled:function(){var a=!0;try{a=navigator.javaEnabled()}catch(b){}return a},hasMinVersion:function(a){if(void 0!==this.hasMinVersionResult[a])return this.hasMinVersionResult[a];if(a=a||this.options.minVersion,!this._isEnabled())return!1;var b=!1;return b=this._supportsNavigatorMimeTypes()&&!Browser.ie?this._checkMimeTypes(a):this._checkPluginVersion(a),this.hasMinVersionResult[a]=b,b},_checkPluginVersion:function(a){for(var b=this._findJavaVersionsFromPlugin(),c=0;c<b.length;c++)if(this._versionIsGoodEnough(b[c],a))return!0;return!1},_findJavaVersionsFromPlugin:function(){try{for(var a='<object classid="clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA" id="deployJavaPlugin" width="0" height="0"></object>',b=Elements.from(a)[0],c=[],d=b.jvms,e=0;e<d.getLength();e++)c[e]=d.get(e).version;return c}catch(f){return Uverse.console.error("[DetectJavaVersion]","Java Detection failed"),Uverse.console.throwAway(f),[]}},_checkMimeTypes:function(a){for(var b=navigator.mimeTypes,c,d,e=0,f=b.length;f>e;e++)if(c=b[e].type,d=c.match(this.mimeRegExp),d&&this._versionIsGoodEnough(d[1],a))return!0;return!1},_versionIsGoodEnough:function(a,b){if(!a)return!1;if(!this._isStrNum(a)||!this._isStrNum(b))return!1;for(var c=b.split(this.splitNumRegex),d=a.split(this.splitNumRegex),e=Math.min(d.length,d.length),f,g,h=0;e>h;h++){if(f=c[h],g=d[h],f>g)return!1;if(g>f)return!0}return!0},_supportsNavigatorPlugins:function(){return navigator.plugins&&navigator.plugins.length>0},_supportsNavigatorMimeTypes:function(){return navigator.mimeTypes&&navigator.mimeTypes.length>0},_isStrNum:function(a){return"string"==typeof a&&/\d/.test(a)}}),Uverse.utils.DigitalSmithsAPI=new Class({Implements:[Options],options:{baseUrl:null,anonUserId:"anon:{sessionId}",clientSessionCookie:"ClientSessionId",clientSessionValue:"Session_{random}",sessionIdDigits:20},userId:null,sessionId:null,queue:null,initialize:function(a){this.setOptions(a),this.queue=[],this.options.baseUrl=Uverse.config.digitalsmiths.baseUrl,this._setupIds()},_setupIds:function(){this.sessionId=this._getSessionId(),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalization.bind(this))},_getSessionId:function(){var a=Uverse.page.retrieveFromSession(this.options.clientSessionCookie);if(!a){var b=this.options.sessionIdDigits,c=Math.pow(10,b-1),d=Math.pow(10,b),e=c+Math.floor(Math.random()*(d-c));a=this.options.clientSessionValue.substitute({random:e}),Uverse.page.storeToSession(this.options.clientSessionCookie,a)}return a},_onPersonalization:function(a){var b=a.getUserIdHash();b||(b=String.substitute(this.options.anonUserId,{sessionId:this.sessionId})),this.userId=b,this._processQueue()},trackVideoWatch:function(a){var b={itemId:a.videoKey,startTime:a.startTime.getTime(),endTime:a.endTime.getTime(),portionViewed:isNaN(a.portionViewed)?void 0:Math.ceil(1e3*a.portionViewed),channel:a.channel,ViewType:a.isLive?"LINEAR":"VOD_SUBSCRIPTION",queryId:null};this._viewEvent(b)},trackVideoRecord:function(a){var b={type:"RECORD",itemId:a};this._implicitEvent(b)},trackVideoShare:function(a){var b={type:"SHARE",itemId:a};this._implicitEvent(b)},trackFavoriteAdd:function(a){var b={type:"FAVORITE",itemId:a};this._implicitEvent(b)},trackViewCategoryPage:function(a){var b={type:"VIEW_DETAILS",itemId:a};this._implicitEvent(b)},_viewEvent:function(a){this._postJSON("/viewEvents",a)},_implicitEvent:function(a){this._postJSON("/implicitEvents",a)},_postJSON:function(a,b){if(this.queue)return Uverse.console.log("[DigitalSmithsAPI]","Queueing track info...",a,b),void this.queue.push(arguments);this._addUserIdSessionIdUserAgentTimestamp(b),b=[b];var c=new Request.CrossDomain({method:"POST",urlEncoded:!1,headers:{"Content-Type":"application/json"},onSuccess:function(){Uverse.console.log("[DigitalSmithsAPI]","Tracked ",a,b)},onFailure:function(){Uverse.console.error("[DigitalSmithsAPI]","Error tracking to DigitalSmiths!",a,b)},onException:function(a,b){Uverse.console.error("[DigitalSmithsAPI]","Could not set header",a,b)}});c.send({url:this.options.baseUrl+a,data:JSON.encode(b)})},_processQueue:function(){if(this.queue){var a=this.queue;this.queue=null,a.each(function(a){this._postJSON.apply(this,a)},this)}},_addUserIdSessionIdUserAgentTimestamp:function(a){a.userId=this.userId,a.sessionId=this.sessionId,a.userAgent=Browser.name,a.timestamp=(new Date).getTime()}}),Uverse.utils.DvrAPI=new Class({Implements:[MemoryEvents],options:{recordForTileUrl:"/dvr/schedule.json",recordUrl:"/dvr/record.json",eraseUrl:"/dvr/erase.json",dvrDataUrl:"/dvr/dvrData.json"},dvrMode:null,dvrItemsMap:$H(),dvrGroups:null,dvrDataMap:null,initialize:function(){this.dvrMode=Uverse.config.dvr.dvrMode,this._setupDvrEvent()},_setupDvrEvent:function(){Uverse.page.addMemoryEvent("Personalization-dvr:once",this._onDvrEventReceived.bind(this))},_onDvrEventReceived:function(){this._makeDvrDataRequest()},getRecordStateForItem:function(a,b){var c=this.dvrItemsMap.get(a);if(c){var d=c.seriesScheduled||c.hasEpisodeScheduled||c.episodeScheduled,e=this._isSeriesFromType(b);return d?e&&c.hasRerunsIncluded?Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES_WITH_RERUNS:e?Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES:Uverse.Enums.DvrItemStates.SET_TO_RECORD.SINGLE:e?Uverse.Enums.DvrItemStates.RECORDED.SERIES:Uverse.Enums.DvrItemStates.RECORDED.SINGLE}return Uverse.Enums.DvrItemStates.UNKNOWN},_generateDvrStatusKey:function(a,b){return b?a+":"+b:a},_isSeriesFromType:function(a){return"movies"==a?!1:!0},recordProgramForTile:function(a,b,c){var d=a.programID,e=this._isSeriesFromType(b.type);b.recordSeries=e;var f={programId:d,highDefinition:b.includeHD?"true":"false",showType:b.includeReruns?"ANY":"FIRST_RUN_ONLY",mode:"generic",series:b.recordSeries?"true":"false"},g=new Request.JSON({url:this.options.recordForTileUrl,method:"POST",data:f});g.send();var h={programId:a.programID,normalizedProgramTitle:a.normalizedProgramTitle,normalizedEpisodeTitle:a.normalizedEpisodeTitle,seriesScheduled:!0,episodeScheduled:!0,episodeRecorded:!1},i=e?Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES:Uverse.Enums.DvrItemStates.SET_TO_RECORD.SINGLE;g.addEvents({success:function(){this._onRecordItemSuccess(h),c.recordSuccess(i)}.bind(this),failure:function(){c.recordFailure()}})},recordProgram:function(a,b){var c=new Request.JSON({url:this.options.recordUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"POST",data:a});c.send(),c.addEvents({success:function(a){this._onRecordDataSuccess(a),b.recordSuccess()}.bind(this),failure:function(){b.recordFailure()}}),this.fireMemoryEvent("dvrapi-recordRequestSent")},_onRecordDataSuccess:function(a){this._processDvrData(a.dvrGroups)},_onRecordItemSuccess:function(a){this._addDvrItem(a)},_addDvrItem:function(a){var b=this._generateDvrStatusKey(a.normalizedProgramTitle);this.dvrItemsMap.set(b,a),this.fireMemoryEvent("Dvr-dvrItems")},eraseRecording:function(a,b){var c=Object.toQueryStringFlat({recordingIds:a.recordingIds,groupIds:a.groupIds,eraseSeries:a.eraseSeries,stopSeries:a.stopSeries,eraseIntention:a.eraseIntention}),d=new Request.JSON({url:this.options.eraseUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"POST",data:c});d.addEvents({success:this._onEraseSuccess.bind(this)}),d.addEvents({success:b.eraseSuccess,failure:b.eraseFailure}),d.send()},_onEraseSuccess:function(a){this._processDvrData(a.dvrGroups)},_makeDvrDataRequest:function(){new Request.JSON({url:this.options.dvrDataUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"GET",onSuccess:this._onDvrDataSuccess.bind(this),onFailure:this._onDvrDataFailure.bind(this),autoRetry:!0}).send()},_onDvrDataFailure:function(){this.fireMemoryEvent("Dvr-dvrDataFailure")},_onDvrDataSuccess:function(a){this._processDvrData(a.dvrGroups)},_processDvrData:function(a){this.dvrGroups=a;var b={};Array.each(a,function(a){Array.each(a.dvrData,function(c){c.dvrGroup=a;var d=c.programId,e=b[d];e?e.dvrStates.push(c):(e={dvrStates:[c]},b[d]=e)})}),this.dvrDataMap=b,this.fireMemoryEvent("Dvr-dvrData")},getDvrStateForGuideItem:function(a){if(null==this.dvrDataMap)return null;var b=a.programId,c=this.dvrDataMap[b];if(c)for(var d=0,e=c.dvrStates.length;e>d;d++){var f=c.dvrStates[d];if(this._guideItemMatchesDvrState(a,f))return f}return null},_guideItemMatchesDvrState:function(a,b){return a.programId==b.programId&&a.startTime==b.startTime&&a.channelNumber==b.channelNumber},getDvrStateForGroup:function(a){var b=this.dvrGroups.filter(function(b){return b.id===a});return 1===b.length?{dvrGroup:b[0]}:null}}),Uverse.utils.ElementFadeCycler=new Class({Implements:[Options],currentIdx:0,lastIdx:null,options:{itemFx:{property:"opacity",duration:1e3,link:"cancel"},itemFxIn:{transition:Fx.Transitions.Quad.easeOut},itemFxOut:{transition:Fx.Transitions.Quad.easeIn}},positions:{showEl:{"z-index":2,visibility:"visible",opacity:1},showElBottom:{"z-index":1,visibility:"visible"},hideEl:{"z-index":0,visibility:"hidden",opacity:0}},initialize:function(a,b){this.setOptions(b),this.els=a,this._setupElements()},_setupElements:function(){Browser.ie8&&(this.options.itemFx.duration=0),this.els.set("tween",this.options.itemFx),this._showEl($$(this.els[0])),this._hideEl($$(this.els.slice(1)))},_showEl:function(a){return a.setStyles(this.positions.showEl),a},_showElBottom:function(a){return a.setStyles(this.positions.showElBottom),a},_hideEl:function(a){a.setStyles(this.positions.hideEl)},fadeTo:function(a){if(void 0===a)throw"Invalid item index specified";a>=this.els.length&&(a=0),this.currentIdx!=a&&this._transition(this.lastIdx,this.currentIdx,a)},_setTransitions:function(a,b){a.set("tween",this.options.itemFxOut),b.set("tween",this.options.itemFxIn)},_fadeOut:function(a){var b=this;this._showEl(a).get("tween").start(1,0).chain(function(){b._hideEl(a)})},_fadeIn:function(a){this._showElBottom(a).get("tween").start(0,1)},_transition:function(a,b,c){var d=this.els,e=d[b],f=d[c];
if(null!==a){var g=d[a];g.get("tween").cancel(),this._hideEl(g)}this._setTransitions(e,f),this._fadeOut(e),this._fadeIn(f),this.lastIdx=b,this.currentIdx=c}}),Uverse.utils.Ellipsify=new Class({Implements:[Options],options:{ellipsis:"...",cloneOriginal:!1,truncateTo:"letter",wrapChild:null,restoreOriginal:!1},initialize:function(a){this.setOptions(a)},ellipsifyElement:function(a,b){b=Object.merge({},this.options,b),"string"==typeof b.wrapChild&&(b.wrapChild=a.getElement(b.wrapChild));var c=a,d,e=b.wrapChild||c;if(b.cloneOriginal||b.restoreOriginal){var f=e.retrieve("originalElement");if(b.restoreOriginal)return f&&(e.eliminate("originalElement"),e.empty().adopt(f.childNodes)),!1;f?(d=Array.from(f.clone().childNodes),e.empty().adopt(d)):(e.store("originalElement",e.clone()),d=Array.from(e.childNodes))}else d=Array.from(e.childNodes);var g=1,h=1===c.childNodes.length&&c.childNodes[0].nodeType===g,i;h?i=d[0]:(i=new Element("div",{style:"visibility: hidden;"}),c.adopt(i.appendChildren(c.childNodes)),e===c&&(e=i));var j=c.offsetHeight,k=function(){return j<i.offsetHeight},l=null,m=!1;if(k()){switch(l=b.ellipsis,typeOf(l)){case"element":case"textnode":case"whitespace":l=l.clone();break;case"null":case"undefined":l=null;break;case"string":default:l=document.createTextNode(l)}l&&(e.adopt(l),b.showMoreLink&&e.adopt(this._getShowMoreLink(b.showMoreLink)));var n=this._findWrapNode(k,i,d,l);m=this._trimWrapNode(k,n)}return h||c.appendChildren(i.dispose().childNodes),m},_getShowMoreLink:function(a){return a.text&&a.url?new Element("a",{text:a.text,href:a.url}):null},_findWrapNode:function(a,b,c,d){for(var e;;){if(1===c.length)e=c[0];else{var f=c.length;do f--,e=c[f],b.removeChild(e);while(f>0&&a());d?b.insertBefore(e,d):b.appendChild(e),Uverse.console.enabled&&(a()||Uverse.console.error("[Ellipsify]","Element is not measuring correctly, so ellipsify probably didn't work.",{offsetHeight:e.offsetHeight,outerHTML:e.outerHTML},e))}if(!(e&&e.childNodes&&e.childNodes.length))break;b=e,c=e.childNodes,d=null}return e},_trimWrapNode:function(a,b){if(b){var c=3;if(b.nodeType!==c)return void b.parentNode.removeChild(b);var d=!1;switch(this.options.truncateTo){case"node":return void b.parentNode.removeChild(b);case"word":d=!0;break;case"letter":}var e=b.nodeValue,f;d?(e=e.split(/\b/g),f=function(c,d){return b.nodeValue=e.slice(0,c).join(""),d?a()?-1:1:void 0}):f=function(c,d){return b.nodeValue=e.substr(0,c),d?a()?-1:1:void 0};var g=this._binarySearch(e.length,f);return f(g-1,!1),g<e.length}},_binarySearch:function(a,b){for(var c=0,d=0;a>0;){d=c+(a>>1);var e=b(d,!0);if(e>0)d++,a+=c-d,c=d;else{if(!(0>e))return d;a=d-c}}return d}}),Uverse.utils.Entitlement=new Class({compareEntitlement:function(a){if(!a)return Uverse.Enums.Entitlement.ALLOWED;if(!Uverse.page.isLoggedIn())return Uverse.Enums.Entitlement.NEED_LOGIN;if(Uverse.page.isLoggedIn()&&!Uverse.page.isUverseUser())return Uverse.Enums.Entitlement.NEED_ORDER;if(this.needsHDPremiumPackage(a)&&!this._userHasEntitledPackage(a)){if(a.split(",").length>2)return Uverse.Enums.Entitlement.NEED_HDUPGRADE;if(!this.hasHDPremiumPackage())return Uverse.Enums.Entitlement.NEED_HDPREM}return this._userHasEntitledPackage(a)?Uverse.Enums.Entitlement.ALLOWED:Uverse.Enums.Entitlement.NEED_UPGRADE},_userHasEntitledPackage:function(a){var b=Uverse.page.getUserEntitlement().hash,c=a.split(",").some(function(a){return b.get(a)?!0:void 0});return c},getUserUversePackage:function(a){for(var b=a.list,c=b.length,d,e;c--;)0===b[c].indexOf("U>")&&(d=b[c].substring(2)),0===b[c].indexOf("D>")&&(e=b[c].substring(2));return d||e},needsBroadbandPackage:function(a){return this._hasPrefixedPackage(a,"D>")},needsHDPremiumPackage:function(a){return a?a.split(",").contains("P>HDPREM"):!1},hasHDPremiumPackage:function(){var a=Uverse.page.getUserEntitlement().addons;return!!a&&a.contains("HDPREM")},promptUserForLogin:function(a){var b=$("entitlementTemplate").clone(),c=$("entitlementTemplateItems").getElement("."+a).get("html");return b.getElement(".description").set("html",c),b},promptUserForOrder:function(a,b){var c=$("entitlementOrderTemplate").clone(),d=$("entitlementUpgradeItemsTemplate").getElement("."+a).get("html");return c.getElement(".description .custom").set("html",d),c.getElement(".description .base").set("html",b),c},promptUserForUpgrade:function(a,b){var c=$("entitlementUpgradeTemplate").clone(),d=$("entitlementUpgradeItemsTemplate").getElement("."+a).get("html");return c.getElement(".description .custom").set("html",d),c.getElement(".description .base").set("html",b),c},_hasPrefixedPackage:function(a,b){if(!a)return!1;var c=a.split(",").some(function(a){return a.length>b.length&&a.substring(0,2)==b?!0:void 0});return c},_hasTvPackage:function(a){return this._hasPrefixedPackage(a,"U>")},getHashValueByEntitlementKey:function(a){var b=Uverse.page.personalization.getUserEntitlement(),c=b.list,d=b.string,e={};if(a.NONE&&!Uverse.page.isUverseUser())return a.NONE;this._hasTvPackage(d)&&(a.DSL&&delete a.DSL,a.HSIA&&delete a.HSIA);for(var f=0;f<c.length;f++){var g=c[f].indexOf(">"),h=c[f].substring(g+1);e[h]=!0}for(var i in a)if(e[i])return a[i];return null},isPackageBasedEntitlement:function(a){return/>/.test(a)}}),Uverse.Enums.FavoriteStates={SAVED:"saved",NOT_SAVED:"notSaved"},Uverse.utils.FavoriteAPI=new Class({favoriteData:$H(),addRequest:null,removeRequest:null,initialize:function(){Uverse.page.isUserLoggedIn()&&Uverse.page.addMemoryEvent("Favorite-assetList",this._onUverseData.bind(this)),this._setupAjaxRequests()},_setupAjaxRequests:function(){this.favoriteRequest=new Request({method:"post",noCache:!0,timeout:3e3,link:"chain"})},_onUverseData:function(){this.favoriteData=Uverse.page.getPersonalizationData("library")},getFavoriteStateForItem:function(a){return this.favoriteData.contains(a)?Uverse.Enums.FavoriteStates.SAVED:Uverse.Enums.FavoriteStates.NOT_SAVED},getFavoriteCount:function(){return this.favoriteData.length},_requestfailure:function(a,b,c){b?(Uverse.console.log("[FavoriteAPI]","Error adding favorite"),this._showAddToast(a,b)):(Uverse.console.log("[FavoriteAPI]","Error removing favorite"),this._showRemoveToast(a,b))},_showAddToast:function(a,b){Uverse.page.showToast({alert:"",message:Uverse.config.favoriteErrorToast.add,button:{text:Uverse.config.favoriteErrorToast.button,action:this._sendFavoriteRequest.bind(this,a,b)},timeout:0})},_showRemoveToast:function(a,b){Uverse.page.showToast({alert:"",message:Uverse.config.favoriteErrorToast.remove,button:{text:Uverse.config.favoriteErrorToast.button,action:this._sendFavoriteRequest.bind(this,a,b)},timeout:0})},addFavorite:function(a){this._sendFavoriteRequest(a,!0),Uverse.page.favoriteAddItem(a)},removeFavorite:function(a){this._sendFavoriteRequest(a,!1),Uverse.page.favoriteRemoveItem(a)},_sendFavoriteRequest:function(a,b){var c;c={url:b?Uverse.config.favorite.urls.save:Uverse.config.favorite.urls.remove,data:{showPath:a}},c.onFailure=this._requestfailure.bind(this,a,b),this.favoriteRequest.send(c)}}),Uverse.utils.ForeseeAPI=new Class({initialize:function(){Uverse.page.addMemoryEvent("Personalization-userData",this._initializeForesee.bind(this))},_initializeForesee:function(a){this.personalizationUserData=a,this.foreseeJSprops=Asset.javascript(Uverse.config.vendorPath+"Foresee_12_2_5/foresee-fsr.js?cache=true",{onLoad:this._addTrigger.bind(this)})},_addTrigger:function(){this.foreseeJS=Asset.javascript(Uverse.config.vendorPath+"Foresee_12_2_5/foresee-trigger.js?cache=true",{onLoad:this._setUserOptions.bind(this)})},_setUserOptions:function(){window.FSR&&window.FSR.CPPS&&window.FSR.CPPS.set("LoggedIn",this.personalizationUserData.isLoggedIn()?"true":"false")}}),Uverse.utils.GoogleAnalyticsAPI=new Class({initialize:function(){window._gaq=window._gaq||[],window._gaq.push(["_setAccount",Uverse.config.google_analytics.code]);var ga=document.createElement("script");ga.type="text/javascript",ga.async=!0,ga.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(ga,a)},api:function(a,b){Uverse.console.log("[GoogleAnalyticsAPI]","GA pushing: "+a+" | args: "+b);var c=b||[];c.unshift(a),_gaq.push(c)}}),Uverse.utils.History=new Class({Implements:[Callbacks],Binds:["_checkForChanges"],callbacks:{historyChanged:null},baseUrlInfo:null,currentUrlInfo:null,initialWindowTitle:null,timer:null,pushStateEnabled:!1,historyChanging:!1,initialize:function(a){this.setCallbacks(a),this.pushStateEnabled="pushState"in window.history,this.pushStateEnabled?(Element.NativeEvents.popstate=2,window.addEvent("popstate",this._checkForChanges)):this.historyStateCache={},"onhashchange"in window?(Element.NativeEvents.hashchange=1,window.addEvent("hashchange",this._checkForChanges)):this.timer=this._checkForChanges.periodical(200)},checkInitialUrl:function(){var a=this._parseUrl(window.location);this.baseUrlInfo=this.currentUrlInfo=a,this.initialWindowTitle=document.title,(a.hash||a.search)&&(a.hash&&(a=this._parseUrl(a.pathname+a.search),this.baseUrlInfo=this.currentUrlInfo=a),this._checkForChanges(!0))},reloadCurrentUrl:function(){this._checkForChanges(!0)},pushToHistory:function(a,b,c){null===a&&(a=this.baseUrlInfo.pathname),c=Object.merge({windowTitle:null,replaceHistory:!1,historyData:b},c);var d=this._parseUrl(a,this.baseUrlInfo);this.currentUrlInfo=d;var e=this._getWindowTitle(c.windowTitle);if(this.pushStateEnabled){var f=c.replaceHistory?"replaceState":"pushState";window.history[f](c,e,a)}else{this.historyStateCache[d.href]=c;var g=d.relativeUrl||"/";window.location.hash=g}return document.title=e,d},_getWindowTitle:function(a){if(null==a)return this.initialWindowTitle;var b=" - ",c=this.initialWindowTitle.split(b);return c=c[c.length-1],a+b+c},_checkForChanges:function(a){var b=this._getCurrentUrlInfo(),c=a===!0;if(c||this.currentUrlInfo.href!==b.href){this.historyChanging=!0,this.currentUrlInfo=b;var d;d=this.pushStateEnabled?a&&a.event&&"state"in a.event?a.event.state:window.history.state:this.historyStateCache[b.href];var e=this._getWindowTitle(d&&d.windowTitle||null);document.title=e,this.callbacks.historyChanged(b,d&&d.historyData||null),this.historyChanging=!1}},_getCurrentUrlInfo:function(){var a=this._parseUrl(window.location,this.baseUrlInfo);return a=this._normalizeUrlInfo(a)},_parseUrl:function(a,b){var c;"string"==typeof a?(this.parsingLink||(this.parsingLink=new Element("a")),this.parsingLink.href=a,this.parsingLink.href=this.parsingLink.href,c=this.parsingLink):c=a;var d={href:c.href,pathname:c.pathname.replace(/^\/?/,"/"),search:c.search,hash:"#"==c.hash?"":c.hash};if(b){var e=b.pathname+b.search,f=d.pathname+d.search;d.relativeUrl=e===f?d.hash:d.pathname+d.hash}return d},_normalizeUrlInfo:function(a){if(a.hash&&"/"===a.hash.charAt(1)){var b=a.hash.substr(1);"/"===b&&(b=""),a=this._parseUrl(b)}return a}}),Uverse.utils.ImagesLoader=new Class({queue:[],results:[],initialize:function(){},loadImages:function(a,b){this.queue.push(Array.from(arguments)),1===this.queue.length&&this._nextQueue()},_nextQueue:function(){var a=this.queue[0];Asset.images(a,{onComplete:this._onImagesComplete.bind(this)})},_onImagesComplete:function(){this.queue.shift(),this.results.push(!0),this.queue.length&&this._nextQueue()},hasLoaded:function(a){return this.results[a]}}),Uverse.Enums.InHomeStatus={OK:"STB_OK",NOTFOUND:"STB_NOT_FOUND",FORBIDDEN:"STB_FORBIDDEN",ERROR:"ERROR",JAVA_OUT_OF_DATE:"javaoutofdate",APPLET_NOT_INSTALLED:"appletnotinstalled",OUT_OF_HOME:"outofhome",IN_HOME:"inhome"},Uverse.utils.InHomeApplet=new Class({Implements:[Options,Timers],options:{appletPollInterval:15,appletRunTime:30},isAtHome:null,isOnPage:!1,isRunning:!1,inHomeApplet:null,appletSetup:!1,userName:"",subscriptions:[],initialize:function(a){this.setOptions(a),Uverse.page.isUserLoggedIn()&&(this.userName=Uverse.page.personalization.userData.getUsername())},setupApplet:function(){this.isInstalled()?this.hasJavaMinVersion()?this.appletSetup||(this._createAppletCallback(),this._runApplet(!1),this.appletSetup=!0):this.isAtHome=Uverse.Enums.InHomeStatus.JAVA_OUT_OF_DATE:this.isAtHome=Uverse.Enums.InHomeStatus.APPLET_NOT_INSTALLED},_getAppletData:function(){return Uverse.page.retrieveFromCache("inHomeApplet-"+this.userName,!1)||{}},_setAppletData:function(a){Uverse.page.storeToCache("inHomeApplet-"+this.userName,a,!1)},_addApplet:function(){var a=this._getAppletData(),b=(new Date).format("%s"),c=!a.startTime||b-a.startTime>this.options.appletRunTime,d=!a.endTime||b-a.endTime-this.options.appletRunTime>=60*this.options.appletPollInterval;this.isOnPage||(Uverse.console.log("[InHomeApplet]","Previous load attempt: "+b-a.startTime||0,"Previous run finish: "+b-a.endTime||0),c&&d?(a.startTime=b,this._setAppletData(a),this._setAppletRunStatus(!0),this.isOnPage=!0,Uverse.console.log("[InHomeApplet]","Loading In Home Applet"),this._addAppletElement()):d?this.setTimer(this._addApplet,{timeout:1e3*this.options.appletRunTime}):(this.setTimer(this._addApplet,{timeout:1e3*(60*this.options.appletPollInterval-(b-a.endTime)+this.options.appletRunTime)}),this.isAtHome=a.success,this._updateSubscriptions()))},_addAppletElement:function(){var a=new Element("div",{html:Uverse.config.inHomeApplet.html});$(document.body).adopt(a),this.inHomeApplet=a.getElement("#inHomeApplet")},_createAppletCallback:function(){window.setInHomeStatus=function(a){this.setInHomeStatus(a)}.bind(this)},_runApplet:function(a){var b=this._getAppletData(),c=(new Date).format("%s"),d=0;if(b.installed){if(b.endTime&&(d=Math.max(0,1e3*(60*this.options.appletPollInterval-(c-b.endTime)-this.options.appletRunTime)),d>0))return this.isAtHome=b.success,void this.setTimer(this._addApplet,{timeout:d});this.setTimer(this._addApplet,{timeout:d+1e3})}},_setAppletRunStatus:function(a){this.isRunning=a,window.fireEvent("inHomeApplet-running",a)},forceInstallApplet:function(){this.recheckInHomeStatus()},subscribe:function(a){this.setupApplet(),this.isRunning||a(this.isAtHome),Uverse.page.isUverseUser()&&this.subscriptions.push(a)},unsubscribe:function(a){for(var b=0;b<this.subscriptions.length;b++)this.subscriptions[b]===a&&this.subscriptions.splice(b,1)},recheckInHomeStatus:function(){Uverse.page.isUverseUser()&&(this.isRunning||(this.inHomeApplet?(this._setAppletRunStatus(!0),this.inHomeApplet.requestProbe()):(this.clearTimers(),this._setAppletData({installed:this.isInstalled()}),this._createAppletCallback(),this.appletSetup=!0,this._addApplet())))},setInHomeStatus:function(a){this.isAtHome=a===Uverse.Enums.InHomeStatus.OK?Uverse.Enums.InHomeStatus.IN_HOME:Uverse.Enums.InHomeStatus.OUT_OF_HOME,this._storeAppletStatusToCache(),this._updateSubscriptions(),this._setAppletRunStatus(!1),Uverse.console.log("[InHomeApplet]","In Home Applet Loaded",a)},getCurrentStatus:function(){return this.isAtHome},_storeAppletStatusToCache:function(){var a=this._getAppletData();Object.append(a,{success:this.isAtHome,installed:!0,endTime:(new Date).format("%s")}),this._setAppletData(a)},isInstalled:function(){if(!Uverse.page.isUverseUser())return!1;var a=this._getAppletData();return!!a.installed},_updateSubscriptions:function(){for(var a=0;a<this.subscriptions.length;a++)this.subscriptions[a](this.isAtHome)},hasJavaMinVersion:function(){return this.detectJavaVersion||(this.detectJavaVersion=new Uverse.utils.DetectJavaVersion),this.detectJavaVersion.hasMinVersion()}}),Uverse.utils.LiveAjaxManager=new Class({Implements:[Options,Timers],subscriptions:{},metadataRequest:null,options:{updateInterval:30,initialAmountOfTime:Uverse.config.liveAjax.initialAmountOfTime,amountOfTimeToRequest:120,minutesToBufferRequest:5,testOffset:0,metadataUrl:"/liveChannelMetadata.json"},channelsToUpdate:[],contextTags:[],initialize:function(a){this.setOptions(a),this._setupAjaxRequest(),this._setupInitialRun()},_setupAjaxRequest:function(){this.metadataRequest=new Request.JSON({url:this.options.metadataUrl,method:"get",onSuccess:this._metadataReceived.bind(this),timeout:5e3})},_setupInitialRun:function(){var a=this._getCurrentTime(),b=a.get("minutes"),c=this.options,d=6e4*(c.initialAmountOfTime-c.testOffset-c.minutesToBufferRequest+(60-b)%c.updateInterval),e=Number.random(0,60*(c.minutesToBufferRequest-1)*1e3);this.setTimer(this._setInterval,{timeout:d+e})},_getCurrentTime:function(){var a=(new Date).increment("minute",this.options.testOffset);return a},_setInterval:function(){this.setTimer(this._checkAjaxUpdates,{interval:6e4*this.options.updateInterval}),this._checkAjaxUpdates()},_checkAjaxUpdates:function(){this._getCardsToUpdate(),this.channelsToUpdate.length&&this._requestChannelData()},_requestChannelData:function(){var a=this.channelsToUpdate.splice(0,35),b=+this._getCurrentTime().format("%s"),c=1e3*(60*this.options.updateInterval-b%(60*this.options.updateInterval)+b),d=[];d.push("videoKey="+a.join("&videoKey=")),d.push("startTime="+c),d.push("endTime="+(c+60*this.options.amountOfTimeToRequest*1e3)),this.contextTags.length>0&&d.push("tags="+this.contextTags.join(",")),this.metadataRequest.get(d.join("&"))},_getCardsToUpdate:function(){var a=this._getCurrentTime(),b=this.options.updateInterval-a.get("minutes")%this.options.updateInterval,c;a.increment("minute",b).set("seconds",0).set("ms",0);for(var d in this.subscriptions){var e=this.subscriptions[d].liveMetadata;e&&e.peek()&&e.peek().end?(c=new Date(e.peek().end),Uverse.console.log("[LiveAjaxManager",d,c.format("%s"),a.format("%s"),(new Date).format("%s"),c.diff(a,"ms")>=0),c.diff(a,"ms")>=0&&this.channelsToUpdate.push(d)):this.channelsToUpdate.push(d)}},_metadataReceived:function(a){for(var b in a)this.subscriptions[b].liveMetadata.push.apply(this.subscriptions[b].liveMetadata,a[b]);this.channelsToUpdate.length&&this._requestChannelData()},subscribe:function(a,b){this.subscriptions[a.videoKey]=a,this._setContextTags(b.contextTags)},unsubscribe:function(a){delete this.subscriptions[a.videoKey]},_setContextTags:function(a){this.contextTags=a&&a.length>0?a:[]}}),Uverse.utils.LiveEntitlement=new Class({inHomeCallbacks:[],inHomeStatus:Uverse.Enums.Entitlement.UNKNOWN,inHomeStatusSubscribed:!1,entitlementHelper:new Uverse.utils.Entitlement,getEntitlementFunction:function(a,b,c,d,e){function f(b){g=b==h.ALLOWED?h.ALLOWED:void 0!==b&&b!==h.UNKNOWN?i._highestPriorityStatus(g,b):i._getEntitlementStatus(a,!1,c,d),e(g)}var g=this._getEntitlementStatus(a,b,c,d),h=Uverse.Enums.Entitlement,i=this;return!c||g!==h.UNKNOWN&&g!==h.OUT_OF_HOME&&g!==h.ALLOWED||this.inHomeCallbacks.push(f),g!==h.UNKNOWN||this.inHomeStatusSubscribed?e(g):(Uverse.page.subscribeInHomeStatus(this._inHomeStatusUpdated.bind(this)),this.inHomeStatusSubscribed=!0),f},_highestPriorityStatus:function(a,b){var c=Uverse.Enums.Entitlement.Priority[a]||0,d=Uverse.Enums.Entitlement.Priority[b]||0;return c>d?a:b},_getEntitlementStatus:function(a,b,c,d){var e=this.entitlementHelper.compareEntitlement(a),f=Uverse.Enums.Entitlement;return c&&Uverse.page.isUserLoggedIn()&&this._isGeoRestricted(d)?f.GEO_RESTRICTED:b?f.BLACKED_OUT:e!=f.ALLOWED?e:c?Uverse.page.isInHomeInstalled()?this.inHomeStatus:f.APPLET_NOT_INSTALLED:f.ALLOWED},_inHomeStatusUpdated:function(a){var b=a?Uverse.Enums.Entitlement.ALLOWED:Uverse.Enums.Entitlement.OUT_OF_HOME;this.inHomeStatus=a;for(var c=0;c<this.inHomeCallbacks.length;c++)this.inHomeCallbacks[c](b)},stopTracking:function(a){for(var b=0;b<this.inHomeCallbacks.length;b++)this.inHomeCallbacks[b]===a&&this.inHomeCallbacks.splice(b,1)},_isGeoRestricted:function(a){return void 0===Uverse.page.personalization.uverseData.getLiveChannelMapping(a)}}),Uverse.utils.LivePluginOsChecker=new Class({initialize:function(){},isUserOnUnsupportedOS:function(){var a=this._compareWithOutdatedOSAndOutdatedIE();return null===a.resultOSVersionCompare?(Uverse.console.log("[ConfigureLivePlayerPluginPage]","OS ("+Browser.Platform.name+") is not supported"),!0):this._doesOSAndBrowserPass(a)},_compareWithOutdatedOSAndOutdatedIE:function(){var a={resultOSVersionCompare:null,resultBrowserVersionCompare:null,minimimOSVersion:null,minimimBrowserVersion:null};return Browser.Platform.mac?(a.resultOSVersionCompare=Uverse.page.compareOSVersion(Uverse.config.livePlayerIncompatible.osVersions.mac),a.minimimOSVersion=Uverse.config.livePlayerIncompatible.osVersions.mac):Browser.Platform.win&&(a.resultOSVersionCompare=Uverse.page.compareOSVersion(Uverse.config.livePlayerIncompatible.osVersions.win),a.minimimOSVersion=Uverse.config.livePlayerIncompatible.osVersions.win,"ie"===Browser.name&&(a.resultBrowserVersionCompare=Uverse.page.compareBrowserVersion(Uverse.config.livePlayerIncompatible.browserVersions.ie),a.minimimBrowserVersion=Uverse.config.livePlayerIncompatible.browserVersions.ie)),a},_doesOSAndBrowserPass:function(a){var b=this._doesOSPass(a),c=this._doesBrowserPass(a);return b&&c?(Uverse.console.log("[ConfigureLivePlayerPluginPage]","OS & Browser pass minimum system requirements"),!1):(Uverse.console.log("[ConfigureLivePlayerPluginPage]","OS and/or Browser DO NOT pass minimum system requirements"),!0)},_doesOSPass:function(a){return a.resultOSVersionCompare===Uverse.Enums.UserAgentDetection.compare.LESS?(Uverse.console.log("[ConfigureLivePlayerPluginPage]","OS ("+Browser.Platform.name+") is LESS than the required minimum version ("+Object.toQueryString(a.minimimOSVersion)+")"),!1):(Uverse.console.log("[ConfigureLivePlayerPluginPage]","OS ("+Browser.Platform.name+") is GREATER or EQUAL to the required minimum version ("+Object.toQueryString(a.minimimOSVersion)+")"),!0)},_doesBrowserPass:function(a){return a.resultBrowserVersionCompare&&a.resultBrowserVersionCompare===Uverse.Enums.UserAgentDetection.compare.LESS?(Uverse.console.log("[ConfigureLivePlayerPluginPage]","Browser ("+Browser.name+Browser.version+") is LESS than the required minimum version ("+Object.toQueryString(a.minimimBrowserVersion)+")"),!1):(null===a.resultBrowserVersionCompare?Uverse.console.log("[ConfigureLivePlayerPluginPage]","Not running IE ("+Browser.name+Browser.version+"), no browser requirement necessary."):Uverse.console.log("[ConfigureLivePlayerPluginPage]","Browser ("+Browser.name+Browser.version+") is GREATER or EQUAL to the required minimum version ("+Object.toQueryString(a.minimimBrowserVersion)+")"),!0)}}),Uverse.utils.LiveTileExpire=new Class({Implements:[Timers],modalOpen:!1,timerExpired:!1,toastAlreadyDisplayed:!1,initialize:function(){this._createTimer(),Uverse.page.addMemoryEvent("modalClosed",this._onModalPlayerClosed.bind(this)),Uverse.page.addMemoryEvent("playVideo",this._onPlayVideo.bind(this))},_createTimer:function(){this.setTimer(this._onTimerExpire,{timeout:60*Uverse.config.liveTiles.scheduleSizeWindowSizeMinutes*1e3})},_onTimerExpire:function(){this.timerExpired=!0,this._attemptToShowToast()},_attemptToShowToast:function(){!this.timerExpired||this.toastAlreadyDisplayed||this.modalOpen||this._showExpiredToast()},_showExpiredToast:function(){Uverse.page.showToast({alert:Uverse.config.liveTiles.expirationToast.infoAlert,message:Uverse.config.liveTiles.expirationToast.infoMessage,button:{text:Uverse.config.liveTiles.expirationToast.buttonText,action:function(){document.location=document.location.href}},timeout:0}),this.toastAlreadyDisplayed=!0},_onPlayVideo:function(){this.modalOpen=!0},_onModalPlayerClosed:function(){this.modalOpen=!1,this._attemptToShowToast()}}),Uverse.utils.Loadable=new Class({implementsLoadable:!0,load:function(){},unload:function(){},destroy:function(){}}),Uverse.utils.LoadableList=new Class({Implements:Uverse.utils.Loadable,list:null,initialize:function(a){this.list=a},load:function(){this._eachLoadable(function(a){a.load()})},unload:function(){this._eachLoadable(function(a){a.unload()})},destroy:function(){this._eachLoadable(function(a){a.destroy()})},_eachLoadable:function(a){this.list.each(function(b){b&&b.implementsLoadable&&a(b)})}}),Uverse.utils.MarketingCountdown=new Class({Implements:[Timers],callback:function(){},bind:null,initialize:function(a,b,c){this.callback=b,this.bind=c;var d=this._getVariousTimeInformation(a);if(d.isStartTimeLessThan24Hours)this.setTimer(this._updateTimeToOnline,{interval:1e3,args:a,alias:"secondTimer"});else{var e=this._formatTimeDifferenceData(d.secondsToOnline,d.formattedTimes.greaterThan24Hours);this.callback.call(this.bind,this._formatCallback(e)),this.setTimer(this.initialize,{timeout:1e3*d.secondsTo24HoursBeforeProgramStart,args:[a,this.callback,this.bind]})}},_getVariousTimeInformation:function(a){var b=(new Date).diff(new Date(a),"second"),c=86400,d=b-c;return 0>=d&&(d=1),{isStartTimeLessThan24Hours:c>b,secondsTo24HoursBeforeProgramStart:d,secondsToOnline:b,formattedTimes:{greaterThan24Hours:new Date(a).format("%B %d")}}},_updateTimeToOnline:function(a){var b=new Date(a),c=this._getTimeDifferenceData(b,{labelsOn:!1}),d=this._getTimeDifferenceData(b,{separator:" ",labelsOn:!0,names:[" sec"," min"," hr"," dy"," yr"],displayNames:[!1,!0,!0,!1,!1]});this.callback.call(this.bind,this._formatCallback(c,d))},_getTimeDifferenceData:function(a,b){var c=new Date;null==a&&(a=new Date);var d=((a-c)/1e3).floor(),e=this._getTimeRemainingFormatted(d,b);return this._formatTimeDifferenceData(d,e)},_formatTimeDifferenceData:function(a,b){return{timeRemaining:a,formattedTimeRemaining:b}},_getTimeRemainingOrZeroIfExpired:function(a){var b;return a>0?b=a:(b=0,this.clearTimer("secondTimer")),b},_getTimeRemainingFormatted:function(a,b){var c={separator:":",names:["s","m","h","d","y"],displayNames:[!0,!0,!0,!1,!1],leadingZeros:[!0,!0,!1,!1,!1],zeroPlaceholders:[!0,!0,!0,!1,!1]};Object.merge(c,b);for(var d=[],e=[60,60,24,365,0],f,g,h=0;h<e.length;h++){if(h&&!a){if(c.zeroPlaceholders[h]){var i=c.labelsOn?c.names[h]||"":"";d.unshift("00"+i)}break}if(f=a,(g=e[h])&&(f=a%g,a=(a/g).floor()),c.leadingZeros[h]&&10>f&&(f="0"+f),c.displayNames[h]){var i=c.labelsOn?c.names[h]||"":"";d.unshift(f+i)}}return d.join(c.separator)},_formatCallback:function(a,b){var c={};return a&&(c.exact={formatted:a.formattedTimeRemaining,actual:this._getTimeRemainingOrZeroIfExpired(a.timeRemaining)}),c.rounded=this._useExactIfRoundedDoesntExist(b,c.exact),c},_useExactIfRoundedDoesntExist:function(a,b){return a?{formatted:a.formattedTimeRemaining,actual:this._getTimeRemainingOrZeroIfExpired(a.timeRemaining)}:b}}),Uverse.utils.NativeUtils={setPxStyles:function(a,b){var c="",d;for(d in b)b.hasOwnProperty(d)&&(c+=""+d+": "+b[d]+"px; ");a.style.cssText=c},setText:function(a,b){if("string"==typeof a.textContent)a.textContent=b;else if("string"==typeof a.innerText)a.innerText=b;else{for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(document.createTextNode(b))}},toggleClass:function(a,b,c){if("object"==typeof a){var d=RegExp(b),e=RegExp("(\\s+)?"+b),f=a.className,g=d.test(f);if(null==c)g?a.className=a.className.replace(e,""):a.className+=" "+b;else if(c){if(g)return;a.className+=" "+b}else{if(!g)return;a.className=f.replace(e,"")}}},_q:function(a,b,c){return null==b&&(b=document),c=c?"All":"",b["querySelector"+c](a)},qs:function(a,b){return this._q(a,b,!1)},qsa:function(a,b){return this._q(a,b,!0)},addClass:function(a,b){this.toggleClass(a,b,!0)},removeClass:function(a,b){this.toggleClass(a,b,!1)},dispose:function(a){return a.parentNode?a.parentNode.removeChild(a):a},getSize:function(a){return{x:a.offsetWidth,y:a.offsetHeight}},clone:function(a){var b=a.cloneNode(!0),c=[b],d=[a],e;for(e=c.length;e--;){var f=c[e],g=d[e];if(f.clearAttributes&&(f.clearAttributes(),f.mergeAttributes(g),f.removeAttribute("uniqueNumber"),f.options))for(var h=f.options,i=g.options,j=h.length;j--;)h[j].selected=i[j].selected}return b},getChildren:function(a){for(var b=a.children,c=[],d=0,e=b.length;e>d;d++){if(Browser.ie){var f=b[d].tagName.toLowerCase();if("!"===f)continue}c.push(b[d])}return c}},Uverse.Enums.NotificationStates={NOTIFIED:"notified",NOT_NOTIFIED:"notNotified"},Uverse.utils.NotificationAPI=new Class({notificationData:$H(),userEmail:null,showList:[],initialize:function(){Uverse.page.isUserLoggedIn()&&(Uverse.page.addMemoryEvent("Notification-showList",this._onShowListRetrieved.bind(this)),Uverse.page.addMemoryEvent("Notification-userEmail",this._onUserEmailRetrieved.bind(this)))},_onShowListRetrieved:function(){this.showList=Uverse.page.getPersonalizationData("notifications").episodes},_onUserEmailRetrieved:function(){this.userEmail=Uverse.page.getPersonalizationData("notifications").emailAddr},getNotificationStateForItem:function(a){return this.showList.contains(a)?Uverse.Enums.NotificationStates.NOTIFIED:Uverse.Enums.NotificationStates.NOT_NOTIFIED},getUserEmail:function(){return this.userEmail}}),Uverse.utils.Pager=new Class({Implements:[Options,Callbacks],options:{itemFx:{property:"left",duration:500,transition:"quint:out"}},callbacks:{pageCountChanged:!1,pageChanged:!1},el:null,scroller:null,currentIndex:-1,pageCount:null,pageWidth:null,initialize:function(a,b,c){this.el=a,this.setOptions(b),this.sliderEl=a.getElement(b.sliderElementSelector)||a.getChildren()[0],this.setCallbacks(c),this._setupScroller()},movePage:function(a){this.setPage(this.currentIndex+a)},setPage:function(a){if(a=Math.min(Math.max(0,a),this.pageCount-1),this.currentIndex!==a){this.currentIndex=a;var b=this.currentIndex*this.pageWidth;this.scroller.start(-b),this.callbacks.pageChanged&&this.callbacks.pageChanged(this.currentIndex,this.pageCount-1)}},_setupScroller:function(){this.pageWidth=this.el.getWidth();var a=this.sliderEl.getScrollWidth();this.sliderEl.setStyle("width",a),this.pageCount=Math.ceil(a/this.pageWidth),this.sliderEl.set("tween",this.options.itemFx),this.scroller=this.sliderEl.get("tween"),this.callbacks.pageCountChanged&&this.callbacks.pageCountChanged(this.pageCount)}}),Uverse.utils.Personalization=new Class({Implements:[Callbacks],callbacks:{userDataComplete:null,uverseDataComplete:null},userData:null,uverseData:null,initialize:function(a){this.setCallbacks(a),this._fetchUserData(),this._fetchUverseData()},_fetchUserData:function(){this.userData=new Uverse.utils.Personalization.UserData,this.callbacks.userDataComplete.delay(0)},_fetchUverseData:function(){this.uverseData=new Uverse.utils.Personalization.UverseData,this.userData.isLoggedIn()?this.uverseData.requestData({onComplete:this._onUverseDataComplete.bind(this)}):this._onUverseDataComplete()},_onUverseDataComplete:function(){this.callbacks.uverseDataComplete.delay(0)},isUserDataComplete:function(){return this.userData.complete},isUverseDataComplete:function(){return this.uverseData.complete},isLoggedIn:function(){return this.userData.isLoggedIn()},getUsername:function(){return this.userData.getUsername().trim()},getUserZip:function(){return this.userData.getZip()},getUserEntitlement:function(){return this.userData.getUserEntitlement()},isUverseUser:function(){return this.userData.isUverse()},isDSL:function(){return this.userData.isDSL()},getPersonalizationData:function(a){return this.uverseData.getPersonalizationData(a)},setPersonalizationData:function(a,b){return this.uverseData.setPersonalizationData(a,b)},favoriteAddItem:function(a){this.uverseData.favoriteAddItem(a)},favoriteRemoveItem:function(a){this.uverseData.favoriteRemoveItem(a)},setNotificationUserEmail:function(a){this.uverseData.setNotificationUserEmail(a)},notificationAddCategoryPath:function(a){this.uverseData.notificationAddCategoryPath(a)},getVideoBookmark:function(a){return this.uverseData.getVideoBookmark(a)},setVideoBookmark:function(a,b){this.uverseData.setVideoBookmark(a,b)}}),Uverse.utils.Personalization.UserData=new Class({cookieNames:Uverse.Enums.CookieNames,cookieValues:{tablet:"tablet",ipad:"ipad",LOGGED_IN:"LOGGEDIN",EMPTY_PACKAGES:"U>"},username:null,entitlementPackages:{string:"",list:[],addons:[]},loginPortal:null,uverseUser:!1,hsia:!1,hasHSIAPackage:!1,dsl:!1,hd:!1,zip:null,complete:!1,uverseExists:!1,initialize:function(){this._getUserInfoFromCookie(),this.complete=!0},_getUserInfoFromCookie:function(){this._getCookieUsername(),this._getCookieForLoginPortal(),this._getCookieForHSIA(),this._getCookieForHD(),this._getCookieDeviceType(),this._getCookieDeviceName(),this.isLoggedIn()&&(this._getCookieForEntitlement(),this._getCookieForPackages(),this._getCookieForUverse(),this._getCookieForZip(),this._setHSIAPackage(),this._setDSL()),this._setUverseUser()
},_getCookieUsername:function(){this.username=Cookie.read(this.cookieNames.USERNAME)},_getCookieForEntitlement:function(){var a=Cookie.read(this.cookieNames.ENTITLEMENT);if(a){a=a.replace(/"/g,""),this.entitlementPackages.string=a,this.entitlementPackages.list=this.entitlementPackages.string.split(",");var b=$H();this.entitlementPackages.list.each(function(a){b[a]=!0}),this.entitlementPackages.hash=b}},_getCookieForPackages:function(){var a=Cookie.read(this.cookieNames.ADDED_PACKAGES);a&&(a=a.replace(/"/g,""),this.entitlementPackages.addons=a.split(","))},_getCookieForLoginPortal:function(){var a=this.cookieNames,b=window.__usingNewAuth?a.LOGINPORTAL_NEW:a.LOGINPORTAL;this.loginPortal=Cookie.read(b)},_getCookieForUverse:function(){this.uverseValue=Cookie.read(this.cookieNames.UVERSE),this.uverseExists=this.uverseValue&&""!==this.uverseValue?!0:!1},_getCookieForHSIA:function(){var a=Cookie.read(this.cookieNames.HSIA);this.hsia=a&&"true"===a?!0:!1},_getCookieForHD:function(){var a=Cookie.read(this.cookieNames.HAS_HD);this.hd=a&&"true"===a?!0:!1},_getCookieForZip:function(){this.zip=Cookie.read(this.cookieNames.ZIP)},_getCookieDeviceType:function(){this.deviceType=Cookie.read(this.cookieNames.DEVICE_TYPE)},_getCookieDeviceName:function(){this.deviceName=Cookie.read(this.cookieNames.DEVICE_NAME)},_setHSIAPackage:function(){var a="D>HSIA",b=this.entitlementPackages.list;this.hasHSIAPackage=b.contains(a)},_setDSL:function(){var a="D>DSL",b=this.entitlementPackages.list;this.dsl=b.contains(a)},getUserEntitlement:function(){return this.entitlementPackages},isLoggedIn:function(){return null!=this.username&&null!=this.loginPortal&&""!==this.loginPortal},getUsername:function(){return this.username},getZip:function(){return this.zip},hasHD:function(){return this.hd},getDeviceType:function(){return this.deviceType},getDeviceName:function(){return this.deviceName},getUverseValue:function(){return this.uverseValue},isHSIA:function(){return this.hsia},isDSL:function(){return this.dsl},_setUverseUser:function(){(this.uverseExists||this.hasHSIAPackage||this.dsl)&&(this.uverseUser=!0)},isUverse:function(){return this.uverseUser}}),Uverse.utils.Personalization.UverseData=new Class({Implements:[Callbacks],Binds:["_onPersonalizationComplete"],callbacks:{onComplete:null},url:"/personalisation.json",personalizationData:{},request:null,complete:!1,initialize:function(){this.request=new Request.JSON({url:this.url,method:"get",link:"cancel",noCache:!0,autoRetry:!0,onSuccess:this._onPersonalizationComplete})},requestData:function(a){this.setCallbacks(a),this._makePersonalizationRequest()},_makePersonalizationRequest:function(){this.request.send()},_onPersonalizationComplete:function(a){this.personalizationData=a,this.complete=!0,this.callbacks.onComplete()},getPersonalizationData:function(a){if(!a)throw Error("Missing argument (name): must request a type of personalization data");return this.personalizationData[a]||null},setPersonalizationData:function(a,b){this.personalizationData[a]=b},favoriteAddItem:function(a){this.personalizationData.library.include(a)},favoriteRemoveItem:function(a){this.personalizationData.library.erase(a)},setNotificationUserEmail:function(a){this.personalizationData.notifications.emailAddr=a},notificationAddCategoryPath:function(a){this.personalizationData.notifications.episodes.push(a)},getVideoBookmark:function(a){return this.personalizationData.bookmarks[a]},setVideoBookmark:function(a,b){this.personalizationData.bookmarks[a]=b},isDeviceRetreived:function(){return this.personalizationData.deviceRetreived||!1},setDeviceRetreived:function(a){this.personalizationData.deviceRetreived=a},getTimeZoneInfo:function(){return this.personalizationData.timeZoneDetail},isHouseholdAccount:function(){return this.personalizationData.isHouseholdAccount},getLiveChannelMapping:function(a){return this.personalizationData&&this.personalizationData.liveChannelMapping?this.personalizationData.liveChannelMapping[a]:null},hasDvr:function(){return this.personalizationData.hasDvr},getUserIdHash:function(){return this.personalizationData.userIdHash||null}}),Uverse.utils.PlayerManager=new Class({Implements:[Uverse.utils.Loadable,Options],el:null,contentEls:{player:null,loading:null},options:{item_id:null,playerClassName:null,companionAdClassName:null,headerTitleClassName:".modal-player-header-title-text",playerOptions:{companionAdEl:null,videoNetwork:null,playerApi:null},extensions:[],extensionsOptions:{}},player:null,extensionManager:null,videoKey:null,shrink:null,initialize:function(a,b){Uverse.console.log("[PlayerManager]","Player Manager Loaded"),this.el=$(a),this.setOptions(b),this._setupElements(),this._setupShrink(),this._setupExtensionManager(),this.extensionManager.runPlayerLoading()},_setupElements:function(){this.contentEls.player=this.el.getElement(".player"),this.contentEls.loading=this.el.getElement(".player-loading")},_setupShrink:function(){this.shrink=new Uverse.utils.Shrink,this.shrink.resize(this.el.getElement(this.options.headerTitleClassName))},_setupExtensionManager:function(){var a=this.options.extensions,b=this.options.extensionsOptions,c=this._startPlayer.bind(this);this.extensionManager=new Uverse.playerExtensions.ExtensionManager(this.el,a,c,b)},_startPlayer:function(){this.videoKey=this._getVideoKey(this.options.item_id),this._showLoading(),this._createPlayerInstance(this.options.playerClassName)},_getVideoKey:function(a){return a=a.replace(/\:s$/,""),a.substring(a.indexOf(":")+1)},_createPlayerInstance:function(a){this.options.playerOptions.companionAdEl=this.el.getElement("."+this.options.companionAdClassName),Uverse.console.log("[PlayerManager]","Starting",a),this.player=new Uverse.players[a](this.contentEls.player,this.options.playerOptions),this.player.addEvent("ready",this._loadVideo.bind(this)),this.player.addEvent("playerError",this._onPlayerError.bind(this)),this.player.addEvent("videoEnd",this._onPlayerVideoEnd.bind(this)),this.extensionManager.runPlayerLoaded(this.player,this.el),this.player.build(this.options.playerLocation)},_showLoading:function(){this.contentEls.loading.removeClass("hidden")},_hideLoading:function(){this.contentEls.loading.addClass("hidden")},_loadVideo:function(){this.player.load(this.videoKey,this.options.item_id),this._hideLoading()},_onPlayerError:function(a){Uverse.console.error("[PlayerManager]","Player Error: ",a),this._destroyPlayer()},_onPlayerVideoEnd:function(){this._destroyPlayer(),this.extensionManager.runPlayerFinished()},_destroyPlayer:function(){this.player&&(this.player.destroyPlayer(),this.player=null)},load:function(){},unload:function(){},destroy:function(){this.extensionManager.destroyExtensions(),this._destroyPlayer(),$(this.el).destroy()}}),Uverse.utils.RecordButtons=new Class({options:{isSeries:!1,messages:{conflictAlert:null,conflictMessage:null,conflictButtonText:null,conflictButtonLink:null},recordingOptions:{messages:{pageBlockerMessage:null,recordFail:null,recordEpisodeFail:null,eraseFail:null,updateFail:null,tryAgain:null},flyoutOptions:null}},contentEls:{airings:[],header:null},_setupRecordingOptions:function(){var a={};this.recordingOptions=new Uverse.widgets.epg.RecordingOptions(this.el,this.options.recordingOptions,a)},_onDvrData:function(){var a=Uverse.Enums.RecordingType.NONE,b=!1,c=[];this.recordingOptions||this._setupRecordingOptions(),this.contentEls.airings.each(function(d,e){var f=d.retrieve("metadata")||d.getElement(".has-program-info")||d,g=f.get("data-program-id"),h={channelNumber:f.get("data-channel"),programId:f.get("data-program-id"),startTime:f.get("data-start-time")},i=Uverse.page.dvr.getDvrStateForGuideItem(h);i?(i.recordingOptions&&f.set("data-end-option",i.recordingOptions.endRecordingOption).set("data-keep-until",i.recordingOptions.keepRecordingOption).set("data-recording-id",i.recordingId),c.contains(i.dvrGroup.id)||c.push(i.dvrGroup.id),a!==Uverse.Enums.RecordingType.NONE||this.options.isSeries&&i.recordingType!==Uverse.Enums.RecordingType.SERIES||(a=i.recordingType,this.contentEls.header.set("data-show-type",i.dvrGroup.showTypeRecordingOption).set("data-air-time",i.dvrGroup.airtimeRecordingOption).set("data-end-option",i.dvrGroup.endRecordingOption).set("data-keep-until",i.dvrGroup.keepRecordingOption).set("data-program-info-keys",f.get("data-program-info-keys")))):f.set("data-end-option",null).set("data-keep-until",null).set("data-recording-id","0");var j=d.getElements(".epg-show-tag.record"),k=d.retrieve("metadata");k&&j.append(k.getElements(".epg-show-tag.record")),j&&(["record-conflict","record-series","hidden"].each(function(a){j.removeClass(a)}),i?i.recordingStatus===Uverse.Enums.RecordingStatus.CONFLICTED&&(j.addClass("record-conflict"),b=!0):j.addClass("hidden")),this.showRecordButtons(f,i?i.recordingType:Uverse.Enums.RecordingType.NONE)}.bind(this)),this.contentEls.header.set("data-group-ids",c.join(",")),this._updateHeaderButtons(a),b&&this._showConflictToast()},showRecordButtons:function(a,b){var c=b!==Uverse.Enums.RecordingType.NONE;a.getElements(".program-details-button.record").toggleClass("hidden",c),a.getElements(".program-details-button.cancel").toggleClass("hidden",!c),a.getElements(".program-details-button.options").toggleClass("hidden",!c)},_updateHeaderButtons:function(a){this.showRecordButtons(this.contentEls.header,a)},_showConflictToast:function(){Uverse.page.showToast({alert:this.options.messages.conflictAlert,message:this.options.messages.conflictMessage,button:{text:this.options.messages.conflictButtonText,action:this.options.messages.conflictButtonLink}})}}),Uverse.utils.Recycler=new Class({cloneFunc:null,objectQueue:[],initialize:function(a){this.cloneFunc=a},getObject:function(){return this.objectQueue.length?this.objectQueue.pop():this.cloneFunc()},recycle:function(a){this.objectQueue.push(a)},recycleAll:function(a){for(var b=0,c=a.length;c>b;b++)this.recycle(a[b])}}),Uverse.utils.Shrink=new Class({Implements:[Options],options:{minimumFontSize:11},initialize:function(a){this.setOptions(a)},resize:function(a){for(var b=a.getParent(),c=parseInt(a.getStyle("font-size"),10);a.offsetWidth>b.offsetWidth&&c>this.options.minimumFontSize;)a.setStyle("font-size",--c)}}),Uverse.utils.TileHelper=new Class({ENTITLEMENT_CLASS_PREFIX:"entitlement-",ellipsify:null,initialize:function(){this.ellipsify=new Uverse.utils.Ellipsify({truncateTo:"word",cloneOriginal:!0,ellipsis:new Element("span.ellipsis").set("text","...")})},ellipsifyElements:function(a,b){a.getElements(b).each(function(a){this.ellipsify.ellipsifyElement(a)}.bind(this))},setupVideoPlayLinks:function(a){var b=a.getElements(".video-play-link");return b.each(function(a){var b=a.get("href").replace("?","#");a.set("href",b)}),b},loadVideoPlayLink:function(a,b){var c=a.getElement(".videoInfo-title"),d=a.getElement(".videoInfo-subtitle"),e=a.getElement(".videoInfo-description");e&&(e=e.retrieve("originalElement")||e);var f={videoTitle:c?c.get("text"):"",videoSubtitle:d?d.get("text"):"",videoDescription:e?e.get("text"):"",videoNetwork:""};"movies"==a.getAttribute("data-content-type")&&(f.videoSubtitle=f.videoTitle);var g={windowTitle:f.videoTitle,replaceHistory:!1};Uverse.page.loadDeepLink(b,f,g)},applyEntitlement:function(a,b){var c=this.getEntitlementStringFromElement(a),d=b.compareEntitlement(c),e=this._createEntitlementAccessClassName(d);a.addClass(e)},getEntitlementStringFromElement:function(a){var b=a.get("data-entitlement");return b=b?b.replace(/::/g,">"):""},_createEntitlementAccessClassName:function(a){return this.ENTITLEMENT_CLASS_PREFIX+a},getEntitlementStateViaClassName:function(a,b){var c=this._createEntitlementAccessClassName(b);return a.hasClass(c)}}),Uverse.utils.TokenHandler=new Class({Implements:[Callbacks],callbacks:{tokenError:null,tokenRetrieved:null},MAX_STREAMS_ERROR_CODE:"max-streams",initialize:function(a){this.setCallbacks(a)},sendAuthenticationRequest:function(a){var b=new Request({method:"get",headers:{Accept:"application/xml"},url:Uverse.config.token.urls.token.substitute({key:a}),onSuccess:this._onAuthenticationRequestComplete.bind(this),onFailure:this._onRequestFailure.bind(this)});b.send()},_onRequestFailure:function(a){500==a.status&&this.callbacks.tokenError(this.MAX_STREAMS_ERROR_CODE)},_onAuthenticationRequestComplete:function(a,b){function c(a){return b.getElementsByTagName(a)[0].firstChild}if(!this._isErrorThenHandle(b)){var d=c("playToken"),e=c("streamToken").data,f=c("heartbeat").data;this.callbacks.tokenRetrieved({tokenXML:d,tokenString:this._serializeToken(d)},e,f)}},_serializeToken:function(a){if(a.xml)return a.xml;var b=new XMLSerializer;return b.serializeToString(a)},_isErrorThenHandle:function(a){var b=a.getElementsByTagName("error")[0];return b?(this.callbacks.tokenError(b.firstChild.data),!0):!1}}),function(){var a={"transitions-tile-drawer-open":{props:["height"]},"transitions-modal-shadow-open":{props:["opacity"]},"transitions-modal-container-open":{props:[]},"transitions-mastfooter-open":{props:["bottom"]},"transition-mastfooter-back-to-top":{props:["width"]},"transition-mastfooter-back-to-top-show":{props:["bottom"]},"transition-tile-groups-reloading":{props:["opacity"]},"transition-main-nav-menu-shown":{props:["height"]},"transition-toast-shown":{props:["top"]}};Element.implement({addClassWithTransition:function(b,c){return c=c||a[b],c||Uverse.console.warn("[Transitions]","Transition is not defined for:",b),this.transition(c,function(){this.addClass(b)})},removeClassWithTransition:function(b,c){return c=c||a[b],c||Uverse.console.warn("[Transitions]","Transition is not defined for:",b),this.transition(c,function(){this.removeClass(b)})},toggleClassWithTransition:function(a,b){return this.hasClass(a)?this.removeClassWithTransition(a,b):this.addClassWithTransition(a,b)}})}(),Uverse.utils.UnsupportedBrowsers=new Class({el:null,unsupportedUserAgents:null,unsupportedUserAgent:null,clientUserAgent:null,clientDocumentMode:null,noToast:null,initialize:function(){this.unsupportedUserAgents=Uverse.config.unsupportedBrowsers,this.clientUserAgent=navigator.userAgent,this.clientDocumentMode=document.documentMode,this.unsupportedUserAgent=this._getUnsupportedUserAgent(this.clientUserAgent,this.clientDocumentMode)},_getUnsupportedUserAgent:function(a,b){for(var c in this.unsupportedUserAgents){var d=this.unsupportedUserAgents[c];if(this._isUserAgentMatch(a,b,c,d))return d.browserIsSupported===!0?null:(d.disabledToast===!0&&(this.noToast=!0),d)}return null},_isUserAgentMatch:function(a,b,c,d){return!a.match(RegExp(c))||void 0!==d.andDocumentModeIsNot&&d.andDocumentModeIsNot===b?!1:!0}}),Uverse.Enums.UserAgentDetection={compare:{EQUAL:0,LESS:-1,GREATER:1}},Uverse.utils.UserAgentDetection=new Class({userAgentItems:"",OSVersion:{},browserVersion:{},isDeviceIpad:null,initialize:function(){this._determineUserAgentParts(),this.deviceInfo=this._getDeviceInfo()},compareOSVersion:function(a){return this._fillMissingMinors(a),this._determineOSVersion(),this._doDeepCompare(a,this.OSVersion)},compareBrowserVersion:function(a){return this._fillMissingMinors(a),this._determineBrowserVersion(),this._doDeepCompare(a,this.browserVersion)},_doDeepCompare:function(a,b,c){c||(c=0);var d=Object.keys(b);return c>=d.length?Uverse.Enums.UserAgentDetection.compare.EQUAL:a[d[c]]===b[d[c]]?this._doDeepCompare(a,b,++c):a[d[c]]<b[d[c]]?Uverse.Enums.UserAgentDetection.compare.GREATER:a[d[c]]>b[d[c]]?Uverse.Enums.UserAgentDetection.compare.LESS:void 0},_determineUserAgentParts:function(){""===this.userAgentItems&&(this.userAgentItems=navigator.userAgent.split(/\s*[;)(]\s*/))},_determineOSVersion:function(){if(this.OSVersion.major)return this.OSVersion;if(Browser.Platform.win)this._determineOSVersionWindows();else if(Browser.Platform.mac)this._determineOSVersionMac();else{if(!Browser.Platform.linux)return void Uverse.console.warn("UserAgentDetection","Your OS could not be detected. Something bad may have happened.");this._determineOSVersionLinux()}this._fillMissingMinors(this.OSVersion),Uverse.console.log("UserAgentDetection","OS ("+Browser.Platform.name+") version: "+Object.toQueryString(this.OSVersion))},_determineBrowserVersion:function(){if(this.browserVersion.major)return this.browserVersion;if("ie"===Browser.name)this._determineIEBrowserVersion();else if("chrome"===Browser.name)this._determineChromeBrowserVersion();else if("firefox"===Browser.name)this._determineFirefoxBrowserVersion();else if("opera"===Browser.name)this._determineOperaBrowserVersion();else{if("safari"!==Browser.name)return void Uverse.console.warn("[UserAgentDetection]","Your Browser could not be detected. Something bad may have happened.");this._determineSafariBrowserVersion()}this._fillMissingMinors(this.browserVersion),Uverse.console.log("[UserAgentDetection]","Browser version: "+Object.toQueryString(this.browserVersion))},_determineOSVersionWindows:function(){var a=/^.*Windows NT ((\d[._]?)*).*$/gm,b=a.exec(navigator.userAgent);if(!b[1])return this._setLowestVersion(this.OSVersion,"OS"),void Uverse.console.log("[UserAgentDetection]","Cannot detect individual OS versions for Windows 98 and less.");var c=b[1].split(/[_.]/);this.OSVersion={major:+c[0],minor:+c[1],update:+c[2]}},_determineOSVersionMac:function(){var a=this.userAgentItems[2].split(" ")[4].split(/[_.]/);this.OSVersion={major:+a[0],minor:+a[1],update:+a[2]}},_determineOSVersionLinux:function(){this._setLowestVersion(this.OSVersion,"OS"),Uverse.console.log("[UserAgentDetection]","Cannot detect versions of linux.")},_setLowestVersion:function(a,b){a={major:0,minor:0,update:0},Uverse.console.log("[UserAgentDetection]","Setting the "+b+" version to 0.")},_determineIEBrowserVersion:function(){var a=Object.hasOwnProperty.call(window,"ActiveXObject")&&!window.ActiveXObject;if(a)return this._setLowestVersion(this.browserVersion,"browser"),void(this.browserVersion.major=11);var b=/^.*MSIE ((\d[._]?)*);.*$/gm,c=b.exec(navigator.userAgent);if(!c[1])return this._setLowestVersion(this.browserVersion,"browser"),void Uverse.console.log("[UserAgentDetection]",'Cannot detect IE browser version (user-agent does not inculde "MSIE").');var d=c[1].split(/[_.]/);this.browserVersion={major:+d[0],minor:+d[1],update:+d[2]}},_determineChromeBrowserVersion:function(){this._setLowestVersion(this.browserVersion,"browser"),Uverse.console.log("[UserAgentDetection]","Cannot detect versions of chrome.")},_determineFirefoxBrowserVersion:function(){this._setLowestVersion(this.browserVersion,"browser"),Uverse.console.log("[UserAgentDetection]","Cannot detect versions of firefox.")},_determineOperaBrowserVersion:function(){this._setLowestVersion(this.browserVersion,"browser"),Uverse.console.log("[UserAgentDetection]","Cannot detect versions of opera.")},_determineSafariBrowserVersion:function(){this._setLowestVersion(this.browserVersion,"browser"),Uverse.console.log("[UserAgentDetection]","Cannot detect versions of safari.")},_fillMissingMinors:function(a){a.major&&""!==a.major||(a.major=0),a.minor&&""!==a.minor||(a.minor=0),a.update&&""!==a.update||(a.update=0)},isIpadTablet:function(){if(null!==this.isDeviceIpad)return this.isDeviceIpad;var a=this.userAgentItems[1].toLowerCase();return this.isDeviceIpad=-1!=a.indexOf("ipad"),this.isDeviceIpad},_getDeviceInfo:function(){var a={name:this._determineDeviceName(),isMobile:this._determineMobile.bind(this),orientation:this._determineOrientation()};return a},_determineDeviceName:function(){var a;return a=Browser.Platform.ios?this.userAgentItems[1].toUpperCase():Browser.Platform.name.toUpperCase(),Uverse.console.log("[DeviceDetection] - Device Name: "+a),a},_determineMobile:function(){return Browser.Platform.ios||Browser.Platform.android?!0:!1},_determineOrientation:function(){var a=window.screen.availWidth>window.screen.availHeight?Uverse.Enums.Orientation.LANDSCAPE:Uverse.Enums.Orientation.PORTRAIT;return a}}),Uverse.utils.WebtrendsAPI=new Class({metaTagsNames:{REGISTERED_VISITOR:"WT.rv",LOGGED_IN:"WT.z_LoggedIn",USER_TYPE:"WT.z_UserType",IS_HSIA:"WT.z_HSIA",USERNAME:"DCS.dcsaut"},metaTagBooleanContents:{REGISTERED:1,LOGGED_IN:"Logged In",LOGGED_OUT:"Guest",USER_UVERSE:"U-verse",USER_ATT:"ATT.net",USER_HSIA:"HSIA",USER_NONHSIA:"Non-HSIA"},initialize:function(){Uverse.page.addMemoryEvent("Personalization-userData",this._addMetaTags.bind(this))},_addMetaTags:function(a){if(a.isLoggedIn()){this._addMetaTagToPage({name:this.metaTagsNames.REGISTERED_VISITOR,content:this.metaTagBooleanContents.REGISTERED}),this._addMetaTagToPage({name:this.metaTagsNames.LOGGED_IN,content:this.metaTagBooleanContents.LOGGED_IN});var b=this._hasOnlyDSLPackage(a),c=a.isUverse()&&!(a.isDSL()&&b);this._addMetaTagToPage(c?{name:this.metaTagsNames.USER_TYPE,content:this.metaTagBooleanContents.USER_UVERSE}:{name:this.metaTagsNames.USER_TYPE,content:this.metaTagBooleanContents.USER_ATT})}else this._addMetaTagToPage({name:this.metaTagsNames.LOGGED_IN,content:this.metaTagBooleanContents.LOGGED_OUT});this._addMetaTagToPage(a.isHSIA()?{name:this.metaTagsNames.IS_HSIA,content:this.metaTagBooleanContents.USER_HSIA}:{name:this.metaTagsNames.IS_HSIA,content:this.metaTagBooleanContents.USER_NONHSIA}),this._loadWebtrends()},_hasOnlyDSLPackage:function(a){var b=a.getUserEntitlement().list,c=[a.cookieValues.LOGGED_IN,a.cookieValues.EMPTY_PACKAGES],d=b.filter(function(a){return!c.contains(a)});return 1===d.length},_addMetaTagToPage:function(a){new Element("meta",{name:a.name,content:a.content}).inject(document.head)},_loadWebtrends:function(){var a={dcsid:Uverse.config.webtrends.dcsid,domain:Uverse.config.webtrends.domain,DivList:Uverse.config.webtrends.baseTags,onsitedoms:Uverse.config.webtrends.onsitedoms};window.webtrendsAsyncInit=function(){var b=(new Webtrends.dcs).init({dcsid:a.dcsid,domain:a.domain,navigationtag:"div,span",timezone:-8,offsite:!0,download:!0,downloadtypes:"xls,doc,pdf,txt,csv,zip,docx,xlsx,rar,gzip",onsitedoms:a.onsitedoms,FPCConfig:{enabled:!0,domain:"",name:"wls_id",expires:315569259747},plugins:{LinkTrack:{src:Uverse.config.vendorPath+"Webtrends_10_2_1/linkTrack.js?cache=true",DivList:a.DivList},campaign:{src:Uverse.config.vendorPath+"Webtrends_10_2_1/campaign.js?cache=true"}}}).track({filter:function(a,b){},transform:function(a,b){},finish:function(a,b){}})};var b=document.createElement("script");b.async=!0,b.src=Uverse.config.vendorPath+"Webtrends_10_2_1/webtrends.min.js?cache=true";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}}),Uverse.utils.ZipCodeDetect=new Class({Implements:[Callbacks],callbacks:{zipCodeChanged:null},timezoneZipCodes:{"-0800":92058,"-0700":79936,"-0600":75104,"-0500":30308},defaultZipCode:30308,initialize:function(a){this.setCallbacks(a),this._getInitialZipCode()},_getInitialZipCode:function(){var a=this._getStoredZipCode();a||(a=this._determineDefaultZipCodeByTimeZone()),this.callbacks.zipCodeChanged(a)},_getStoredZipCode:function(){return Uverse.page.retrieveFromSession("EPG_Custom_Zip_Code")},_determineDefaultZipCodeByTimeZone:function(){var a=(new Date).setExact("month",0),b=a.getGMTOffset();return this.timezoneZipCodes[b]||this.defaultZipCode},hasCustomZipCode:function(){return!!this._getStoredZipCode()},updateZipCode:function(a){Uverse.page.storeToSession("EPG_Custom_Zip_Code",a),this.callbacks.zipCodeChanged(a)}}),Uverse.utils.EpgInfo=new Class({Implements:[Options,Callbacks],request:null,options:{normalizedProgramTitle:"",normalizedEpisodeTitle:"",dateFormat:"%a %m/%d at %l:%M%p"},epgInfoUrl:"/epg_info.json",callbacks:{onEpgInfoRecieved:null,onEpgInfoFailed:null},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this.request=new Request.JSON({url:this.epgInfoUrl,data:this.options,method:"get",noCache:!0,onSuccess:this._onSuccess.bind(this),onFailure:this._onFailure.bind(this)}).send()},_onSuccess:function(a){var b={},c={};if(a.guideItem){var d=a.guideItem.airDate,e="";if("number"==typeof d){var f=new Date(d);e=f.format(this.options.dateFormat);var g=this._parseTzNameFromBrowserDateToString(f);g&&(e+=" "+g)}else e=d;b.airDate={friendlyFormat:e},b.programID=a.guideItem.programId,b.isHD=a.guideItem.hd,c={name:a.guideItem.channel.callLetters,number:a.channelLineup.channelNumber}}this.callbacks.onEpgInfoRecieved({canBeRecorded:a.epgStatus.canBeScheduled,hasUpcomingEpisode:a.epgStatus.hasUpcomingEpisode,normalizedProgramTitle:a.epgStatus.normalizedProgramTitle,normalizedEpisodeTitle:a.epgStatus.normalizedEpisodeTitle,airDate:b.airDate,programID:b.programID,isHD:b.isHD,channel:c})},_parseTzNameFromBrowserDateToString:function(a){var b=/(\(([A-Za-z ]+)\)|([A-Z]{3}) [0-9]{4})/g,c=b.exec(a+"");if(c){if(c[2])return c[2].replace(/[a-z ]/g,"");if(c[3])return c[3]}return null},_onFailure:function(){this.callbacks.onEpgInfoFailed()},cancelRequest:function(){this.request.cancel()}}),Uverse.utils.ProgramDetailsManager=new Class({Implements:[Uverse.utils.Loadable,Options,Uverse.utils.RecordButtons],Binds:["_onRecordButtonClick","_onCancelButtonClick","_onDvrData","_onDvrDataFailure","_onSetupComplete","_onAiringClick","_onFormatFormChanging","_loadLiveContent"],el:null,options:{activeAiring:null,scrollDuration:350,liveVideoKey:null,blackout:!1},contentEls:{header:null,airings:null,formatForm:null,showContainer:null,showContainerHd:null,showContainerSd:null,episodeInfoContainer:null,watchLiveButton:null},headerHeight:0,formatForm:null,currentMetadata:null,initialize:function(a,b){Uverse.console.log("[ProgramDetailsManager]","Program Details Manager initializing."),this.el=$(a).removeClass("hidden"),this.setOptions(b),this._setupElements(),this._setInitialActiveAiring(),this._setupEvents(),this._setupTweens(),this._setupFormatForm(),this._showActiveAiring(),this._setupPositions(),this._scrollToActiveAiring(),Uverse.page.isUverseUser()||(this._onSetupComplete(),this._setupRecordingOptions(),this.showRecordButtons(this.el,Uverse.Enums.RecordingType.NONE))},_loadLiveContent:function(a){a.preventDefault(),Uverse.page.closeCurrentModal(),window.location.hash="#play="+this.options.liveVideoKey},_setupElements:function(){var a=this.el,b=this.contentEls,c=".epg-table-item-row";b.header=a.getElement(".program-details-header"),b.showContainer=a.getElement(".program-details-notfixed"),b.showContainerHd=b.showContainer.getElement(".hd"),b.showContainerSd=b.showContainer.getElement(".sd"),b.airings=b.showContainer.getElements(c),b.formatForm=a.getElement(".program-details-format-form"),b.episodeInfoContainer=a.getElement(".program-details-episodeInfo-container").removeClass("hidden")},_setupEvents:function(){this.options.liveVideoKey&&this.el.addEvent("click:relay(.program-details-button.watch-live)",this._loadLiveContent),this.el.addEvent("click:relay(.epg-table-item-row)",this._onAiringClick),Uverse.page.dvr.addMemoryEvent("Dvr-dvrData:once",this._onSetupComplete),Uverse.page.dvr.addMemoryEvent("Dvr-dvrData",this._onDvrData),Uverse.page.dvr.addMemoryEvent("Dvr-dvrDataFailure:once",this._onDvrDataFailure)},_removeEvents:function(){this.options.liveVideoKey&&this.el.removeEvent("click:relay(.program-details-button.watch-live)",this._loadLiveContent),this.el.removeEvent("click:relay(.epg-table-item-row)",this._onAiringClick),Uverse.page.dvr.removeMemoryEvent("Dvr-dvrData:once",this._onSetupComplete),Uverse.page.dvr.removeMemoryEvent("Dvr-dvrData",this._onDvrData),Uverse.page.dvr.removeMemoryEvent("Dvr-dvrDataFailure:once",this._onDvrDataFailure)},_setupPositions:function(){this.headerHeight=this.el.getElement(".program-details-fixed").getSize().y,this.contentEls.showContainer.setStyle("padding-top",this.headerHeight)},_setupFormatForm:function(){if(!this.contentEls.formatForm)return void Uverse.console.log("[ProgramDetailsManager]","There is no HD / SD form.");var a={changing:this._onFormatFormChanging};this.formatForm=new Uverse.controls.Form(this.contentEls.formatForm,a)},_onFormatFormChanging:function(a,b,c,d){if("format"===b.getName()){var e="HD"===c;this.contentEls.showContainerHd.toggleClass("hidden",!e),this.contentEls.showContainerSd.toggleClass("hidden",e),this.scrollFx.start(0,0),this._scrollToActiveAiring()}},_setupTweens:function(){var a={duration:this.options.scrollDuration};this.scrollFx=new Fx.Scroll(this.el.getScrollParent(),a)},_showActiveAiring:function(){var a=this._getActiveAiring(),b=a.getClosest(".epg-group"),c=b.hasClass("hd");this.formatForm&&this.formatForm.setValue("format",c?"HD":"SD"),this.contentEls["showContainer"+(c?"Hd":"Sd")].removeClass("hidden"),this._showMetadataForAiring(a)},_showMetadataForAiring:function(a){var b=a.retrieve("metadata");b||(b=a.getElement(".program-details-episodeInfo").dispose().removeClass("hidden"),a.store("metadata",b)),this.contentEls.episodeInfoContainer.empty().adopt(b),this.options.liveVideoKey&&!this.options.blackout&&(this.currentMetadata=b,this._toggleWatchLiveButton())},_toggleWatchLiveButton:function(){var a=this.currentMetadata,b=new Date(+a.get("data-start-time")),c=new Date(+a.get("data-end-time")),d=new Date,e=!(d.diff(c,"second")>0&&d.diff(b,"second")<=0);this.el.getElement(".program-details-button.watch-live").toggleClass("hidden",e)},_onDvrDataFailure:function(){this._onSetupComplete()},_updateHeaderButtons:function(a){if(this.contentEls.header.get("data-program-type")!=Uverse.Enums.RecordingType.SERIES){var b=this._getActiveAiring();a="0"!=b.get("data-recording-id")?Uverse.Enums.RecordingType.SINGLE:Uverse.Enums.RecordingType.NONE}void 0!==a&&this.contentEls.header.get("data-program-type")===Uverse.Enums.RecordingType.SERIES&&(this.showRecordButtons(this.contentEls.header,a===Uverse.Enums.RecordingType.SERIES?a:Uverse.Enums.RecordingType.NONE),this.contentEls.header.getElement(".program-details-header-record-indicator").toggleClass("hidden",a!==Uverse.Enums.RecordingType.SERIES))},_getActiveAiring:function(){return this.contentEls.airings.filter(".active")[0]},_onSetupComplete:function(){this._updateHeaderButtons()},_onAiringClick:function(a,b){this._showMetadataForAiring(b),this.contentEls.airings.removeClass("active"),b.addClass("active"),this._scrollToActiveAiring()},_scrollToActiveAiring:function(){if(0!==this._getActiveAiringIdx()){var a=this._getActiveAiring(),b=a.getOffsetTop()-this.headerHeight;this.scrollFx.start(0,b)}},_setInitialActiveAiring:function(){if(!this.options.activeAiring)return void this.contentEls.airings[0].addClass("active");var a=this._filterActiveItemIdx();this.contentEls.airings.removeClass("active")[a].addClass("active")},_getActiveAiringIdx:function(){for(var a=this.contentEls.airings,b=a.length,c=0;b>c;){if(a[c].hasClass("active"))return c;c++}return 0},_filterActiveItemIdx:function(){for(var a=this.contentEls.airings,b=0,c=a.length;c>b;b++){var d=a[b].getElement(".has-program-info");if(d){var e=d.get("data-internal-id");if(+e===this.options.activeAiring)return b}}return 0},unload:function(){Uverse.console.log("[ProgramDetailsManager]","Program Details Manager unloading."),this._removeEvents()}}),Uverse.utils.TileDrawerOverlayParent=new Class({drawerElement:null,overlayElement:null,templateElementID:null,initialize:function(a){this.drawerElement=a,this._cloneOverlay()},hideOverlay:function(){this.overlayElement&&(this.overlayElement=this.overlayElement.dispose())},_cloneOverlay:function(){this.overlayElement||(this.overlayElement=$(this.templateElementID).clone())},showOverlay:function(a){if(this.overlayElement.removeClass("detached").set("style",null),this.drawerElement.adopt(this.overlayElement),a&&a.detachOverlayFromTile){Uverse.console.log("[TileDrawerOverlay]","Showing detached overlay");var b=this.drawerElement.getClosest(".tile"),c=this.overlayElement.getCoordinates(b);b.adopt(this.overlayElement),this.overlayElement.addClass("detached").setStyles({top:c.top,left:c.left})}}}),Uverse.utils.TileDrawerOverlayGeneric=new Class({Extends:Uverse.utils.TileDrawerOverlayParent,templateElementID:"tileDrawerGenericTemplate",textContainerElement:null,initialize:function(a){this.parent(a)},showGenericOverlay:function(a,b){this.overlayElement.adopt(a),this.showOverlay(b)},hideOverlay:function(){this.overlayElement.empty(),this.parent()}}),Uverse.utils.TileDrawerOverlayLoading=new Class({Extends:Uverse.utils.TileDrawerOverlayParent,templateElementID:"tileDrawerLoadingTemplate",spinner:null,initialize:function(a){this.parent(a),this.spinner=this.overlayElement.getElement(".loading-image")
},showLoadingOverlay:function(a){this.showOverlay(a),this.spinner&&this.spinner.removeClass.delay(500,this.spinner,"hidden")},hideLoadingOverlay:function(){this.hideOverlay(),this.spinner&&this.spinner.addClass("hidden")}}),Uverse.utils.TileDrawerOverlayMessage=new Class({Extends:Uverse.utils.TileDrawerOverlayParent,templateElementID:"tileDrawerMessageTemplate",textContainerElement:null,initialize:function(a){this.parent(a),this._processOverlay()},_processOverlay:function(){this.textContainerElement=this.overlayElement.getElement(".drawer-overlay-message"),this.overlayElement.addEvent("click",this._onOverlayClose.bind(this))},showMessageOverlay:function(a,b){this._addMessageToContentElement(a),this.showOverlay(b)},_addMessageToContentElement:function(a){this.textContainerElement.set("html",a)},_onOverlayClose:function(a){a.stopPropagation(),this.hideOverlay()}}),Uverse.widgets.Accordion=new Class({Implements:[Options,Callbacks],options:{itemSelector:".accordion-item-row",contentSelector:".accordion-content",subItemSelector:".accordion-content-row",contentWrapSelector:".accordion-content-wrap",firstOpen:!0,singleOpenOnly:!0,activeOpenIsCollapsible:!1,scrollToActive:!0,duration:350,offsetTop:0},callbacks:{onChange:!1},contents:null,items:null,tweens:null,openIdx:0,isInitialized:!1,initialize:function(a,b,c){this.el=a,this.setOptions(b),c=c||{},this.setCallbacks(c),this._setupElements(),this._setupTweens(),this._setupEvents(),this.options.firstOpen&&(this.show(0),this.isInitialized=!0)},_setupElements:function(){this.items=this.el.getElements(this.options.itemSelector),this.wrappers=this.el.getElements(this.options.contentWrapSelector);var a=this.el.getElements(this.options.contentSelector),b=[];this.items.each(function(c,d){var e=new Element("div",{"class":"accordion-content-wrapper",styles:{overflow:"hidden",padding:0,height:0,margin:0}}),f=a[d];f.removeClass("hidden"),e.wraps(f),c.store("index",d),e.store("index",d),b.push(e)},this),this.contents=$$(b)},_setupTweens:function(){var a={duration:this.options.duration,property:"height",link:"cancel"};this.tweens=this.contents.map(function(b){return new Fx.Tween(b,a)}),this.scrollFx=new Fx.Scroll(this.el.getScrollParent(),a)},_setupEvents:function(){var a=this.options;this.el.addEvent("click:relay("+a.itemSelector+")",function(b){if(!b.target.getClosest(".prevent-accordion")){var c=b.target.getClosest(a.itemSelector).retrieve("index");if(b.target.getClosest(".active"))return void((!a.singleOpenOnly||a.activeOpenIsCollapsible)&&this.hide(c));this.options.scrollToActive&&this.scrollTo(this.openIdx,c),a.singleOpenOnly&&this.hide(this.openIdx),this.show(c),this.callbacks.onChange&&this.callbacks.onChange()}}.bind(this))},hide:function(a){this.items[a].removeClass("active"),this.wrappers[a].removeClass("active"),this.contents[a].setStyle("overflow","hidden"),this.tweens[a].start(0)},show:function(a){var b=this._getHeight(this.contents[a]);this.items[a].addClass("active"),this.wrappers[a].addClass("active"),this.tweens[a].start(b).chain(function(){this.contents[a].setStyle("overflow","visible")}.bind(this)),this.openIdx=a},scrollTo:function(a,b,c){null==c&&(c=!0);var d=b>a?this._getPreviousHeight(a,c):0,e=this.items[b].getOffsetTop(),f=e-d-this.options.offsetTop;this.scrollFx.start(0,f)},_getHeight:function(a,b){var c=a.offsetHeight;a.setStyle("height","auto");var d=a.offsetHeight;return a.setStyle("height",c),d},_getPreviousHeight:function(a,b){return b===!0?this._getHeight(this.contents[a]):this.contents[a].offsetHeight},getCurrentIndex:function(){return this.openIdx},isCurrentIndexSingle:function(){var a=this.contents[this.openIdx].getElements(this.options.subItemSelector);return a?a.length<=1:!0},setActive:function(a){var b=this.openIdx;this.options.singleOpenOnly&&this.hide(b),this.show(a),this.options.scrollToActive&&this.scrollTo(b,a,this.isInitialized)}}),Uverse.widgets.AutoAuthButton=new Class({Implements:[Options],el:null,flyoutEl:null,viewModel:null,inHomeService:null,initialize:function(a,b){this.el=$(a),this.flyoutEl=this.el.getElement(".auto-auth-flyout"),this.buttonEl=this.el.getElement(".auto-auth-button"),this.setOptions(b),this.inHomeService=Uverse.page.getInHomeService(),this._setupFlyout(),this._setupViewModel()},_setupFlyout:function(){var a={relativeTo:this.buttonEl,parentEdge:{x:"right",y:"bottom"},flyoutEdge:{x:"right",y:"top"}};this.flyout=new Uverse.widgets.Flyout(this.flyoutEl,a),this.inHomeService.newAutoAuth()&&this.flyout.show()},_setupViewModel:function(){this.viewModel=Object({newAutoAuth:this.inHomeService.newAutoAuth,usePlugin:this.inHomeService.usePlugin,autoLoggedIn:this.inHomeService.autoLoggedIn,DSLCustomer:ko.observable(Uverse.page.isDSL()),showFlyout:this.flyout.show.bind(this.flyout),inHomeService:this.inHomeService,buttonAction:function(){},dismissNewFeature:function(a){setTimeout(function(){this.inHomeService.newAutoAuth(!1)}.bind(this),10)},tryAgain:function(){this.inHomeService.checkAutoAuthStatus()}}),ko.applyBindings(this.viewModel,this.el)}}),Uverse.widgets.Banners=new Class({Implements:[Options],el:null,options:{path:null,section:"1",bannerUrl:"/banner.json",unsupportedBannerUrl:"/bannerCampaign.json"},campaignIds:{"Internet Explorer 1":"Unsupported/Unsupported Campaign - IE1","Internet Explorer 2":"Unsupported/Unsupported Campaign - IE2","Internet Explorer 3":"Unsupported/Unsupported Campaign - IE3","Internet Explorer 4":"Unsupported/Unsupported Campaign - IE4","Internet Explorer 5":"Unsupported/Unsupported Campaign - IE5","Internet Explorer 6":"Unsupported/Unsupported Campaign - IE6","Internet Explorer 7":"Unsupported/Unsupported Campaign - IE7","Internet Explorer 8":"Unsupported/Unsupported Campaign - IE8","Firefox 1":"Unsupported/Unsupported Campaign - Firefox1","Firefox 2":"Unsupported/Unsupported Campaign - Firefox2","Firefox 3":"Unsupported/Unsupported Campaign - Firefox3","Firefox 4":"Unsupported/Unsupported Campaign - Firefox4","Firefox 5":"Unsupported/Unsupported Campaign - Firefox5","Firefox 6":"Unsupported/Unsupported Campaign - Firefox6",Android:"Unsupported/Unsupported Campaign - Android",iPad:"Unsupported/Unsupported Campaign - iPad","Safari 4":"Unsupported/Unsupported Campaign - Safari4",Default:"Unsupported/Unsupported Campaign - Default"},manager:null,_loadTargetedBanners:function(){var a,b,c;a=function(a){if(a&&a.bannerAvailable){a.imageAlt||(a.imageAlt="U-verse Banner");var b=new Uverse.utils.Banner(a.imageUrl,a.imageAlt);a.link&&(b.options.link=a.link,b.options.template="defaultWithLink",b.options.target=a.externalLink?"_blank":"_self"),this.manager.add(b)}},b=function(a){Uverse.console.log("[Banner]","AJAX call error - No banner set up for this page or server error")},c=new Request.JSON({url:this.options.bannerUrl,method:"get",data:{path:this.options.path,section:this.options.section,json:"yes"},onSuccess:a.bind(this),onFailure:b.bind(this)}),c.send()},_onUnsupportedBrowser:function(a,b){this._loadUnsupportedBanners(a)},_loadUnsupportedBanners:function(a){var b,c,d;b=function(b){if(b&&b.campaigns[0].banners[0].imageUrl){var c=b.campaigns[0].banners[0],d=new Uverse.utils.Banner(c.imageUrl,a.name);d.options.template="unsupportedBrowser",d.options.browser=a.name,d.options.browser=a.name,c.link&&(d.options.url=c.link,d.options.target="_blank"),this.manager.clear(),this.manager.add(d),this.manager.readOnly=!0}},c=function(a){Uverse.console.log("[Banner]","AJAX call error - Unsupported Browser banner")};var e=this.campaignIds[a.name];void 0===e&&(e=this.campaignIds.Default),d=new Request.JSON({url:this.options.unsupportedBannerUrl,method:"get",data:{campaignId:e},onSuccess:b.bind(this),onFailure:c.bind(this)}),d.send()},initialize:function(a,b){this.el=$(a),this.setOptions(b),this.options.path=Uverse.config.requestPath,this.manager=new Uverse.utils.BannersManager(this.el),this._loadTargetedBanners(),Uverse.page.addMemoryEvent("UnsupportedBrowser",this._onUnsupportedBrowser.bind(this))}}),Uverse.widgets.DigitalSmithsSocial=new Class({Implements:[Options],el:null,options:{path:"",videoKey:""},initialize:function(a,b){this.el=$(a),this.setOptions(b),this.el.getElements(".digital-smiths-social").each(function(a){a.addEvent("click",this._trackShare.bind(this))}.bind(this))},_trackShare:function(){var a=this.options.path||this.options.videoKey;Uverse.page.getDigitalSmithsAPI().trackVideoShare(a)}}),Uverse.widgets.DiscoverMenu=new Class({Implements:[Options],el:null,flyoutEl:null,buttonEl:null,viewModel:null,options:{isMenuActive:!0,menuRelativeTo:null,menuOffset:{x:0,y:0},genreHeaderHeight:39},menu:{shouldPrepare:null,shouldShow:null},initialize:function(a,b){this.el=$(a),this.setOptions(b),this.flyoutEl=this.el.getElement(".discover-menu").removeClass("hidden"),this.buttonEl=this.el.getElement(".page-header-discover"),this._positionGenres(),this._setupViewModel(),Uverse.page.addMemoryEvent("setGenre",this._setGenre.bind(this))},_menuShouldShow:function(a){a&&this.options.isMenuActive?(this.buttonEl.click(),this.viewModel.showMenu(!0),this._positionMenu()):(this.viewModel.showMenu(!1),this.viewModel.showGenreMenu(!1))},_destroyMenu:function(){this.menu.shouldPrepare.dispose(),this.menu.shouldShow.dispose()},_positionMenu:function(){this.flyoutEl.position({relativeTo:this.options.menuRelativeTo||this.el,position:"bottomLeft",edge:"upperLeft",offset:this.options.menuOffset})},_positionGenres:function(){var a=this.options.genreHeaderHeight,b=this.flyoutEl.getElement(".discover-promo");b&&(a+=b.getHeight()),this.el.getElement(".discover-menu-genres").setStyle("top",this.flyoutEl.getHeight()-a)},_setGenre:function(a){this.viewModel.activeGenre(a),Uverse.page.tileManager.tileLoader.setGenre(a)},_setupViewModel:function(){this.viewModel=Object({showMenuHovered:ko.observable(!1),showMenu:ko.observable(!1),showGenreMenu:ko.observable(!1),genreMenuEnabled:ko.observable(!0),partiallyVisible:ko.observable(),activeGenre:ko.observable("")}),Object.append(this.viewModel,{menuShouldShow:this.viewModel.showMenuHovered.extend({delay:{"in":100,out:100}})}),this.viewModel.toggleGenreMenu=function(a,b){b.preventDefault(),this.viewModel.genreMenuEnabled()&&this.viewModel.showGenreMenu(!this.viewModel.showGenreMenu())}.bind(this),this.viewModel.genreClick=function(a,b){var c=new DOMEvent(b);c.preventDefault(),Uverse.page.scrollToTop(),this.viewModel.menuShouldShow(!1);var d=b.target.get("href"),e="#";d&&d.length&&(e="#genre="+d),Uverse.page.history.pushToHistory(e),this._setGenre(d)}.bind(this),this.menu.shouldShow=this.viewModel.menuShouldShow.subscribe(this._menuShouldShow.bind(this)),ko.applyBindings(this.viewModel,this.el)}}),Uverse.widgets.FavoriteSaver=new Class({Implements:[Callbacks],callbacks:{showLoading:null,hideLoading:null,closeDrawer:null,showGenericOverlay:null,hideGenericOverlay:null},favoriteID:null,favoriteTemplateElementID:"favoriteOptionsTemplate",screens:{addToFavorites:null,removeFromFavorites:null,confirmation:null},addToFavoritesRequest:null,oneClickFavorites:"oneClickFavorites",oneClickFavoritesEnabled:!1,favoriteData:{},initialize:function(a,b,c){this.setCallbacks(c),this.favoriteID=a,"Video"==b?this.favoriteData={itemKey:this.favoriteID}:"Category"==b&&(this.favoriteData={showPath:this.favoriteID}),this._setupRequests()},_setupRequests:function(){this.addToFavoritesRequest=new Request.JSON({url:Uverse.config.favorite.urls.save,method:"post",data:this.favoriteData,noCache:!0,onComplete:this._onAddToFavoritesSuccess.bind(this)}),this.removeRequest=new Request.JSON({url:Uverse.config.favorite.urls.remove,method:"post",data:this.favoriteData,noCache:!0,onComplete:this._onRemoveSuccess.bind(this)}),this.saveUserSettingRequest=new Request.JSON({url:Uverse.config.personalization.urls.saveUserSetting,method:"post",noCache:!0,link:"chain"})},getUI:function(a){var b=this._getClassNamesFromState(a),c=this._getTemplate(b);return Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalization.bind(this)),this._unHideFirstScreen(c),c},_unHideFirstScreen:function(a){a.getChildren()[0].removeClass("hidden")},_getClassNamesFromState:function(a){switch(a){case Uverse.Enums.FavoriteStates.NOT_SAVED:return["favorite-add","favorite-remove","favorite-remove-confirmation"];case Uverse.Enums.FavoriteStates.SAVED:return["favorite-remove","favorite-add","favorite-remove-confirmation"]}},_getTemplate:function(a){var b=$(this.favoriteTemplateElementID),c=[];return a.each(function(a){switch(a){case"favorite-add":var d=b.getElement(".favorite-add").clone();this.screens.addToFavorites=d,this.screens.addToFavoritesFormWidget=new Uverse.controls.Form(d.getElement("form"),{submit:this._onAddSubmit.bind(this),changing:this._onOneClickChanging.bind(this)}),c.push(d);break;case"favorite-remove":var e=b.getElement(".favorite-remove").clone();this.screens.removeFromFavorites=e,this.screens.removeFromFavoritesFormWidget=new Uverse.controls.Form(e.getElement("form"),{submit:this._onRemoveSubmit.bind(this),changing:this._onOneClickChanging.bind(this)}),c.push(e);break;case"favorite-remove-confirmation":var f=b.getElement(".favorite-remove-confirmation").clone();this.screens.confirmation=f,this.screens.confirmationFormWidget=new Uverse.controls.Form(f.getElement("form"),{submit:this._onConfirmationSubmit.bind(this)}),c.push(f)}},this),b=new Element("div"),c.each(function(a){b.adopt(a)}),b},_onAddSubmit:function(a){this.addToFavorites(),this._isUILoaded()&&this.callbacks.showLoading()},addToFavorites:function(){Uverse.console.log("[FavoriteSaver]","Adding to Favorites"),Uverse.page.favoriteAddItem(this.favoriteID),this.addToFavoritesRequest.send()},_onAddToFavoritesSuccess:function(a){this._isUILoaded()&&(this._showRemoveFromFavorites(),this.callbacks.hideLoading())},_onRemoveSubmit:function(a){this.screens.confirmation.dispose().removeClass("hidden"),this.callbacks.showGenericOverlay(this.screens.confirmation)},_onConfirmationSubmit:function(a,b){var c="confirm"===b.result,d={confirmationResult:c,preventDrawerFromCollapsing:!1};this.callbacks.hideGenericOverlay(d),this.preventDrawerFromCollapsing=d.preventDrawerFromCollapsing,c&&this._onRemoveConfirmed()},_onRemoveConfirmed:function(){Uverse.console.log("[FavoriteSaver]","Removing from Favorites"),Uverse.page.favoriteRemoveItem(this.favoriteID),this.removeRequest.send(),this.callbacks.showLoading()},_onRemoveSuccess:function(a){this.oneClickFavoritesEnabled&&!this.preventDrawerFromCollapsing?this.callbacks.closeDrawer():(this._showAddToFavorites(),this.callbacks.hideLoading())},_showAddToFavorites:function(){this.screens.addToFavorites.removeClass("hidden"),this.screens.removeFromFavorites.addClass("hidden")},_showRemoveFromFavorites:function(){this.screens.addToFavorites.addClass("hidden"),this.screens.removeFromFavorites.removeClass("hidden")},_isUILoaded:function(){return null!=this.screens.addToFavorites},_onOneClickChanging:function(a,b,c,d){b.getName()==this.oneClickFavorites&&(a.target.set("data-clicktrack-label",c?"On":"Off"),this._saveOneClickSetting(this.oneClickFavorites,c))},_saveOneClickSetting:function(a,b){Uverse.console.log("[FavoriteSaver]","Setting ",a," to ",b);var c={};c[a]=b,this.saveUserSettingRequest.send({data:c}),Uverse.page.updateUserSetting(a,b)},_onPersonalization:function(a){this.oneClickFavoritesEnabled=a.getPersonalizationData(this.oneClickFavorites),this.screens.removeFromFavoritesFormWidget.setValue(this.oneClickFavorites,this.oneClickFavoritesEnabled),this.screens.addToFavoritesFormWidget.setValue(this.oneClickFavorites,this.oneClickFavoritesEnabled)}}),Uverse.widgets.FilterBar=new Class({Implements:[Callbacks,Options],Binds:["_onFilterFormChanging"],options:{initialFilter:null},callbacks:{filterChanged:null},el:null,primaryFilters:null,secondaryFilterBars:null,filterForms:null,selectedFilterForm:null,initialize:function(a,b,c){this.el=$(a),this.setOptions(b),this.setCallbacks(c),this._setupFilterBar()},_setupFilterBar:function(){this._setupPrimaryFilters(),this._setupSecondaryFilters()},_setupPrimaryFilters:function(){if(this.primaryFilters=this.el.getElements(".primary-filter-tab"),this.primaryFilters.length>0){var a=this;this.primaryFilters.addEvents({click:function(b){b.preventDefault(),a._setPrimaryFilter(this),a.updateFilter()}})}},_setupSecondaryFilters:function(){this.secondaryFilterBars=this.el.getElements(".secondary-filter-bar"),this.filterForms=this.secondaryFilterBars.getElement(".filter-form").map(function(a){var b={changing:this._onFilterFormChanging},c=new Uverse.controls.Form(a,b);return c},this)},checkInitialFilter:function(){if(this.primaryFilters.length>0){var a=this.primaryFilters.filter(".selected")[0];Uverse.console.assert(a,"[FilterBar]","One of the Primary Filters must be selected.",this.primaryFilters),this._setPrimaryFilter(a),this.updateFilter()}else Uverse.console.assert(1==this.filterForms.length,"[FilterBar]","If there's no Primary Filters, there should only be 1 Secondary Filter.",this.filterForms.length),this.selectedFilterForm=this.filterForms[0],this.updateFilter()},_onFilterFormChanging:function(a,b,c,d){this.updateFilter()},_setPrimaryFilter:function(a){var b=a.getAttribute("data-primary-filter-value");this.primaryFilters.removeClass("selected"),a.addClass("selected"),this.secondaryFilterBars.each(function(a,c){var d=a.getAttribute("data-primary-filter-value");b==d?(a.removeClass("hidden"),this.selectedFilterForm=this.filterForms[c]):a.addClass("hidden")},this)},updateFilter:function(){this.filterValues=this.selectedFilterForm.getValues({filterEmpty:!0}),this.callbacks.filterChanged(this.filterValues)},resetToDefault:function(){this.options.initialFilter&&(this.selectedFilterForm.setValues(this.options.initialFilter,!0),this.updateFilter())}}),Uverse.widgets.FixedHeader=new Class({Implements:[Options],options:{},el:null,barInfo:{primary:{className:"detached-header",initialTop:null,isDetached:!1},secondary:{className:"detached-secondary",initialTop:null,isDetached:!1}},secondary:null,body:null,initialize:function(a,b){this.el=$(a),this.body=$(document.body),this.setOptions(b),this._setupScroll()},_setupScroll:function(){this.secondary=$$(".detachable")[0],this.barInfo.primary.initialTop=this.el.getTop(),window.addEvent("scroll",this._onScroll.bind(this))},_onScroll:function(){var a=window.getScrollTop();this._checkScroll(a,this.barInfo.primary),this.secondary&&(this.barInfo.secondary.initialTop||(this.barInfo.secondary.initialTop=this.secondary.getTop()-this.el.getHeight()),this._checkScroll(a,this.barInfo.secondary))},_checkScroll:function(a,b){var c;c=a>=b.initialTop,c!=b.isDetached&&(b.isDetached=c,this.body.toggleClass(b.className,c))}}),Uverse.widgets.Flyout=new Class({Implements:[Options,Callbacks],Binds:["_onDocumentClick","_onCloseClick","_onWindowResize"],options:{relativeTo:null,parentEdge:{x:"left",y:"bottom"},flyoutEdge:{x:"left",y:"top"},flyoutOffset:{x:0,y:0},flyoutShadows:{top:4,right:10,bottom:6,left:4}},callbacks:{flyoutLoading:!1},el:null,relativeTo:null,arrowEl:null,closeEl:null,isOpen:!1,initialize:function(a,b,c){this.el=a,this.setOptions(b),this.setCallbacks(c),this.relativeTo=this.options.relativeTo,this.arrowEl=this.el.getElement(".flyout-triangle"),this.closeEl=this.el.getElement(".flyout-close"),this._setupEvents(),this._setupArrowDirection(),this._setupDimensions(),this._setPosition()},_setupArrowDirection:function(){var a=this.options.flyoutEdge,b=this.options.parentEdge;a.x===b.x?this.arrowDirection=a.y:a.y===b.y&&(this.arrowDirection=a.x),this.arrowEl.addClass(this.arrowDirection)},_setupDimensions:function(){var a=function(a){return{width:a.offsetWidth,height:a.offsetHeight}};this.el.fade("hide").removeClass("hidden"),this.arrowSize=a(this.arrowEl)},_setupEvents:function(){this.closeEl.addEvent("click",this._onCloseClick)},_onCloseClick:function(a){a.preventDefault(),this.hide()},_onWindowResize:function(){this._setPosition()},_setPosition:function(){this._setFlyoutPosition(),this._setArrowPosition()},_setFlyoutPosition:function(){var a=this.arrowSize,b=Object.clone(this.options.flyoutOffset),c=this.options.parentEdge,d=this.options.flyoutEdge;switch(this.arrowDirection){case"top":b.y+=a.height;break;case"bottom":b.y-=a.height;break;case"left":b.x+=a.width;break;case"right":b.x-=a.width}if(Browser.ie8){var e=this.options.flyoutShadows;b.x-=e.left,b.y-=e.top}this.el.position({relativeTo:this.relativeTo,position:c,offset:b,edge:d})},_setArrowPosition:function(){var a=Object.clone(this.options.parentEdge),b=Object.clone(this.options.flyoutEdge),c={};switch(this.arrowDirection){case"top":case"bottom":a.x=b.x="center";break;case"left":case"right":a.y=b.y="center"}if(Browser.ie8){var d=this.options.flyoutShadows;switch(this.arrowDirection){case"bottom":c.y=-d.bottom;break;case"right":c.x=-d.right}}this.arrowEl.position({relativeTo:this.relativeTo,position:a,offset:c,edge:b})},_onDocumentClick:function(a){this.el.contains(a.target)||this.relativeTo.contains(a.target)||this.hide()},show:function(){$(document).addEvent("click",this._onDocumentClick),window.addEvent("resize:pace(100)",this._onWindowResize),this._setPosition(),this.el.fade("in"),this.isOpen=!0,this.callbacks.flyoutLoading&&this.callbacks.flyoutLoading(this.el)},hide:function(){$(document).removeEvent("click",this._onDocumentClick),window.removeEvent("resize:pace(100)",this._onWindowResize),this.el.fade("out"),this.isOpen=!1},toggle:function(){this.isOpen?this.hide():this.show()}}),Uverse.widgets.Footer=new Class({Implements:[Options],options:{openButtonSelector:"#open-footer-button",openClassName:"transitions-mastfooter-open",backToTopButtonSelector:".mastfooter-back-to-top",backToTopButtonHoverClass:"transition-mastfooter-back-to-top",backToTopShowClass:"transition-mastfooter-back-to-top-show",enableBackToTop:!0,showBackToTopAt:1e3,animation:{duration:100,transition:Fx.Transitions.Sine.easeOut,backToTop:{duration:75,transition:Fx.Transitions.Sine.easeOut}}},openButton:null,backToTopButton:null,modalOpen:!1,viewModel:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._setupSiteSwitchLink(),this.openButton=this.el.getElement(this.options.openButtonSelector),this.backToTopButton=this.el.getElement(this.options.backToTopButtonSelector),this.openButton.addEvent("click",this._toggleOpen.bind(this)),this.el.set("morph",this.options.animation),this._scrollParent=this.el.getScrollParent(),this._scrollParent.addEvent("scroll",this._onScrollHandler.bind(this)),this.backToTopButton.addEvents({mouseenter:this._toggleBackToTop.bind(this),mouseleave:this._toggleBackToTop.bind(this),click:this._scrollToTop.bind(this)}),this.backToTopButton.set("morph",this.options.animation.backToTop),Uverse.page.addMemoryEvent("modalLoaded",this._onModalPlayerOpen.bind(this)),Uverse.page.addMemoryEvent("modalClosed",this._onModalPlayerClosed.bind(this))},_setupSiteSwitchLink:function(){this.viewModel={isSupportedMobileDevice:this._isIPhoneDevice()||this._isAndroidDevice(),siteSwitchUrl:this._getSiteSwitchUrl()},ko.applyBindings(this.viewModel,this.el)},_isIPhoneDevice:function(){return!!Browser.Platform.ios},_isAndroidDevice:function(){return!!Browser.Platform.android},_getSiteSwitchUrl:function(){var a=Uverse.config.siteSwitch.siteSwitchUrlTemplate,b="mobile",c="/",d=String.substitute(a,{deviceType:b,returnUrl:encodeURIComponent(c)});return d},_toggleOpen:function(a){a.preventDefault(),this.el.toggleClassWithTransition(this.options.openClassName)},_toggleBackToTop:function(a){a.preventDefault(),this.backToTopButton.toggleClassWithTransition(this.options.backToTopButtonHoverClass)},_scrollToTop:function(a){if(Fx.Scroll){a.preventDefault();var b=new Fx.Scroll(this._scrollParent);b.toTop()}},_onScrollHandler:function(a){this._scrollParent.getScroll().y>this.options.showBackToTopAt&&this.options.enableBackToTop&&!this.modalOpen?this.backToTopButton.reveal():this.backToTopButton.dissolve()},_onModalPlayerOpen:function(a){this.modalOpen=!0,this.backToTopButton.hide()},_onModalPlayerClosed:function(a){this.modalOpen=!1,this._onScrollHandler()}}),Uverse.widgets.GetPromoBanner=new Class({Implements:[Options],el:null,viewModel:null,request:null,options:{getUverseUrl:"/promoHeader.json"},initialize:function(a,b){this.el=$(a),this.setOptions(b),this.request=new Request.JSON({url:this.options.getUverseUrl,method:"get",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._onRequestSuccess.bind(this)}),this._setupViewModel(),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this))},_setupViewModel:function(){this.viewModel=Object({text:null,link:null,shouldShowButton:!1,shouldOpenInNewTab:ko.observable(),buttonText:null,page:ko.observable()}),this.viewModel.clicktrackLabel=ko.computed(function(){return this.viewModel.text+" - "+this.viewModel.page()},this),this.viewModel.linkTarget=ko.computed(function(){return this.viewModel.shouldOpenInNewTab()?"_blank":"_self"},this)},_onUserData:function(a){this.request.send()},_onRequestSuccess:function(a){a&&a.text&&a.text.length&&(ko.merge(this.viewModel,a),ko.applyBindings(this.viewModel,this.el),this.el.show())}}),Uverse.widgets.InfiniteScroll=new Class({Implements:[Options,Callbacks],Binds:["_onScrolledIn","_onWindowResize"],options:{minDistance:1e3},callbacks:{endOfContainerReached:null},scrollingOptions:{distance:{bottom:-1e3}},tileContainer:null,lastTile:null,pageHeight:0,emptyDistance:0,columns:[],disabled:!1,initialize:function(a,b,c){this.setOptions(b),this.setCallbacks(c),this.scrollingOptions=Object.clone(this.scrollingOptions),this.tileContainer=a,this._setupResize(),this._setupScrolling()},_setupResize:function(){window.addEvent("resize:pace(1000)",this._onWindowResize),this._onWindowResize()},_onWindowResize:function(){this.pageHeight=window.getHeight(),this._updateScrollingOptions()},_setupScrolling:function(){this.tileContainer.store("scrollingOptions",this.scrollingOptions),this.tileContainer.addEvent("scrolling:position(above top)",this._onScrolledIn)},updateScrollingContainer:function(a){this.tileContainer.removeEvent("scrolling:position(above top)",this._onScrolledIn),this.tileContainer=a,this._setupScrolling()},destroyInfiniteScroll:function(){window.removeEvent("resize:pace(1000)",this._onWindowResize),this.tileContainer.removeEvent("scrolling:position(above top)",this._onScrolledIn)},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},_onScrolledIn:function(a,b,c){this.disabled||this.callbacks.endOfContainerReached()},updateColumns:function(a){this.columns=a,this._updateEmptyDistance()},_updateEmptyDistance:function(){if(0!==this.columns.length){var a=this.columns.map(function(a){return a.offsetHeight});this.emptyDistance=a.max()-a.min(),this._updateScrollingOptions()}},_updateScrollingOptions:function(){var a=Math.max(this.options.minDistance,this.pageHeight+this.emptyDistance);this.scrollingOptions.distance.bottom=-a},tilesAdded:function(){this._updateEmptyDistance();var a=this.tileContainer.getScrollParent();a.fireEvent("scroll");var b=this.tileContainer.getScrollingPosition(this.scrollingOptions);("above"===b||"top"===b)&&this.callbacks.endOfContainerReached()}}),Uverse.widgets.InfiniteScrollGeneric=new Class({Implements:[Events],Binds:["_onWindowResize","_onWindowScroll"],options:{minDistance:1e3},windowHeight:0,windowScroll:0,emptySpace:0,active:!0,pageDisclaimer:null,initialHeight:0,initialize:function(){this.initialHeight=window.getScrollHeight(),this._setupWindowEvents(),this._onWindowResize(),this._setupDisclaimer()},_setupWindowEvents:function(){window.addEvent("resize:pace(1000)",this._onWindowResize),window.addEvent("scroll:pace(250)",this._onWindowScroll)},_onWindowResize:function(){this.windowHeight=window.getHeight(),this.checkScrollPosition()},_onWindowScroll:function(){this.windowScroll=window.getScroll().y,this.checkScrollPosition()},destroyInfiniteScroll:function(){window.removeEvent("resize:pace(1000)",this._onWindowResize),window.removeEvent("scroll:pace(250)",this._onWindowScroll)},checkScrollPosition:function(){if(this.active){var a=this.windowHeight,b=this.windowScroll,c=this.emptySpace,d=this.windowHeight,e=window.getScrollSize().y,f=b+a,g=e-c-d;(f>=g||e===this.initialHeight)&&this.fireEvent("endOfContainerReached")}},enable:function(a){this.active=a,this.checkScrollPosition(),this.pageDisclaimer&&this.pageDisclaimer.toggleClass("hidden",a)},setEmptySpace:function(a){this.emptySpace=a,this.checkScrollPosition()},_setupDisclaimer:function(){this.pageDisclaimer=$("mainDisclaimer")}}),Uverse.Enums.LivePageStep={SIGNIN:0,INSTALLPLUGIN:1,CONNECTED:2,COMPLETE:3},Uverse.widgets.LiveCardPage=new Class({Implements:[Options],options:{cardControllerOptions:null,liveCardDataKey:"liveCardDataKey"},viewModel:null,cardController:null,liveCardData:null,entitlementHelper:null,el:null,initialize:function(a,b){this.el=a,this.setOptions(b),this.liveCardData=Uverse.loader.retrieveModelData(this.options.liveCardDataKey),this.entitlementHelper=new Uverse.utils.Entitlement,this._setupCardController(),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this))},_onUserData:function(){this._setupViewModel(),this._inHomeStatusUpdated(null),Uverse.page.subscribeInHomeStatus(this._inHomeStatusUpdated.bind(this)),Uverse.page.isUverseUser()&&Uverse.page.addMemoryEvent("Personalization-uverseData",this._onUverseData.bind(this)),ko.applyBindings(this.viewModel,this.el),Uverse.page.isUverseUser()||this._finishLoading()},_finishLoading:function(){var a=this.liveCardData.some(function(a){return!this._isEntitled(a)}.bind(this)),b=this.liveCardData.some(function(a){return this._isEntitled(a)}.bind(this)),c=this.liveCardData.some(function(a){return this._isEntitled(a)&&a.inHomeOnly}.bind(this));this.viewModel.hasUnentitledCards(a),this.viewModel.hasEntitledCards(b),this.viewModel.hasInHomeCards(c),this._setChannelCounts(),this.viewModel.pageHasLoaded(!0),this.el.removeClass("is-loading")},_onUverseData:function(a){for(var b=this.viewModel,c=function(b){return void 0!==a.getLiveChannelMapping(b)}.bind(this),d=b.liveCards(),e=[],f=0,g;g=d[f];f++)this.entitlementHelper.isPackageBasedEntitlement(g.entitlementLevel)||c(g.callLetters)||(e.push(g),"function"==typeof g.destroyCard&&g.destroyCard());b.liveCards.removeAll(e),this._finishLoading()},_inHomeStatusUpdated:function(a){var b=this.viewModel,c=Uverse.Enums.LivePageStep,d=Uverse.Enums.InHomeStatus;b.isAtHome(a),b.currentStep(Uverse.page.isUserLoggedIn()?a===d.APPLET_NOT_INSTALLED?c.INSTALLPLUGIN:a===d.JAVA_OUT_OF_DATE?c.INSTALLPLUGIN:a===d.OUT_OF_HOME?c.CONNECTED:c.COMPLETE:c.SIGNIN),this._setChannelCounts()},_setChannelCounts:function(){for(var a=this.viewModel,b=0,c=0,d=0,e=0;e<this.liveCardData.length;e++){var f=this.liveCardData[e],g=this._isEntitled(f);g&&d++,f.inHomeOnly?g&&a.isAtHome()===Uverse.Enums.InHomeStatus.IN_HOME&&c++:(b++,g&&c++)}a.totalChannels(this.liveCardData.length),a.availableChannels(c),a.availableChannelsSignin(b),a.entitledChannels(d)},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupViewModel:function(){this.viewModel={liveCards:ko.observableArray(this.liveCardData),isSignedIn:ko.observable(Uverse.page.isLoggedIn()),isAtHome:ko.observable(Uverse.Enums.InHomeStatus.APPLET_NOT_INSTALLED),hasUnentitledCards:ko.observable(!0),hasEntitledCards:ko.observable(!1),hasInHomeCards:ko.observable(!0),isEntitled:this._isEntitled.bind(this),cardController:this.cardController,pageHasLoaded:ko.observable(!1),currentStep:ko.observable(0),availableChannels:ko.observable(0),availableChannelsSignin:ko.observable(0),entitledChannels:ko.observable(0),totalChannels:ko.observable(0),expanded:ko.observable(!0),recheckApplet:this._recheckApplet.bind(this),appletIsRunning:ko.observable(!1)},window.addEvent("inHomeApplet-running",this._appletIsRunning.bind(this)),Uverse.page.subscribeInHomeStatus(this.viewModel.isAtHome),Uverse.page.subscribeInHomeStatus(function(a){var b=a!==Uverse.Enums.InHomeStatus.IN_HOME;this.viewModel.expanded(b)}.bind(this))},_appletIsRunning:function(a){this.viewModel.appletIsRunning(a);
var b=new Fx.Scroll(window,{transition:Fx.Transitions.Pow.easeOut,duration:500}).toTop()},_recheckApplet:function(){this.viewModel.currentStep()===Uverse.Enums.LivePageStep.CONNECTED&&Uverse.page.recheckInHomeStatus()},_isEntitled:function(a){return this.entitlementHelper.compareEntitlement(a.entitlementLevel)===Uverse.Enums.Entitlement.ALLOWED}}),Uverse.widgets.LogInLinks=new Class({Implements:[Options],el:null,flyoutEl:null,viewModel:null,options:{isMenuActive:!0,menuRelativeTo:null,menuOffset:{x:18,y:5}},menu:{shouldPrepare:null,shouldShow:null},packageManager:null,initialize:function(a,b){this.el=$(a),this.flyoutEl=this.el.getElement(".user-menu"),this.setOptions(b),this._setupViewModel(),this.el.removeClass("hidden"),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this))},_onUserData:function(a){this._refresh(a),Uverse.page.addMemoryEvent("showAccountMenu",this._onShowAccountMenu.bind(this))},_onShowAccountMenu:function(a){return this.viewModel.isUserLoggedIn()?void this._menuShouldShow(!0):void(document.location.href=Uverse.config.cgate.url+"#"+a)},_setupPackages:function(){this.packageManager=new Uverse.widgets.PackageManager(this.viewModel)},_refresh:function(a){this.viewModel.isUserLoggedIn(a.isLoggedIn()),a.username&&""!==a.username.trim()&&this.viewModel.userFirstName(a.getUsername())},_menuShouldShow:function(a){a&&this.options.isMenuActive?(Uverse.page.clickTrack&&Uverse.page.clickTrack(this.el.getElement(".track")),this.packageManager.resetPage(),this.viewModel.showMenu(!0),this._positionMenu()):this.viewModel.showMenu(!1)},_destroyMenu:function(){this.menu.shouldPrepare.dispose(),this.menu.shouldShow.dispose()},_positionMenu:function(){this.flyoutEl.position({relativeTo:this.options.menuRelativeTo||this.el,position:"bottomRight",edge:"upperRight",offset:this.options.menuOffset})},_setupViewModel:function(){this.viewModel=Object({isUserLoggedIn:ko.observable(!1),showMenuHovered:ko.observable(!1),showMenu:ko.observable(!1),partiallyVisible:ko.observable(),userFirstName:ko.observable()}),Object.append(this.viewModel,{menuShouldShow:this.viewModel.showMenuHovered.extend({delay:{"in":100,out:100}})}),this.menu.shouldShow=this.viewModel.menuShouldShow.subscribe(this._menuShouldShow.bind(this)),this._setupPackages(),ko.applyBindings(this.viewModel,this.el)}}),Uverse.widgets.MainLinks=new Class({Implements:[Options],el:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),Uverse.page.addMemoryEvent("Personalization-userData",function(a){a.isLoggedIn()&&Uverse.page.addMemoryEvent("Favorite-assetList",this._updateFavoritesCount.bind(this))}.bind(this))},_updateFavoritesCount:function(){var a=this.el.getElements(".badge.favoritesCount"),b=Uverse.page.favorites.getFavoriteCount();a.each(function(a){this._updateBadgeText(a,b,b>0)},this)},_updateBadgeText:function(a,b,c){a.getElement(".badge-text").innerHTML=b,a.removeClass("hidden"),c?a.removeClass("disabled"):a.addClass("disabled")}}),Uverse.widgets.MarketingPage=new Class({Implements:[Options,Callbacks],options:{marketingDataKey:"marketingDataKey",callbacks:{}},callbacks:{onAllComponentsLoaded:function(){}},marketingPageData:null,viewModel:null,initialize:function(a,b){this.el=a,this.setOptions(b),this.setCallbacks(b.callbacks),this.marketingPageData=Uverse.loader.retrieveModelData(this.options.marketingDataKey),this._setupViewModel(),ko.applyBindings(this.viewModel,this.el),this.callbacks.onAllComponentsLoaded(this.el)},_setupViewModel:function(){this.viewModel={components:ko.observableArray(this.marketingPageData.components),getTemplateId:function(a){return Uverse.Enums.MarketingPage[a]}}}}),Uverse.widgets.MyShowsPage=new Class({Implements:[Options],options:{cardControllerOptions:null,bookmarkRequestUrl:"/myshows/getResumeWatchingCards.json",bookmarkRequestCount:25,favoriteRequestUrl:"/myshows/getFavoriteGroups.json",favoriteRequestCount:5},viewModel:null,infiniteScroll:null,cardController:null,hasMoreBookmarks:!0,hasMoreFavorites:!0,bookmarkRequest:null,favoriteRequest:null,bookmarksAPI:null,favoritesAPI:null,el:null,MAX_CARDS_PER_ROW:12,initialize:function(a,b){this.el=a,this.setOptions(b),this._setupCardController(),this._setupViewModel(),this._setupAjaxRequests(),this._setupInfiniteScroll(),this.infiniteScroll.checkScrollPosition()},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupViewModel:function(){var a=this.viewModel={bookmarkCards:ko.observableArray([]),favoriteGroups:ko.observableArray([]),showFavoritesSection:ko.observable(!1),cardController:this.cardController,isLoading:ko.observable(!0),numberOfBookmarks:ko.observable(null),numberOfFavorites:ko.observable(null)};Object.append(a,{removeFavorite:this._removeFavorite.bind(this),removeBookmark:this._removeBookmark.bind(this)}),ko.applyBindings(this.viewModel,this.el)},_setupInfiniteScroll:function(){this.infiniteScroll=new Uverse.widgets.InfiniteScrollGeneric,this.infiniteScroll.addEvent("endOfContainerReached",this._getMoreData.bind(this))},_getMoreData:function(){this.bookmarkRequest.isRunning()||this.favoriteRequest.isRunning()||(this.hasMoreBookmarks?this._getMoreBookmarkCards():this.hasMoreFavorites?this._getMoreFavoriteGroups():(this.infiniteScroll.enable(!1),this.viewModel.isLoading(!1)))},_removeFavorite:function(a){a.isRemoved(!0),this.viewModel.favoriteGroups.remove(a),this.viewModel.numberOfFavorites(this.viewModel.numberOfFavorites()-1),Uverse.page.favorites.removeFavorite(a.favoriteId),this.infiniteScroll.checkScrollPosition()},_removeBookmark:function(a){this.viewModel.bookmarkCards.remove(a),this.viewModel.numberOfBookmarks(this.viewModel.numberOfBookmarks()-1),Uverse.page.bookmarks.removeBookmark(a.videoKey,a.safeVideoKey),this.infiniteScroll.checkScrollPosition()},_setupAjaxRequests:function(){this.bookmarkRequest=new Request.JSON({url:this.options.bookmarkRequestUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"post",onSuccess:this._onBookmarkData.bind(this),onFailure:this._onBookmarkRequestFailure.bind(this),link:"cancel"}),this.favoriteRequest=new Request.JSON({url:this.options.favoriteRequestUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"post",onSuccess:this._onFavoriteData.bind(this),onFailure:this._onFavoriteRequestFailure.bind(this),link:"cancel"})},_getMoreBookmarkCards:function(){var a=this.viewModel.bookmarkCards().length;Uverse.console.log("[MyShowsPage]","Bookmark Data Requested"),this.bookmarkRequest.send({data:{start:a,count:this.options.bookmarkRequestCount}})},_getMoreFavoriteGroups:function(){var a=this.viewModel.favoriteGroups().length;Uverse.console.log("[MyShowsPage]","Favorite Data Requested"),this.favoriteRequest.send({data:{start:a,count:this.options.favoriteRequestCount}})},_onBookmarkData:function(a){Uverse.console.log("[MyShowsPage]","Bookmark Data Retrieved");var b=this.viewModel.bookmarkCards,c=a.cards;c.each(function(a){a.removeBookmark=this._removeBookmark.bind(this,a)},this),b.push.apply(b,c),this.viewModel.numberOfBookmarks(a.total),this.viewModel.bookmarkCards().length>=this.viewModel.numberOfBookmarks()&&(Uverse.console.log("[MyShowsPage]","Finished loading Bookmarks"),this.hasMoreBookmarks=!1,this.viewModel.showFavoritesSection(!0)),this.infiniteScroll.checkScrollPosition()},_onFavoriteData:function(a){var b=a.groups,c,d;Uverse.console.log("[MyShowsPage]","Retrieved Favorite Cards: ",b.length);for(var e=0;e<b.length;e++){c=0,d=[];var f=b[e];f.isRemoved=ko.observable(!1);for(var g=0;g<f.cards.length&&c<this.MAX_CARDS_PER_ROW;g++)d[g]=f.cards[g],"clip"==f.cards[g].cardType?c++:c+=4;f.cards=d}var h=this.viewModel.favoriteGroups;h.push.apply(h,b),this.viewModel.numberOfFavorites(a.total),this.viewModel.favoriteGroups().length>=this.viewModel.numberOfFavorites()&&(Uverse.console.log("[MyShowsPage]","Finished loading Favorites"),this.hasMoreFavorites=!1),this.infiniteScroll.checkScrollPosition()},_onFavoriteRequestFailure:function(){Uverse.console.error("[MyShowsPage]","Request for favorite data failed."),this.viewModel.isLoading(!1)},_onBookmarkRequestFailure:function(){Uverse.console.error("[MyShowsPage]","Request for bookmark data failed."),this.viewModel.isLoading(!1)}}),Uverse.widgets.MyShowsWidget=new Class({Implements:[Options,Timers],options:{cardControllerOptions:null,cardRequestUrl:"/getMyShowsWidget.json"},viewModel:null,cardController:null,columnCount:null,cardData:{resumeCards:null,favoriteCards:null,seriesCards:null},bookmarksLoaded:!1,favoritesLoaded:!1,bookmarkRemoved:!1,needsToLoadGroups:!1,el:null,initialize:function(a,b){return Uverse.page.isUserLoggedIn()?(this.el=a,this.setOptions(b),this._setupCardController(),this._setupViewModel(),this._setupMemoryEvent(),void this._sendAjaxRequest()):void a.destroy()},_setupMemoryEvent:function(){Uverse.page.addMemoryEvent("PageWidth_columnsChanged",this._columnsChanged.bind(this)),Uverse.page.addMemoryEvent("Favorite-assetList",this._favoritesChanged.bind(this)),Uverse.page.addMemoryEvent("Bookmarks-ready",this._bookmarksChanged.bind(this))},_favoritesChanged:function(){this.favoritesLoaded?this._reloadWidget():this.favoritesLoaded=!0},_bookmarksChanged:function(){this.bookmarksLoaded?this._reloadWidget():this.bookmarksLoaded=!0},_columnsChanged:function(a){this.columnCount=a,this._reloadGroups()},_reloadGroups:function(){this.viewModel.isLoading()||(this._clearGroups(),this._loadGroups())},_clearGroups:function(){this.viewModel.resumeCards.removeAll(),this.viewModel.favoriteCards.removeAll(),this.viewModel.seriesCards.removeAll()},_reloadWidget:function(){this.bookmarkRemoved?this.bookmarkRemoved&&(this.bookmarkRemoved=!1,this._reloadGroups()):(this.viewModel.isLoading(!0),this._clearGroups(),this.setTimer(this._sendAjaxRequest,{timeout:3e3}))},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupViewModel:function(){var a=!!Uverse.page.retrieveFromCache("displayWidget",!0),b=this,c=this.viewModel={resumeCards:ko.observableArray([]),favoriteCards:ko.observableArray([]),seriesCards:ko.observableArray([]),resumeWatchingCount:ko.observable(0),favoriteCount:ko.observable(0),elements:{outerWrapElement:null,innerWrapElement:null},hideWidget:ko.observable(a),cardController:this.cardController,isOverflowing:ko.observable(!1),isLoading:ko.observable(!0)};c.toggleWidget=function(){var a=c.hideWidget();a&&this.needsToLoadGroups&&c.isLoading(!0),c.hideWidget(!a),Uverse.page.storeToCache("displayWidget",!a,!0)}.bind(this),c.animationFinished=function(){!c.hideWidget()&&this.needsToLoadGroups&&(c.isLoading(!1),this._loadGroups(),this.needsToLoadGroups=!1)}.bind(this),ko.applyBindings(this.viewModel,this.el),this.el.removeClass("hidden")},_sendAjaxRequest:function(){var a=new Request.JSON({url:this.options.cardRequestUrl,headers:Uverse.config.refreshUserSessionHeaders,method:"get",nocache:!0,onSuccess:this._onCardData.bind(this),onFailure:this._onCardRequestFailure.bind(this)});a.send()},_onCardData:function(a){Uverse.console.log("[MyShowsWidget]","Card Data Retrieved"),this.viewModel.resumeWatchingCount(a.resumeWatchingCount),this.viewModel.favoriteCount(a.favoriteCount),this.cardData.resumeCards=a.resumeWatchingCards,this.cardData.favoriteCards=a.favoriteCards,this.cardData.seriesCards=a.newSeriesCards,this.cardData.resumeCards.each(function(a){a.removeBookmark=this._removeBookmark.bind(this,a)},this),this.viewModel.isLoading(!1),this._loadGroups()},_loadGroups:function(){if(this.viewModel.hideWidget())return void(this.needsToLoadGroups=!0);var a=0,b=0,c=this.columnCount>=6?3:2,d=Math.min(this.cardData.resumeCards.length,c);this.viewModel.isOverflowing(!1);for(var e=0;d>e;e++)this.viewModel.resumeCards.push(this.cardData.resumeCards[e]);for(var e=0;e<this.cardData.favoriteCards.length;e++)if(this.viewModel.favoriteCards.push(this.cardData.favoriteCards[e]),this._isOverflowing())return void this.viewModel.favoriteCards.pop();for(var e=0;e<this.cardData.seriesCards.length;e++)if(this.viewModel.seriesCards.push(this.cardData.seriesCards[e]),this._isOverflowing())return void this.viewModel.seriesCards.pop()},_isOverflowing:function(){return this.viewModel.elements.innerWrapElement.offsetHeight>this.viewModel.elements.outerWrapElement.offsetHeight?!0:!1},_onCardRequestFailure:function(){Uverse.console.error("[MyShowsWidget]","Request for data failed."),this.viewModel.isLoading(!1)},_removeBookmark:function(a){this.cardData.resumeCards.erase(a),this.viewModel.resumeCards.remove(a),this.viewModel.resumeWatchingCount(this.viewModel.resumeWatchingCount()-1),this.bookmarkRemoved=!0,Uverse.page.bookmarks.removeBookmark(a.videoKey,a.safeVideoKey)}}),Uverse.widgets.NotificationCreator=new Class({Implements:[Callbacks],callbacks:{showLoading:null,hideLoading:null,showMessage:null},categoryPath:null,currentState:null,email:null,notificationTemplateElementID:"notificationOptionsTemplate",screens:{set:null,setForm:null,hasBeenSet:null},requestData:{request:null,params:{data:{}}},initialize:function(a,b){this.setCallbacks(b),this.categoryPath=a,this.requestData.request=new Request.JSON({url:Uverse.config.notification.urls.create,headers:Uverse.config.refreshUserSessionHeaders,method:"post",noCache:!0,onSuccess:this._onSaveSuccess.bind(this)}),Uverse.page.addMemoryEvent("Notification-userEmail",this._onNotificationUserEmailChanged.bind(this))},_onNotificationUserEmailChanged:function(){this.screens.hasBeenSet&&this._updateEmailInTemplate(this.screens.hasBeenSet),this.screens.setForm&&this._updateEmailTextField($(this.screens.setForm.email))},_updateEmailInTemplate:function(a){a.getElement(".email").set("text",Uverse.page.getNotificationUserEmail())},_updateEmailTextField:function(a){a.set("value",Uverse.page.getNotificationUserEmail())},getUI:function(a){this.currentState=a;var b=this._getClassNamesFromState(a),c=this._getTemplate(b);return this._unHideFirstScreen(c),c},_unHideFirstScreen:function(a){a.getChildren()[0].removeClass("hidden")},_getClassNamesFromState:function(a){switch(a){case Uverse.Enums.NotificationStates.NOT_NOTIFIED:return["set","hasBeenSet"];case Uverse.Enums.NotificationStates.NOTIFIED:return["hasBeenSet"]}},_getTemplate:function(a){var b=$(this.notificationTemplateElementID),c=[];return a.each(function(a){switch(a){case"set":var d=b.getElement(".set").clone();this.screens.set=d,this.screens.setForm=d.getElement("form"),this._updateEmailTextField($(this.screens.setForm.email)),this._addSaveEventsToTemplate(d),c.push(d);break;case"hasBeenSet":var e=b.getElement(".hasBeenSet").clone();this._updateEmailInTemplate(e),this.screens.hasBeenSet=e,c.push(e)}},this),b=new Element("div"),c.each(function(a){b.adopt(a)}),b},_addSaveEventsToTemplate:function(a){new Uverse.controls.Form(this.screens.setForm,{submit:this._onSaveSubmit.bind(this)})},_onSaveSubmit:function(a,b){return this._invalidEmail(b.email)?void this.callbacks.showMessage(Uverse.config.messages.error.invalidEmail):(this.callbacks.showLoading(),this.requestData.params.data.seriesPath=this.categoryPath,this.requestData.params.data.email=b.email,void this.requestData.request.send(this.requestData.params))},_invalidEmail:function(a){return this._isEmailEmpty(a)?!0:this._isEmailInvalid(a)?!0:!1},_isEmailEmpty:function(a){return a&&""!==a?!1:!0},_isEmailInvalid:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return!b.test(a)},_onSaveSuccess:function(a){Uverse.page.notificationUserEmailChanged(a.emailAddr),Uverse.page.notificationAddCategoryPath(this.categoryPath),this.screens.set.addClass("hidden"),this.screens.hasBeenSet.removeClass("hidden"),Browser.ie8&&this.screens.hasBeenSet.getSize(),this.currentState=Uverse.Enums.NotificationStates.NOTIFIED,this.callbacks.hideLoading()}}),Uverse.widgets.NotificationsSettings=new Class({el:null,viewModel:null,modal:null,isUserLoggedIn:!1,initialize:function(a,b){this.modal=a,this.el=b,this._setupViewModel(),a.applyBindings(this.viewModel,this.el),this.modal.startLoading(),Uverse.page.addMemoryEvent("Personalization-userData",this._onPersonalization.bind(this))},_onPersonalization:function(a){a.isLoggedIn()?(this.isUserLoggedIn=!0,this.viewModel.editingAllowed(!0),this._getDefaultStates()):this.modal.stopLoading()},_setupViewModel:function(){this._setupViewModel_Observables(),this._setupViewModel_Methods()},_setupViewModel_Observables:function(){this.viewModel={topShows:ko.observable(),library:ko.observable(),dvr:ko.observable(),favoriteEpisodes:ko.observable(),email:ko.observable(),errorMessage:ko.observable(),emailIsVerified:ko.observable(),showError:ko.observable(!1).extend({reset:!0}),editingAllowed:ko.observable(!1),initialState:ko.observable()}},_setupViewModel_Methods:function(){var a=this;this.viewModel.isFormValid=function(){var b=a.viewModel.emailCheck(a.viewModel.email());if(b.emailExists){if(b.emailIsValid)return a.viewModel.showError(!1),!0}else if(!a.viewModel.atLeastOneCheckboxIsChecked())return a.viewModel.showError(!1),!0;return a.viewModel.showError(!0),!1},this.viewModel.emailCheck=function(a){var b={emailIsValid:!1,emailExists:!1};if(a&&""!==a&&(b.emailExists=!0,a)){var c=Uverse.config.emailValidation.regex;b.emailIsValid=c.test(a)}return b},this.viewModel.atLeastOneCheckboxIsChecked=function(){return this.topShows()||this.library()||this.dvr()||this.favoriteEpisodes()},this.viewModel.saveNotificationsSettings=function(b,c){if(c.preventDefault(),a.isUserLoggedIn){var d=a._jsonMapping();if(b.isFormValid())var e=new Request.JSON({method:"put",url:"/notification/options.json",headers:Uverse.config.refreshUserSessionHeaders,data:d,onSuccess:a.modal._closeModal.bind(a.modal)}).send()}},this.viewModel.saveEmail=function(b,c){if(c.preventDefault(),a.isUserLoggedIn&&b.isFormValid()){b.initialState().email=b.email();var d=new Request.JSON({method:"put",url:"/notification/options.json",headers:Uverse.config.refreshUserSessionHeaders,data:b.initialState(),onSuccess:b.resendVerificationEmail.bind(this,b)}).send()}},this.viewModel.resendVerificationEmail=function(b,c){var d=new Request.JSON({method:"get",url:"/notification/resend.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:function(c){b._changeEmailVerificationMessage(a,c)}}).send()},this.viewModel.closeNotificationsSettings=function(){a.modal._closeModal()},this.viewModel._changeEmailVerificationMessage=function(a,b){var c=Uverse.config.notification.toast.message.replace("{0}",b.emailAddr);Uverse.page.showToast({message:c,timeout:Uverse.config.notification.toast.timeout})},this.viewModel.hideTooltip=function(a,b){a.showError.reset()},this.viewModel.showVerifyLink=function(a,b){a.emailIsVerified(a.emailCheck(a.email()).emailIsValid?Uverse.config.notification.emailResendLink:"")}},_getDefaultStates:function(){this.firstRequest=new Request.JSON({method:"get",url:"/notification.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._onDefaultDataReceived.bind(this)}).send()},_onDefaultDataReceived:function(a){var b=this.viewModel;b.email(a.emailAddr),b.topShows(a.topShows),b.library(a.favorites),b.dvr(a.dvr),b.favoriteEpisodes(a.favoriteEpisodes),a.emailVerified===!1&&null!=a.emailAddr&&b.emailIsVerified(Uverse.config.notification.emailResendLink);var c=this._jsonMapping();b.initialState(c),this.modal.stopLoading()},_jsonMapping:function(){var a={email:this.viewModel.email(),topShows:this.viewModel.topShows(),library:this.viewModel.library(),dvr:this.viewModel.dvr(),favoriteEpisodes:this.viewModel.favoriteEpisodes()};return a}}),Uverse.widgets.PackageManager=new Class({viewModel:null,entitlementHelper:null,entitlementPackages:null,options:{fadeDuration:1e3,fadeTransition:"quint:out"},pager:{currentPage:0,pageSize:6,totalPages:0},initialize:function(a){this.viewModel=a,this.entitlementHelper=new Uverse.utils.Entitlement,this._setupViewModel()},_setupViewModel:function(){Object.append(this.viewModel,{userPackage:ko.observable(),displayPackages:ko.observableArray(),packages:ko.observableArray(),fadeDuration:this.options.fadeDuration,fadeTransition:this.options.fadeTransition}),this.viewModel.nextPage=this._nextPage.bind(this),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this))},_onUserData:function(a){a.isLoggedIn()&&(this.entitlementPackages=a.entitlementPackages,this.viewModel.userPackage(this.entitlementHelper.getUserUversePackage(this.entitlementPackages)),this.entitlementPackages.hash&&this._setupPager())},_setupPager:function(){var a=this.viewModel.packages.removeAll();this._determinePackageEntitlement(a),a=this._sortPackagesByEntitled(a),this.viewModel.packages(a),this.pager.totalPages=Math.ceil(this.viewModel.packages().length/this.pager.pageSize),this._displayCurrentPage()},_determinePackageEntitlement:function(a){for(var b=a.length;b--;){for(var c=a[b],d=c.packageKeys,e=d.length,f=!1;e--;)this.entitlementPackages.addons.contains(d[e])&&(f=!0);c.entitled=f}},_sortPackagesByEntitled:function(a){for(var b=[],c=0;c<a.length;)a[c].entitled?b.append(a.splice(c,1)):c++;return b.append(a),b},_displayCurrentPage:function(){var a=this.pager.currentPage*this.pager.pageSize,b=this.viewModel.packages.slice(a,a+this.pager.pageSize);this.viewModel.displayPackages(b)},_nextPage:function(){this.pager.currentPage++,this.pager.currentPage===this.pager.totalPages&&(this.pager.currentPage=0),this._displayCurrentPage()},resetPage:function(){0!==this.pager.currentPage&&(this.pager.currentPage=0,this._displayCurrentPage())}}),Uverse.widgets.PageBlocker=new Class({Implements:[Options,Timers],el:null,timer:null,timerDone:!1,hideCalled:!1,options:{minDisplayDuration:2e3},contentEls:{messageEl:null},transitions:{shown:{props:["opacity"]}},initialize:function(a){this.el=$("pageBlocker"),this.setOptions(a),this._setupElements(),this._setupEvents()},show:function(a,b){void 0===b&&(b=!0),b&&Uverse.page.hidePrimaryScrollBars(),this.contentEls.messageEl.set("text",a||""),this.el.removeClass("hidden"),this.el.addClassWithTransition("shown",this.transitions.shown),this.setTimer(this._onTimer,{timeout:this.options.minDisplayDuration}),this.timerDone=!1,this.hideCalled=!1,this.hideScrollBars=b},hide:function(){this.hideCalled=!0,this._hideWhenComplete()},_onTimer:function(){this.timerDone=!0,this.clearTimers(),this._hideWhenComplete()},_hideWhenComplete:function(){this.hideCalled&&this.timerDone&&(this.el.removeClassWithTransition("shown",this.transitions.shown),this.el.get("morph").chain(function(){this.el.addClass("hidden")}.bind(this)),this.hideScrollBars&&Uverse.page.restoreScrollBars())},_setupElements:function(){this.contentEls.messageEl=this.el.getElement(".page-blocker-message")},_setupEvents:function(){this.el.addEvent("click",this._onClick.bind(this))},_onClick:function(a){a.stop()}}),Uverse.widgets.PageWidth=new Class({Implements:[Options],Binds:["_onWindowResize"],options:{minimumColumns:4,maximumColumns:6,columnWidth:null,columnMargin:null,pagePadding:20,pageLayout:!1},categoryPageLayout:{leftBarWidth:250,videoCardWidth:320,videoCardMargin:20,minimumColumns:2,maximumColumns:3},articlePageLayout:{leftBarWidth:0,videoCardWidth:320,videoCardMargin:20,minimumColumns:3,maximumColumns:4},pageContainer:null,pageLayout:null,columnCount:0,recalculateWidth:!1,parentWidth:0,initialize:function(a,b){this.pageContainer=$(a),this.setOptions(b);var c=this.pageContainer.getElement(".columnTemplate");c&&c.isVisible()?(this._setupCardPageLayout(c),this._initialized()):this.options.pageLayout&&this._initialized()},_initialized:function(){this.pageContainer.addClass("hasPageWidth"),this._setupWindowEvents(),this._onWindowResize()},_setupCardPageLayout:function(a){this.options.columnWidth=a.getWidth();var b=a.getClosest(".tile-group");this.options.columnMargin=-(b.getStyle("margin-left").toInt()+b.getStyle("margin-right").toInt()),Uverse.console.assert(this.options.columnWidth,"[PageWidth]","Failed to initialize!  Could not find the column width."),Uverse.console.assert(!isNaN(this.options.columnMargin)&&this.options.columnMargin,"[PageWidth]","Failed to initialize!  Could not find the column margin.")},_setupWindowEvents:function(){window.addEvent("resize:pace(100)",this._onWindowResize)},_onWindowResize:function(){var a=this.pageContainer.getParent().getWidth();this.parentWidth!==a&&(this.parentWidth=a,this.options.pageLayout?this._updateCategoryPageColumns(a):this._updateCardPageColumns(a))},_updateCardPageColumns:function(a){var b=Math.floor((a-this.options.pagePadding+this.options.columnMargin)/this.options.columnWidth);b=Math.min(Math.max(this.options.minimumColumns,b),this.options.maximumColumns);var c=b*this.options.columnWidth-this.options.columnMargin;this._updateColumnCount(b,c)},_updateCategoryPageColumns:function(a){var b=this.categoryPageLayout,c=this.options.pageLayout;"article_page"===c&&(b=this.articlePageLayout);var d=b.maximumColumns;this.recalculateWidth&&(d-=1);var e=Math.floor((a-b.leftBarWidth+b.videoCardMargin)/(b.videoCardWidth+b.videoCardMargin));e=Math.min(Math.max(b.minimumColumns,e),d);var f=b.leftBarWidth+e*b.videoCardWidth+(e-1)*b.videoCardMargin;this.recalculateWidth?(this._updateColumnCount(e,f),this.recalculateWidth=!1):a-f>20?this._updateColumnCount(e,f):(this.recalculateWidth=!0,this._updateCategoryPageColumns(a))},_updateColumnCount:function(a,b){var c=this.columnCount;if(c!==a){this.columnCount=a,Uverse.page.fireMemoryEvent("PageWidth_columnsChanging",[a,c,b]);var d=this.pageContainer.getElements(".needsPageWidth");d.setStyle("width",b),d.removeClass("hide-until-pageWidth"),Uverse.page.fireMemoryEvent("PageWidth_columnsChanged",[a,c,b])}}}),Uverse.widgets.ParentalControlsSettings=new Class({el:null,viewModel:null,modal:null,currentView:null,subCategories:null,pinLength:4,initialize:function(a,b){this.modal=a,this.el=b,this.subCategories=Object({enablePC:"Main",setPIN:"Set Pin",PCEnabled:"Main",changePIN:"Change Pin",disablePC:"Disable Parental Controls",forgotPIN:"Forgot My PIN"}),this._setupViewModel(),this.modal.applyBindings(this.viewModel,this.el),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalization.bind(this))},_onPersonalization:function(a){a.isHouseholdAccount()?(this.viewModel.editingAllowed(!0),this._requestParentalControlsData()):this._changeViewModelPage("enablePC")},_setupViewModel:function(){this._setupViewModelObservables(),this._setupViewModelComputed(),this._setupViewModelMethods()},_setupViewModelObservables:function(){var a=this,b=Object({enablePC:{},setPIN:{form:{newPin:ko.observable("").extend({reset:!0}),confirmPin:ko.observable("").extend({reset:!0})},showError:ko.observable(!1).extend({reset:!0})},PCEnabled:{},changePIN:{form:{currentPin:ko.observable("").extend({reset:!0}),newPin:ko.observable("").extend({reset:!0}),confirmPin:ko.observable("").extend({reset:!0})},showError:ko.observable(!1).extend({reset:!0}),showErrorCurrentPin:ko.observable(!1).extend({reset:!0}),showTooltipCurrentPin:ko.observable(!1),currentPinErrorMessage:ko.observable(Uverse.config.parentalControls.errors.invalidPin)},forgotPIN:{},disablePC:{form:{currentPin:ko.observable("").extend({reset:!0})},showError:ko.observable(!1).extend({reset:!0}),showTooltipCurrentPin:ko.observable(!1),currentPinErrorMessage:ko.observable(Uverse.config.parentalControls.errors.invalidPin)}});this.viewModel=Object({subcategory:ko.observable(),pages:b,enablePC:ko.observable(),setPIN:ko.observable(),PCEnabled:ko.observable(),changePIN:ko.observable(),disablePC:ko.observable(),forgotPIN:ko.observable(),editingAllowed:ko.observable(!1)})},_requestParentalControlsData:function(){this.firstRequest=new Request.JSON({method:"get",url:"/parentalControls/retrieveParentalControls.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._onRetrieveParentalControls.bind(this)}).send(),this.modal.startLoading()},_setupViewModelComputed:function(){var a=function(a){return a.form.newPin()===a.form.confirmPin()?this._regexCheckOnlyNumbers(a.form.newPin(),this.pinLength):!1},b=function(a){return a.currentPinErrorMessage(Uverse.config.parentalControls.errors.invalidPin),this._regexCheckOnlyNumbers(a.form.currentPin(),this.pinLength)};this.viewModel.pages.setPIN.isPinValid=ko.computed(a.bind(this,this.viewModel.pages.setPIN)),this.viewModel.pages.changePIN.isPinValid=ko.computed(a.bind(this,this.viewModel.pages.changePIN)),this.viewModel.pages.changePIN.isCurrentPinValid=ko.computed(b.bind(this,this.viewModel.pages.changePIN)),this.viewModel.pages.disablePC.isCurrentPinValid=ko.computed(b.bind(this,this.viewModel.pages.disablePC))},_setupViewModelMethods:function(){var a=this;this.viewModel.doSavePIN=function(b,c){c.preventDefault(),b.showError(!b.isPinValid()),b.showError()||(this.firstRequest=new Request.JSON({method:"post",data:JSON.encode({newPin:b.form.newPin()}),url:"/parentalControls/setPin.json",headers:_.extend(Uverse.config.refreshUserSessionHeaders,{"Content-Type":"application/json"}),urlEncoded:!1,onSuccess:a._onSavePinDataReceived.bind(a)}).send(),this.modal.startLoading(),a._resetForm(b.form))}.bind(this),this.viewModel.doChangePIN=function(b,c){c.preventDefault(),b.showErrorCurrentPin(!b.isCurrentPinValid()),b.showTooltipCurrentPin(!b.isCurrentPinValid()),b.showError(!b.isPinValid()),b.showError()&&b.showTooltipCurrentPin(!1),b.showError()||b.showErrorCurrentPin()||(this.firstRequest=new Request.JSON({method:"post",data:JSON.encode({currentPin:b.form.currentPin(),newPin:b.form.newPin()}),url:"/parentalControls/changePin.json",headers:_.extend(Uverse.config.refreshUserSessionHeaders,{"Content-Type":"application/json"}),urlEncoded:!1,onSuccess:function(c){a._onChangePinDataReceived(b,c)}}).send(),this.modal.startLoading())}.bind(this),this.viewModel.doDisablePC=function(b,c){c.preventDefault(),b.showError(!b.isCurrentPinValid()),b.showTooltipCurrentPin(!b.isCurrentPinValid()),b.showTooltipCurrentPin()||b.showError()||(this.firstRequest=new Request.JSON({method:"post",data:JSON.encode({currentPin:b.form.currentPin()}),url:"/parentalControls/disablePin.json",headers:_.extend(Uverse.config.refreshUserSessionHeaders,{"Content-Type":"application/json"}),urlEncoded:!1,onSuccess:function(c){a._onDisablePCDataReceived(b,c)}}).send(),this.modal.startLoading())}.bind(this),this.viewModel.doRememberPin=function(b,c){c.preventDefault(),this.firstRequest=new Request.JSON({method:"post",url:"/parentalControls/reminder.json",headers:_.extend(Uverse.config.refreshUserSessionHeaders,{"Content-Type":"application/json"}),urlEncoded:!1,onSuccess:a._onRememberPinDataReceived.bind(a)}).send(),this.modal.startLoading()}.bind(this),this.viewModel.changePage=function(b,c,d){d.preventDefault(),Uverse.config.clickTracking.startTracking(d.target),c.form&&a._resetForm(c.form),c.showError&&c.showError.reset(),c.showErrorCurrentPin&&c.showErrorCurrentPin.reset(),c.showTooltipCurrentPin&&c.showTooltipCurrentPin(!1),a._changeViewModelPage(b)},this.viewModel.hideTooltip=function(a,b){a.showError&&a.showError.reset(),a.showErrorCurrentPin&&a.showErrorCurrentPin.reset(),a.showTooltipCurrentPin&&a.showTooltipCurrentPin(!1)},this.viewModel.checkInputText=function(a,b){b=b?b:event;var c=b.charCode||b.keyCode||b.which||0;return!b.shiftKey&&c>47&&58>c||c>95&&106>c||c>32&&41>c||8===c||9===c||46===c||144===c}},_changeViewModelPage:function(a){this.viewModel.subcategory(this.subCategories[a]),null!==this.currentView&&this.currentView(null);var b=this.viewModel[a](this.viewModel.pages[a]);this.currentView=this.viewModel[a]},_onSavePinDataReceived:function(a){a.success&&this._changeViewModelPage("PCEnabled"),this.modal.stopLoading()},_onDisablePCDataReceived:function(a,b){b.success?(this._resetForm(a.form),this._changeViewModelPage("enablePC")):"IncorrectPinException"===b.message&&(a.currentPinErrorMessage(Uverse.config.parentalControls.errors.wrongPin),a.showError(!0),a.showTooltipCurrentPin(!0)),this.modal.stopLoading()},_onChangePinDataReceived:function(a,b){b.success?(this._resetForm(a.form),this._changeViewModelPage("PCEnabled")):"IncorrectPinException"===b.message&&(a.showErrorCurrentPin(!0),a.showTooltipCurrentPin(!0),a.currentPinErrorMessage(Uverse.config.parentalControls.errors.wrongPin)),this.modal.stopLoading()
},_onRetrieveParentalControls:function(a){this._changeViewModelPage(a?"PCEnabled":"enablePC"),this.modal.stopLoading()},_onRememberPinDataReceived:function(a){a.success&&this._changeViewModelPage("forgotPIN"),this.modal.stopLoading()},_resetForm:function(a){for(var b in a)ko.isObservable(a[b])&&"function"==typeof a[b].reset&&a[b].reset()},_regexCheckOnlyNumbers:function(a,b){if(b&&a.length!=b)return!1;var c=/^\d+$/;return c.test(a)}}),Uverse.widgets.PlayerLoader=new Class({Implements:[Options,Callbacks],options:{},callbacks:{loadModal:null},playerTemplate:null,initialize:function(a,b,c){this.playerTemplate=a,this.setOptions(b),this.setCallbacks(c),this._setupShrink()},_setupShrink:function(){this.shrink=new Uverse.utils.Shrink},playVideo:function(a){var b=this.playerTemplate.clone();b.getElement(".playerLoader-network").set("text",a.videoNetwork||""),b.getElement(".playerLoader-title").set("text",a.videoTitle||""),b.getElement(".playerLoader-subtitle").set("text",a.videoSubtitle||""),b.getElement(".playerLoader-description").set("text",a.videoDescription||"");var c={categoryPath:a.categoryPath,videoId:a.videoId};a.nextVideoHistory&&(c.nextVideoHistory=a.nextVideoHistory);var d={debugName:"Play Video "+a.videoId,className:"modal-container-for-modal-player",requestOptions:{url:"/getPlayer.html",data:c,onFailure:this._onRequestFailure.bind(this,b)},closeOnBackgroundClick:!1},e={},f=new Uverse.widgets.Modal(b,d,e);this.callbacks.loadModal(f),this.shrink.resize(b.getElement(".playerLoader-shrink"))},_onRequestFailure:function(a,b){a.getElement(".player-loading").addClass("hidden"),a.getElement(".loadingError-extension").removeClass("hidden")}}),Uverse.widgets.QuickSearch=new Class({Implements:[Options],Binds:["_onRequestSuccess","_onDocumentClick"],options:{searchUrl:null,searchKey:null,requestPace:250,minCharacters:1,hidePreviewDelay:1},uversePage:!1,iokoApp:!1,el:null,request:null,tileHelper:new Uverse.utils.TileHelper,entitlementHelper:new Uverse.utils.Entitlement,formControl:null,textbox:null,searchResultsContainer:null,uverseData:null,selectedResult:null,submittedSearchQuery:!1,currentSearchTerms:"",requestedSearchTerms:"",displayedResultsSearchTerms:null,resultCache:{},transitions:{searching:null},initialize:function(a,b){this.el=$(a),this.setOptions(b);var c=this.el.getElement("form");this._setupForm(c),this._setupRequest(),this._setupResults(),this._setupTextbox(),this._setupZipcode(),this._updateAdvancedSearchOptions(),"undefined"!=typeof Uverse&&Uverse.page&&Uverse.page.clickTracking&&(this.uversePage=!0),"undefined"!=typeof Ioko&&Ioko.namespace("storage","App")&&(this.iokoApp=!0)},_setupForm:function(a){var b={submit:this._onSubmit.bind(this),changing:this._onChanging.bind(this)};this.formControl=new Uverse.controls.Form(a,b)},_setupZipcode:function(){var a=this.el.getElement(".epg-zipcode-input");a&&Uverse.page.setupMemoryEvent("epg-zipcode",this._updateZipcode.bind(this,a))},_updateZipcode:function(a,b){a.set("value",b),this._clearResultCache()},_clearResultCache:function(){this.resultCache={}},_onSubmit:function(a,b){!this.selectedResult||this.selectedResult.match(".quick-search-advanced-submit")?""===b.query||b.query.length<this.options.minCharacters||(this.uversePage?Uverse.page.clickTrack(a.target,{callback:function(){return Uverse.console.log("[QuickSearch]","Navigating to the advanced search page."),this.formControl.submit(),!0}.bind(this),addLabel:b.query}):this.formControl.submit()):this._navigateToSelectedResult()},_onChanging:function(a,b,c,d){this.currentSearchTerms=c.toLowerCase().clean(),this._checkForChanges()},_setupRequest:function(){this.request=new Request({url:this.options.searchUrl,method:"POST",onSuccess:this._onRequestSuccess}),this._sendRequest=this._sendRequest.pace(this.options.requestPace,this)},_checkForChanges:function(){if(this.el.getElement(".quick-search-textbox").toggleClass("has-text",this.currentSearchTerms.length>0),this.currentSearchTerms.length<this.options.minCharacters)return this._hideResults(),void this._hasText(!1);this._hasText(!0);var a=this.resultCache[this.currentSearchTerms];return a?(this._renderResults(this.currentSearchTerms,a),void this._setIsSearching(!1)):void(this.request.isRunning()||this._sendRequest())},_sendRequest:function(){Uverse.console.log("[QuickSearch]","Searching for",this.currentSearchTerms),this.requestedSearchTerms=this.currentSearchTerms;var a=this.formControl.getValues()||{};a[this.options.searchKey]=this.currentSearchTerms,this.request.send({data:a}),this._setIsSearching(!0)},_setIsSearching:function(a){this.el.toggleClass("searching",a)},_onRequestSuccess:function(a){var b=this.requestedSearchTerms;this.resultCache[b]=a,this._renderResults(b,a),this._setIsSearching(!1),this._checkForChanges()},_renderResults:function(a,b){this.displayedResultsSearchTerms!==a&&(this.displayedResultsSearchTerms=a,this.searchResultsContainer.empty().set("html",b),this.searchResultsContainer.hasClass("hidden")&&this.searchResultsContainer.removeClass("hidden"),this.selectedResult=null,this._setupPlayLinks(),this._setupEntitlement(),Uverse.console.log("[QuickSearch]","Rendered search results for ",a))},_hideResults:function(){this.searchResultsContainer.addClass("hidden").empty(),this.displayedResultsSearchTerms=null},_resultsAreVisible:function(){return null!==this.displayedResultsSearchTerms},_hasText:function(a){this.el.toggleClass("has-text",a)},_setupResults:function(){this.searchResultsContainer=this.el.getElement(".quick-search-results-container"),this.searchResultsContainer.addEvents({"mouseover:relay(.quick-search-result, .quick-search-advanced-submit)":function(a,b){this._setSelectedResult(b)}.bind(this),"mouseout:relay(.quick-search-result, .quick-search-advanced-submit)":function(a,b){this._setSelectedResult(null)}.bind(this),"click:relay(.quick-search-result-link)":function(a,b){this._clickedLink(a,b)}.bind(this)})},_onDocumentClick:function(a){var b=$(a.target),c=!this.el.contains(b);c&&this._onBlur(null)},_setupTextbox:function(){this.textbox=this.el.getElement(".quick-search-textbox"),Uverse.console.assert(this.textbox),this.textbox.addEvents({keydown:this._onKeyDown.bind(this),focus:this._onFocus.bind(this),click:this._onFocus.bind(this)})},_onFocus:function(a){this.el.addClass("active"),$(document).addEvent("click",this._onDocumentClick),this._checkForChanges()},_onBlur:function(a){this.el.removeClass("active"),$(document).removeEvent("click",this._onDocumentClick),this._hideResults(),this.textbox.blur()},_onKeyDown:function(a){if(this._resultsAreVisible())switch(a.key){case"esc":a.preventDefault(),this.selectedResult?this._setSelectedResult(null):this._hideResults();break;case"up":a.preventDefault(),this._moveSelection(-1);break;case"down":a.preventDefault(),this._moveSelection(1);break;case"tab":a.preventDefault(),this._moveSelection(a.shift?-1:1);break;case"left":this._hasSelection()&&this._highlightPreview();break;case"right":this._hasSelection()&&this._unhighlightPreview()}},_moveSelection:function(a){var b=-1,c=this.el.getElements(".quick-search-result, .quick-search-advanced-submit");this.selectedResult&&(b=c.indexOf(this.selectedResult)),b+=a,0>b&&(b=c.length-1),b>=c.length&&(b=0),this._setSelectedResult(c[b])},_hasSelection:function(){return null!==this.selectedResult},_setSelectedResult:function(a){this.selectedResult!==a&&(this.selectedResult&&this.selectedResult.removeClass("selected"),a&&a.addClass("selected"),this.selectedResult=a,this._updatePreview())},_navigateToSelectedResult:function(){var a=this.currentPreview&&this.currentPreview.getElement(".image-overlay-active a"),b=a||this.selectedResult.getElement(".quick-search-result-link");b.focus(),b.click()},_updatePreview:function(){!this.selectedResult||this.selectedResult.match(".quick-search-advanced-submit")?this.hidePreviewTimer=this._hidePreview.delay(this.options.hidePreviewDelay,this,[!0]):(this._hidePreview(),this.currentPreview=this.selectedResult.getElement(".quick-search-preview-container"),this.currentPreview&&this._showPreview())},_showPreview:function(){this.currentPreview.hasClass("hidden")&&this.currentPreview.fade("hide").removeClass("hidden"),this.currentPreview.fade("in","quint:out"),this._positionCurrentPreview()},_hidePreview:function(a){this.hidePreviewTimer&&(clearTimeout(this.hidePreviewTimer),this.hidePreviewTimer=null),this.currentPreview&&(this.currentPreview.fade("out",a?"quint:in":"quint:out"),this._unhighlightPreview())},_highlightPreview:function(){this.currentPreview&&this.currentPreview.getElements(".image-overlay").addClass("image-overlay-active")},_unhighlightPreview:function(){this.currentPreview&&this.currentPreview.getElements(".image-overlay-active").removeClass("image-overlay-active")},_positionCurrentPreview:function(){var a=8,b=4,c=this.currentPreview.getElement(".quick-search-preview-tile"),d=this.searchResultsContainer.getTop()+b,e=this.searchResultsContainer.getHeight()-2*b,f=c.setStyle("top",0).getTop()+a,g=c.getHeight()-2*a,h=this.selectedResult.getTop(),i=this.selectedResult.getHeight(),j=h+(i-g)/2;j=Math.max(Math.min(d+e-g,j),d),c.setStyle("top",j-f)},_clickedLink:function(a,b){var c="left"==a.getMouseButton(),d=!c;if(c&&a.preventDefault(),(b.hasClass("epg-channel-link")||b.hasClass("epg-show-link"))&&this._hideResults(),this._reportSearchQuery(this.displayedResultsSearchTerms,d),this.uversePage){var e=b.get("href");Uverse.page.clickTrack(b,{callback:function(){return Uverse.console.log("[QuickSearch]","Clicked a search suggestion."),c&&e&&!this.submittedSearchQuery?(window.location=e,this.submittedSearchQuery=!0,!0):void this._onBlur(null)}.bind(this)})}else this.iokoApp&&Ioko.namespace("storage","App").clickTracking.track(b,{followLink:c,event:a})},_getClickTrackingLabelFromLink:function(a){var b;return this.uversePage?b=Uverse.page.getConstant("clickTracking","attributeMap.prefix")+Uverse.page.getConstant("clickTracking","attributeMap.names.label"):this.iokoApp&&(b=Ioko.namespace("storage","App").clickTracking.LABEL),a.get(b)},_reportSearchQuery:function(a,b){if(!this.submittedSearchQuery){var c=new Request({url:"/report/search_queries.json",method:"POST",async:b,link:"chain"});c.send({data:{query_type:"QUICK_SEARCH_CLICK",query:a}})}},_setupPlayLinks:function(){this.tileHelper.setupVideoPlayLinks(this.el),this.playLinksBound||(this.playLinksBound=!0,this.el.addEvent("click:button(left):relay(.video-play-link)",this._onPlayLinkClick.bind(this)))},_onPlayLinkClick:function(a,b){a.preventDefault(),this.tileHelper.loadVideoPlayLink(this.el,b),this._onModalOpened()},_onModalOpened:function(){this._onBlur(null)},_onModalClosed:function(){this._onFocus(null)},_setupEntitlement:function(){this.uverseData?this._checkEntitlement(this.uverseData):Uverse.page.addMemoryEvent("Personalization-uverseData",this._checkEntitlement.bind(this))},_checkEntitlement:function(a){this.uverseData=a;var b=this.el.getElements(".tile");if(b.each(function(a){var b=a.getElement(".watch-live-caption.in-home");b&&b.hide()},this),this.uversePage&&Uverse.page.isUserLoggedIn()){var c=Uverse.page.currentInHomeStatus();b.each(function(a){var b=this.tileHelper.getEntitlementStringFromElement(a);a.get("data-call-letters")&&this._isGeoRestricted(a.get("data-call-letters"),b)&&a.addClass("geo-restricted"),"live"==a.get("data-tile-class")&&a.addClass("live"),this.tileHelper.applyEntitlement(a,this.entitlementHelper),this._toggleInHomeOnly(a,c)},this)}else this.uversePage&&b.each(function(a){var b="true"===a.get("data-in-home-only");(b||"live"==a.get("data-tile-class"))&&a.addClass("live"),a.toggleClass("inhome in-home-block-login",b),this._toggleInHomeOnly(a,null)},this)},_isGeoRestricted:function(a,b){return void 0===this.uverseData.getLiveChannelMapping(a)&&!this.entitlementHelper.isPackageBasedEntitlement(b)},_toggleBlackout:function(a){var b=null!==a.getElement(".watch-live-caption.blackout");Uverse.page.isUserLoggedIn()&&a.toggleClass("blackout",b)},_toggleInHomeOnly:function(a,b){var c="true"===a.get("data-in-home-only");if(c){var d=b===Uverse.Enums.InHomeStatus.IN_HOME;a.hasClass("geo-restricted")||(a.toggleClass("in-home-java-update",b===Uverse.Enums.InHomeStatus.JAVA_OUT_OF_DATE),a.toggleClass("inhome",b===Uverse.Enums.InHomeStatus.APPLET_NOT_INSTALLED),a.toggleClass("in-home-block",b===Uverse.Enums.InHomeStatus.OUT_OF_HOME)),a.toggleClass("live-offair",!d),a.getElements(".watch-live-caption").each(function(a){a.hide()});var e=d?".watch-live":".in-home";a.getElement(".watch-live-caption"+e).show()}},_updateAdvancedSearchOptions:function(){Uverse.page.addMemoryEvent("search-onAdvancedOptionsSaved",this._updateAdvancedSearchFormInputs.bind(this)),this._updateAdvancedSearchFormInputs(Uverse.config.search.advancedSearch.currentDataValues)},_updateAdvancedSearchFormInputs:function(a){a&&(this.el.getElement(".searchEpisodeAndClipDescriptions").set("value",a[Uverse.config.search.advancedSearch.modelNames.DESCRIPTIONS]),this.el.getElement(".searchHdOnly").set("value",a[Uverse.config.search.advancedSearch.modelNames.HDONLY]),this.el.getElement(".searchFreeOnly").set("value",a[Uverse.config.search.advancedSearch.modelNames.FREEONLY]),this.el.getElement(".searchEspanolOnly").set("value",a[Uverse.config.search.advancedSearch.modelNames.ESPANOLONLY]))}}),Uverse.widgets.Recorder=new Class({Implements:[Callbacks],callbacks:{showLoading:null,hideLoading:null,showMessage:null},recordingTemplateElementID:"recordingOptionsTemplate",epgInfo:{},type:null,recordRequest:null,recordingForms:{record:null,setToRecord:null},currentState:null,initialize:function(a,b){this.type=a,this.setCallbacks(b)},getUI:function(a,b){this.epgInfo=b,this.currentState=a;var c=this._getClassNamesFromState(a),d=this._getRecordingTemplate(c);return this._updateTemplateViaType(c,d),this._updateTemplateData(d,this.epgInfo),this.recordingForms.record=d.getElement("div.record"),this.recordingForms.setToRecord=d.getElement("div.setToRecord"),this._addRecordEventsToTemplate(d),d},getErrorStateUI:function(){return this._getRecordingTemplate(["genericError"])},_getClassNamesFromState:function(a){switch(a){case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SINGLE:case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES:case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES_WITH_RERUNS:return["setToRecord"];case Uverse.Enums.DvrItemStates.RECORDED.SINGLE:case Uverse.Enums.DvrItemStates.RECORDED.SERIES:return["recorded"];case Uverse.Enums.DvrItemStates.CAN_BE_RECORDED:return["record","setToRecord"];case Uverse.Enums.DvrItemStates.CANNOT_BE_RECORDED:return["cannotBeRecorded"];case Uverse.Enums.DvrItemStates.CANNOT_BE_RECORDED_LOCAL:return["cannotBeRecorded-local"]}},_getRecordingTemplate:function(a){var b=$(this.recordingTemplateElementID),c=[];return a.each(function(a){switch(a){case"recorded":c.push(b.getElement(".recorded").clone());break;case"setToRecord":c.push(b.getElement(".setToRecord").clone());break;case"record":var d=b.getElement(".record").clone();c.push(d);break;case"cannotBeRecorded":c.push(b.getElement(".cannotBeRecorded").clone());break;case"cannotBeRecorded-local":c.push(b.getElement(".cannotBeRecorded-local").clone());break;case"genericError":c.push(b.getElement(".genericError").clone())}},this),b=new Element("div"),c.each(function(a,c){0===c?a.removeClass("hidden"):a.addClass("hidden"),b.adopt(a)}),b},_updateTemplateViaType:function(a,b){a.each(function(a){var c=$(this.recordingTemplateElementID).getElement(".labels").getElement("."+a).getElement("."+this.type).clone(),d=b.getElement("."+a);this._addSectionToTemplateOrRemove(d,c,"description"),this._addSectionToTemplateOrRemove(d,c,"options"),this._addSectionToTemplateOrRemove(d,c,"time"),this._addSectionToTemplateOrRemove(d,c,"channel")},this)},_addSectionToTemplateOrRemove:function(a,b,c){var d=null,e=null,f=b.getElement("."+c);f?(d=f.get("html"),e=a.getElement("."+c)):a.getElement("."+c)&&a.getElement("."+c).destroy(),d&&e&&e.set("html",d)},_updateTemplateData:function(a){if(a)switch(this.epgInfo.airDate&&this._addDataSectionToTemplate(a,".time",this.epgInfo.airDate.friendlyFormat),this._addDataSectionToTemplate(a,".channel .number",this.epgInfo.channel.number),this._addDataSectionToTemplate(a,".channel .name",this.epgInfo.channel.name),this.currentState){case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES_WITH_RERUNS:break;default:this._hideReruns(a)}},_addDataSectionToTemplate:function(a,b,c){var d=a.getElements(b);d.set("text",c)},_hideReruns:function(a){var b=a.getElements(".description .reruns");b.length>0&&b.hide()},_addRecordEventsToTemplate:function(a){var b=a.getElement("form");if(b){var c={submit:this._onRecordSubmit.bind(this)};this.formWidget=new Uverse.controls.Form(b,c)}},_onRecordSubmit:function(a,b){this.callbacks.showLoading();var c={includeHD:this.epgInfo.isHD,includeReruns:b.includeReruns,type:this.type},d={recordSuccess:this._onRecordSuccess.bind(this),recordFailure:this._onRecordFailure.bind(this)};Uverse.page.dvr.recordProgramForTile(this.epgInfo,c,d)},_isRerunsSelected:function(){var a=this.formWidget.getValues();return a.includeReruns},_onRecordSuccess:function(a){this.currentState=a,this._showOrHideRerunsText(),this.recordingForms.record.addClass("hidden"),this.recordingForms.setToRecord.removeClass("hidden"),Browser.ie8&&this.recordingForms.setToRecord.getSize(),this.callbacks.hideLoading()},_showOrHideRerunsText:function(){var a=this.recordingForms.setToRecord.getElement(".description .reruns");a&&(this._isRerunsSelected()?a.show("inline"):a.hide())},_onRecordFailure:function(a){this.callbacks.showMessage(Uverse.config.messages.error.generic),this.callbacks.hideLoading()}}),Uverse.widgets.ScrollingArrows=new Class({Implements:[Options],el:null,options:{duration:1e3,margin:52,innerArrows:!0,loadingObject:null,animateArrowMovement:!0},initialize:function(a,b){this.container=a,this.setOptions(b),this.arrows=a.getElements(".arrow"),this.header=$("masthead"),this.footer=$("mastfooter"),this.options.loadingObject?this.options.loadingObject.addEvent("load",this._setupArrowsMargins.bind(this)):this._setupArrowsMargins(),window.addEvents({scroll:this._scrollCheck.bind(this),load:this._scrollCheck.bind(this),resize:this._setupArrowsMargins.bind(this)})},_setupArrowsMargins:function(){var a;a=this.options.innerArrows?this.container.getCoordinates().width>window.getCoordinates().width?0:window.getCoordinates().width-this.container.getCoordinates().width-this.container.getCoordinates().left:window.getCoordinates().width-this.container.getCoordinates().width-this.container.getCoordinates().left-this.options.margin,this.arrows[0].setStyle("left",a),this.arrows[1].setStyle("right",a),this.arrows.each(function(a){a.hasChildNodes()&&a.removeClass("hidden")}),this._scrollCheck()},_scrollCheck:function(){var a=0;a=this._containerIsTooSmall()?this._setArrowsAtMiddleOnSmallContainer():this._isAtTopOfContainer()?this._setArrowsAtTopOfContainer():this._isAtBottomOfContainer()?this._setArrowsAtBottomOfContainer():this._setArrowsAtMiddleOfContainer(),this._moveArrows(a)},_containerIsTooSmall:function(){return this.footer.getCoordinates().top>=this.container.getCoordinates().bottom-window.getScrollTop()&&this.header.getCoordinates().bottom+window.getScrollTop()<=this.container.getCoordinates().top},_isAtTopOfContainer:function(){return window.getScrollTop()+this.header.getCoordinates().height<=this.container.getCoordinates().top},_isAtBottomOfContainer:function(){return this.footer.getCoordinates().top>this.container.getCoordinates().height+this.container.getCoordinates().top-window.getScrollTop()},_setArrowsAtTopOfContainer:function(){return this.container.getCoordinates().top+(this.footer.getCoordinates().top-this.container.getCoordinates().top-window.getScrollTop())/2},_setArrowsAtMiddleOfContainer:function(){return this.header.getCoordinates().height+(this.footer.getCoordinates().top-this.header.getCoordinates().bottom)/2},_setArrowsAtBottomOfContainer:function(){return this.header.getCoordinates().height+(this.container.getCoordinates().bottom-this.header.getCoordinates().bottom-window.getScrollTop())/2},_setArrowsAtMiddleOnSmallContainer:function(){return this.container.getCoordinates().top+this.container.getCoordinates().height/2-window.getScrollTop()},_setArrowsAtTopEdgeOfContainer:function(){return this.container.getCoordinates().top-window.getScrollTop()+this.arrows[0].getCoordinates().height/2},_setArrowsAtBottomEdgeOfContainer:function(){return this.container.getCoordinates().bottom-window.getScrollTop()-this.arrows[0].getCoordinates().height/2},_isOutOfContainerBounds:function(a,b){var c={};return c.top=this._isAtTopOfContainer()&&this.footer.getCoordinates().top-(this.container.getCoordinates().top-window.getScrollTop())<=this.arrows[0].getCoordinates().height,c.bottom=this._isAtBottomOfContainer()&&this.container.getCoordinates().bottom-window.getScrollTop()-this.header.getCoordinates().bottom<=this.arrows[0].getCoordinates().height,b?c[b]:c.top||c.bottom},_moveArrows:function(a){this._isOutOfContainerBounds(a,"top")?a=this._setArrowsAtTopEdgeOfContainer():this._isOutOfContainerBounds(a,"bottom")&&(a=this._setArrowsAtBottomEdgeOfContainer()),this.options.animateArrowMovement?(this.arrows.set("tween",{duration:this.options.duration}),this.arrows.tween("top",a)):this.arrows.setStyle("top",a)}}),Uverse.widgets.AdvancedSearchOptions=new Class({el:null,viewModel:null,modal:null,advancedSearchOptions:null,initialize:function(a,b){this.modal=a,this.el=b,this._setupViewModel_Observables(),a.applyBindings(this.viewModel,this.el),this._populateModal()},_setupViewModel_Observables:function(){this.viewModel={episodeAndClipDescriptions:ko.observable(!1),hdOnly:ko.observable(!1),freeOnly:ko.observable(!1),espanolOnly:ko.observable(!1),saveButtonClicked:this._saveButtonClicked.bind(this),checkWhichIsChecked:this._checkWichOptionIsSelected.bind(this)}},_populateModal:function(a){this.modal.stopLoading(),this._updateUIWithOptionsData(Uverse.config.search.advancedSearch.currentDataValues)},_updateUIWithOptionsData:function(a){this.viewModel.episodeAndClipDescriptions(!!a[Uverse.config.search.advancedSearch.modelNames.DESCRIPTIONS]),this.viewModel.hdOnly(!!a[Uverse.config.search.advancedSearch.modelNames.HDONLY]),this.viewModel.freeOnly(!!a[Uverse.config.search.advancedSearch.modelNames.FREEONLY]),this.viewModel.espanolOnly(!!a[Uverse.config.search.advancedSearch.modelNames.ESPANOLONLY])},_saveButtonClicked:function(){this._saveSelectedOptions(),this.modal.startLoading()},_saveSelectedOptions:function(){var a={};a[Uverse.config.search.advancedSearch.modelNames.DESCRIPTIONS]=this.viewModel.episodeAndClipDescriptions(),a[Uverse.config.search.advancedSearch.modelNames.HDONLY]=this.viewModel.hdOnly(),a[Uverse.config.search.advancedSearch.modelNames.FREEONLY]=this.viewModel.freeOnly(),a[Uverse.config.search.advancedSearch.modelNames.ESPANOLONLY]=this.viewModel.espanolOnly(),Uverse.config.search.advancedSearch.currentDataValues=a,this._onAdvancedSearchOptionsSaveComplete(a)},_onAdvancedSearchOptionsSaveComplete:function(a){this.modal._closeModal(),Uverse.page.onSearchAdvancedOptionsSaved(a)},_checkWichOptionIsSelected:function(){var a="";return this.viewModel.episodeAndClipDescriptions()&&(a+="episodeAndClipDescriptions "),this.viewModel.hdOnly()&&(a+="hdOnly "),this.viewModel.freeOnly()&&(a+="freeOnly "),this.viewModel.espanolOnly()&&(a+="espanolOnly "),a}}),Uverse.widgets.SecondaryNavigation=new Class({Implements:[Options],options:{addHoveredClass:!0,flyoutsContainerId:null},el:null,fx:{cssSelector:"transition-main-nav-menu-shown"},initialize:function(a,b){this.el=a,this.setOptions(b),this._addDropdownEvents(),this._setupFlyouts()},_setupFlyouts:function(){var a=this.el.getElements(".require-authentication"),b=$(this.options.flyoutsContainerId);this.flyouts=new Uverse.widgets.SecondaryNavigationAuthenticatedFlyouts(a,b)},_addDropdownEvents:function(){this.el.getElements(".main-nav-item").addEvents({mouseenter:this._onItemHoverEnter.bind(this),mouseleave:this._onItemHoverExit.bind(this)})},_onItemHoverEnter:function(a){var b=$(a.target).getClosest(".main-nav-item");this.options.addHoveredClass&&b.addClass("hovered");var c=b.getElement(".main-nav-menu");c&&c.addClassWithTransition(this.fx.cssSelector)},_onItemHoverExit:function(a){var b=$(a.target).getClosest(".main-nav-item");this.options.addHoveredClass&&b.removeClass("hovered");var c=b.getElement(".main-nav-menu");c&&c.removeClassWithTransition(this.fx.cssSelector)}}),Uverse.widgets.SecondaryNavigationAuthenticatedFlyouts=new Class({authenticatedLinks:null,flyoutContentContainer:null,authenticatedElList:{},initialize:function(a,b){this.authenticatedLinks=a,this.flyoutContentContainer=b,Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalizationUverseData.bind(this))},_onPersonalizationUverseData:function(a){a.hasDvr()||this._addAuthenticationEvents()},_addAuthenticationEvents:function(){this.authenticatedLinks.each(function(a){var b=a.get("data-authenticated-index"),c=new Uverse.widgets.Flyout(this.flyoutContentContainer.getElement(".flyout.authenticated-flyout-"+b),{relativeTo:a,parentEdge:{x:"left",y:"bottom"},flyoutEdge:{x:"left",y:"top"}},{});Uverse.page.isUserLoggedIn()?a.getElements(".requires-not-logged-in").each(function(a){a.addClass("hidden")}):a.getElements(".requires-logged-in").each(function(a){a.addClass("hidden")}),a.addEvent("click",this._onLinkClicked.bind(this,c))},this)},_onLinkClicked:function(a,b){b.preventDefault(),a.show()}}),Uverse.widgets.SplashScreen=new Class({Implements:[Options],Binds:["_onModalClosed"],cookieNames:{hiddenSplashScreens:"hiddenSplashScreens"},options:{splashScreenUniqueId:null,modalOptions:{debugName:"Splash Screen",className:"modal-splash-screen",closeOnBackgroundClick:!0,closeOnForegroundClick:!1,closeOnEscape:!0}},hiddenSplashScreens:[],splashScreenKey:null,splashScreenContents:null,initialize:function(a,b){this.splashScreenContents=$(a).dispose(),this.setOptions(b),this.splashScreenKey=this.options.splashScreenUniqueId,this._getHiddenSplashScreens(),this._checkForSplashScreen()},_getHiddenSplashScreens:function(){var a=Cookie.read(this.cookieNames.hiddenSplashScreens);a&&(this.hiddenSplashScreens=a.split(","))},_checkForSplashScreen:function(){if(this.hiddenSplashScreens.contains(this.splashScreenKey)){Uverse.console.log("[SplashScreen]","Splash Screen has already been shown:",this.splashScreenKey);var a=!1;Uverse.page.splashScreenIsDone(a)}else Uverse.console.log("[SplashScreen]","Loading Splash Screen:",this.splashScreenKey),this._displaySplashScreen()},_displaySplashScreen:function(){var a=this.options.modalOptions,b={modalClosed:this._onModalClosed},c=new Uverse.widgets.Modal(this.splashScreenContents,a,b);Uverse.page.loadPlayerModal(c),this.splashScreenContents.removeClass("hidden")},_onModalClosed:function(){this._hideSplashScreenForever(),this.splashScreenContents.destroy();var a=!0;Uverse.page.splashScreenIsDone(a)},_hideSplashScreenForever:function(){Uverse.console.log("[SplashScreen]","Hiding Splash Screen:",this.splashScreenKey);var a=3650;this.hiddenSplashScreens.push(this.splashScreenKey);var b=this.cookieNames.hiddenSplashScreens,c=this.hiddenSplashScreens.join(","),d={duration:a};Cookie.write(b,c,d)}}),Uverse.widgets.TVNotes=new Class({Binds:["_handleScheduleSuccess","_handleScheduleFailure"],viewModel:null,request:null,initialScheduleTime:null,pageBlocker:null,pageBlockerMinDuration:800,initialize:function(a,b){this.el=b,this._setupInitialScheduleTime(),this._setupRequest(),this._setupViewModel(),this.pageBlocker=new Uverse.widgets.PageBlocker({minDisplayDuration:this.pageBlockerMinDuration}),a.applyBindings(this.viewModel,this.el)},_setupInitialScheduleTime:function(){var a=new Date;return this.initialScheduleTime={day:a.format("%A"),ampm:a.get("hours")>=12?"PM":"AM",hour:+a.format("%l")+1}},_setupRequest:function(){this.request=new Request({url:"/notes/scheduled.json",method:"POST",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._handleScheduleSuccess,onFailure:this._handleScheduleFailure})},_setupViewModel:function(){function a(a){Array.each(d.blocks,function(b){d[b](!1),d[a](!0)})}var b=this.initialScheduleTime,c=this._hideWelcomeScreen(),d={blocks:["create","schedule"],daysCheckboxes:[{label:"Su",value:"Sunday",sum:1},{label:"M",value:"Monday",sum:10},{label:"Tu",value:"Tuesday",sum:10},{label:"W",value:"Wednesday",sum:10},{label:"Th",value:"Thursday",sum:10},{label:"F",value:"Friday",sum:10},{label:"Sa",value:"Saturday",sum:1}],timeHourOpts:{open:ko.observable(!1),values:["1","2","3","4","5","6","7","8","9","10","11","12"]},timeMinuteOpts:{open:ko.observable(!1),values:["00","15","30","45"]},timeAMPMOpts:{open:ko.observable(!1),values:["AM","PM"]},maxCharacters:140,remainingChars:ko.observable(140),noteText:ko.observable(""),create:ko.observable(!0),schedule:ko.observable(!1),blocktv:ko.observable(!1),scheduleNote:ko.observable(!1),isWeeklyOccurrence:ko.observable(!1),deliveryTime:ko.observable("now"),timeHour:ko.observable(b.hour),timeMinute:ko.observable("00"),timeAMPM:ko.observable(b.ampm),welcomeDisabled:ko.observable(!0),hideWelcome:ko.observable(c),toastMessages:ko.observable()};Array.each(d.daysCheckboxes,function(a){a.checked=ko.observable(a.value===b.day)}),d.toggleCheck=function(a){a.checked(!a.checked())},d.checkedDays=ko.computed(function(){return Array.filter(d.daysCheckboxes,function(a){return a.checked()})}),d.scheduledText=ko.computed(function(){return"now"==d.deliveryTime()||0===d.checkedDays().length?"Now":this.getFormattedTime()},this),d.toggleCreate=a.bind(this,"create"),d.toggleSchedule=a.bind(this,"schedule"),d.sendButtonDisabled=ko.computed(function(){return!d.noteText()||"now"!==d.deliveryTime()&&d.checkedDays().length<1}),d.outputDays=ko.computed(function(){return d.checkedDays().map(function(a){return a.value.slice(0,3).toUpperCase()}).join(",")}),d.sendNote=function(){d.sendButtonDisabled()||(this._showPageBlocker(),this.request.send({data:this._serializeModel()}))}.bind(this),d.dismissWelcomeScreen=function(){d.hideWelcome(!0),this._hideWelcomeScreen(d.welcomeDisabled())}.bind(this),this.viewModel=d},getFormattedTime:function(){var a=this.viewModel,b=a.timeHour()+":"+a.timeMinute()+" "+a.timeAMPM(),c=this._getPeriodInfo(),d=c.periodText,e="";return e=a.isWeeklyOccurrence()?"Every "+d+" at "+b:c.isSpecial?"Each "+d+" for the next week at "+b:1===a.checkedDays().length?d+" at "+b:"At "+b+" on "+d},getDaysStr:function(a){return Array.map(a,function(a){return a.value.slice(0,3)}).join(", ")},_addTimes:function(){return Array.reduce([].slice.call(arguments),function(a,b){return a+b.sum},0)},_serializeModel:function(){var a=this.viewModel;return Object.toQueryStringFlat({body:a.noteText(),time:this._getOutputTime(),repeat:a.isWeeklyOccurrence(),dayOfWeek:this._getOutputDays(),block:a.blocktv(),isScheduled:"now"!==a.deliveryTime()})},_getPeriodInfo:function(){var a=this.viewModel,b=a.checkedDays(),c=this._addTimes.apply(this,b),d="",e=2===c,f=50===c,g=52===c,h=e||f||g;return d=e?"weekend day":f?"weekday":g?"day":1===b.length?a.isWeeklyOccurrence()?b[0].value:"Today":this.getDaysStr(b),{periodText:d,isSpecial:h}},_getOutputDays:function(){var a=this.viewModel;return"now"!==a.deliveryTime()?a.outputDays():(new Date).format("%a").toUpperCase()},_getOutputTime:function(){var a=this.viewModel,b=new Date,c=b.format("%z"),d="now"===a.deliveryTime()?b.format("%M"):a.timeMinute(),e="now"===a.deliveryTime()?+b.format("%l"):a.timeHour(),f=a.timeAMPM();return 12===e&&"AM"===f?e="00":12!==e&&"PM"===f?e=+e+12:10>e&&(e="0"+e),e+":"+d+":00.000-00:00"},_showPageBlocker:function(){this.pageBlocker.show(this.viewModel.pageBlockerMessage)},_hidePageBlocker:function(){this.pageBlocker.hide()},_handleScheduleSuccess:function(a){var b=this.viewModel.toastMessages().SUCCESS;this._hidePageBlocker(),this._showToast(b),this._resetViewModel(),Uverse.console.log("[TV Notes]","Schedule request was SUCCESSFUL with response: ",JSON.parse(a))},_handleScheduleFailure:function(a){var b=this.viewModel,c="now"===b.deliveryTime()?b.toastMessages().ERROR_NOW:b.toastMessages().ERROR_LATER;
this._hidePageBlocker(),this._showToast(c),Uverse.console.error("[TV Notes]","Schedule request FAILED with response: ",JSON.parse(a.responseText))},_showToast:function(a){Uverse.page.showToast({alert:a})},_resetViewModel:function(){var a=this.viewModel,b=this._setupInitialScheduleTime();a.noteText(""),a.create(!0),a.schedule(!1),a.blocktv(!1),a.scheduleNote(!1),a.isWeeklyOccurrence(!1),a.deliveryTime("now"),a.timeHour(b.hour),a.timeMinute("00"),a.timeAMPM(b.ampm),Array.each(a.daysCheckboxes,function(a){a.checked(a.value===b.day)})},_hideWelcomeScreen:function(a){var b="hide-tvnotes-welcome";return null!=a?(Cookie.write(b,a),a):"true"===Cookie.read(b)}}),Uverse.widgets.TabletAppIntegration=new Class({modal:null,initialize:function(a,b){this._showAppIntegrationModal(),ko.applyBindings(new this.appLaunchButton(this),this.modal.modalManager.modalContents)},appLaunchButton:function(a){this.onClick=function(){a.appLaunchAction()}},appLaunchAction:function(){setTimeout(function(){window.location=Uverse.config.uverseMobileApps.iOS.itunesURL},25),window.location=Uverse.config.uverseMobileApps.iOS.customURIProtocol},_showAppIntegrationModal:function(){this.modal=Uverse.page.createAndLoadGenericModal(Uverse.page.templates.tabletAppIntegrationModal,{useLoading:!1})}}),Uverse.widgets.Tile=new Class({Implements:[Options],el:null,imageOverlay:null,drawer:null,drawerIcons:{},currentDrawerItem:null,pendingOperationsCancelFunctions:null,entitlementMessageBase:null,tileHelper:new Uverse.utils.TileHelper,entitlementHelper:new Uverse.utils.Entitlement,ENTITLEMENT_DATA_ATTR_NAME_UPGRADE_MESSAGE:"data-entitlement-message-upgrade",CLICK_TRACKING_ICON_STATES:{OPEN:"Open",CLOSE:"Close"},initialize:function(a,b,c){this.el=a,this.imageOverlay=this.el.getElement(".image-overlay"),this.pendingOperationsCancelFunctions=$H(),this.setOptions(b),this.tileEvents=c,Uverse.page.isUserLoggedIn()&&this.setupEntitlement()},setupEntitlement:function(){var a=this.el;this.tileHelper.applyEntitlement(a,this.entitlementHelper),this.entitlementMessageBase=a.get(this.ENTITLEMENT_DATA_ATTR_NAME_UPGRADE_MESSAGE)},setupDrawer:function(){var a={closeDrawer:this._closeCurrentDrawer.bind(this)},b=this.el.getElement(".drawer");this.drawer=new Uverse.widgets.Tile.Drawer(b,a)},onDrawerIconClick:function(a,b){var c=b.get("data-icon-class").trim();if(this.drawerIcons[c]){var d=this.drawerIcons[c].icon;d.onClick.call(d,a)}},setupRecording:function(){var a=this.el.getElement(".dvr:not(.hidden)");if(a){var b=new Uverse.widgets.Tile.Drawer.RecordingItem(a,{normalizedProgramTitle:this.el.get("data-program-title"),normalizedEpisodeTitle:this.el.get("data-episode-title"),isCategory:"Category"===this.getTileType()?!0:!1,type:this.el.get("data-content-type")},{onIconClicked:this._onIconClicked.bind(this,{requires:{login:!0,uverse:!0,entitlement:!0}}),onShowLoading:this.drawer.showLoading.bind(this.drawer),onHideLoading:this.drawer.hideLoading.bind(this.drawer),onShowMessage:this.drawer.showMessage.bind(this.drawer)});this.pendingOperationsCancelFunctions.recording=b.cancelOperations.bind(b),this.drawerIcons.dvr=b}},setupFavorite:function(){var a=this.el.getElement(".favorite:not(.hidden)");a&&(this.drawerIcons.favorite=new Uverse.widgets.Tile.Drawer.FavoriteItem(a,{favoriteID:this.el.get("data-favorite-id"),favoriteType:this.getTileType()},{onIconClicked:this._onIconClicked.bind(this,{requires:{login:!0,uverse:!1,entitlement:!1}}),onShowLoading:this.drawer.showLoading.bind(this.drawer),onHideLoading:this.drawer.hideLoading.bind(this.drawer),showGenericOverlay:this._showGenericOverlayForFavorites.bind(this),hideGenericOverlay:this._hideGenericOverlayForFavorites.bind(this)}))},_showGenericOverlayForFavorites:function(a,b){b=b||{};var c=this.el;this.tileEvents.fireEvent("FavoriteRemovePrompt",[c,b]),this.drawer.showGenericOverlay(a,b)},_hideGenericOverlayForFavorites:function(a){var b=this.el;this.tileEvents.fireEvent("FavoriteRemoveSubmit",[b,a]),this.drawer.hideGenericOverlay()},setupNotification:function(){var a=this.el.getElement(".notify:not(.hidden)");a&&(this.drawerIcons.notify=new Uverse.widgets.Tile.Drawer.NotificationItem(a,{categoryPath:this.el.get("data-category-path")},{onIconClicked:this._onIconClicked.bind(this,{requires:{login:!0,uverse:!1,entitlement:!1}}),onShowLoading:this.drawer.showLoading.bind(this.drawer),onHideLoading:this.drawer.hideLoading.bind(this.drawer),onShowMessage:this.drawer.showMessage.bind(this.drawer)}))},setupInformation:function(){var a=this.el.getElement(".info:not(.hidden)");a&&(this.drawerIcons.info=new Uverse.widgets.Tile.Drawer.InformationItem(a,{categoryPath:this.el.get("data-category-path"),information:this.el.get("data-information")},{onIconClicked:this._onIconClicked.bind(this,{requires:{login:!1,uverse:!1,entitlement:!1}}),onShowLoading:this.drawer.showLoading.bind(this.drawer),onHideLoading:this.drawer.hideLoading.bind(this.drawer),onShowMessage:this.drawer.showMessage.bind(this.drawer)}))},getTileType:function(){return Uverse.console.error("[Tile]","getTileType has not been overridden for this tile."),null},_closeCurrentDrawer:function(){Uverse.console.log("[Tile]","Closing the drawer"),this.currentDrawerItem.updateClickTrackingLabel(this.CLICK_TRACKING_ICON_STATES.CLOSE),this.currentDrawerItem.setSelected(!1),this.drawer.hideDrawer(this.currentDrawerItem.name),this.drawer.hideLoading(),this.drawer.hideGenericOverlay(),this.drawer.hideMessage();var a=this.el;this.tileEvents.fireEvent("DrawerClose",[a])},_onIconClicked:function(a,b,c,d){this.drawer.isOpen()||null===a?c==this.currentDrawerItem?this._closeCurrentDrawer():(Uverse.console.log("[Tile]","Swapping the drawer"),this.currentDrawerItem.updateClickTrackingLabel(this.CLICK_TRACKING_ICON_STATES.CLOSE),this.currentDrawerItem.setSelected(!1),this.currentDrawerItem=c,this.currentDrawerItem.setSelected(!0),this.currentDrawerItem.updateClickTrackingLabel(this.CLICK_TRACKING_ICON_STATES.OPEN),this._openDrawerWithContent(a,b,this.currentDrawerItem)):d?Uverse.console.log("[Tile]","Drawer staying closed due to OneClick"):(Uverse.console.log("[Tile]","Opening the drawer"),this.currentDrawerItem&&this.currentDrawerItem.setSelected(!1),this.currentDrawerItem=c,this.currentDrawerItem.setSelected(!0),this.currentDrawerItem.updateClickTrackingLabel(this.CLICK_TRACKING_ICON_STATES.OPEN),this._openDrawerWithContent(a,b,this.currentDrawerItem))},_openDrawerWithContent:function(a,b,c){this._cancelPendingOperations(c.name),a.requires.login&&!Uverse.page.isUserLoggedIn()?this.drawer.showDrawer(this._getHeaderElement(c.name,"signIn"),this.entitlementHelper.promptUserForLogin(c.name)):a.requires.uverse&&!Uverse.page.isUverseUser()?this.drawer.showDrawer(this._getHeaderElement(c.name,"signIn"),this.entitlementHelper.promptUserForOrder(c.name,this.entitlementMessageBase)):a.requires.entitlement&&this.tileHelper.getEntitlementStateViaClassName(this.el,Uverse.Enums.Entitlement.NEED_UPGRADE)?this.drawer.showDrawer(this._getHeaderElement(c.name,"signIn"),this.entitlementHelper.promptUserForUpgrade(c.name,this.entitlementMessageBase)):b(this._getHeaderElement(c.name),this.drawer.showDrawer.bind(this.drawer))},_cancelPendingOperations:function(a){this.pendingOperationsCancelFunctions.each(function(b,c){c!==a&&b()})},_getHeaderElement:function(a,b){var c=$("tileDrawerHeadersTemplate").getElement(".drawer-header").clone();return c.addClass(Uverse.config.drawer.headers[b||a].classname),c.appendText(Uverse.config.drawer.headers[a].text,"top"),c},hideImageOverlay:function(){this.imageOverlay.addClass("hidden")},showImageOverlay:function(){this.imageOverlay.removeClass("hidden")}}),Uverse.widgets.Tile.Interval=new Class({Extends:Uverse.widgets.Tile,Implements:[Timers],options:{interval:5e3,enableRotation:!0,itemFx:{property:"opacity",duration:1e3,transition:Fx.Transitions.Quad.easeOut,link:"cancel"},additionalImages:null},el:null,itemEls:null,paginationEls:null,tileName:"Interval",currentItemIndex:0,lastItemIndex:null,playing:!1,tracked:null,initialize:function(a,b,c){if(!(this.itemEls&&this.itemEls.length>0&&this.paginationEls&&this.paginationEls.length>0))return Uverse.console.log("[Tile]","["+this.tileName+" Tile]","ItemEls or PaginationEls are empty."),!1;this.parent(a,b,c),this.el.addEvent("mousemove",this._stop.bind(this)).addEvent("mouseleave",this._start.bind(this)),this.tracked=new Hash,this.itemTweens=[];for(var d=0,e=this.itemEls.length;e>d;d++)this.itemTweens[d]=new Fx.Tween(this.itemEls[d],this.options.itemFx);this._setupImagesLoader()},setupItems:function(a,b){this.itemEls=a.getElements(b),this.itemEls.each(function(a,b){a.setStyles(0===b?{"z-index":2,visibility:"visible"}:{"z-index":1,visibility:"hidden"})},this),a.addEvent("click:relay(.event)",this._trackClickThrough.bind(this))},setupPagination:function(a,b){this.paginationEls=a.getElements(b),this.paginationEls.each(function(a,b){a.store("itemIndex",b)}),a.addEvent("click:relay("+b+")",this._onClickNavigationItem.bind(this))},setupEntitlement:function(){this.itemEls.each(function(a){this.tileHelper.applyEntitlement(a,this.entitlementHelper),this.entitlementMessageBase=a.get(this.ENTITLEMENT_DATA_ATTR_NAME_UPGRADE_MESSAGE)},this)},_setupImagesLoader:function(){var a=this.itemEls.map(function(a){return a.getElement("img").get("src")});this.imagesLoader=new Uverse.utils.ImagesLoader,this.options.additionalImages?a.each(function(a,b){this.imagesLoader.loadImages(a,this.options.additionalImages[b])},this):a.each(function(a){this.imagesLoader.loadImages(a)},this),this._start(),this._trackImpression()},_onClickNavigationItem:function(a){var b=$(a.target),c=b.retrieve("itemIndex");this._change(c)},_start:function(){if(!this.playing){if(!this.imagesLoader.hasLoaded(this.currentItemIndex))return Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Current Images not yet loaded ... delaying ..."),void this.setTimer(this._start,{timeout:1e3});Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Started Playing"),this.setTimer(this._next,{timeout:this.options.interval}),this.playing=!0}},_stop:function(){this.playing&&(Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Stopped Playing"),this.clearTimers(),this.playing=!1)},_next:function(){var a=this.currentItemIndex+1;return a>=this.itemEls.length&&(a=0),this.imagesLoader.hasLoaded(a)?(this._change(a),void this.setTimer(this._next,{timeout:this.options.interval})):(Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Next Images not yet loaded ... delaying ..."),void this.setTimer(this._next,{timeout:1e3}))},_change:function(a){if(this.currentItemIndex!=a){if(null==a)throw"Invalid item index specified";var b=this.currentItemIndex;null!=this.lastItemIndex&&(this.itemTweens[this.lastItemIndex].cancel(),this.itemTweens[this.lastItemIndex].set(0),this.itemEls[this.lastItemIndex].setStyles({"z-index":1,visibility:"hidden"})),this.itemEls[b].setStyle("z-index",2),this.itemEls[a].setStyle("z-index",1),this.itemEls[b].removeClass("active"),this.paginationEls[b].removeClass("active"),this.paginationEls[a].addClass("active"),this.itemEls[a].setStyle("visibility","visible"),this.itemTweens[a].set(1),this.itemTweens[b].start(1,0).chain(function(){this.itemEls[b].setStyle("z-index",0)}.bind(this)),this.lastItemIndex=b,this.currentItemIndex=a,this.tileEvents.fireEvent("intervalTileChange",[a]),this._trackImpression()}},_trackImpression:function(){var a="impression_"+this.currentItemIndex;if(!this.tracked.has(a)){var b=this.itemEls[this.currentItemIndex],c=b.get("data-eventtrack-category"),d=b.get("data-eventtrack-action"),e=b.get("data-eventtrack-label");c&&d&&e&&(Uverse.page.googleAnalyticsPush("_trackEvent",[c,d+" Impression",e]),Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Tracked Impression")),this.tracked.set(a,c+" | "+d+" | "+e)}},_trackClickThrough:function(a){var b="click"+this.currentItemIndex;if(!this.tracked.has(b)){var c=a.target,d=c.getParent(".eventTrack");if(d){var e=d.get("data-eventtrack-category"),f=d.get("data-eventtrack-action"),g=d.get("data-eventtrack-label");e&&f&&g&&(Uverse.page.googleAnalyticsPush("_trackEvent",[e,f+" Click-Through",g]),Uverse.console.log("[Tile]","["+this.tileName+" Tile]","Tracked Clicktrough"))}}}}),Uverse.widgets.Tile.Category=new Class({Extends:Uverse.widgets.Tile,initialize:function(a,b,c){this.parent(a,b,c),this.setupDrawer(),this.setupRecording(),this.setupFavorite(),this.setupNotification()},getTileType:function(){return"Category"}}),Uverse.widgets.Tile.Video=new Class({Extends:Uverse.widgets.Tile,initialize:function(a,b,c){this.parent(a,b,c),this.setupDrawer(),this.setupRecording(),this.setupFavorite(),this.setupNotification()},getTileType:function(){return"Video"}}),Uverse.widgets.Tile.Promo=new Class({el:null,initialize:function(a){this.el=a;var b=this._getTileData();this._setupTile(b)},_getTileData:function(){var a=this.el.get("data-promo-key"),b=Uverse.loader.retrieveModelData(a),c=new Uverse.utils.Entitlement;return c.getHashValueByEntitlementKey(b)},_setupTile:function(a){var b=this.el,c=b.getElement(".promoLink"),d=b.getElement(".promoImage"),e=d.get("data-base-uri"),f="";"category"==a.item.itemType&&(f=c.get("data-category-path")),f+=a.item.path,c.set("href",f),a.item.isExternalLink&&c.set("target","_blank"),d.set("src",e+a.imagePath),d.set("target",a.target),d.set("alt",this._dataDashFriendly(a.title)),a.backgroundColor&&b.setStyle("background-color",a.backgroundColor),a.height&&b.setStyle("height",a.height),b.set("data-clicktrack-label",this._dataDashFriendly(a.title)),d.removeClass("hidden")},_dataDashFriendly:function(a){return"string"!=typeof a?"":this._htmlencode(a.replace(">","::"))},_htmlencode:function(a){return a.replace(/[&<>"']/g,function(a){return"&"+{"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#39"}[a]+";"})},getTileType:function(){return"Promo"}}),Uverse.widgets.Tile.Live=new Class({Extends:Uverse.widgets.Tile,Implements:[Timers],dataClickTrackPrefix:"",userHasHD:!1,liveMetadata:null,PROGRESS_BAR_INTERVAL:null,inHomeStatus:!0,currentState:null,STATES:{OFF_AIR:0,PLAYING:1,NO_DATA:2},metadataElements:{title:{classname:".tile-header-title",element:null},description:{classname:".description",element:null},subTitle:{classname:".tile-header-subtitle",element:null},startDate:{classname:".time-startDate",element:null},endDate:{classname:".time-endDate",element:null},watchLiveCaption:{classname:".watch-live-caption.watch-live",element:null},nextOnAirCaption:{classname:".watch-live-caption.off-air",element:null},nextOnAirCaptionTime:{classname:".watch-live-caption.off-air .time",element:null},noDataCaption:{classname:".watch-live-caption.no-data",element:null},inHome:{classname:".watch-live-caption.in-home",element:null},progressBar:{classname:".live-progress-bar-thumb",element:null}},watchLiveCaptionOriginalText:"",timeZoneInfo:null,initialize:function(a,b,c){this.parent(a,b,c),this.PROGRESS_BAR_INTERVAL=Uverse.config.liveTiles.progressBarInterval,this.currentProgressBarPercentage=0,this.incrementValue=0,this._setupElements(),this._storeDataClickTrackPrefix(),this._setupMetaDataRefresh(),this._setupSimulatedMode(),this._setupTileExpiration(),"true"===this.el.get("data-in-home-only")&&Uverse.page.subscribeInHomeStatus(this._inHomeUpdated.bind(this)),Uverse.page.addMemoryEvent("Personalization-userData",this._onPersonalizationUserData.bind(this)),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalizationUverseData.bind(this)),this.setupDrawer(),this.setupFavorite()},_inHomeUpdated:function(a){Uverse.page.isUserLoggedIn()&&this.el.toggleClass("inhome",!Uverse.page.isInHomeInstalled()),this.inHomeStatus=a,a?this._updateTileState(this.currentState):(this.el.addClass("live-offair"),this.metadataElements.watchLiveCaption.element.hide(),this.metadataElements.nextOnAirCaption.element.hide(),this.metadataElements.noDataCaption.element.hide(),this.metadataElements.inHome.element.show(),this.showImageOverlay())},_onPersonalizationUserData:function(a){this.userHasHD=a.hasHD(),this._populateNextMetadataItem()},_onPersonalizationUverseData:function(a){this.timeZoneInfo=a.getTimeZoneInfo(),this._populateNextMetadataItem()},_setupElements:function(){Object.each(this.metadataElements,function(a){a.element=this.el.getElement(a.classname)},this)},_storeDataClickTrackPrefix:function(){this.dataClickTrackPrefix=this.el.getAttribute("data-clicktrack-label")},_setupMetaDataRefresh:function(){var a=this.el.getElement(".live-metadata");this.liveMetadata=JSON.decode(a.innerHTML.trim())},_setupSimulatedMode:function(){Uverse.config.liveTiles.simulated.enable&&Uverse.config.liveTiles.simulated.repopulateMethods.push(this._populateNextMetadataItem.bind(this))},_populateNextMetadataItem:function(){var a=this._getNextItemAndState();a?(this._updateTile(a),this._updateTimers(a)):(this._disableTimers(),this._resetProgressBarToZero(),this._updateTileState(this.STATES.NO_DATA))},_getNextItemAndState:function(){for(var a=this._getProgramListForStream(),b=this.STATES.PLAYING,c=this._getCurrentTime(),d=0;d<a.length;d++)if(a[d].endDate-c>0)return a[d].startDate-c>0&&(b=this.STATES.OFF_AIR),{item:a[d],state:b};return null},_getProgramListForStream:function(){var a=this.userHasHD?"hdStream":"sdStream",b=this.userHasHD?"sdStream":"hdStream";return this._getPreferenceIfAvailableOrAlternateInstead(a,b)},_getPreferenceIfAvailableOrAlternateInstead:function(a,b){return this.liveMetadata[a]?this.liveMetadata[a].guideInfo:this.liveMetadata[b].guideInfo},_updateTile:function(a){this._updateTileText(a.item),this._updateTileState(a.state,a.item)},_updateTileText:function(a){this.metadataElements.title.element.set("html",a.title),this.metadataElements.description.element.set("html",a.description).eliminate("originalElement"),this.metadataElements.startDate.element.set("text",this._getFormattedTime(a.startDate)),this.metadataElements.endDate.element.set("text",this._getFormattedTime(a.endDate)),this.el.setAttribute("data-clicktrack-label",this.dataClickTrackPrefix+a.title),this.tileHelper.ellipsifyElements(this.el,".description")},_updateTileState:function(a,b){this.currentState=a,this.inHomeStatus&&null!==a&&(a===this.STATES.PLAYING?(this.el.removeClass("live-offair"),this.metadataElements.watchLiveCaption.element.show(),this.metadataElements.nextOnAirCaption.element.hide(),this.metadataElements.noDataCaption.element.hide(),this.metadataElements.inHome.element.hide(),this.showImageOverlay(),this.metadataElements.subTitle.element.removeClass("hide")):a===this.STATES.OFF_AIR&&b?(this.el.addClass("live-offair"),this.metadataElements.nextOnAirCaptionTime.element.set("text",this._getFormattedTime(b.startDate)),this.metadataElements.watchLiveCaption.element.hide(),this.metadataElements.nextOnAirCaption.element.show(),this.metadataElements.noDataCaption.element.hide(),this.metadataElements.inHome.element.hide(),this.hideImageOverlay()):(this.el.addClass("live-offair"),this.metadataElements.watchLiveCaption.element.hide(),this.metadataElements.nextOnAirCaption.element.hide(),this.metadataElements.noDataCaption.element.show(),this.metadataElements.inHome.element.hide(),this.hideImageOverlay()))},_updateTimers:function(a){if(this._disableTimers(),this.currentProgressBarPercentage=0,this.incrementValue=0,a.state===this.STATES.PLAYING){var b=this._getProgramTotalTime(a.item.startDate,a.item.endDate);this._setInitialProgressBarState(this._getTimePastStartTime(this._getCurrentTime(),a.item.startDate),b),this.incrementValue=this._incrementValue(b),this.setTimer(this._updateProgressBar,{interval:this.PROGRESS_BAR_INTERVAL}),this.setTimer(this._populateNextMetadataItem,{timeout:this._getTimeToItemEndDate(a.item.endDate)})}else this._resetProgressBarToZero(),this.setTimer(this._populateNextMetadataItem,{timeout:this._getTimeToItemStartDate(a.item.startDate)})},_disableTimers:function(){this.clearTimers(this._updateProgressBar,this._populateNextMetadataItem)},_getProgramTotalTime:function(a,b){return b-a},_getTimePastStartTime:function(a,b){return a-b},_setInitialProgressBarState:function(a,b){this.currentProgressBarPercentage=a/b,this._updateProgressBar()},_resetProgressBarToZero:function(){this.currentProgressBarPercentage=0,this.incrementValue=0,this._updateProgressBar()},_updateProgressBar:function(){this.currentProgressBarPercentage+=this.incrementValue,this.metadataElements.progressBar.element.setStyle("width",100*this.currentProgressBarPercentage+"%")},_setupTileExpiration:function(){Uverse.page.liveTileExpire=new Uverse.utils.LiveTileExpire},_incrementValue:function(a){return this.PROGRESS_BAR_INTERVAL/a},_getTimeToItemEndDate:function(a){return a-this._getCurrentTime()},_getTimeToItemStartDate:function(a){return a-this._getCurrentTime()},_convertMSToMinutes:function(a){return a/1e3/60},_getCurrentTime:function(){if(Uverse.config.liveTiles.simulated.enable&&Uverse.config.liveTiles.simulated.date){var a=new Date(1e3*(new Date).format("%s")+Uverse.config.liveTiles.simulated.dateDiff);return a}return 1e3*(new Date).format("%s")},_getFormattedTime:function(a){return new Date(a).format("%l:%M%p",this.timeZoneInfo)},getTileType:function(){return"Live"}}),Uverse.widgets.Tile.PPV=new Class({Extends:Uverse.widgets.Tile,initialize:function(a,b,c){this.parent(a,b,c),this.setupDrawer(),this.setupInformation()},getTileType:function(){return"PPV"}}),Uverse.widgets.Tile.Minitron=new Class({Extends:Uverse.widgets.Tile.Interval,tileName:"Minitron",initialize:function(a,b,c){this.setupItems(a,".minitronItem"),this.setupPagination(a,".paginationItem"),this.parent(a,b,c)}}),Uverse.widgets.Tile.PPVMinitron=new Class({Extends:Uverse.widgets.Tile.Interval,tileName:"PPVMinitron",initialize:function(a,b,c){this.setupItems(a,".ppvMinitronItem"),this.setupPagination(a,".paginationItem"),this.parent(a,b,c)}}),Uverse.widgets.Tile.Network=new Class({Extends:Uverse.widgets.Tile.Interval,tileName:"Network",initialize:function(a,b,c){this.setupItems(a,".networkTileItem"),this.setupPagination(a,".paginationItem"),this.parent(a,b,c)}}),Uverse.widgets.Tile.Drawer=new Class({Implements:[Callbacks],callbacks:{closeDrawer:null},el:null,overlays:{loading:null,message:null,generic:null},fx:{cssSelector:"transitions-tile-drawer-open"},initialize:function(a,b){this.el=$(a),this.setCallbacks(b),this._setupOverlays(),this._setupTransitions()},_setupOverlays:function(){this.overlays.loading=new Uverse.utils.TileDrawerOverlayLoading(this.el),this.overlays.message=new Uverse.utils.TileDrawerOverlayMessage(this.el),this.overlays.generic=new Uverse.utils.TileDrawerOverlayGeneric(this.el)},_setupTransitions:function(){this.el.set("morph")},isOpen:function(){return this.el.hasClass(this.fx.cssSelector)},hideDrawer:function(a){this.el.removeClassWithTransition(this.fx.cssSelector),this.el.get("morph").chain(this._onHideTransitionComplete.bind(this))},_onHideTransitionComplete:function(){this.el.empty();var a=this.el.getParent(".tile");a&&a.removeClass("drawer-is-open")},showDrawer:function(a,b,c){a&&a.inject(b,"top"),b&&this._replaceContents(this._createEmptyContentElement().adopt(b),c),this.el.addClassWithTransition(this.fx.cssSelector);var d=this.el.getParent(".tile");d&&d.addClass("drawer-is-open")},_replaceContents:function(a,b){var c=this.el.getElement(".drawer-content");a.inject(this.el,"top"),this._transitionElements(a,c,b)},_isMarkedForTransition:function(a,b){return!a||b&&b.isAsync!==!1||Browser.ie8?!1:!0},_transitionElements:function(a,b,c){if(a===b)a.setStyles({position:null}).fade("show");else if(this._isMarkedForTransition(b,c)){var d={link:"cancel"};a.setStyles({position:null}).set("tween",d),a.fade("hide").fade("in"),b.setStyles({position:"absolute",top:0}).set("tween",d),b.fade("show").fade("out").get("tween").chain(function(){b.destroy()})}else b&&b.destroy()},_createEmptyContentElement:function(){return new Element("div",{"class":"drawer-content"})},showLoading:function(a){this._openDrawerIfClosed(),this.overlays.loading.showLoadingOverlay(a)},hideLoading:function(){this.overlays.loading.hideLoadingOverlay()},showMessage:function(a,b){this.isOpen()&&this.overlays.message.showMessageOverlay(a,b)},hideMessage:function(){this.overlays.message.hideOverlay()},showGenericOverlay:function(a,b){this.overlays.generic.showGenericOverlay(a,b)},hideGenericOverlay:function(){this.overlays.generic.hideOverlay()},_openDrawerIfClosed:function(){this.isOpen()||this.showDrawer()},onDrawerCloseClick:function(a){a.stopPropagation(),Uverse.page.clickTrack(a.target,{addAction:"Drawer Close"}),this.callbacks.closeDrawer()}}),Uverse.widgets.Tile.Drawer.BaseItem=new Class({Implements:[Options,Callbacks],icon:null,iconContainer:null,name:null,callbacks:{onIconClicked:null,onShowLoading:null,onHideLoading:null,onShowMessage:!1},initialize:function(a,b,c){this.iconContainer=a,this.setOptions(b),this.setCallbacks(c)},updateClickTrackingLabel:function(a){Uverse.page.updateClickTrackAttribute(this.iconContainer,Uverse.page.getConstant("clickTracking","attributeMap.names.label"),a)},setSelected:function(a){this.iconContainer.toggleClass("selected",a),this.iconContainer.getElement(".icon").toggleClass("selected",a)}}),Uverse.widgets.Tile.Drawer.FavoriteItem=new Class({Extends:Uverse.widgets.Tile.Drawer.BaseItem,drawerFavoriteSaver:null,name:"favorite",callbacks:{showGenericOverlay:null,hideGenericOverlay:null},initialize:function(a,b,c){this.parent(a,b,c),this.icon=new Uverse.widgets.FavoriteIcon(a,this.options.favoriteID,{onClick:this._onFavoriteClicked.bind(this),onOneClick:this._onFavoriteOneClick.bind(this),onStateChange:this._onStateChange.bind(this)}),this.state=this.icon.getState(),this.drawerFavoriteSaver=new Uverse.widgets.FavoriteSaver(this.options.favoriteID,this.options.favoriteType,{showLoading:this.callbacks.onShowLoading.bind(this),hideLoading:this.callbacks.onHideLoading.bind(this),closeDrawer:this._onFavoriteClicked.bind(this),showGenericOverlay:this.callbacks.showGenericOverlay,hideGenericOverlay:this.callbacks.hideGenericOverlay})},_onStateChange:function(a){this.state=a},_onFavoriteClicked:function(a){this.callbacks.onIconClicked(this._onDrawerReady.bind(this),this)},_onFavoriteOneClick:function(){this.drawerFavoriteSaver.addToFavorites();var a=!0;this.callbacks.onIconClicked(this._onDrawerReady.bind(this),this,a)},_onDrawerReady:function(a,b){Uverse.console.log("[Tile.Drawer.FavoriteItem]","Creating Favorites UI"),b(a,this.drawerFavoriteSaver.getUI(this.state))}}),Uverse.widgets.Tile.Drawer.InformationItem=new Class({Extends:Uverse.widgets.Tile.Drawer.BaseItem,name:"information",initialize:function(a,b,c){this.parent(a,b,c),this.icon=new Uverse.widgets.InformationIcon(a,this.options.categoryPath,{onClick:this._onInformationClicked.bind(this),onStateChange:this._onStateChange.bind(this)}),this.state=this.icon.getState()},_onStateChange:function(a){this.state=a},_onInformationClicked:function(a){this.callbacks.onIconClicked(this._onDrawerReady.bind(this),this)},_onDrawerReady:function(a,b){var c=$("informationOptionsTemplate"),d=[],e=c.getElement(".drawer-information").clone();e.getElement(".description").innerHTML=this.options.information,d.push(e),c=new Element("div"),d.each(function(a){c.adopt(a)}),b(a,c);var f=new Uverse.utils.Ellipsify({truncateTo:"word"});f.ellipsifyElement(c.getElement(".description"))}}),Uverse.widgets.Tile.Drawer.NotificationItem=new Class({Extends:Uverse.widgets.Tile.Drawer.BaseItem,drawerNotificationCreator:null,name:"notification",initialize:function(a,b,c){this.parent(a,b,c),this.icon=new Uverse.widgets.NotificationIcon(a,this.options.categoryPath,{onClick:this._onNotificationClicked.bind(this),onStateChange:this._onStateChange.bind(this)}),this.state=this.icon.getState(),this.drawerNotificationCreator=new Uverse.widgets.NotificationCreator(this.options.categoryPath,{showLoading:this.callbacks.onShowLoading.bind(this),hideLoading:this.callbacks.onHideLoading.bind(this),showMessage:this.callbacks.onShowMessage.bind(this)})},_onStateChange:function(a){this.state=a},_onNotificationClicked:function(a){this.callbacks.onIconClicked(this._onDrawerReady.bind(this),this)},_onDrawerReady:function(a,b){b(a,this.drawerNotificationCreator.getUI(this.state))}}),Uverse.widgets.Tile.Drawer.RecordingItem=new Class({Extends:Uverse.widgets.Tile.Drawer.BaseItem,name:"recording",drawerRecorder:null,state:null,epgInfoObject:null,epgInfoData:null,options:{normalizedProgramTitle:"",normalizedEpisodeTitle:"",isCategory:!1,type:null},initialize:function(a,b,c){this.parent(a,b,c),this.icon=new Uverse.widgets.RecordingIcon(a,{onClick:this._recordingClicked.bind(this),onStateChange:this._onStateChange.bind(this)},this.options.normalizedProgramTitle,this.options.type),this.drawerRecorder=new Uverse.widgets.Recorder(this.options.type,{showLoading:this.callbacks.onShowLoading.bind(this),hideLoading:this.callbacks.onHideLoading.bind(this),showMessage:this.callbacks.onShowMessage.bind(this)})},_onStateChange:function(a){this.state=a},_recordingClicked:function(a){this.callbacks.onIconClicked(this._onDrawerReady.bind(this),this)},_onDrawerReady:function(a,b){this.epgInfoData?b(a,this.drawerRecorder.getUI(this.state,this.epgInfoData)):(this.callbacks.onShowLoading(),this._requestEpgInfo(a,b,{isAsync:!0}))},_requestEpgInfo:function(a,b,c){this.epgInfoObject=new Uverse.utils.EpgInfo({normalizedProgramTitle:this.options.normalizedProgramTitle,normalizedEpisodeTitle:this.options.normalizedEpisodeTitle},{onEpgInfoRecieved:this._onEpgInfoRecieved.bind(this,a,b,c),onEpgInfoFailed:this._onEpgInfoFailed.bind(this,a,b)})},_onEpgInfoRecieved:function(a,b,c,d){Uverse.page.dvr.addMemoryEvent("Dvr-dvrItems:once",this._processEpgInfo.bind(this,a,b,c,d)),Uverse.page.dvr.addMemoryEvent("Dvr-dvrItemsFailure:once",this._onEpgInfoFailed.bind(this,a,b))},_onEpgInfoFailed:function(a,b){b(a,this.drawerRecorder.getErrorStateUI())},_processEpgInfo:function(a,b,c,d){this.state===Uverse.Enums.DvrItemStates.UNKNOWN&&this.icon.setState(d.canBeRecorded?Uverse.Enums.DvrItemStates.CAN_BE_RECORDED:!d.canBeRecorded&&d.hasUpcomingEpisode?Uverse.Enums.DvrItemStates.CANNOT_BE_RECORDED_LOCAL:Uverse.Enums.DvrItemStates.CANNOT_BE_RECORDED),this.epgInfoData=d,this.callbacks.onHideLoading(),b(a,this.drawerRecorder.getUI(this.state,d),c)},cancelOperations:function(){this.epgInfoObject&&this.epgInfoObject.cancelRequest()}}),Uverse.widgets.Tile.Header={},Uverse.widgets.Tile.Header.HeroHeader=new Class({Implements:[Options],Binds:["_onHoverClose"],options:{moreEllipsifyOptions:{truncateTo:"word",cloneOriginal:!1,ellipsis:new Element("span.ellipsis").set("text","... ").grab(new Element("a").set({"class":"moreLink",href:"#",text:"MORE>"}))},heroFx:{property:"opacity",duration:1e3,transition:Fx.Transitions.Quad.easeOut,link:"cancel"},interval:5e3,enableRotation:!0,animateMore:Browser.ie8?!1:!0},heroEl:null,descriptionHover:null,herosPlaying:!1,currentHeroIndex:0,lastHeroIndex:null,initialize:function(a,b){this.heroEl=$(a),this.setOptions(b),this._setupDataBlock(),this._initImageFader()},_setupDataBlock:function(){var a=new Uverse.utils.Ellipsify(this.options.moreEllipsifyOptions),b=this.heroEl.getElement("p.ellipsis.multiLine.more");b&&a.ellipsifyElement(b)&&(b.addEvent("click",this._onMoreClicked.bind(this)),this.descriptionHover=this.heroEl.getElement(".header-description-hover"),this.descriptionHover.getElement(".header-description-hover-close").addEvent("click",this._onHoverClose))},_onMoreClicked:function(a){if(a.preventDefault(),this.options.animateMore?this.descriptionHover.fade("hide").removeClass("hidden").fade("in"):this.descriptionHover.removeClass("hidden"),!this.descriptionHoverScroll){var b=this.descriptionHover.getElement(".description"),c={addClass:"header-description-hover-scrollbar",direction:"vertical"};this.descriptionHoverScroll=Uverse.controls.ScrollBar.attachScrollBarTo(b,c)}document.addEvent("keydown:keys(esc)",this._onHoverClose)},_onHoverClose:function(a){a.preventDefault(),document.removeEvent("keydown:keys(esc)",this._onHoverClose),this.options.animateMore?this.descriptionHover.fade("show").fade("out"):this.descriptionHover.addClass("hidden")
},_initImageFader:function(){if(this.heroImages=this.heroEl.getElements(".heroImage"),this.heroImages&&this.heroImages.length>1){this.heroImages.each(function(a,b){0===b?(a.setStyle("z-index",2),a.setStyle("visibility","visible")):(a.setStyle("z-index",1),a.setStyle("visibility","hidden"))},this),this.heroTweens=[];for(var a=0,b=this.heroImages.length;b>a;a++)this.heroTweens[a]=new Fx.Tween(this.heroImages[a],this.options.heroFx);this._preloadHeroImages()}},_preloadHeroImages:function(){var a=[];this.heroImages.each(function(b){a.push(b.get("src"))}),this.heroTimeout=this._onHerosTimeout.delay(2e4,this),this.heros=new Asset.images(a,{onComplete:function(){this._onHerosLoaded()}.bind(this)})},_onHerosTimeout:function(){this._onHerosLoaded()},_onHerosLoaded:function(){clearTimeout(this.heroTimeout),this._startHeros()},_startHeros:function(){this.herosPlaying||(this.heroPeriodical=this._nextHero.periodical(this.options.interval,this),this.playing=!0)},_nextHero:function(){this._changeHero(this.currentHeroIndex+1)},_changeHero:function(a){if(a>=this.heroImages.length&&(a=0),this.currentHeroIndex!=a){if(null==a)throw"Invalid item index specified";var b=this.currentHeroIndex;null!=this.lastHeroIndex&&(this.heroTweens[this.lastHeroIndex].cancel(),this.heroTweens[this.lastHeroIndex].set(0),this.heroImages[this.lastHeroIndex].setStyle("z-index",1),this.heroImages[this.lastHeroIndex].setStyle("visibility","hidden")),this.heroImages[b].setStyle("z-index",2),this.heroImages[a].setStyle("z-index",1),this.heroImages[b].removeClass("active"),this.heroImages[a].setStyle("visibility","visible"),this.heroTweens[a].set(1),this.heroTweens[b].start(1,0).chain(function(){this.heroImages[b].setStyle("z-index",0)}.bind(this)),this.lastHeroIndex=b,this.currentHeroIndex=a}}}),Uverse.widgets.Tile.Header.PPVHeader=new Class({currentItemIndex:0,heroTron:null,lastItemIndex:null,tileController:null,heroImages:null,heroImageSources:null,initialize:function(a){this.heroTron=a,Uverse.console.log(a),this._setupImages(),this._setupPPVMinitron()},_setupImages:function(){this.heroImages=this.heroTron.getElements(".hero-tron-image"),this.heroImageSources=this.heroImages.map(function(a){return a.get("data-src")}),this._setupHeroImage(0),this.imageCycler=new Uverse.utils.ElementFadeCycler(this.heroImages,null)},_setupPPVMinitron:function(){this.tileEvents=new Events,this.tileController=new Uverse.widgets.TileManager.Controller(this.heroTron,this.tileEvents);var a=this.heroTron.getElement(".ppvminitron");this.tileController.addTile(a,{additionalImages:this.heroImageSources}),this.tileEvents.addEvent("intervalTileChange",this._onTileChange.bind(this))},_onTileChange:function(a){this._setupHeroImage(a),this.imageCycler.fadeTo(a)},_setupHeroImage:function(a){var b=this.heroImages[a];if(!b.retrieve("hasBackgroundImage")){b.store("hasBackgroundImage",!0);var c=this.heroImageSources[a];b.setStyle("background-image","url("+c+")")}}}),Uverse.widgets.TileExtensions=new Class({Implements:[Callbacks],callbacks:{removeTile:null},tileEvents:null,initialize:function(a,b){this.setCallbacks(a),this.tileEvents=b}}),Uverse.widgets.TileExtensions.FavoriteTileRemover=new Class({Extends:Uverse.widgets.TileExtensions,transitions:{tileFade:{elements:{".tileWrapper":{props:["opacity"]}}}},initialize:function(a,b){this.parent(a,b),this.tileEvents.addEvents({FavoriteRemovePrompt:this._onFavoriteRemovePrompt.bind(this),FavoriteRemoveSubmit:this._onFavoriteRemoveSubmit.bind(this),DrawerClose:this._onDrawerClose.bind(this)})},_onFavoriteRemovePrompt:function(a,b){b.detachOverlayFromTile=!0,a.addClassWithTransition("about-to-remove",this.transitions.tileFade)},_onFavoriteRemoveSubmit:function(a,b){b.confirmationResult===!0?(b.preventDrawerFromCollapsing=!0,a.addClassWithTransition("removed",this.transitions.tileFade),a.getElement(".tileWrapper").get("morph").chain(function(){this.callbacks.removeTile(a)}.bind(this))):this._onDrawerClose(a)},_onDrawerClose:function(a){a.removeClassWithTransition("about-to-remove",this.transitions.tileFade)}}),Uverse.widgets.TileLayout=new Class({Implements:[Options,Callbacks],Binds:["_onPageWidthChanged"],options:{reusableTemplates:!1},callbacks:{columnsChanged:!1},spacerTemplate:null,columnContainer:null,columnTemplate:null,tiles:[],initialize:function(a,b,c){this.columnContainer=$(a),this.setOptions(b),this.setCallbacks(c),this._setupElements()},_setupElements:function(){this.columnTemplate=this.columnContainer.getElement(".columnTemplate"),this.options.reusableTemplates||this.columnTemplate.dispose().removeClass("columnTemplate"),this.spacerTemplate=new Element("div",{"class":"card-spacer"}),Uverse.console.assert(this.columnContainer&&this.columnTemplate,"Missing argument!")},addTiles:function(a){this.tiles.append(a);var b=this.columnContainer.getChildren(".column:not(.stage)");this._insertTilesIntoColumns(a,b)},stageTiles:function(a){for(var b=0,c=a.length;c>b;b++)this.stageColumn.appendChild(a[b])},reshuffleTiles:function(a){this.tiles.exclude(a),a.each(function(a){a.dispose()}),this.stageTiles(a),this.addTiles(a)},destroyTile:function(a){this.tiles.erase(a)},destroyLayout:function(){},_insertTilesIntoColumns:function(a,b){for(var c=a.map(function(a){return a.getComputedSize({styles:["padding","border","margin"]}).totalHeight}),d=b.map(function(a){return a.offsetHeight}),e=[],f=b.length;f--;)e[f]=document.createDocumentFragment();for(var g=0,h=a.length;h>g;g++){var i=a[g],j=this._getColumnSpan(i),k=this._determineNextColumnIndex(d,j),l=e[k],m=c[g];if(d[k]+=m,l.appendChild(i),j>1){var n=i.retrieve("tile-spacers");if(!n){var o=j-1;n=this._createSpacers(o,m),i.store("tile-spacers",n)}for(var p=1;j>p;p++){var q=e[k+p];q.appendChild(n[p-1]),d[k+p]+=m}}}for(f=b.length;f--;)b[f].appendChild(e[f])},setColumns:function(a,b){for(var c=this.columnContainer.getChildren(".column:not(.stage)");c.length<a;){var d=this.columnTemplate.clone();this.columnContainer.grab(d),c.push(d)}for(;c.length>a;)c.pop().dispose();this.stageColumn||(this.stageColumn=this.columnTemplate.clone(),this.stageColumn.addClass("stage"),this.columnContainer.grab(this.stageColumn,"top")),this.callbacks.columnsChanged&&this.callbacks.columnsChanged(c),c.each(function(a){a.empty()}),this.stageTiles(this.tiles),this._insertTilesIntoColumns(this.tiles,c)},_determineNextColumnIndex:function(a,b){return a.minIndex(0,a.length-(b-1),1)},_getColumnSpan:function(a){return a.hasClass("one-column")?1:a.hasClass("two-column")?2:a.hasClass("three-column")?3:1},_createSpacers:function(a,b){for(var c=[];a--;){var d=this.spacerTemplate.clone().setStyle("height",b);c.push(d)}return c}}),Uverse.widgets.TileLoader=new Class({Implements:[Options,Callbacks],Binds:["_onRequestSuccess","_onRequestFailure"],options:{tilesUrl:"/tiles.html",pathKey:"path",path:null,siteAreaKey:"siteArea",tileIndexKey:"startTile",genreKey:"genre",siteArea:null,evalScripts:!0,errorRetryInterval:2e3,connectionErrorStatusCodes:[0,502,503,504]},callbacks:{tilesLoading:null,tilesLoaded:null,tilesLoadedDone:null,tilesLoadingError:null,tilesFinished:null,tilesResetting:null,newTileGroup:null,updateSectionHeader:!1,newRecommendations:!1},request:null,retrying:!1,retryCount:0,filter:null,currentTileGroupKey:null,genre:"",tileIndex:0,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this._setupRequest()},_setupRequest:function(){this.request=new Request({url:this.options.tilesUrl,method:"get",evalScripts:this.options.evalScripts,onSuccess:this._onRequestSuccess,onFailure:this._onRequestFailure})},updateFilter:function(a){Uverse.console.log("[TileLoader]","Filter has been updated:",a),Object.areEqual(this.filter,a)||(this.filter=a,this._resetTileLoader(),this.startOver())},setGenre:function(a){this.genre=a,this._resetTileLoader(),this.startOver()},_resetTileLoader:function(){this.isBusy()&&this.cancelRequest(),this.callbacks.tilesResetting()},startOver:function(){this.tileIndex=0,this.currentTileGroupKey=null,this.getMoreTiles()},setInitialTiles:function(a,b){var c=$(a).getChildren();b&&(this.filter=String.parseQueryString(b)),this._processNewElements(c)},getMoreTiles:function(){return this.isBusy()?void Uverse.console.warn("[TileLoader]","You should never try to get more tiles when a request is in progress."):(Uverse.console.log("[TileLoader]","Getting more tiles (tile #",this.tileIndex,", filter:",this.filter,")"),void this._sendTilesRequest())},_sendTilesRequest:function(){var a={};a[this.options.pathKey]=this.options.path||Uverse.config.requestPath,a[this.options.siteAreaKey]=this.options.siteArea,a[this.options.tileIndexKey]=this.tileIndex,this.genre&&this.genre.length>0&&(a[this.options.genreKey]=this.genre),this.filter&&Object.merge(a,this.filter),this.request.send({data:a}),this.callbacks.tilesLoading()},isBusy:function(){return this.request.isRunning()||this.retrying},cancelRequest:function(){this.request.cancel()},_onRequestSuccess:function(a){var b=Elements.from(a).filter("#initial-tiles")[0];if(!b)return Uverse.console.assert(b,"[TileLoader]","Parsed the HTML, but could not find the tiles container!"),void this._onRequestFailure("noTiles");var c=b.getChildren(),d=b.hasClass("end-of-tiles"),e=0===c.length;if(e)return d?void this._tilesFinished():(Uverse.console.error("[TileLoader]","No tiles found in the response!"),void this._onRequestFailure("noTiles"));Uverse.console.log("[TileLoader]","Tiles Loaded"),this.retryCount=0,this._processNewElements(c);var f=Elements.from(a).getElement("#section-header")[0];f&&this.callbacks.updateSectionHeader&&this.callbacks.updateSectionHeader(f),d&&this._tilesFinished()},_processNewElements:function(a){var b=0,c=[],d=[];a.each(function(a){if(a.hasClass("tile-group-header")){var e=a.get("text"),f=this.currentTileGroupKey!==e;f&&(this.currentTileGroupKey=e,c.length&&this.callbacks.tilesLoaded(c),this.callbacks.newTileGroup(a),c=[])}else a.hasClass("tile")||a.hasClass("card")||a.hasClass("video-card")?(b++,c.push(a)):Uverse.console.error("[TileLoader]","Unrecognized element found in response: ",a);"recommendation"===a.id&&d.push(a)},this);var e=this.tileIndex;this.tileIndex+=b,c.length&&this.callbacks.tilesLoaded(c),d.length&&this.callbacks.newRecommendations&&this.callbacks.newRecommendations(d,e),this.callbacks.tilesLoadedDone(b)},_onRequestFailure:function(a){Uverse.console.error("[TileLoader]","Tiles loading error!");var b=!0;if(-1!==this.options.errorRetryInterval&&"noTiles"!==a&&this.options.connectionErrorStatusCodes.contains(a.status)||(b=!1),b){this.retryCount++,Uverse.console.warn("[TileLoader]","Retrying (",this.retryCount,")");var c=this.options.errorRetryInterval*Math.min(10,this.retryCount);this.retrying=function(){this.retrying=!1,this._sendTilesRequest()}.delay(c,this)}this.callbacks.tilesLoadingError(this.request)},_tilesFinished:function(){Uverse.console.log("[TileLoader]","Tiles have finished loading"),this.callbacks.tilesFinished()},destroyTile:function(a){this.tileIndex--}}),Uverse.widgets.TileManager=new Class({Implements:[Options],Binds:["_onPageWidthChanging","_onPageWidthChanged","_onTilesLoaded","_onTilesLoading","_onTilesLoadedDone","_onTilesLoadingError","_onTilesFinished","_onTilesResetting","_onNewTileGroup","_onFilterChanged","_onLayoutColumnsChanged","_onEndOfContainerReached"],options:{initialTilesId:"",tileLoaderOptions:null,filterBarId:null,tileExtensions:null,tileOptions:null},infiniteScroll:null,tileLayout:null,tileLayouts:[],tileController:null,tileLoader:null,filterBar:null,spinner:null,spinnerReloading:null,tileSection:null,tileGroups:null,tileGroupTemplate:null,tileGroup:null,allTiles:[],tilesResetting:!1,disclaimerContainer:null,entitlementHelper:null,initialize:function(a,b){this.tileSection=$(a),this.disclaimerContainer=$("mainDisclaimer"),this.setOptions(b),this.entitlementHelper=new Uverse.utils.Entitlement,this.tileGroups=this.tileSection.getElement(".tile-groups"),this.tileGroupTemplate=this.tileSection.getElement(".tile-group").dispose().clone(),this._setupTileEvents(),this._setupTileExtensions(),this._setupTileController(),this._setupInfiniteScroll(),this._setupTileLoader(),this._setupFilterBar(),this._setupSpinner(),this._setupHero(),this._setupEvents(),Uverse.page.tileManager=this,this._initialized()},_setupEvents:function(){Uverse.page.addMemoryEvent("PageWidth_columnsChanging",this._onPageWidthChanging),Uverse.page.addMemoryEvent("PageWidth_columnsChanged",this._onPageWidthChanged)},_onPageWidthChanging:function(a,b,c){this._storeScrollPosition("pct")},_onPageWidthChanged:function(a,b,c){this.tileLayouts.each(function(c){c.setColumns(a,b)}),0!==b&&this._restoreScrollPosition("pct")},_setupTileController:function(){this.tileController=new Uverse.widgets.TileManager.Controller(this.tileSection,this.tileEvents)},_setupTileEvents:function(){this.tileEvents=new Events},_tileStateChanged:function(a,b,c){Uverse.console.log("[TileManager]","Tile State Changed:",b,c),this.tileExtensions&&this.tileExtensions.each(function(d){d.tileStateChanged(a,b,c)})},_setupTileExtensions:function(){this.tileExtensions=[];var a=this.options.tileExtensions;if(a){var b={removeTile:this._removeTile.bind(this)};a.each(function(a){var c=Uverse.widgets.TileExtensions[a];if(c){var d=new c(b,this.tileEvents);this.tileExtensions.push(d),Uverse.console.log("[TileManager]","Loaded tileExtension: ",a)}else Uverse.console.error("[TileManager]","Could not find the following tileExtension: ",a)},this)}},_removeTile:function(a){Uverse.console.log("[TileManager]","Removing the Tile");var b=this._destroyTile(a);if(0===this.allTiles.length)this.tileLoader.startOver();else{var c=this.allTiles.slice(b);this.tileLayout.reshuffleTiles(c)}var d=this.tileSection.getElement(".tile-section-total-count");if(d){var e=d.get("text").toInt();e--,d.set("text",e)}},_newTileLayout:function(){if(this.tileLayout){var a={columnsChanged:!1};this.tileLayout.setCallbacks(a)}var b={},c={columnsChanged:this._onLayoutColumnsChanged},d=new Uverse.widgets.TileLayout(this.tileGroup,b,c);this.tileLayout=d,this.tileLayouts.push(d),Uverse.page.addMemoryEvent("PageWidth_columnsChanged:once",function(a,b,c){d.setColumns(a,b)})},_onLayoutColumnsChanged:function(a){this.infiniteScroll.updateColumns(a)},_storeScrollPosition:function(a){var b=this.tileSection.getScrollParent();"pct"==a?this.scrollPct=b.getScrollTop()/b.getScrollHeight():"top"==a&&(this.scrollTop=b.getScrollTop())},_restoreScrollPosition:function(a){var b=this.tileSection.getScrollParent(),c;if("pct"==a){var d=b.getScrollHeight();c=this.scrollPct*d}else"top"==a&&(c=this.scrollTop);b.scrollTo(0,c)},_setupInfiniteScroll:function(){var a={},b={endOfContainerReached:this._onEndOfContainerReached};this.infiniteScroll=new Uverse.widgets.InfiniteScroll(this.tileSection,a,b)},_onEndOfContainerReached:function(){this.tileLoader.isBusy()||this.tileLoader.getMoreTiles()},_setupTileLoader:function(){var a=this.options.tileLoaderOptions,b={tilesLoaded:this._onTilesLoaded,tilesLoadedDone:this._onTilesLoadedDone,tilesLoading:this._onTilesLoading,tilesLoadingError:this._onTilesLoadingError,tilesFinished:this._onTilesFinished,tilesResetting:this._onTilesResetting,newTileGroup:this._onNewTileGroup};this.tileLoader=new Uverse.widgets.TileLoader(a,b)},_onTilesLoading:function(){this._updateSpinner("loading")},_onTilesLoaded:function(a){Uverse.console.group("[TileManager]","Loading tiles"),Uverse.console.time("[TileManager] Adding tiles took "),this._prepareUI(),this._checkForTileGroup(),a=a.filter(this._isValidTile.bind(this)),this._addTiles(a),Uverse.console.timeEnd("[TileManager] Adding tiles took "),Uverse.console.groupEnd()},_onTilesLoadedDone:function(a){this._updateSpinner("loaded"),this._tilesAdded(a)},_onTilesLoadingError:function(a){this.tilesResetting&&(this.tilesResetting=!1,this._clearTiles(),this.tileGroups.removeClassWithTransition("transition-tile-groups-reloading")),this._updateSpinner("ERROR")},_onTilesFinished:function(){this.infiniteScroll.disable(),this._updateSpinner("finished"),this.disclaimerContainer&&this.disclaimerContainer.removeClass("hidden")},_onTilesResetting:function(){this.tileGroups.addClassWithTransition("transition-tile-groups-reloading"),this._updateSpinner("reloading"),this.disclaimerContainer&&this.disclaimerContainer.addClass("hidden"),this.tilesResetting=!0},_onNewTileGroup:function(a){this._prepareUI(),this.tileGroups.grab(a),this.tileGroup=null},_isValidTile:function(a){var b=a.get("data-tile-class");if("Promo"===b){var c=a.get("data-promo-key"),d=Uverse.loader.retrieveModelData(c),e=this.entitlementHelper.getHashValueByEntitlementKey(d);return!!e}return!0},_checkForTileGroup:function(){this.tileGroup||(this.tileGroup=this.tileGroupTemplate.clone(),this.tileGroups.grab(this.tileGroup),this._newTileLayout())},_prepareUI:function(){this.tilesResetting&&(this.tilesResetting=!1,this._clearTiles(),this.tileGroups.removeClassWithTransition("transition-tile-groups-reloading"))},_setupFilterBar:function(){var a=this.options.filterBarId;if(a&&$(a)){var b={},c={filterChanged:this._onFilterChanged};this.filterBar=new Uverse.widgets.FilterBar(a,b,c)}},_onFilterChanged:function(a){Uverse.console.log("[TileManager]","New filter selected: ",Object.toQueryString(a)),this.tileLoader.updateFilter(a)},_setupSpinner:function(){this.spinner=this.tileSection.getElement(".tiles-loading-container"),this.spinnerReloading=this.tileSection.getElement(".tiles-reloading-container"),this._updateSpinner("done")},_updateSpinner:function(a){switch(a){case"ERROR":this.spinner.addClass("hidden"),this.spinnerReloading.addClass("hidden");break;case"reloading":this.spinner.addClass("hidden"),this.spinnerReloading.removeClass("hidden");break;case"loading":this.tilesResetting||this.spinner.removeClass("hidden");break;case"loaded":case"finished":this.spinner.addClass("hidden"),this.spinnerReloading.addClass("hidden")}},_initialized:function(){this.options.initialTilesId&&this.tileLoader.setInitialTiles(this.options.initialTilesId,this.options.initialFilter),this.filterBar&&this.filterBar.checkInitialFilter(),Uverse.page.fireMemoryEvent("tileManagerInitialized")},_addTiles:function(a){this.allTiles.append(a),this.tileLayout.stageTiles(a),this.tileController.addTiles(a,this.options.tileOptions),this.tileLayout.addTiles(a)},_tilesAdded:function(a){this.infiniteScroll.tilesAdded()},_destroyTile:function(a){this.tileController.destroyTiles([a]),this.tileLoader.destroyTile(a),this.tileLayout.destroyTile(a);var b=this.allTiles.indexOf(a);return this.allTiles.splice(b,1),a.dispose(),b},_clearTiles:function(){this.tileLayout=null,this.tileLayouts.each(function(a){a.destroyLayout()},this),this.tileLayouts.empty(),this.tileController.destroyTiles(this.allTiles),this.infiniteScroll.enable(),this.tileGroup=null,this.tileGroups.empty(),this.allTiles.empty()},_setupHero:function(){if(this.heroContainer=this.tileSection.getElement(".hero"),this.heroContainer){var a;a=this.heroContainer.hasClass("hero-tron")?new Uverse.widgets.Tile.Header.PPVHeader(this.heroContainer):new Uverse.widgets.Tile.Header.HeroHeader(this.heroContainer)}}}),Uverse.widgets.TileManager.Controller=new Class({el:null,tileEvents:null,tileHelper:new Uverse.utils.TileHelper,initialize:function(a,b){this.el=$(a),this.tileEvents=b,this.setupEventBindings()},addTiles:function(a,b){a.each(function(a){this.addTile(a,b)},this)},destroyTiles:function(a){},addTile:function(a,b){var c=a.get("data-tile-class");this._processTile(c,a),this._createTileWidget(c,a,b)},_processTile:function(a,b){this.tileHelper.ellipsifyElements(b,".description"),this.tileHelper.setupVideoPlayLinks(b),"PPV"===a?this.tileHelper.ellipsifyElements(b,".tile-header-title"):"PPVMinitron"===a&&this.tileHelper.ellipsifyElements(b,".title")},_createTileWidget:function(a,b,c){var d=Uverse.widgets.Tile[a];if(d){var e=new d(b,c,this.tileEvents);this.setupDrawerEventBindings(b,e)}},setupDrawerEventBindings:function(a,b){var c=b.drawer;c&&(a.addEvent("click:relay(.drawer-close)",c.onDrawerCloseClick.bind(c)),a.addEvent("click:relay(.iconContainer)",b.onDrawerIconClick.bind(b)))},setupEventBindings:function(){this.el.addEvent("click:button(left):relay(.video-play-link)",this._onPlayLinkClick.bind(this))},_onPlayLinkClick:function(a,b){a.preventDefault();var c=$(b);this.tileHelper.loadVideoPlayLink(c.getClosest(".tile"),c.href)}}),Uverse.widgets.TileManagerPVP=new Class({Implements:[Options,Uverse.utils.Loadable],options:{},tileController:null,allTiles:[],initialize:function(a,b){this.tileSection=$(a),this.setOptions(b),this.tileEvents=new Events,this._setupTileController(),this._initialized()},_setupTileController:function(){this.tileController=new Uverse.widgets.TileManager.Controller(this.tileSection,this.tileEvents)},_initialized:function(){var a=this.tileSection.getChildren(".tile");a=Array.from(a),this._addTiles(a)},_addTiles:function(a){this.allTiles.append(a),this.tileController.addTiles(a)},_clearTiles:function(){this.tileController.destroyTiles(this.allTiles),this.allTiles.empty()},destroy:function(){this._clearTiles()}}),Uverse.widgets.Toast=new Class({Implements:[Timers],Binds:["_onButtonClick","_onDocumentClick"],el:null,pageContainer:null,DISPLAY_TYPE:{PUSHDOWN:0,OVERLAY:1},defaults:{message:"",alert:"",button:{text:null,action:null},close:{action:null},timeout:30,display:null,closeOnDocumentClick:!0},button:null,message:null,toastOptions:null,body:null,initialize:function(){this.defaults.display=this.DISPLAY_TYPE.OVERLAY,this.body=$(document.body),this.el=$("toast"),this.pageContainer=$("pageContainer1"),this.closeButton=this.el.getElement(".toast-close"),this.button=this.el.getElement(".toast-button"),this.message=this.el.getElement(".toast-message-text"),this.alert=this.el.getElement(".toast-message-alert"),this._setupEvents()},showToast:function(a){document.addEvent("click",this._onDocumentClick),this.toastOptions=Object.merge({},this.defaults,a),this.message.set("html",this.toastOptions.message),this.alert.set("html",this.toastOptions.alert),null===this.toastOptions.button.text&&null===this.toastOptions.button.action?this.button.dispose():this.button.getElement(".slice-one").set("text",this.toastOptions.button.text).setStyle("white-space","nowrap"),this.toastOptions.display===this.DISPLAY_TYPE.OVERLAY?this.el.addClassWithTransition("transition-toast-shown"):this.toastOptions.display===this.DISPLAY_TYPE.PUSHDOWN&&(this.el.addClass("transition-toast-shown transition-toast-pushDown"),this.pageContainer.addClass("page-container-wrapper-open"),this.body.addClass("withToast")),this.toastOptions.timeout&&this.setTimer(this._hideToast,{timeout:1e3*this.toastOptions.timeout}),this.el.removeClass("hidden")},_setupEvents:function(){this.button.addEvent("click",this._onButtonClick),this.closeButton.addEvent("click",this._onButtonClick)},_onButtonClick:function(a){a.stopPropagation();var b,c=a.target;c.hasClass("toast-button")||c.getParent(".toast-button")?b=this.toastOptions.button.action:c.hasClass("toast-close")&&(b=this.toastOptions.close.action),"function"==typeof b?b():b&&(location.href=b),this._hideToast()},_onDocumentClick:function(a){!this.el.contains(a.target)&&this.toastOptions.closeOnDocumentClick&&this._hideToast()},_hideToast:function(){document.removeEvent("click",this._onDocumentClick),this.hideTimeout&&this.clearTimers(),this.toastOptions.display===this.DISPLAY_TYPE.OVERLAY?this.el.removeClassWithTransition("transition-toast-shown"):this.toastOptions.display===this.DISPLAY_TYPE.PUSHDOWN&&(this.pageContainer.removeClass("page-container-wrapper-open"),this.el.removeClass("transition-toast-shown transition-toast-pushDown")),this.body.removeClass("withToast"),this.el.addClass("hidden")}}),Uverse.widgets.UGuideArticleSectionPage=new Class({Implements:[Options],el:null,iframe:null,options:{articlePageDataKey:null,cardControllerOptions:null},cardController:null,viewModel:{},articlePageDataKey:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this.iframe=this.el.getElement(".uGuideIFrame"),this._setupScrollingArrows(),this._retrieveModelData(),this._setupCardController(),this._setupViewModel()},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupScrollingArrows:function(){var a={animateArrowMovement:!1};new Uverse.widgets.ScrollingArrows(this.el.getElement(".iframe-container"),a)},_setupViewModel:function(){this.viewModel={article:this.articlePageDataKey.article,selectedCategory:ko.observable(this.articlePageDataKey.article.category),relatedCards:this.articlePageDataKey.relatedCards,cardController:this.cardController,categories:this.articlePageDataKey.categories,onCategoryClick:null},ko.applyBindings(this.viewModel,this.el)},_retrieveModelData:function(){this.articlePageDataKey=Uverse.loader.retrieveModelData(this.options.articlePageDataKey)}}),Uverse.widgets.Modal=new Class({Implements:[Options,Callbacks,MemoryEvents],Binds:["_onModalClick","_closeModal"],options:{debugName:"",className:"",closeOnForegroundClick:!1,closeOnBackgroundClick:!0,closeOnEscape:!0,requestOptions:null},callbacks:{modalOpening:!1,modalClosing:!1,modalClosed:!1},contents:null,modalContents:null,modalManager:null,request:null,loadedWidgets:null,initialize:function(a,b,c){this.contents=a,this.setOptions(b),this.setCallbacks(c)},loadModal:function(a){this.callbacks.modalOpening&&this.callbacks.modalOpening(),this.modalManager=a,this._setupModalEvents(a.modalContainer),this.modalContents=a.modalContents,this.modalContents.empty().adopt(this.contents),this.contents=null,this.options.className&&(a.modalContainer.addClass(this.options.className),a.modalShadow.addClass(this.options.className)),this.options.requestOptions&&this._startRequest(this.options.requestOptions),this.fireMemoryEvent("modalLoaded")},unloadModal:function(a){this.callbacks.modalClosing&&this.callbacks.modalClosing(),this._teardownModalEvents(a.modalContainer),this.options.className&&(a.modalContainer.removeClass(this.options.className),a.modalShadow.removeClass(this.options.className)),this.request&&this.request.isRunning()&&this.request.cancel(),this.fireMemoryEvent("modalUnloaded")},destroyModal:function(){this.callbacks.modalClosed&&this.callbacks.modalClosed(),this.fireMemoryEvent("modalDestroying"),this.modalContents.empty(),this.modalContents=null,this.contents=null,this.modalManager=null},_setupModalEvents:function(a){this.options.closeOnEscape&&$(document).addEvent("keydown:keys(esc)",this._closeModal),a.addEvent("click",this._onModalClick)},_teardownModalEvents:function(a){$(document).removeEvent("keydown:keys(esc)",this._closeModal),a.removeEvent("click",this._onModalClick)},_closeModal:function(){this.modalManager.closeCurrentModal()},_onModalClick:function(a){if(!a.wasDefaultPrevented()){var b=this.options,c=this.modalContents.contains(a.target)&&this.modalContents!==a.target,d=!!a.target.getClosest(".modal-close-button")||!!a.target.getClosest(".generic-modal-close"),e=d||b.closeOnForegroundClick&&c||b.closeOnBackgroundClick&&!c;e&&(a.preventDefault(),this._closeModal(),d||Uverse.page.clickTrack(a.target,{addAction:"Background Close"}))}},_startRequest:function(a){a=Object.merge({update:this.modalContents},a),this.request=new Request.HTML(a),this.request.addEvent("success",this._onRequestSuccess.bind(this)),this.request.send()},_onRequestSuccess:function(a,b,c,d){this.loadedWidgets=Uverse.loader.processQueue({preventLazyLoad:!0}),this.addMemoryEvent("modalLoaded",function(){this.loadedWidgets.load()}.bind(this)),this.addMemoryEvent("modalUnloaded",function(){this.loadedWidgets.unload()}.bind(this)),this.addMemoryEvent("modalDestroying",function(){this.loadedWidgets.destroy()}.bind(this))}}),Uverse.widgets.ModalManager=new Class({Implements:[Options,Callbacks],options:{modalContainerId:null,modalShadowId:null,classname:"",showByDeepLink:!0},callbacks:{modalClosed:null},modalContainer:null,modalContents:null,modalShadow:null,currentModal:null,shadowShown:!1,currentScroll:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this.modalContainer=$(this.options.modalContainerId).clone().addClass(this.options.classname),$(document.body).adopt(this.modalContainer),this.modalContents=this.modalContainer.getElement(".modal-contents"),this.modalShadow=$(this.options.modalShadowId).clone().addClass(this.options.classname),$(document.body).adopt(this.modalShadow),Uverse.page.addMemoryEvent("deepLinkChange",this._onDeepLinkChange.bind(this))},_onDeepLinkChange:function(a){"base"===a&&this.closeCurrentModal()},loadModal:function(a){this.currentModal&&this._hideModal(!1),this.currentModal=a,this._showModal()},closeCurrentModal:function(){this.currentModal&&(this._hideModal(!0),this.callbacks.modalClosed())},_showModal:function(){Uverse.console.log("[ModalManager]","Showing modal ",this.currentModal.options.debugName),this.currentModal.loadModal(this),this.modalContainer.removeClass("hidden"),this.modalContainer.addClassWithTransition("transitions-modal-container-open"),this._showShadow()},_showShadow:function(){this.shadowShown||(this.shadowShown=!0,Uverse.page.hidePrimaryScrollBars(),this.modalShadow.removeClass("hidden"),this.modalShadow.addClass("transitions-modal-shadow-open"))},_hideModal:function(a){Uverse.console.log("[ModalManager]","Hiding modal ",this.currentModal.options.debugName),a&&this._hideShadow(),this.currentModal.unloadModal(this),this.currentModal.destroyModal(),this.currentModal=null,this.modalContainer.removeClassWithTransition("transitions-modal-container-open"),this._completeMorph(this.modalContainer)},_hideShadow:function(a){a=a||{},this.shadowShown=!1,this.modalShadow.removeClassWithTransition("transitions-modal-shadow-open"),this._completeMorph(this.modalShadow),a.noScrollbarReset||Uverse.page.restoreScrollBars()},_completeMorph:function(a){a.get("morph").chain(function(){a.addClass("hidden")})},destroyModalModalContainers:function(){this.modalContainer.destroy(),this.modalShadow.destroy()}}),Uverse.widgets.GenericModal=new Class({Extends:Uverse.widgets.Modal,Implements:[Options],options:{useLoading:!1,timeout:500,closeOnForegroundClick:!1,closeOnBackgroundClick:!0,closeOnEscape:!0,showByDeepLink:!0},loadingViewModel:null,timer:null,initialize:function(a,b){this.setOptions(b),this.container=a.clone().removeClass("hidden").addClass("generic-modal"),this.modalOptions=b;var c={};this.parent(this.container,this.modalOptions,c)},_setupLoadingViewModel:function(){this.loadingViewModel={isLoading:ko.observable(!1),showLoading:ko.observable(!1)}},_onModalClick:function(a){a.target.hasClass("generic-modal-close")&&(a.preventDefault(),this.modalManager.closeCurrentModal())},_closeModal:function(a){document.location.href="#"},applyBindings:function(a,b){this.options.useLoading&&(this._setupLoadingViewModel(),a=Object.merge(a,this.loadingViewModel)),ko.applyBindings(a,b)},startLoading:function(){this.loadingViewModel&&(null==this.loadingViewModel.isLoading&&this._setupLoadingViewModel(),this.timer||(this.timer=setTimeout(function(){this.loadingViewModel.showLoading(!0),this._resetTimer()}.bind(this),this.options.timeout)),this.loadingViewModel.isLoading(!0))},stopLoading:function(){this._resetTimer(),this.loadingViewModel.isLoading(!1),this.loadingViewModel.showLoading(!1)},_resetTimer:function(){clearTimeout(this.timer),this.timer=null},destroyModal:function(){this.modalManager.destroyModalModalContainers(),this.parent()}}),Uverse.widgets.GenericModalManager=new Class({Extends:Uverse.widgets.ModalManager,options:{classname:"generic-modal-container"},initialize:function(a,b){this.setOptions(a),this.parent(a,b)},_hideShadow:function(){var a=!1;this.options.showByDeepLink||(a=!0),this.parent({noScrollbarReset:a})}}),Uverse.widgets.ParentIcon=new Class({Implements:[Callbacks],el:null,icon:null,state:null,callbacks:{onClick:null,onOneClick:!1,onStateChange:null},initialize:function(a,b){this.setCallbacks(b),this.el=$(a),this.icon=this.el.getElement(".icon")},setState:function(a){return null},onClick:function(a){var b=a.target.getParent().hasClass("selected");
a.target.set("data-clicktrack-label",b?"Close":"Open"),this.callbacks.onClick()},getState:function(){return this.state}}),Uverse.widgets.FavoriteIcon=new Class({Extends:Uverse.widgets.ParentIcon,favoriteID:null,oneClickFavorites:"oneClickFavorites",oneClickFavoritesEnabled:!1,initialize:function(a,b,c){this.parent(a,c),this.state=Uverse.Enums.FavoriteStates.NOT_SAVED,this.favoriteID=b,Uverse.page.addMemoryEvent("Favorite-assetList",this._onUverseDataReceived.bind(this)),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalization.bind(this))},setState:function(a){this.state=a,this.callbacks.onStateChange(a),this.icon.removeClass("active"),this.state==Uverse.Enums.FavoriteStates.SAVED&&this.icon.addClass("active")},_onUverseDataReceived:function(){this.setState(Uverse.page.getFavoriteStateForItem(this.favoriteID))},onClick:function(a){this.oneClickFavoritesEnabled&&this.state===Uverse.Enums.FavoriteStates.NOT_SAVED?(this.icon.set("data-clicktrack-label","One-Click-Favorites Save"),this.callbacks.onOneClick()):this.parent(a)},_onPersonalization:function(a){this.oneClickFavoritesEnabled=a.getPersonalizationData(this.oneClickFavorites)}}),Uverse.widgets.InformationIcon=new Class({Extends:Uverse.widgets.ParentIcon,initialize:function(a,b,c){this.parent(a,c)},setState:function(a){this.state=a,this.callbacks.onStateChange(a),this.icon.removeClass("active")}}),Uverse.widgets.NotificationIcon=new Class({Extends:Uverse.widgets.ParentIcon,categoryPath:null,initialize:function(a,b,c){this.parent(a,c),this.categoryPath=b,this.state=Uverse.Enums.NotificationStates.NOT_NOTIFIED,Uverse.page.addMemoryEvent("Notification-showList",this._onNotificationEpisodeListRetrieved.bind(this))},setState:function(a){this.state=a,this.callbacks.onStateChange(a),this.icon.removeClass("active"),this.state==Uverse.Enums.NotificationStates.NOTIFIED&&this.icon.addClass("active")},_onNotificationEpisodeListRetrieved:function(){this.setState(Uverse.page.getNotificationStateForItem(this.categoryPath))}}),Uverse.widgets.RecordingIcon=new Class({Extends:Uverse.widgets.ParentIcon,normalizedProgramTitle:"",type:null,initialize:function(a,b,c,d){this.parent(a,b),this.normalizedProgramTitle=c,this.type=d,this.state=Uverse.Enums.DvrItemStates.UNKNOWN,this.el&&Uverse.page.dvr.addMemoryEvent("Dvr-dvrItems",this._onDvrDataRecieved.bind(this))},_onDvrDataRecieved:function(){var a=Uverse.page.dvr.getRecordStateForItem(this.normalizedProgramTitle,this.type);this.setState(a)},setState:function(a){switch(this.state=a,this.callbacks.onStateChange(a),this.icon.removeClass("active"),this.icon.removeClass("activeSeries"),this.state){case Uverse.Enums.DvrItemStates.RECORDED.SINGLE:case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SINGLE:this.icon.addClass("active");break;case Uverse.Enums.DvrItemStates.RECORDED.SERIES:case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES:case Uverse.Enums.DvrItemStates.SET_TO_RECORD.SERIES_WITH_RERUNS:this.icon.addClass("activeSeries")}this.icon.show()}}),Uverse.widgets.ArticleCardPage=new Class({Implements:[Options],el:null,options:{articleCardDataKey:null,cardControllerOptions:null},cardController:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._retrieveModelData(),this._setupCardController(),this._setupViewModel();var c="";this._filterCards(c),Uverse.page.addMemoryEvent("Generic_DeepLink",this._onDeepLink.bind(this))},_onDeepLink:function(a){"articleCategory"in a.data&&this._filterCards(a.data.articleCategory)},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupViewModel:function(){this.viewModel={categories:this.categories,articleCards:ko.observableArray(),selectedCategory:ko.observable(""),cardController:this.cardController,onCategoryClick:this._onCategoryClick.bind(this)},ko.applyBindings(this.viewModel,this.el)},_retrieveModelData:function(){var a=Uverse.loader.retrieveModelData(this.options.articleCardDataKey);this.categories=a.categories},_filterCards:function(a){var b=this.categories.first(function(b){return b.value===a});b||(b=this.categories.first()),this.viewModel.articleCards(b.articleCards),this.viewModel.selectedCategory(b.value)},_onCategoryClick:function(a,b){var c=new DOMEvent(b),d=c.target.getClosest("[href]");if(d){c.preventDefault();var e=d.get("href");Uverse.page.loadDeepLink(e,null,{replaceHistory:!0})}}}),Uverse.widgets.cards.Card=new Class({Implements:[Options],options:{hasFlyout:!0,isFlyoutActive:!0,applyOwnBinding:!0},flyout:{shouldPrepare:null,shouldShow:null},viewModel:{},cardDetailsManager:null,initialize:function(a,b,c,d){this.setOptions(d),this.el=a,this.cardShare=b,this.cardHelper=b.cardHelper,this.cardDetailsManager=b.cardDetailsManager,this.setupViewModel(c),c&&ko.merge(this.viewModel,c),this.options.applyOwnBinding&&this.applyBindings()},setupViewModel:function(){Object.append(this.viewModel,{showMoreLink:ko.observable(!0),ellipsifyDescription:ko.observable(!0),cardIsHovered:ko.observable(!1),messageProperty:this.cardHelper.messageProperty.bind(this.cardHelper)}),this.viewModel.toggleEllipsifyDescription=function(){this.ellipsifyDescription(!this.ellipsifyDescription())},this.options.hasFlyout&&!this.cardShare.cardController.options.listView&&this._setupFlyout()},applyBindings:function(){ko.applyBindings(this.viewModel,this.el)},updateViewModel:function(a){ko.merge(this.viewModel,a),this.options.hasFlyout&&!this.flyout.shouldPrepare?this._setupFlyout():!this.options.hasFlyout&&this.flyout.shouldPrepare&&this._destroyFlyout()},_setupFlyout:function(){Object.append(this.viewModel,{flyoutKey:ko.observable(null)}),Object.append(this.viewModel,{flyoutShouldPrepare:this.viewModel.cardIsHovered.extend({delay:{"in":50}}),flyoutShouldShow:this.viewModel.cardIsHovered.extend({delay:{"in":500,out:500}})}),this.flyout.shouldPrepare=this.viewModel.flyoutShouldPrepare.subscribe(this._flyoutShouldPrepare.bind(this)),this.flyout.shouldShow=this.viewModel.flyoutShouldShow.subscribe(this._flyoutShouldShow.bind(this))},_flyoutShouldPrepare:function(a){a&&this.cardDetailsManager.prepareFlyoutData(this.el,this.viewModel.flyoutKey())},_flyoutShouldShow:function(a){a&&this.options.isFlyoutActive?(this.cardDetailsManager.showFlyout(this.el),Uverse.page.clickTrack(this.el,{addAction:"Show Flyout"})):this.cardDetailsManager.hideFlyout(this.el)},_destroyFlyout:function(){this.flyout.shouldPrepare.dispose(),this.flyout.shouldShow.dispose()},_getFlyoutKey:function(a){var b;return b=a.type&&a.type===Uverse.Enums.CollectionCardType.VIDEO_ITEM?"contentType="+a.contentType.toLowerCase()+"&videoKey="+a.videoKey:"categoryPath="+(a.categoryPath?a.categoryPath:a.id)+"&contentType="+a.contentType.toLowerCase()}}),Uverse.widgets.cards.Card.ArticleCard=new Class({Extends:Uverse.widgets.cards.Card,options:{hasFlyout:!1},initialize:function(a,b,c){this.parent(a,b,c)}}),Uverse.widgets.cards.Card.CategoryImageCard=new Class({Extends:Uverse.widgets.cards.Card,initialize:function(a,b,c){this.parent(a,b,c)},setupViewModel:function(a){this.parent();var b=this.viewModel;Object.append(b,{id:null,imageUrl:null,categoryTitle:null,isNew:!1}),a&&ko.merge(b,a),b.displayTitle=b.title||b.videoTitle||b.categoryTitle}}),Uverse.widgets.cards.Card.ClipCard=new Class({Extends:Uverse.widgets.cards.Card,entitlementHelper:new Uverse.utils.Entitlement,cardShare:null,initialize:function(a,b,c){this.cardShare=b,this.parent(a,b,c)},setupViewModel:function(a){this.parent(),Object.append(this.viewModel,{contentType:null,imageUrl:null,playLink:null,title:null,categoryTitle:null,videoTitle:null,entitlementLevel:null,allowedOverlays:null}),a&&(ko.merge(this.viewModel,a),Object.append(this.viewModel,{formattedDuration:ko.computed(function(){return this.cardHelper.formattedDuration(this.viewModel)},this)})),this.viewModel.displayTitle=this.viewModel.title||this.viewModel.videoTitle||this.viewModel.categoryTitle,this.viewModel.entitled=this.entitlementHelper.compareEntitlement(this.viewModel.entitlementLevel)==Uverse.Enums.Entitlement.ALLOWED;var b=(this.viewModel.contentType||"").toUpperCase()+" - "+this.viewModel.categoryTitle;this.viewModel.videoTitle&&(b+=": "+this.viewModel.videoTitle),this.viewModel.clickTrackingLabel=b,this.viewModel.playLinkClick=function(a,b){var c={videoTitle:a.categoryTitle,videoSubtitle:a.videoTitle,videoDescription:"",videoNetwork:""};this.cardShare.cardHelper.loadVideoPlayLink(b,c)}.bind(this),this.viewModel.allowsOverlayTitle=this.viewModel.allowedOverlays&&this.viewModel.allowedOverlays[Uverse.Enums.AllowedOverlays.TITLE]}}),Uverse.widgets.cards.Card.CommonCard=new Class({Extends:Uverse.widgets.cards.Card,initialize:function(a,b,c){this.parent(a,b,c),b.cardHelper.setCardEntitlement(this.viewModel)},setupViewModel:function(a){this.parent(),Object.append(this.viewModel,{id:ko.observable(null),duration:ko.observable(0),contentType:ko.observable(""),title:ko.observable(""),entitlementLevel:ko.observable(""),fullCount:ko.observable(0),categoryUrl:ko.observable(""),categoryImageType:ko.observable("thumbnail"),categoryImageUrl:ko.observable(""),categoryTitle:ko.observable(""),categoryDescription:ko.observable(""),cardMetadataMessage:ko.observable(""),networkName:ko.observable(""),networkUrl:ko.observable(""),assetRating:ko.observable(""),hasHd:ko.observable(!1),tagState:ko.observable(Uverse.Enums.CardTagStates.NONE),flyoutKey:ko.observable(""),isRecommendation:"recommendation"==this.el.id}),Object.append(this.viewModel,{clicktrackSubcategory:ko.computed(function(){var a="";if(this.viewModel.isRecommendation)switch(a+="Recommendation-",this.viewModel.contentType()){case"tv":a+="TVShows";break;case"movies":a+="Movies"}else a="Category Tile";return a},this)}),Object.append(this.viewModel,{imageSize:ko.computed(function(){return this._getImageSize(this.viewModel.categoryImageType)},this),shortDescription:ko.computed(function(){var a=this.categoryDescription||"";return a.length<Uverse.config.cards.shortDescriptionLimit},this.viewModel)}),Object.append(this.viewModel,{showHeader:ko.computed(function(){return!(this.shortDescription()&&"THUMBNAIL"!=this.imageSize()&&"music"!=this.contentType())},this.viewModel),showArticle:ko.computed(function(){return!(this.shortDescription()||"THUMBNAIL"==this.imageSize())},this.viewModel),formattedReleaseDate:ko.computed(function(){return this.cardHelper.formatReleaseDate(this.viewModel)},this),formattedDuration:ko.computed(function(){return this.cardHelper.formattedDuration(this.viewModel)},this),formattedGenres:ko.computed(function(){return this.cardHelper.formattedGenres(this.viewModel)},this)}),a&&this.viewModel.flyoutKey(this._getFlyoutKey(a)),this.viewModel.flyoutShouldShow&&this.viewModel.flyoutShouldShow.subscribe(function(a){a&&this._updateFlyoutData()}.bind(this))},updateViewModel:function(a){this.parent(a),this.viewModel.flyoutKey(this._getFlyoutKey(a))},_getImageSize:function(a){switch(a()){case"showcard":case"showcardIngested":return"SHOWCARD";case"posterArt":case"boxart":case"showcardVertical":case"showImage":case"override":return"POSTER";default:return"THUMBNAIL"}},_updateFlyoutData:function(){this.cardDetailsManager.prepareFlyoutData(this.el,this.viewModel.flyoutKey(),!0)}}),Uverse.widgets.cards.Card.CycleCard=new Class({Extends:Uverse.widgets.cards.Card,Implements:[Timers,Options],options:{interval:5e3,fadeDuration:1e3,fadeTransition:"quint:out",applyOwnBinding:!0},entitlementHelper:new Uverse.utils.Entitlement,initialize:function(a,b,c,d){this.setOptions(d),this.options.applyOwnBinding=!c,this.options.hasFlyout=!a.hasClass("network"),this.parent(a,b,c,this.options),this._setupCardData(c),this.el=a,this.viewModel.activeIndex(0),this.viewModel.items().length>=2&&this.viewModel.paused(!1),this.options.applyOwnBinding||ko.applyBindings(this.viewModel,this.el)},_setupCardData:function(a){this.cardData=a||Uverse.loader.retrieveModelData(this.viewModel.cycleCardDataKey()),this.cardData&&(this.viewModel.cardType(this.cardData.cardType),this.cardData.items[0]&&this.viewModel.itemType(this.cardData.items[0].type),this.viewModel.id(this.cardData.id),this.viewModel.items(this.cardData.items),this.viewModel.cycleImageUrl(this.cardData.cycleImageUrl),this.viewModel.cycleName(this.cardData.cycleName),this.viewModel.cycleUrl(this.cardData.cycleUrl),this.viewModel.premium(this.cardData.premium),this.viewModel.title(this.cardData.title),this.viewModel.imageSizeClass(this.cardData.premium?"imageSize-poster":"imageSize-card"),this.viewModel.hasCycleImage(this.cardData.cycleImageUrl&&""!==this.cardData.cycleImageUrl))},setupViewModel:function(a){this.parent(),Object.append(this.viewModel,{activeIndex:ko.observable(-1),items:ko.observableArray(),paused:ko.observable(!0),entitled:ko.observable(!1),imageIsHover:ko.observable(!1),fadeDuration:this.options.fadeDuration,fadeTransition:this.options.fadeTransition,imageSizeClass:ko.observable(null),hasCycleImage:ko.observable(!1),cycleCardDataKey:ko.observable(null),cardType:ko.observable(null),id:ko.observable(null),cycleImageUrl:ko.observable(null),cycleName:ko.observable(null),cycleUrl:ko.observable(null),premium:ko.observable(!1),title:ko.observable(null),itemType:ko.observable(null),videoItemType:Uverse.Enums.CollectionCardType.VIDEO_ITEM}),Object.append(this.viewModel,{activeItem:ko.computed(function(){return this.items()[this.activeIndex()]},this.viewModel)}),this.viewModel.paused.subscribe(this._setPaused.bind(this)),this.viewModel.flyoutShouldShow&&(this.viewModel.flyoutShouldShow.subscribe(function(a){a&&this._updateFlyoutData()}.bind(this)),this.viewModel.imageIsHover.subscribe(function(a){this.viewModel.cardIsHovered(a),this._setEntitled()}.bind(this)))},_setEntitled:function(){var a=this.viewModel.activeItem();a&&this.viewModel.entitled(this.entitlementHelper.compareEntitlement(a.entitlementLevel)==Uverse.Enums.Entitlement.ALLOWED)},_setPaused:function(a){a?this.clearTimer(this._nextItem):this.setTimer(this._nextItem,{interval:this.options.interval})},_nextItem:function(){var a=(this.viewModel.activeIndex()+1)%this.viewModel.items().length;this.viewModel.activeIndex(a)},_updateFlyoutData:function(){var a=this.viewModel.activeItem();if(a){var b=this._getFlyoutKey(a);Uverse.page.clickTrack(this.el,{addLabel:a.contentType.capitalize()+" - "+a.title}),this.cardDetailsManager.prepareFlyoutData(this.el,b,!0)}}}),Uverse.widgets.cards.Card.FeatureCard=new Class({Extends:Uverse.widgets.cards.Card,options:{autoStart:!0,hasFlyout:!1,pauseOnHover:!0,slideDuration:850,intervalValue:5e3,applyOwnBinding:!1},initialize:function(a,b,c){this.cardHelper=new Uverse.utils.CardHelper,this.entitlementHelper=new Uverse.utils.Entitlement,this.parent(a,b);var d=this._getCardData(c);ko.merge(this.viewModel,d),ko.applyBindings(this.viewModel,this.el)},_getCardData:function(a){return a&&a.slides?{slides:a.slides}:Uverse.loader.retrieveModelData(this.el.get("data-feature-key"))},setupViewModel:function(){this.parent();var a=new Uverse.utils.Ellipsify({ellipsis:"...",textOnly:!0,truncateTo:"word",cloneOriginal:!1,restoreOriginal:!1}),b={slides:ko.observableArray([]).mergeMapping(function(){return{active:ko.observable(!0),title:ko.observable(""),subtitle:ko.observable(""),position:ko.observable("left"),watchLink:ko.observable("#"),upgradeLink:ko.observable("#"),contentLink:ko.observable("#"),contentType:ko.observable(""),description:ko.observable(""),externalLink:ko.observable(!1),fullImagePath:ko.observable(""),watchLinkText:ko.observable(""),entitlementLevel:ko.observable("")}}),activeIdx:ko.observable(0),ellipsifyElement:ko.observable()};Object.append(b,this.options),b.next=function(){b.activeIdx(b.activeIdx()+1),b.clearSelection()},b.prev=function(){b.activeIdx(b.activeIdx()-1),b.clearSelection()},b.setActive=function(a){return b.activeIdx(a)},b.playLink=function(a,b){var c={videoTitle:a.title(),videoSubtitle:a.subtitle(),videoDescription:a.description(),videoNetwork:""};this.cardHelper.loadVideoPlayLink(b,c)}.bind(this),b.entitlementState=function(a){return this.entitlementHelper.compareEntitlement(a.entitlementLevel())}.bind(this),b.clearSelection=function(){document.clearSelection()},Object.append(this.viewModel,b)}}),Uverse.Enums.CardAirState={LIVE:"live",OFFAIR:"offAir",NODATA:"noData"},Uverse.widgets.cards.Card.LiveCard=new Class({Extends:Uverse.widgets.cards.Card,Implements:[Timers,Options],Binds:["_appletIsRunning"],options:{listView:!1,displayCountdown:!1,applyOwnBinding:!0},timeZoneInfo:null,initialize:function(a,b,c,d){this.setOptions(d),this.options.applyOwnBinding=!c,this.parent(a,b,c,this.options),this._setupCardData(c),Uverse.page.addMemoryEvent("Personalization-userData",this._onPersonalizationUserData.bind(this)),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalizationUverseData.bind(this)),this.cardDetailsManager=b.cardDetailsManager,this.cardHelper=b.cardHelper,this._setupSubscriptions(c),this._setupEntitlement(),this._setupCountdownTimer(),this.options.applyOwnBinding||ko.applyBindings(this.viewModel,this.el)},_setupCardData:function(a){this.cardData=a||Uverse.loader.retrieveModelData(this.viewModel.liveCardDataKey()),this.cardData.destroyCard=this.destroyCard.bind(this),this.viewModel.channelLogoUrl(this.cardData.channelLogoUrl),this.viewModel.inHomeOnly(this.cardData.inHomeOnly),this.viewModel.entitlementLevel(this.cardData.entitlementLevel)},_setupSubscriptions:function(a){var b={};a&&a.context&&(b.contextTags=a.context),Uverse.page.subscribeLiveAjaxManager(this.cardData,b),this.viewModel.inHomeOnly()&&Uverse.page.subscribeInHomeStatus(this.viewModel.isInHome)},_setupEntitlement:function(){var a=this.cardData.entitlementLevel,b=this.cardHelper.entitlementHelper.compareEntitlement(a);this.viewModel.entitlementState(b)},setupViewModel:function(){this.parent(),Object.append(this.viewModel,{currentMetadata:{categoryImageUrl:ko.observable(),categoryTitle:ko.observable(),startTime:ko.observable(),endTime:ko.observable(),assetRating:ko.observable(),assetGenres:ko.observable(),categoryDescription:ko.observable(),isEllipsified:ko.observable(!0),minutesRemaining:ko.observable(0),currentProgress:ko.observable(0),isBlackout:ko.observable()},entitlementLevel:ko.observable(null),channelLogoUrl:ko.observable(null),onAirStatus:ko.observable(Uverse.Enums.CardAirState.NODATA),nextAirTime:ko.observable(),userHasHd:ko.observable(!1),categoryImageUrl:ko.observable(),entitlementState:ko.observable(),assetPlayUrl:ko.observable(null),inHomeOnly:ko.observable(!1),isInHome:ko.observable(Uverse.Enums.InHomeStatus.OUT_OF_HOME),geoRestricted:ko.observable(!1),liveCardDataKey:ko.observable(null),appletIsRunning:ko.observable(!1),countdownEnabled:ko.observable(this.options.displayCountdown),timeToOnlineExact:ko.observable(""),timeToOnlineRounded:ko.observable(""),isGreaterThan24Hours:ko.observable(!0)}),Object.append(this.viewModel,{isBlackout:this.viewModel.currentMetadata.isBlackout},this),this.viewModel.flyoutShouldShow&&this.viewModel.flyoutShouldShow.subscribe(function(a){a&&this._updateFlyoutData()}.bind(this)),this.viewModel.playLinkClick=function(a,b){var c={videoTitle:a.currentMetadata.categoryTitle(),videoSubtitle:a.currentMetadata.categoryTitle(),videoDescription:a.currentMetadata.categoryDescription(),videoNetwork:""};this.cardHelper.loadVideoPlayLink(b,c)}.bind(this),this.viewModel.isLocked=ko.computed(function(){return this.viewModel.currentMetadata.isBlackout()||this.viewModel.entitlementState()!==Uverse.Enums.Entitlement.ALLOWED},this),this.viewModel.isOnline=ko.computed(function(){return this.viewModel.onAirStatus()===Uverse.Enums.CardAirState.LIVE},this),this.options.listView&&(this.viewModel.hasPlayLink=ko.computed(function(){var a=this.viewModel;return(!a.inHomeOnly()||a.isInHome()===Uverse.Enums.InHomeStatus.IN_HOME||a.isInHome()===Uverse.Enums.InHomeStatus.OUT_OF_HOME)&&!a.isLocked()&&a.isOnline()},this),this.viewModel.overlayMessage=ko.computed(function(){var a=this.viewModel,b=Uverse.config.liveCards.overlay.message,c=Uverse.page.getInHomeService(),d=c.applet;return a.geoRestricted()?b.geo:a.entitlementState()!==Uverse.Enums.Entitlement.ALLOWED?Uverse.page.isUserLoggedIn()?b.upgrade:a.inHomeOnly()?b.inhome.signin:b.signin:a.inHomeOnly()&&a.isInHome()!==Uverse.Enums.InHomeStatus.IN_HOME?d.isInstalled()?d.hasJavaMinVersion()?b.inhome.notconnected:b.inhome.javaupdate:b.inhome.noplugin:a.currentMetadata.isBlackout()?b.blackout:""},this),this.viewModel.overlayLink=ko.computed(function(){var a=this.viewModel,b=Uverse.config.liveCards.overlay.link,c=Uverse.page.getInHomeService(),d=c.applet;return a.geoRestricted()?null:a.entitlementState()!==Uverse.Enums.Entitlement.ALLOWED?Uverse.page.isUserLoggedIn()?b.upgrade:Uverse.config.cgate.url:!a.inHomeOnly()||d.isInstalled()&&d.hasJavaMinVersion()?a.currentMetadata.isBlackout()?null:a.assetPlayUrl:b.install},this))},_updateProgressBar:function(){var a=new Date,b=new Date(this.viewModel.currentMetadata.start),c=new Date(this.viewModel.currentMetadata.end),d=a.diff(c,"minute"),e=b.diff(c,"minute"),f=Math.ceil(100*(1-d/e));this.viewModel.currentMetadata.minutesRemaining(Math.max(d,1)),this.viewModel.currentMetadata.currentProgress(Math.min(Math.max(0,f),100)),this.setTimer(this._updateProgressBar,{interval:6e4})},_onPersonalizationUserData:function(a){this.viewModel.userHasHd(a.hasHD()),this._populateNextMetadataItem()},_onPersonalizationUverseData:function(a){this.timeZoneInfo=a.getTimeZoneInfo(),this.channelNumber=a.getLiveChannelMapping(this.cardData.callLetters);var b=!this.cardHelper.entitlementHelper.isPackageBasedEntitlement(this.cardData.entitlementLevel);void 0===this.channelNumber&&b&&this.viewModel.geoRestricted(!0),this._populateNextMetadataItem()},_setAirtime:function(a,b){var c=a==Uverse.Enums.CardAirState.LIVE?b.end:b.start;this.viewModel.onAirStatus(a),this.viewModel.nextAirTime(this._getFormattedTime(b.start,!0)),this.setTimer(this._populateNextMetadataItem,{timeout:this._getTimeUntilDate(c)})},_formatTimeMetadata:function(a){a.startTime(this._getFormattedTime(a.start,this._timesCrossBoundry(a.start,a.end))),a.endTime(this._getFormattedTime(a.end,!0))},_setFlyoutState:function(a){this.options.isFlyoutActive=a!=Uverse.Enums.CardAirState.OFFAIR},_setPlayUrl:function(a,b){if(a==Uverse.Enums.CardAirState.LIVE){var c=this.cardData.hdUrl||this.cardData.sdUrl;this.viewModel.assetPlayUrl(c)}},_setCardOffairState:function(){this._disableTimers(),this.options.isFlyoutActive=!1,this.viewModel.currentMetadata.startTime(""),this.viewModel.currentMetadata.categoryTitle(""),this.viewModel.currentMetadata.assetRating(""),this.viewModel.currentMetadata.categoryImageUrl(this.viewModel.categoryImageUrl()),this.viewModel.currentMetadata.categoryDescription(""),this.viewModel.assetPlayUrl(null),this.viewModel.onAirStatus(Uverse.Enums.CardAirState.NODATA)},_populateNextMetadataItem:function(){var a=this._getNextItemAndState();if(a){var b=a.state,c=this.viewModel.currentMetadata;ko.merge(this.viewModel.currentMetadata,a.item),this._setAirtime(b,c),this._formatTimeMetadata(c),this._setFlyoutState(b),this._setPlayUrl(b,c),this._updateFlyoutData(),this._updateProgressBar()}else this._setCardOffairState()},_getNextItemAndState:function(){var a=this.cardData.liveMetadata;if(!a)return Uverse.console.error("[Card.LiveCard]","Empty program list, unable to display data on tile."),null;for(var b=Uverse.Enums.CardAirState.LIVE,c=this._getCurrentTime(),d=0,e=a.length;e>d;d++){var f=a[d];if(f.end-c>0)return f.start-c>0&&(b=Uverse.Enums.CardAirState.OFFAIR),{item:f,state:b}}return null},_disableTimers:function(){this.clearTimers()},_getCurrentTime:function(){if(Uverse.config.liveTiles.simulated.enable&&Uverse.config.liveTiles.simulated.date){var a=new Date(1e3*(new Date).format("%s")+Uverse.config.liveTiles.simulated.dateDiff);return a}return 1e3*(new Date).format("%s")},_getTimeUntilDate:function(a){return a-this._getCurrentTime()},_getFormattedTime:function(a,b){return new Date(a).format("%l:%M"+(b?" %p":""),this.timeZoneInfo).trim()},_timesCrossBoundry:function(a,b){var c=new Date(a).format("%p",this.timeZoneInfo),d=new Date(b).format("%p",this.timeZoneInfo);return c!=d},_updateFlyoutData:function(){var a=this._getNextItemAndState(),b=a&&a.item;if(b){var c={assetAddonPackage:this.cardData.assetAddonPackage,assetUpgradePackage:this.cardData.assetUpgradePackage,contentType:this.cardData.contentType,entitlementLevel:this.cardData.entitlementLevel,favoritesId:this.cardData.favoritesId,flyoutType:this.cardData.flyoutType,packageUpgradeUrl:this.cardData.packageUpgradeUrl,flyoutUrl:this.cardData.hdUrl||this.cardData.sdUrl,callLetters:this.cardData.callLetters,categoryTitle:b.categoryTitle,assetImageUrl:b.categoryImageUrl,assetGenres:b.assetGenres,isBlackout:b.isBlackout,inHomeOnly:this.viewModel.inHomeOnly(),channelNumber:this.channelNumber,recheckApplet:ko.observable(this._recheckApplet.bind(this))};this.cardDetailsManager.updateFlyoutData(this.el,c)}},_recheckApplet:function(){this.viewModel.appletIsRunning(!0),window.addEvent("inHomeApplet-running",this._appletIsRunning),Uverse.page.recheckInHomeStatus()},_appletIsRunning:function(a){a||(this.viewModel.appletIsRunning(!1),window.removeEvent("inHomeApplet-running",this._appletIsRunning))},_setupCountdownTimer:function(){if(this.viewModel.countdownEnabled()){var a=this._getNextItemAndState();if(a){var b=a.item.start;new Uverse.utils.MarketingCountdown(b,this._onMarketingCountdownUpdateReady.bind(this))}else this.viewModel.countdownEnabled(!1)}},_onMarketingCountdownUpdateReady:function(a){this.viewModel.timeToOnlineExact(a.exact.formatted),this.viewModel.timeToOnlineRounded(a.rounded.formatted),this.viewModel.isGreaterThan24Hours(a.exact.actual>86400?!0:!1),this.viewModel.countdownEnabled(a.exact.actual>0)},destroyCard:function(){Uverse.page.unsubscribeLiveAjaxManager(this.cardData),this.viewModel.inHomeOnly()&&Uverse.page.unsubscribeInHomeStatus(this.viewModel.isInHome),this.clearTimers()}}),Uverse.widgets.cards.Card.PromoCard=new Class({Extends:Uverse.widgets.cards.Card,el:null,cardHelper:null,promoItems:null,initialize:function(a,b,c){this.el=a,this.cardHelper=b.cardHelper,this.parent(this.el,b,c),this.promoItems=this._getPromoItems(c),Uverse.page.addMemoryEvent("Personalization-userData",this._loadData.bind(this))},_getPromoItems:function(a){return a&&a.promoTileElements?a.promoTileElements:Uverse.loader.retrieveModelData(this.el.get("data-promo-key"))},_loadData:function(){var a=this.cardHelper.entitlementHelper.getHashValueByEntitlementKey(this.promoItems);ko.merge(this.viewModel,a),this.viewModel.target(this.viewModel.item.isExternalLink()?"_blank":null)},setupViewModel:function(){this.parent(),Object.append(this.viewModel,{promoCardDataKey:ko.observable(null),title:ko.observable(null),hasBorder:ko.observable(!1),height:ko.observable(null),backgroundColor:ko.observable(null),link:ko.observable(null),target:ko.observable(null),imagePath:ko.observable(null),item:{isExternalLink:ko.observable(null),itemType:ko.observable(null),path:ko.observable(null)},dataDashFriendly:this.cardHelper.dataDashFriendly.bind(this.cardHelper),imageBaseUri:ko.observable(null)}),Object.append(this.viewModel,{imageUrl:ko.computed(function(){var a=this.viewModel.imagePath();return a?this.viewModel.imageBaseUri()+this.viewModel.imagePath():null},this)})}}),Uverse.widgets.cards.Card.SearchPromoCard=new Class({Extends:Uverse.widgets.cards.Card,initialize:function(a,b,c){this.cardHelper=b.cardHelper,this.parent(a,b,c)},setupViewModel:function(a){this.parent(a),Object.append(this.viewModel,{dataDashFriendly:this.cardHelper.dataDashFriendly.bind(this.cardHelper)})}}),Uverse.Enums.AllowedOverlays={PROGRESS_BAR:"allowsProgressBar",AIR_DATE:"allowsOverlayText",TITLE:"allowsOverlayTitleText"},Uverse.widgets.cards.Card.VideoCard=new Class({Extends:Uverse.widgets.cards.Card,entitlementHelper:new Uverse.utils.Entitlement,cardShare:null,initialize:function(a,b,c){this.cardShare=b,this.options.hasFlyout=!!c.flyoutKey,this.parent(a,b,c),Uverse.page.addMemoryEvent("Bookmarks-ready",this._onBookmarksReady.bind(this))},setupViewModel:function(a){this.parent(),Object.append(this.viewModel,{contentType:null,imageUrl:null,playLink:null,safeVideoKey:null,title:null,subtitle:null,categoryTitle:null,videoTitle:null,entitlementLevel:null,releaseDate:null,allowedOverlays:null,metaText:null,metaLink:null,isNew:null,latestEpisodeKey:null,bookmarkProgress:ko.observable(),hasBookmark:ko.observable(!1),showTitleTooltip:ko.observable(!1)}),a&&(ko.merge(this.viewModel,a),Object.append(this.viewModel,{formattedReleaseDate:ko.computed(function(){return this.cardHelper.formatReleaseDate(this.viewModel)},this),formattedDuration:ko.computed(function(){return this.cardHelper.formattedDuration(this.viewModel)},this)})),this.viewModel.displayTitle=this.viewModel.title||this.viewModel.videoTitle||this.viewModel.categoryTitle,this.viewModel.entitled=this.entitlementHelper.compareEntitlement(this.viewModel.entitlementLevel)==Uverse.Enums.Entitlement.ALLOWED;var b=(this.viewModel.contentType||"").toUpperCase()+" - "+this.viewModel.categoryTitle;this.viewModel.videoTitle&&(b+=": "+this.viewModel.videoTitle),this.viewModel.clickTrackingLabel=b,this.viewModel.playLinkClick=function(a,b){var c={videoTitle:a.categoryTitle,videoSubtitle:a.videoTitle,videoDescription:"",videoNetwork:""};this.cardShare.cardHelper.loadVideoPlayLink(b,c)}.bind(this),this.viewModel.allowsProgressBar=this.viewModel.allowedOverlays&&this.viewModel.allowedOverlays[Uverse.Enums.AllowedOverlays.PROGRESS_BAR],this.viewModel.allowsAirDate=this.viewModel.allowedOverlays&&this.viewModel.allowedOverlays[Uverse.Enums.AllowedOverlays.AIR_DATE],this.viewModel.imageFillMode||(this.viewModel.imageFillMode=this._getImageFillMode()),this.viewModel.hasDescription=ko.computed(function(){return this.viewModel.description&&""!==this.viewModel.description}.bind(this))},applyBindings:function(){this.viewModel.ellipsifyDescription(!1),this.parent(),this.viewModel.ellipsifyDescription()||(this.viewModel.showTitleTooltip(!0),this.viewModel.ellipsifyDescription(!0))},_onBookmarksReady:function(){if(Uverse.page.isLoggedIn()){var a=Uverse.page.personalization.uverseData.getVideoBookmark(this.viewModel.safeVideoKey);this.viewModel.hasBookmark(!!a),a&&this.viewModel.bookmarkProgress(Math.round(100*a.position/a.totalTime)+"%")}},_getImageFillMode:function(){return-1!==Uverse.config.networksThatNeedThumbnailToCoverCard.indexOf(this.viewModel.networkName)?"cover":"contain"}}),Uverse.widgets.cards.CardArea=new Class({Implements:[Options,Callbacks],callbacks:{readyForMoreCards:null},options:{categoryPath:null,cardControllerOptions:{reusableTemplates:!0}},el:null,cardController:null,recommendationsService:null,resetState:{incomingCardGroups:null,isAnimating:!1},initialize:function(a,b,c){this.el=$(a),this.setOptions(b),this.setCallbacks(c),this._setupCardController(),this._setupRecommendationsService(),this._setupViewModel(),this.viewModel.hasRecommendations()&&this.recommendationsService.getCategoryRecommendations(4,this.options.categoryPath,function(a){this.viewModel.recommendationCards(a)}.bind(this))},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupRecommendationsService:function(){this.recommendationsService=new Uverse.services.RecommendationsService},_setupViewModel:function(){this.viewModel={cardController:this.cardController,cardGroups:ko.observableArray(),cardsResetting:ko.observable(!1),cardsAnimating:this._onCardsAnimating.bind(this),cardsLoading:ko.observable(!0),recommendationCards:ko.observableArray([]),hasRecommendations:ko.observable(!1)},ko.applyBindings(this.viewModel,this.el)},_onCardsAnimating:function(a){this.resetState.isAnimating=a,this._checkResetState()},cardsResetting:function(){this.viewModel.cardsResetting(!0),this.viewModel.cardsLoading(!1)},cardGroupsReady:function(a){this.viewModel.cardsResetting()?(this.resetState.incomingCardGroups=a,this._checkResetState()):(this._appendCardGroups(a),this.viewModel.cardsLoading(!0),this.callbacks.readyForMoreCards())
},cardsDone:function(){this.viewModel.cardsResetting()&&(this.resetState.incomingCardGroups=[],this._checkResetState()),this.viewModel.cardsLoading(!1)},_checkResetState:function(){var a=null!==this.resetState.incomingCardGroups&&this.resetState.isAnimating===!1;if(a){var b=this.resetState.incomingCardGroups;this.resetState.incomingCardGroups=null,this._replaceCardGroups(b)}},_replaceCardGroups:function(a){Uverse.console.log("[CategoryPage]","Replacing cards"),this.viewModel.cardsResetting(!1),this.viewModel.cardGroups.removeAll(),this._appendCardGroups(a),this.callbacks.readyForMoreCards()},_appendCardGroups:function(a){Uverse.console.log("[CategoryPage]","Appending cards");var b=function(a,b){return a==b?!0:null==a||null==b?!1:a.title===b.title},c=this.viewModel.cardGroups;a.each(function(a,d){if(0===d){var e=c().peek(),f=b(a,e);if(f)return void e.tiles.append(a.tiles)}a.tiles=ko.observableArray(a.tiles),c.push(a)},this)}}),Uverse.widgets.cards.CardController=new Class({Implements:[Options],options:{templateIds:{cardFlyout:"cardFlyoutTemplate",resumeWatchingCard:"resumeWatchingCardTemplate",categoryImageCard:"categoryImageCardTemplate",episodeCard:"resumeWatchingCardTemplate",liveCard:"liveCardTemplate",clipCard:"clipCardTemplate",commonCard:"commonCardTemplate",categoryCard:"categoryCardTemplate",musicianCard:"musicianCardTemplate",movieCard:"movieCardTemplate",networkCard:"networkCardTemplate",collectionCard:"collectionCardTemplate",promoCard:"promoCardTemplate",staticPageTile:"staticPageTileTemplate",marketingTile:"marketingTileTemplate",PPVTile:"PPVTileTemplate",promoTile:"promoTileTemplate",articleCardTemplate:"articleCardTemplate",featureCardTemplate:"featureCardTemplate"},flyoutOptions:{parentEdge:{x:"right",y:"top"},flyoutEdge:{x:"left",y:"top"},flyoutOffset:{x:-20,y:-10}},reusableTemplates:!1,listView:!1,displayCountdown:!1},destroyableCardWidgets:null,cardHelper:null,cardDetailsManager:null,cardShare:{cardDetailsManager:null,cardController:null,cardHelper:null},templates:null,initialize:function(a){this.setOptions(a),this.destroyableCardWidgets=[],this._setupCardHelper(),this._setupCardDetails()},_setupCardHelper:function(){this.cardHelper=new Uverse.utils.CardHelper,this.cardShare.cardHelper=this.cardHelper,this.cardShare.cardController=this},_setupCardDetails:function(){var a=$(this.options.templateIds.cardFlyout);this.cardDetailsManager=new Uverse.widgets.cards.CardDetailsManager(a,{flyoutOptions:this.options.flyoutOptions},this.cardShare),this.cardShare.cardDetailsManager=this.cardDetailsManager},_setupTileExtensions:function(){this.tileExtensions=[];var a=this.options.tileExtensions;if(a){var b={removeTile:this._removeTile.bind(this)};a.each(function(a){var c=Uverse.widgets.TileExtensions[a];if(c){var d=new c(b);this.tileExtensions.push(d),Uverse.console.log("[TileManager]","Loaded tileExtension: ",a)}else Uverse.console.error("[TileManager]","Could not find the following tileExtension: ",a)},this)}},addCards:function(a){a.each(function(a){this.addCard(a,null)},this)},destroyTiles:function(a){this.destroyableCardWidgets.each(function(a){a.destroyCard()}),this.destroyableCardWidgets.empty()},addCard:function(a,b){var c=a.get("data-card-widget");if(!c)return void Uverse.console.error("[CardController]","Could not find the 'data-card-widget' attribute.");var d=Uverse.widgets.cards.Card[c];if(void 0===d)return void Uverse.console.error("[CardController]","Unknown card widget name: ",c);var e=new d(a,this.cardShare,b,{listView:this.options.listView,displayCountdown:this.options.displayCountdown});e.destroyCard&&this.destroyableCardWidgets.push(e),a.store("widget",e)},createCardTemplate:function(a){var b=this.options.listView?"List":"",c=this._getTemplateId(a)+b,d=this._createTemplateClone(c);return d},_getTemplateId:function(a){if(a.cardType)switch(a.cardType){case"resume":case"video":return this.options.templateIds.resumeWatchingCard;case"categoryImage":return this.options.templateIds.categoryImageCard;case"clip":return this.options.templateIds.clipCard;case"category":switch(a.contentType){case"music":return this.options.templateIds.musicianCard;case"movie":return this.options.templateIds.movieCard;case"live":return this.options.templateIds.liveCard;default:return this.options.templateIds.categoryCard}break;case"network":return this.options.templateIds.networkCard;case"collection":return this.options.templateIds.collectionCard;case"promo":return this.options.templateIds.promoCard;case"articleCard":case"articleCardJumbo":return this.options.templateIds.articleCardTemplate;case"feature":return this.options.templateIds.featureCardTemplate;default:throw Error("[CardController] This card type cannot be loaded via a template: "+a.cardType)}else if(a.tileType)switch(a.tileType){case"staticPage":return this.options.templateIds.staticPageTile;case"marketing":return this.options.templateIds.marketingTile;case"ppv":return this.options.templateIds.PPVTile;case"promo":return this.options.templateIds.promoTile;default:throw Error("[CardController] This card type cannot be loaded via a template: "+a.cardType)}throw Error("[CardController] This card type cannot be loaded via a template: "+a.cardType)},_createTemplateClone:function(a){var b;return this.templates?b=this.templates[a]:this.templates={},b||(b=this.options.reusableTemplates?$(a):$(a).dispose(),this.templates[a]=b),b.clone()}}),Uverse.widgets.cards.CardDetails=new Class({Implements:[Options],el:null,viewModel:null,flyout:null,cardHelper:null,uverseData:null,cardTypes:{empty:0,movies:1,tv:2,live:3},entitlementHelper:new Uverse.utils.Entitlement,initialize:function(a,b,c){this.el=a,this.setOptions(b),this.cardHelper=c.cardHelper,this._setupFlyout(),this._setupViewModel(),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onUverseData.bind(this)),ko.applyBindings(this.viewModel,this.el)},_onUverseData:function(a){Uverse.page.isUserLoggedIn()&&(this.uverseData=a,this.viewModel.callLetters()&&this._setGeoRestriction())},_setGeoRestriction:function(){var a=void 0!==this.uverseData.getLiveChannelMapping(this.viewModel.callLetters()),b=!this.entitlementHelper.isPackageBasedEntitlement(this.viewModel.entitlementLevel());!a&&b&&this.viewModel.isGeoRestricted(!0)},_setupFlyout:function(){var a=this.options;a.relativeTo=this.el,this.flyout=new Uverse.widgets.cards.CardFlyout(this.el,this.options.flyoutOptions,{})},_setupViewModel:function(){this._setupViewModel_Observables(),this._setupViewModel_Computed(),this._setupViewModel_Methods(),this._setDefaultStates(),this.viewModel.flyoutModel=this.flyout.viewModel,this.viewModel.flyoutIsHover.subscribe(function(a){var b=ko.contextFor(this.el.parentNode).$data.imageIsHover;b&&b(a)}.bind(this))},_setupViewModel_Observables:function(){this.viewModel={flyoutModel:null,assetDuration:ko.observable(),assetEpisodeNumber:ko.observable(),assetGenres:ko.observable(),assetImageUrl:ko.observable(),assetPromoUrl:ko.observable(),assetReleaseDate:ko.observable(),assetSafeVideoKey:ko.observable(),assetSeasonNumber:ko.observable(),assetUversePackage:ko.observable(),assetAddonPackage:ko.observable(),categorySynopsis:ko.observable(),categoryTitle:ko.observable(),categoryUrl:ko.observable(),callLetters:ko.observable(),contentType:ko.observable(),entitlementLevel:ko.observable(),favoritesId:ko.observable(),flyoutDescription:ko.observable(),flyoutTitle:ko.observable(),flyoutType:ko.observable(),flyoutUrl:ko.observable(),isFull:ko.observable(),numClips:ko.observable(),numFulls:ko.observable(),orderUrl:ko.observable(),price3D:ko.observable(),priceHD:ko.observable(),priceSD:ko.observable(),rating:ko.observable(),rentalPeriod:ko.observable(),packageUpgradeUrl:ko.observable(),isBlackout:ko.observable(),channelNumber:ko.observable(),inHomeOnly:ko.observable(null),recheckApplet:ko.observable(),bookmarkProgress:ko.observable(),bookmarkRemaining:ko.observable(),formattedDuration:ko.observable(),formattedReleaseDate:ko.observable(),showFlyoutWhenDataIsReady:ko.observable(!1),flyoutDataIsReady:ko.observable(!1),isFavorited:ko.observable(!1),hasBookmark:ko.observable(!1),expandDescription:ko.observable(!1),ellipsifyDescription:ko.observable(!1),showMoreLink:ko.observable(!1),showMusicTitleTooltip:ko.observable(!1),showTitleTooltip:ko.observable(!1),isGeoRestricted:ko.observable(!1),inHome:ko.observable(Uverse.Enums.InHomeStatus.OUT_OF_HOME),flyoutIsHover:ko.observable(!1)}},_setupViewModel_Computed:function(){var a=this.viewModel,b=this;a.partiallyVisible=ko.observable(),a.needsBroadband=ko.computed(function(){return b.entitlementHelper.needsBroadbandPackage(this.entitlementLevel())},a),a.entitlementState=ko.computed(function(){return b.entitlementHelper.compareEntitlement(this.entitlementLevel())},a),a.doShowFooter=ko.computed(function(){return this.entitlementState()!==Uverse.Enums.Entitlement.ALLOWED||this.isBlackout()||this.inHomeOnly()&&this.inHome()!==Uverse.Enums.InHomeStatus.IN_HOME&&this.entitlementState()===Uverse.Enums.Entitlement.ALLOWED},a),a.footerIconText=ko.computed(function(){return this.isBlackout()&&this.entitlementState()===Uverse.Enums.Entitlement.ALLOWED?Uverse.config.liveTiles.text.footer.blackout.icon:""},a),a.footerBlackoutText=ko.computed(function(){return Uverse.config.liveTiles.text.footer.blackout.message.substitute({0:this.channelNumber()})},a),a.hasEntitledButton=ko.computed(function(){return this.entitlementState()==Uverse.Enums.Entitlement.ALLOWED&&null!=this.flyoutUrl()},a),a.isEntitled=ko.computed(function(){return this.entitlementState()==Uverse.Enums.Entitlement.ALLOWED},a),a.hasLeftColumn=ko.computed(function(){return"music"!=this.contentType()&&"live"!=this.contentType()&&"category"==this.flyoutType()&&null!=this.assetImageUrl()&&(null!=this.assetPromoUrl()||this.hasEntitledButton())},a),a.showType=ko.computed(function(){return b.cardTypes[this.contentType()]},a),a.flyoutLink=ko.computed(function(){return null==this.flyoutUrl()?null:this.flyoutUrl().replace("?","#")},a),a.assetPromoLink=ko.computed(function(){return null==this.assetPromoUrl()?null:this.assetPromoUrl().replace("?","#")},a),a.showFlyout=ko.computed(function(){return this.showFlyoutWhenDataIsReady()&&this.flyoutDataIsReady()},a),a.isEpisode=ko.computed(function(){return"0"!=this.assetSeasonNumber()&&"0"!=this.assetEpisodeNumber()},a),a.isClipCard=ko.computed(function(){return null!=this.isFull()&&this.isFull()===!1},a),a.isClip=ko.computed(function(){return!this.hasEntitledButton()&&null!=this.assetPromoUrl()&&"rental"!=this.contentType()&&("movies"!=this.contentType()||"movies"==this.contentType()&&this.numClips()>1)},a),a.isTrailer=ko.computed(function(){return!this.hasEntitledButton()&&null!=this.assetPromoUrl()&&("rental"==this.contentType()||"movies"==this.contentType()&&1==this.numClips())},a),a.description=ko.computed(function(){return"tv"==this.contentType()&&!this.isClip()&&!this.isEntitled()&&this.categorySynopsis()&&this.categorySynopsis().length>0?this.categorySynopsis():this.flyoutDescription()},a),a.title=ko.computed(function(){return"music"==this.contentType()||"video"==this.flyoutType()?this.flyoutTitle():this.categoryTitle()},a),a.hasMetadata=ko.computed(function(){return"tv"==this.contentType()&&!this.isClip()||"movies"==this.contentType()&&!this.isClipCard()||this.assetGenres()&&this.assetGenres().length>0},a),a.clicktrackActionUpgradeUrl=ko.computed(function(){return"Upgrade to "+(this.assetUversePackage()||this.assetAddonPackage())},a),a.clicktrackLabelUpgradeUrl=ko.computed(function(){var a=this.title();if(a+="movies"===this.contentType()||"live"===this.contentType()?"":" - "+this.flyoutTitle(),Uverse.page.isUserLoggedIn()){for(var b=Uverse.page.getUserEntitlement().list,c=b.length,d;c--;)0===b[c].indexOf("U>")&&(d=b[c].substring(2));a+=" - "+(d||"Non ATT")}return a},a),a.clicktrackLabel=ko.computed(function(){var a=this.title();return a+="movies"===this.contentType()||"live"===this.contentType()?"":" - "+this.flyoutTitle()},a),a.linkPlayIcon=ko.computed(function(){return this.isClip()||this.isTrailer()?this.assetPromoLink():this.hasBookmark()?this.flyoutLink()+"&resume":this.flyoutLink()},a)},_setupViewModel_Methods:function(){var a=this.viewModel,b=this;a.toggleExpandedDescription=function(){var b=!a.expandDescription();a.expandDescription(b),a.ellipsifyDescription(!b)},a.formatPrice=function(a){return(+a).toFixed(2)},a.playLinkClick=function(a,c){var d={videoTitle:a.categoryTitle(),videoSubtitle:a.flyoutTitle(),videoDescription:a.flyoutDescription(),videoNetwork:""};"movies"==a.contentType()&&(d.videoSubtitle=a.categoryTitle()),b.cardHelper.loadVideoPlayLink(c,d)}},_setDefaultStates:function(){var a=this.viewModel;this._setupViewModel_Favorites(a),this._setupViewModel_FormattedDuration(a),this._setupViewModel_FormattedReleaseDate(a),Uverse.page.isLoggedIn()&&(Uverse.page.addMemoryEvent("Bookmarks-ready",this._setBookmarkState.bind(this)),this.uverseData&&this._setGeoRestriction())},_setBookmarkState:function(){var a=this.viewModel,b=Uverse.page.personalization.uverseData.getVideoBookmark(a.assetSafeVideoKey());a.hasBookmark(!!b),b&&(a.bookmarkProgress(Math.round(100*b.position/b.totalTime)+"%"),a.bookmarkRemaining(Math.round((b.totalTime-b.position)/60)))},_setupViewModel_Favorites:function(a){Uverse.page.addMemoryEvent("Favorite-assetList",this._setFavoriteState.bind(this,a));var b=this;a.toggleFavorite=function(){b._toggleFavorite(this)},this._setupFavoritesRequests(a)},_setupFavoritesRequests:function(a){this.favoritesAddRequest=new Request.JSON({url:Uverse.config.favorite.urls.save,headers:Uverse.config.refreshUserSessionHeaders,method:"post",noCache:!0,onComplete:this._setFavoriteState.bind(this,a)}),this.favoritesRemoveRequest=new Request.JSON({url:Uverse.config.favorite.urls.remove,headers:Uverse.config.refreshUserSessionHeaders,method:"post",noCache:!0,onComplete:this._setFavoriteState.bind(this,a)})},_setFavoriteState:function(a){a.isFavorited(Uverse.page.getFavoriteStateForItem(a.favoritesId())==Uverse.Enums.FavoriteStates.SAVED)},_toggleFavorite:function(a){var b=a.favoritesId(),c;c="live"===a.contentType()?{itemKey:b}:{showPath:b},a.isFavorited()?(Uverse.page.favoriteRemoveItem(b),this.favoritesRemoveRequest.send({data:c}),a.isFavorited(!1)):(Uverse.page.favoriteAddItem(b),this.favoritesAddRequest.send({data:c}),a.isFavorited(!0))},_setupViewModel_FormattedDuration:function(a){var b="",c="",d=a.contentType(),e=a.assetDuration();if(e>0)if("tv"==d||"music"==d||a.isClipCard())if(60>e)b="00:"+(10>e?"0":"")+e;else{for(;e>=60;)c=e%60>9?"":"0",b=":"+c+e%60+b,e=Math.floor(e/60);b=e+b}else"movies"==d&&(b=Math.round(e/60));a.formattedDuration(b)},_setupViewModel_FormattedReleaseDate:function(a){var b="";a.assetReleaseDate()>0&&("tv"===a.contentType()?b=new Date(a.assetReleaseDate()).formatUTC("%b %f, %Y"):"movies"===a.contentType()&&(b=new Date(a.assetReleaseDate()).format("%Y"))),a.formattedReleaseDate(b)},showLoading:function(a){return this.cardEl=a,this.cardEl.adopt(this.el),this.viewModel.flyoutDataIsReady()},updateFlyoutData:function(a){var b=this.viewModel;b.ellipsifyDescription(!1),a.inHomeOnly&&null===this.viewModel.inHomeOnly()&&Uverse.page.subscribeInHomeStatus(this.viewModel.inHome),ko.merge(b,a),this._setDefaultStates(b),b.flyoutDataIsReady(!0),this.viewModel.showFlyout()&&this._prepareFlyoutToBeShown()},showFlyout:function(){this.viewModel.showFlyoutWhenDataIsReady(!0),this.viewModel.showFlyout()&&this._prepareFlyoutToBeShown()},hideFlyout:function(){this.viewModel.showFlyoutWhenDataIsReady(!1)},_prepareFlyoutToBeShown:function(){this.flyout.updatePosition(this.cardEl),this.viewModel.ellipsifyDescription()||this.viewModel.isClipCard()||(this.viewModel.showMoreLink(!0),this.viewModel.showMusicTitleTooltip(!0),this.viewModel.showTitleTooltip(!0),this.viewModel.expandDescription(!1),this.viewModel.ellipsifyDescription(!0))}}),Uverse.widgets.cards.CardDetailsManager=new Class({Implements:[Options],flyoutTemplate:null,cardShare:null,flyoutDataCache:null,currentCardDetails:null,initialize:function(a,b,c){this.flyoutTemplate=a.hide().outerHTML,this.setOptions(b),this.cardShare=c,this._setupFlyoutRequest()},_createCardDetails:function(){var a=Elements.from(this.flyoutTemplate)[0];return new Uverse.widgets.cards.CardDetails(a,{flyoutOptions:this.options.flyoutOptions},this.cardShare)},prepareFlyoutData:function(a,b,c){var d=a.retrieve("flyoutDetails");d||(d=this._createCardDetails(),a.store("flyoutDetails",d)),c&&d.el.dispose();var e=d.showLoading(a);e&&!c||null===b||(Uverse.console.log("[CardDetailsManager]","Preparing flyout data"),this._cancelFlyoutRequest(),this.currentCardDetails=d,this._requestFlyout(b))},showFlyout:function(a){Uverse.console.log("[CardDetailsManager]","Showing Flyout");var b=a.retrieve("flyoutDetails");return b?void b.showFlyout():void Uverse.console.error("[CardDetailsManager]","No flyoutDetails")},hideFlyout:function(a){Uverse.console.log("[CardDetailsManager]","Hiding Flyout");var b=a.retrieve("flyoutDetails");return b?(b.hideFlyout(),void(this.currentCardDetails==b&&this._cancelFlyoutRequest())):void Uverse.console.error("[CardDetailsManager]","No flyoutDetails")},_setupFlyoutRequest:function(){this.flyoutRequest=new Request.JSON({url:"/flyout-details.json",method:"get",onSuccess:this._onFlyoutRequestSuccess.bind(this),onError:this._onFlyoutRequestError.bind(this),link:"cancel"})},_requestFlyout:function(a){Uverse.console.log("[CardDetailsManager]","Flyout - Data Requested",a),this.flyoutRequest.send({data:a})},_onFlyoutRequestSuccess:function(a){Uverse.console.log("[CardDetailsManager]","Flyout - Data Retrieved",a),this.currentCardDetails.updateFlyoutData(a)},_onFlyoutRequestError:function(){Uverse.console.error("[CardDetailsManager]","Request for flyout data failed.")},_cancelFlyoutRequest:function(){this.flyoutRequest.isRunning()&&this.flyoutRequest.cancel()},updateFlyoutData:function(a,b){var c=a.retrieve("flyoutDetails");c&&(Uverse.console.log("[CardDetailsManager]","Updating flyout data"),c.updateFlyoutData(b))}}),Uverse.widgets.CardFilter=new Class({Implements:[Options,Callbacks],options:{twoColumnGroupSize:5,threeColumnGroupSize:10},callbacks:{filterChanged:null},el:null,viewModel:null,seasonFilterName:null,filterGroupSize:null,seasonData:null,initialize:function(a,b,c,d){this.el=$(a),this.setOptions(b),this.setCallbacks(c),this._setupViewModel(),this._loadData(d),Uverse.page.addMemoryEvent("PageWidth_columnsChanged",this._columnsChanged.bind(this)),ko.applyBindings(this.viewModel,this.el)},_setupViewModel:function(){this.viewModel={seasonGroups:ko.observableArray([]),selectGroupOrSeason:this._selectGroupOrSeason.bind(this),currentGroup:ko.observable(null),currentSeason:ko.observable(null),checkbox:[],toggleCheckbox:this._toggleCheckbox.bind(this)}},_toggleCheckbox:function(a){a.checked(!a.checked()),this._updateFilter()},_selectGroupOrSeason:function(a,b){var c=new DOMEvent(b);c.preventDefault();var d=ko.dataFor(c.target);d.isGroup?this.viewModel.currentGroup(d):(this.viewModel.currentSeason(d),this._updateFilter())},_serializeFilter:function(){var a={},b=this.viewModel.currentSeason(),c=this.viewModel.checkbox;this.seasonData&&this.seasonData.length>0&&""!==b.value&&(a[this.seasonFilterName]=b.value);for(var d=0;d<c.length;d++)c[d].checked()&&(a[c[d].name]=c[d].value);return a},_updateFilter:function(){var a=this._serializeFilter();this.callbacks.filterChanged&&this.callbacks.filterChanged(a)},getInitialFilter:function(){return this._serializeFilter()},_loadData:function(a){for(var b=0;b<a.subFilters.length;b++)"DROP_DOWN_LIST"==a.subFilters[b].type?(this.seasonData=a.subFilters[b].items,this.seasonFilterName=a.subFilters[b].name):"CHECKBOX"!=a.subFilters[b].type||a.subFilters[b].disabled||this._loadCheckbox(a.subFilters[b])},_columnsChanged:function(a){this.seasonData&&this.seasonData.length>0&&(this.filterGroupSize=2==a?this.options.twoColumnGroupSize:this.options.threeColumnGroupSize,this.viewModel.seasonGroups.removeAll(),this._groupSeasons(this.seasonData))},_loadCheckbox:function(a){a.checked=ko.observable(a.checked),this.viewModel.checkbox.push(a)},_groupSeasons:function(a){function b(a){return""!==a.value&&!a.value.contains("drop_down_list_additional_item")}var c=[].concat(a),d=c.findIndex(b),e=c.findLastIndex(b),f;-1==d||-1==e?this._initializeSeasons(c):(f=c.splice(d,e-d+1),this._initializeSeasons(c),this._loadGroups(c,f,d)),this.viewModel.seasonGroups().push.apply(this.viewModel.seasonGroups(),c),this.viewModel.seasonGroups.valueHasMutated()},_initializeSeasons:function(a){for(var b=0;b<a.length;b++)a[b].isGroup=!1;this.viewModel.currentSeason()||this.viewModel.currentSeason(a[0])},_loadGroups:function(a,b,c){for(var d,e,f,g=null;b.length>0;){if(b.length>1)d=Math.min(this.filterGroupSize,b.length),e=b.splice(b.length-d,d),g={seasons:e,isGroup:!0,groupName:e[0].label+"..."+e.peek().label},a.splice(c,0,g);else{var h=b.pop();g?(g.seasons.unshift(h),g.groupName=g.seasons[0].label+"..."+g.seasons.peek().label):(h.isGroup=!1,a.splice(c,0,h))}g&&(f=e.indexOf(this.viewModel.currentSeason())>-1||this.viewModel.currentSeason().isGroup===!1,f&&this.viewModel.currentGroup(g))}}}),Uverse.widgets.cards.CardFlyout=new Class({Implements:[Options,Callbacks],Binds:["_onDocumentClick","_onWindowResize"],options:{parentEdge:{x:"right",y:"top"},flyoutEdge:{x:"left",y:"top"},flyoutOffset:{x:0,y:0},keepOnPage:{left:!0,right:!0,top:!0,bottom:!1}},callbacks:{flyoutLoading:!1},el:null,relativeTo:null,viewModel:null,reverseOffset:{x:1,y:1},reverseDirection:{left:"right",right:"left",top:"bottom",bottom:"top"},pageOffset:{x:0,y:0},initialize:function(a,b,c){this.el=a,this.setOptions(b),this.setCallbacks(c),this.viewModel={arrowDirection:ko.observable("left")}},_setInitialDirection:function(){-1==this.reverseOffset.x&&(this.options.parentEdge.x=this.reverseDirection[this.options.parentEdge.x],this.options.flyoutEdge.x=this.reverseDirection[this.options.flyoutEdge.x]),-1==this.reverseOffset.y&&(this.options.parentEdge.y=this.reverseDirection[this.options.parentEdge.y],this.options.flyoutEdge.y=this.reverseDirection[this.options.flyoutEdge.y]),this.reverseOffset={x:1,y:1},this.pageOffset={x:0,y:0},this.viewModel.arrowDirection(this.options.flyoutEdge.x===this.options.parentEdge.x?this.options.flyoutEdge.y:this.options.flyoutEdge.x)},_isOffPage:function(){var a=window.getSize(),b={x:0,y:0},c=window.getScroll(),d=this.el.getCoordinates(),e=!1;return $(document.body).hasClass("detached-header")&&(b=($("sections-navigation")||$("main-navigation")).getSize()),d.bottom>a.y+c.y&&this.options.keepOnPage.bottom&&(this.options.flyoutEdge.x===this.options.parentEdge.x&&"bottom"==this.options.flyoutEdge.y?(this.viewModel.arrowDirection("top"),this.options.parentEdge.x=this.reverseDirection[this.options.parentEdge.x],this.options.flyoutEdge.x=this.reverseDirection[this.options.flyoutEdge.x],this.reverseOffset.y=-1):this.pageOffset.y=a.y+c.y-d.bottom,e=!0),d.top<c.y+b.y&&this.options.keepOnPage.top&&(this.options.flyoutEdge.x===this.options.parentEdge.x&&"top"==this.options.flyoutEdge.y?(this.viewModel.arrowDirection("bottom"),this.options.parentEdge.x=this.reverseDirection[this.options.parentEdge.x],this.options.flyoutEdge.x=this.reverseDirection[this.options.flyoutEdge.x],this.reverseOffset.y=-1):this.pageOffset.y=c.y+b.y-d.top,e=!0),d.right>a.x+c.x&&this.options.keepOnPage.right&&(this.options.flyoutEdge.y===this.options.parentEdge.y&&"left"==this.options.flyoutEdge.x?(this.viewModel.arrowDirection("right"),this.options.parentEdge.x=this.reverseDirection[this.options.parentEdge.x],this.options.flyoutEdge.x=this.reverseDirection[this.options.flyoutEdge.x],this.reverseOffset.x=-1):this.pageOffset.x=a.x+c.x-d.right,e=!0),d.left<c.x&&this.options.keepOnPage.left&&(this.options.flyoutEdge.y===this.options.parentEdge.y&&"right"==this.options.flyoutEdge.x?(this.viewModel.arrowDirection("left"),this.options.parentEdge.x=this.reverseDirection[this.options.parentEdge.x],this.options.flyoutEdge.x=this.reverseDirection[this.options.flyoutEdge.x],this.reverseOffset.x=-1):this.pageOffset.x=c.x-d.left,e=!0),e},_setPosition:function(){this._setInitialDirection(),this._setFlyoutPosition(),this._isOffPage()&&this._setFlyoutPosition()},_setFlyoutPosition:function(){var a=Object.clone(this.options.flyoutOffset);a.x=(a.x+this.pageOffset.x)*this.reverseOffset.x,a.y=(a.y+this.pageOffset.y)*this.reverseOffset.y,this.el.position({relativeTo:this.relativeTo,position:this.options.parentEdge,offset:a,edge:this.options.flyoutEdge,allowNegative:!0})},updatePosition:function(a){this.relativeTo=a,this.el.setStyle("display","block");var b=this.el.getStyle("border-width");this.el.setStyle("border-width","0px"),this._setPosition(),this.el.setStyle("border-width",b),this.callbacks.flyoutLoading&&this.callbacks.flyoutLoading(this.el)},disposeFlyout:function(){this.el.dispose()}}),Uverse.widgets.cards.CardLoader=new Class({Implements:[Options,Callbacks],options:{cardsUrl:"/tiles.html",pathKey:"path",siteAreaKey:"siteArea",tileIndexKey:"startTile",siteArea:null},callbacks:{cardsResetting:null,cardGroupsReady:null,cardsDone:null},initialFilter:null,initialCardGroups:null,cardIndex:0,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this._setupRequest()},setInitialCards:function(a,b){this.initialFilter=a,this.initialCardGroups=b},updateFilter:function(a){if(!Object.areEqual(this.currentFilter,a)){if(this.currentFilter=a,Object.areEqual(this.initialFilter,a)){var b=this.initialCardGroups;return this.initialFilter=null,this.initialCardGroups=null,void this._processCardGroups(b)}this.callbacks.cardsResetting(),this.cardIndex=0,this.request.cancel(),this.requestMoreCards()}},_setupRequest:function(){this.request=new Request.JSON({url:this.options.cardsUrl,method:"get",onSuccess:this._onRequestSuccess.bind(this),onFailure:this._onRequestFailure.bind(this),autoRetry:!0})},requestMoreCards:function(){if(!this.request.isRunning()){var a={};a[this.options.pathKey]=Uverse.config.requestPath,a[this.options.siteAreaKey]=this.options.siteArea,a[this.options.tileIndexKey]=this.cardIndex,Object.merge(a,this.currentFilter),Uverse.console.log("[CardLoader]","Requesting cards",this.currentFilter,a),this.request.send({data:a})}},_onRequestFailure:function(a){Uverse.console.error("[CardLoader]","Failure retrieving cards (cannot autoRetry)",a),this._processCardGroups([])},_onRequestSuccess:function(a){this._processCardGroups(a)},_processCardGroups:function(a){if(0===a.length)return Uverse.console.log("[CardLoader]","Reached the end of the cards"),void this.callbacks.cardsDone();var b=0;a.each(function(a){b+=a.tiles.length}),this.cardIndex+=b,Uverse.console.log("[CardLoader]","Added ",b," new cards"),this.callbacks.cardGroupsReady(a)}}),Uverse.widgets.cards.CardManager=new Class({Implements:[Options],Binds:["_onPageWidthChanging","_onPageWidthChanged","_onTilesLoaded","_onTilesLoading","_onTilesLoadedDone","_onTilesLoadingError","_onTilesFinished","_onTilesResetting","_onNewTileGroup","_onUpdateSectionHeader","_onFilterChanged","_onLayoutColumnsChanged","_onEndOfContainerReached","_onNewRecommendations"],options:{initialTilesId:"",tileLoaderOptions:{evalScripts:!0},filterBarId:null,tileExtensions:null,cardControllerOptions:{cardFlyoutId:null}},infiniteScroll:null,tileLayout:null,tileLayouts:[],cardController:null,tileLoader:null,cardPageHeader:null,spinner:null,spinnerReloading:null,tileSection:null,tileSectionHeader:null,tileGroups:null,tileGroupTemplate:null,tileGroup:null,allTiles:[],tilesResetting:!1,disclaimerContainer:null,entitlementHelper:null,recommendationsService:null,initialize:function(a,b){this.tileSection=$(a),this.disclaimerContainer=$("mainDisclaimer"),this.setOptions(b),this.entitlementHelper=new Uverse.utils.Entitlement,this.tileGroups=this.tileSection.getElement(".tile-groups"),this.tileGroupTemplate=this.tileSection.getElement(".tile-group").dispose().clone(),this.tileSectionHeader=this.tileSection.getElement("#section-header"),this._setupCardController(),this._setupInfiniteScroll(),this._setupTileLoader(),this._setupCardPageHeader(),this._setupSpinner(),this._setupHero(),this._setupRecommendationsService(),this._setupEvents(),Uverse.page.tileManager=this,this._initialized()},_setupEvents:function(){Uverse.page.addMemoryEvent("PageWidth_columnsChanging",this._onPageWidthChanging),Uverse.page.addMemoryEvent("PageWidth_columnsChanged",this._onPageWidthChanged)},_onPageWidthChanging:function(a,b,c){this._storeScrollPosition("pct")},_onPageWidthChanged:function(a,b,c){this.tileLayouts.each(function(c){c.setColumns(a,b)}),0!==b&&this._restoreScrollPosition("pct")},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_removeTile:function(a){Uverse.console.log("[TileManager]","Removing the Tile");var b=this._destroyTile(a);if(0===this.allTiles.length)this.tileLoader.startOver();else{var c=this.allTiles.slice(b);this.tileLayout.reshuffleTiles(c)}var d=this.tileSection.getElement(".tile-section-total-count");if(d){var e=d.get("text").toInt();e--,d.set("text",e)}},_newTileLayout:function(){if(this.tileLayout){var a={columnsChanged:!1};this.tileLayout.setCallbacks(a)}var b={},c={columnsChanged:this._onLayoutColumnsChanged},d=new Uverse.widgets.TileLayout(this.tileGroup,b,c);this.tileLayout=d,this.tileLayouts.push(d),Uverse.page.addMemoryEvent("PageWidth_columnsChanged:once",function(a,b,c){d.setColumns(a,b)})},_onLayoutColumnsChanged:function(a){this.infiniteScroll.updateColumns(a)},_storeScrollPosition:function(a){var b=this.tileSection.getScrollParent();"pct"==a?this.scrollPct=b.getScrollTop()/b.getScrollHeight():"top"==a&&(this.scrollTop=b.getScrollTop())},_restoreScrollPosition:function(a){var b=this.tileSection.getScrollParent(),c;if("pct"==a){var d=b.getScrollHeight();c=this.scrollPct*d}else"top"==a&&(c=this.scrollTop);b.scrollTo(0,c)},_setupInfiniteScroll:function(){var a={},b={endOfContainerReached:this._onEndOfContainerReached};this.infiniteScroll=new Uverse.widgets.InfiniteScroll(this.tileSection,a,b)},_onEndOfContainerReached:function(){this.tileLoader.isBusy()||this.tileLoader.getMoreTiles()},_setupTileLoader:function(){var a=this.options.tileLoaderOptions,b={tilesLoaded:this._onTilesLoaded,tilesLoadedDone:this._onTilesLoadedDone,tilesLoading:this._onTilesLoading,tilesLoadingError:this._onTilesLoadingError,tilesFinished:this._onTilesFinished,tilesResetting:this._onTilesResetting,newTileGroup:this._onNewTileGroup,updateSectionHeader:this._onUpdateSectionHeader,newRecommendations:this._onNewRecommendations};this.tileLoader=new Uverse.widgets.TileLoader(a,b)},_onTilesLoading:function(){this._updateSpinner("loading")},_onTilesLoaded:function(a){Uverse.console.group("[TileManager]","Loading tiles"),Uverse.console.time("[TileManager] Adding tiles took "),this._prepareUI(),this._checkForTileGroup(),a=a.filter(this._isValidTile.bind(this)),this._addTiles(a),Uverse.console.timeEnd("[TileManager] Adding tiles took "),Uverse.console.groupEnd()},_onTilesLoadedDone:function(a){this._updateSpinner("loaded"),this._tilesAdded(a)},_onTilesLoadingError:function(a){this.tilesResetting&&(this.tilesResetting=!1,this._clearTiles(),this.tileGroups.removeClassWithTransition("transition-tile-groups-reloading")),this._updateSpinner("ERROR")},_onTilesFinished:function(){this.infiniteScroll.disable(),this._updateSpinner("finished"),this.disclaimerContainer&&this.disclaimerContainer.removeClass("hidden")},_onTilesResetting:function(){this.tileGroups.addClassWithTransition("transition-tile-groups-reloading"),this._updateSpinner("reloading"),this.disclaimerContainer&&this.disclaimerContainer.addClass("hidden"),this.tilesResetting=!0},_onNewTileGroup:function(a){this._prepareUI(),this.tileGroups.grab(a),this.tileGroup=null},_isValidTile:function(a){var b=a.get("data-card-widget");if("PromoCard"===b){var c=a.get("data-promo-key"),d=Uverse.loader.retrieveModelData(c),e=this.entitlementHelper.getHashValueByEntitlementKey(d);return!!e}return!0},_checkForTileGroup:function(){this.tileGroup||(this.tileGroup=this.tileGroupTemplate.clone(),this.tileGroups.grab(this.tileGroup),this._newTileLayout())
},_prepareUI:function(){this.tilesResetting&&(this.tilesResetting=!1,this._clearTiles(),this.tileGroups.removeClassWithTransition("transition-tile-groups-reloading"))},_onUpdateSectionHeader:function(a){a&&this.tileSectionHeader&&this.tileSectionHeader.set("html",a.get("html"))},_setupCardPageHeader:function(){var a=$(this.options.filterBarId);if(a){var b={filterChanged:this._onFilterChanged};this.cardPageHeader=new Uverse.widgets.cards.CardPageHeader(a,b)}},_onFilterChanged:function(a){Uverse.console.log("[TileManager]","New filter selected: ",Object.toQueryString(a)),this.tileLoader.updateFilter(a)},_setupSpinner:function(){this.spinner=this.tileSection.getElement(".tiles-loading-container"),this.spinnerReloading=this.tileSection.getElement(".tiles-reloading-container"),this._updateSpinner("done")},_updateSpinner:function(a){switch(a){case"ERROR":this.spinner.addClass("hidden"),this.spinnerReloading.addClass("hidden");break;case"reloading":this.spinner.addClass("hidden"),this.spinnerReloading.removeClass("hidden");break;case"loading":this.tilesResetting||this.spinner.removeClass("hidden");break;case"loaded":case"finished":this.spinner.addClass("hidden"),this.spinnerReloading.addClass("hidden")}},_initialized:function(){this.options.initialTilesId&&this.tileLoader.setInitialTiles(this.options.initialTilesId,this.options.initialFilter),this.cardPageHeader&&this.cardPageHeader.checkInitialFilter(),Uverse.page.fireMemoryEvent("tileManagerInitialized")},_addTiles:function(a){this.allTiles.append(a),this.tileLayout.stageTiles(a),this.cardController.addCards(a),this.tileLayout.addTiles(a)},_tilesAdded:function(a){this.infiniteScroll.tilesAdded()},_destroyTile:function(a){this.cardController.destroyTiles([a]),this.tileLoader.destroyTile(a),this.tileLayout.destroyTile(a);var b=this.allTiles.indexOf(a);return this.allTiles.splice(b,1),a.dispose(),b},_clearTiles:function(){this.tileLayout=null,this.tileLayouts.each(function(a){a.destroyLayout()},this),this.tileLayouts.empty(),this.cardController.destroyTiles(this.allTiles),this.infiniteScroll.enable(),this.tileGroup=null,this.tileGroups.empty(),this.allTiles.empty()},_setupHero:function(){if(this.heroContainer=this.tileSection.getElement(".hero"),this.heroContainer){var a;a=this.heroContainer.hasClass("hero-tron")?new Uverse.widgets.Tile.Header.PPVHeader(this.heroContainer):new Uverse.widgets.Tile.Header.HeroHeader(this.heroContainer)}},_setupRecommendationsService:function(){this.recommendationsService=new Uverse.services.RecommendationsService},_onNewRecommendations:function(a,b){this.recommendationsService.getPageBatch(a.length,b,function(b){a.each(function(a,c){var d=a.retrieve("widget");d&&d.updateViewModel(b[c])})})}}),Uverse.widgets.cards.CardPageHeader=new Class({Implements:[Callbacks],callbacks:{filterChanged:null},el:null,viewModel:null,initialize:function(a,b){this.el=$(a),this.setCallbacks(b)},_setupViewModel:function(){this.viewModel={primaryFilterValue:ko.observable()},this.viewModel.primaryFilterValue.subscribe(function(a){var b=a.split("="),c=b[0],d=b[1],e={};e[c]=d,this.callbacks.filterChanged(e)}.bind(this)),ko.applyBindings(this.viewModel,this.el)},checkInitialFilter:function(){this._setupViewModel()}}),Uverse.widgets.cards.CardsLayoutManager=new Class({Implements:[Options],options:{isSearch:!1,search:null,pagePath:null,advancedSearchOptions:{},initialLayout:Uverse.Enums.CardLayout.EMPTY},requests:{filterBarRequest:null,cardsRequest:null},initialize:function(a,b){this.el=a,this._setDefaultAdvancedSearchOptions(),this.setOptions(b),this._setupCardController(),this._setupViewModel(),this._setAdvancedSearchOptions(),this._setupAjaxCalls(),this._retrieveFilterBar(),this._setInitialLayout(),this.el.removeClass("hidden"),ko.applyBindings(this.viewModel,this.el),Uverse.page.addMemoryEvent("search-onAdvancedOptionsSaved",this._doSearchPageRefresh.bind(this))},_setDefaultAdvancedSearchOptions:function(){this.options.advancedSearchOptions[Uverse.config.search.advancedSearch.modelNames.DESCRIPTIONS]=!1,this.options.advancedSearchOptions[Uverse.config.search.advancedSearch.modelNames.HDONLY]=!1,this.options.advancedSearchOptions[Uverse.config.search.advancedSearch.modelNames.FREEONLY]=!1,this.options.advancedSearchOptions[Uverse.config.search.advancedSearch.modelNames.ESPANOLONLY]=!1},_setupAjaxCalls:function(){this.options.isSearch&&(this.requests.filterBarRequest=new Request.JSON({method:"GET",url:"/getSearchResult.json",onSuccess:this._onRetrieveFilterBarSuccess.bind(this)})),this.requests.cardsRequest=new Request.JSON({method:"GET",url:"/getSearchResult.json",onSuccess:this._onRetrieveCardsSuccess.bind(this)})},_setupCardController:function(){var a={reusableTemplates:!0};this.cardController=new Uverse.widgets.cards.CardController(a)},_setupTileLayout:function(){var a={reusableTemplates:!0},b={};this.tileLayout=new Uverse.widgets.TileLayout($(Uverse.Enums.CardLayout.COLUMN).getElement(".tile-group"),a,b)},_setupInfiniteScroll:function(){if(!this.infiniteScroll||this.infiniteScroll.tileContainer!=$(this.viewModel.layout())){var a={},b={endOfContainerReached:this._getMoreData.bind(this)};this.infiniteScroll=new Uverse.widgets.InfiniteScroll($(this.viewModel.layout()),a,b)}},_setupViewModel:function(){this.viewModel={layout:ko.observable(Uverse.Enums.CardLayout.EMPTY),cards:ko.observableArray(),filterCategories:ko.observableArray(),selectSearchCategory:this._selectSearchCategory.bind(this),currentCategory:ko.observable(null),searchButtonClicked:this._searchButtonClicked.bind(this),cardController:this.cardController,cardsLoading:ko.observable(!0),cardsLoaded:ko.observable(0),loadingMoreCards:ko.observable(!1),noCards:ko.observable(!1),listView:ko.observable(!1),advancedSearchOptionsExist:ko.observable(!1),advancedSearchOptionsLabels:ko.observable()}},_setInitialLayout:function(){switch(this.options.initialLayout){case Uverse.Enums.CardLayout.LIST:this._resetCardsToDefault(),this.viewModel.cardController.options.listView=!0,this.viewModel.layout(Uverse.Enums.CardLayout.LIST),this.viewModel.listView(!0)}},_checkRunningRequests:function(){for(var a in this.requests)this.requests[a].isRunning&&this.requests[a].cancel()},_retrieveFilterBar:function(){var a={query:this.options.search.query,path:this.options.pagePath};Object.merge(a,this.options.advancedSearchOptions||{}),this.requests.filterBarRequest.setOptions({data:a}).send()},_retrieveCards:function(a){var b=this.requests.cardsRequest;this._checkRunningRequests();var c={query:this.options.search.query,path:this.options.pagePath};if(this.viewModel.currentCategory()){var d=this.viewModel.currentCategory().name,e=this.viewModel.currentCategory().value;c[d]=e}this.viewModel.noCards(!1),Object.merge(c,a.advancedSearchOptions||{}),a.resetStartTile&&(this._resetCardsToDefault(!0),this.viewModel.currentCategory(null),this.viewModel.filterCategories.removeAll(),this.viewModel.layout(Uverse.Enums.CardLayout.EMPTY),b=this.requests.filterBarRequest),this.viewModel.cardsLoaded()>0&&(c.startTile=this.viewModel.cardsLoaded()),b.options.data=c,b.send(),this.viewModel.cardsLoading(!0)},_selectSearchCategory:function(a,b){b.preventDefault();var c=ko.dataFor(b.target);this.viewModel.currentCategory()!=c&&(this.viewModel.cardsLoaded(0),this.viewModel.loadingMoreCards(!1),this.viewModel.currentCategory(c),this.viewModel.listView()||this.viewModel.layout(Uverse.Enums.CardLayout.EMPTY),this.viewModel.cards.removeAll(),this._retrieveCards({advancedSearchOptions:Uverse.config.search.advancedSearch.currentDataValues}))},_searchButtonClicked:function(a,b){switch(b.preventDefault(),b.target.get("href")){case"#list-view":if(this.viewModel.listView())break;this._resetCardsToDefault(),this.viewModel.cardController.options.listView=!0,this.viewModel.layout(Uverse.Enums.CardLayout.LIST),this.viewModel.listView(!0);break;case"#grid-view":if(!this.viewModel.listView())break;var c=this.viewModel.currentCategory().layout;this._resetCardsToDefault(),this.viewModel.cardController.options.listView=!1,this.viewModel.layout(c),this.viewModel.listView(!1),this._renderLayout()}},_resetCardsToDefault:function(a){var b=a?0:Uverse.config.cards.defaultLength;this.viewModel.cards().length>b&&(this.viewModel.cards(this.viewModel.cards.slice(0,b)),this.viewModel.cardsLoaded(b))},_onRetrieveFilterBarSuccess:function(a){Uverse.console.log("[CardsLayoutManager]","Filter bar retrieved"),a.sections.length>0?(this.viewModel.filterCategories(a.sections[0].filters),this.viewModel.filterCategories().each(function(a){a.selected&&this.viewModel.currentCategory(a)},this),this._onRetrieveCardsSuccess(a)):(this.viewModel.layout(Uverse.Enums.CardLayout.EMPTY),this.viewModel.noCards(!0),this.viewModel.cardsLoading(!1))},_onRetrieveCardsSuccess:function(a){var b;try{b=a.sections[0].tileGroups[0].tiles}catch(c){if(this.alreadyTried)throw c;return Uverse.console.warn("[CardsLayoutManager]","Cards not received, retrying to call the json."),this._retrieveCards({advancedSearchOptions:Uverse.config.search.advancedSearch.currentDataValues}),this.alreadyTried=!0,void 0}this.viewModel.loadingMoreCards()?this.viewModel.cards.append(b):(this.viewModel.cards(b),this.viewModel.layout(this.viewModel.listView()?Uverse.Enums.CardLayout.LIST:this.viewModel.currentCategory().layout),Uverse.console.log("[CardsLayoutManager]","Changing layout to: "+this.viewModel.layout())),this.viewModel.cardsLoaded(this.viewModel.cardsLoaded()+b.length),this.viewModel.cardsLoading(!1),this.infiniteScroll&&this.infiniteScroll.enable(),this.viewModel.currentCategory().searchCount>this.viewModel.cardsLoaded()?this._setupInfiniteScroll():this.viewModel.currentCategory().searchCount==this.viewModel.cardsLoaded()&&this.infiniteScroll&&this.infiniteScroll.disable(),this._renderLayout()},_renderLayout:function(){switch(this.viewModel.layout()){case Uverse.Enums.CardLayout.COLUMN:this.viewModel.loadingMoreCards()||(this._setupTileLayout(),this.tileLayout.setColumns(4,0));var a=$("initial-tiles").getElements(".card");0===a.length&&(a=$("initial-tiles").getElements(".tile")),this.tileLayout.addTiles(a);break;case Uverse.Enums.CardLayout.ROW:case Uverse.Enums.CardLayout.LIST:}this.viewModel.loadingMoreCards(!1)},_getMoreData:function(){this.viewModel.loadingMoreCards(!0),this.viewModel.cardsLoading(!0),this.infiniteScroll.disable(),this._retrieveCards({advancedSearchOptions:Uverse.config.search.advancedSearch.currentDataValues})},_setAdvancedSearchOptions:function(){Uverse.page.onSearchAdvancedOptionsSaved(this.options.advancedSearchOptions,{firstPageLoad:!0}),this._populateSelectedAdvanceSearchOptionsDescription(this.options.advancedSearchOptions)},_doSearchPageRefresh:function(a,b){b||(this._retrieveCards({advancedSearchOptions:a,resetStartTile:!0}),this._populateSelectedAdvanceSearchOptionsDescription(a))},_isOneOrMoreAdvancedSearchOptionsChecked:function(a){var b=Uverse.config.search.advancedSearch.modelNames;return!(!a||!a[b.DESCRIPTIONS]&&!a[b.HDONLY]&&!a[b.FREEONLY]&&!a[b.ESPANOLONLY])},_populateSelectedAdvanceSearchOptionsDescription:function(a){var b=[],c=Uverse.config.search,d=c.headerAdvancedSearchDescription;a&&(a[c.advancedSearch.modelNames.DESCRIPTIONS]&&b.push(d.episodeAndClipDescriptions),a[c.advancedSearch.modelNames.HDONLY]&&b.push(d.hdOnly),a[c.advancedSearch.modelNames.FREEONLY]&&b.push(d.freeOnly),a[c.advancedSearch.modelNames.ESPANOLONLY]&&b.push(d.espanolOnly));var e=b.join(", ");this.viewModel.advancedSearchOptionsLabels(e),this.viewModel.advancedSearchOptionsExist(this._isOneOrMoreAdvancedSearchOptionsChecked(a))}}),Uverse.widgets.cards.CategoryHeader=new Class({Implements:[Options,Uverse.utils.RecordButtons],Binds:["_recordRequestSent"],options:{recordButtons:{url:"/category-recording.html",wrapper:".recording-buttons-wrapper"},categoryPath:null,cardControllerOptions:{reusableTemplates:!0}},el:null,viewModel:null,recordButtonsRequest:null,cardController:null,recommendationsService:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._setupCardController(),this._setupRecommendationsService(),this._setupViewModel(),ko.applyBindings(this.viewModel,this.el),Uverse.page.isUserLoggedIn()?(Uverse.page.addMemoryEvent("Favorite-assetList",this._onFavoriteData.bind(this)),this._setupRecordButtonsRequest(),this.recordButtonsRequest.send()):(this._setupRecordingOptions(),this.showRecordButtons(this.el,Uverse.Enums.RecordingType.NONE)),this.viewModel.hasRecommendations()&&this.recommendationsService.getCategoryRecommendations(4,this.options.categoryPath,function(a){this.viewModel.recommendationCards(a)}.bind(this))},_setupViewModel:function(){this.viewModel={favoriteKey:ko.observable(""),toggleFavorite:this._toggleFavorite.bind(this),favoriteState:ko.observable(!0),canBeRecorded:ko.observable(!1),normalizedProgramTitle:ko.observable(""),recommendationCards:ko.observableArray([]),cardController:this.cardController,hasRecommendations:ko.observable(!1)}},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupRecommendationsService:function(){this.recommendationsService=new Uverse.services.RecommendationsService},_onFavoriteData:function(){var a=Uverse.page.favorites.getFavoriteStateForItem(this.viewModel.favoriteKey())==Uverse.Enums.FavoriteStates.SAVED;this.viewModel.favoriteState(a)},_toggleFavorite:function(){this.viewModel.favoriteState()?(Uverse.page.favorites.removeFavorite(this.viewModel.favoriteKey()),this.viewModel.favoriteState(!1)):(Uverse.page.favorites.addFavorite(this.viewModel.favoriteKey()),this.viewModel.favoriteState(!0))},_setupRecordButtonsRequest:function(){this.recordButtonsRequest=new Request.HTML({url:this.options.recordButtons.url,data:{normalizedProgramTitle:this.viewModel.normalizedProgramTitle(),zipcode:Uverse.page.personalization.getUserZip()},headers:Uverse.config.refreshUserSessionHeaders,method:"POST",update:this.el.getElement(this.options.recordButtons.wrapper),onSuccess:this._onRecordButtonsRequestSuccess.bind(this)})},_onRecordButtonsRequestSuccess:function(a){a&&a.length>1&&(Uverse.page.isUverseUser()?(this.contentEls.header=this.el.getElement(".has-program-info"),this.contentEls.header&&(this.contentEls.airings=this.contentEls.header.getElement(".airings").getChildren(".has-program-info"),Uverse.page.dvr.addMemoryEvent("Dvr-dvrData",this._onDvrData.bind(this)))):this.showRecordButtons(this.el,Uverse.Enums.RecordingType.NONE),Uverse.page.dvr.addMemoryEvent("dvrapi-recordRequestSent",this._recordRequestSent))},_recordRequestSent:function(){Uverse.page.dvr.removeMemoryEvent("dvrapi-recordRequestSent",this._recordRequestSent),Uverse.page.getDigitalSmithsAPI().trackVideoRecord(this.options.categoryPath)}}),Uverse.widgets.cards.CategoryPage=new Class({Implements:[Options],options:{initialCardGroupsKey:null,cardFilterDataKey:null,cardLoaderOptions:null,headerOptions:{recordingOptions:{messages:null,flyoutOptions:null}},cardAreaOptions:{},categoryPath:null},el:null,cardArea:null,infiniteScroll:null,cardLoader:null,cardFilter:null,categoryHeader:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._trackDigitalSmithsView(),this._setupCategoryHeader(),this._setupCardArea(),this._setupInfiniteScroll(),this._setupCardFilter(),this._setupCardLoader(),this._initialized()},_initialized:function(){var a=Uverse.loader.retrieveModelData(this.options.initialCardGroupsKey),b;b=this.cardFilter?this.cardFilter.getInitialFilter():{},this.cardLoader.setInitialCards(b,a),this.cardLoader.updateFilter(b)},_trackDigitalSmithsView:function(){Uverse.page.getDigitalSmithsAPI().trackViewCategoryPage(this.options.categoryPath)},_setupCategoryHeader:function(){var a=this.el.getElement(".category-header");this.options.headerOptions.categoryPath=this.options.categoryPath,this.categoryHeader=new Uverse.widgets.cards.CategoryHeader(a,this.options.headerOptions)},_setupCardArea:function(){var a=this.el.getElement(".card-area"),b={readyForMoreCards:this._onReadyForMoreCards.bind(this)};this.options.cardAreaOptions.categoryPath=this.options.categoryPath,this.cardArea=new Uverse.widgets.cards.CardArea(a,this.options.cardAreaOptions,b)},_setupInfiniteScroll:function(){this.infiniteScroll=new Uverse.widgets.InfiniteScrollGeneric,this.infiniteScroll.addEvent("endOfContainerReached",this._getMoreData.bind(this))},_getMoreData:function(){this.cardLoader.requestMoreCards()},_setupCardFilter:function(){var a=Uverse.loader.retrieveModelData(this.options.cardFilterDataKey);if(void 0!==a){var b={filterChanged:this._filterChanged.bind(this)},c=this.el.getElement(".card-filter");this.cardFilter=new Uverse.widgets.CardFilter(c,{},b,a)}},_filterChanged:function(a){this.cardLoader.updateFilter(a)},_setupCardLoader:function(){var a={cardsResetting:this._onCardsResetting.bind(this),cardGroupsReady:this._onCardGroupsReady.bind(this),cardsDone:this._onCardsDone.bind(this)},b=this.options.cardLoaderOptions;this.cardLoader=new Uverse.widgets.cards.CardLoader(b,a)},_onCardsResetting:function(){this.cardArea.cardsResetting(),Uverse.page.scrollToTop()},_onCardGroupsReady:function(a){this.cardArea.cardGroupsReady(a)},_onReadyForMoreCards:function(){this.infiniteScroll.enable(!0)},_onCardsDone:function(){this.cardArea.cardsDone(),this.infiniteScroll.enable(!1)}}),Uverse.widgets.epg.CalendarController=new Class({Implements:[Options,Callbacks],options:{nowTime:null,timeZoneInfo:null,calendarFlyout:null},callbacks:{onClickDay:null,moveToNow:null,moveToPrimetime:null},initialize:function(a,b,c){this.el=a,this.setOptions(b),this.setCallbacks(c),this.flyout=this.options.calendarFlyout,this._setupEvents(),this._setupCalendar(),this._setupFlyout()},_setupEvents:function(){this.flyout.getElement(".now").addEvent("click",this._onClickNow.bind(this)),this.flyout.getElement(".primetime").addEvent("click",this._onClickPrimetime.bind(this))},_onClickNow:function(a){this.flyout.hide(),this.callbacks.moveToNow(),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Toolbar",addAction:"Calendar: Now",addLabel:Uverse.page.isLoggedIn()?"Logged In":"Logged Out"})},_onClickPrimetime:function(a){this.flyout.hide(),this.callbacks.moveToPrimetime(),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Toolbar",addAction:"Calendar: Primetime",addLabel:Uverse.page.isLoggedIn()?"Logged In":"Logged Out"})},_setupCalendar:function(){var a=this.flyout.getElement(".calendar"),b={clickDay:this._onClickDay.bind(this)};this.calendar=new Uverse.controls.Calendar(a,this.options,b),this.activeDate=this.calendar.calData.activeDate,this.calendarLabel=this.el.getElement(".filter-calendar-date")},_setupFlyout:function(){var a=this.flyout,b=this.el.getElement(".filter-calendar-button"),c={relativeTo:b,parentEdge:{x:"right",y:"bottom"},flyoutEdge:{x:"right",y:"top"}},d={flyoutLoading:this._flyoutLoading.bind(this)};this.flyout=new Uverse.widgets.Flyout(a,c,d),b.addEvents({click:this._onTodayClicked.bind(this)})},_onTodayClicked:function(a){this.flyout.toggle(),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Toolbar",addAction:"Open Calendar",addLabel:Uverse.page.isLoggedIn()?"Logged In":"Logged Out"})},_onClickDay:function(a,b,c){Uverse.console.log("[CalendarController]","Clicked on a day:",c),this.flyout.hide(),this.callbacks.onClickDay(c),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Toolbar",addAction:"Calendar: Select Date",addLabel:c.pretty.shortDate+" - "+(Uverse.page.isLoggedIn()?"Logged In":"Logged Out")})},_flyoutLoading:function(){var a=this.calendar.getActive().pretty.longDate,b=this.calendar.getDateData(this.activeDate).pretty.longDate;if(a!==b){var c=this._getActiveDateIdx(b);this.calendar.setActive(c)}},_getActiveDateIdx:function(a){for(var b=this.calendar.calData.days,c=0,d=b.length;d>c;c++)if(b[c].pretty.longDate===a)return c},setDateLabel:function(a){this.calendarLabel.set("text",a)}}),Uverse.widgets.epg.Grid=new Class({Implements:[Options],Binds:["_onChannelsListLoaded","_onChannelsListLoading","_onCellBlockRendered","_onTimelineTweenFrame","_onTimelineCellClick","_onTimelineLeftClick","_onTimelineRightClick","_onGridMousedown","_onWindowScroll","_onWindowResize","_onMousedown","_onMouseup","_onClick","_onMouseout","_onDrag","_onKeydown","_onShowLinkClick","_onChannelLinkClick","_onFilterChanged","_onUserData"],el:null,options:{nowTime:new Date,primetimeHour:null,timelineCellSeconds:1800,times:[],gridCellControllerOptions:{},todayText:null,tomorrowText:null,initialChannelsList:null,initialFilterString:null,dragMinimumDistance:5},timeZoneInfo:{offset:null,nextChange:null,nextOffset:null,dst:!1},primetimeHours:{"-8":20,"-7":19,"-6":19,"-5":20},defaultPrimetimeHour:20,dateFormats:{todayLabel:"%a, %b %d",calendarLabel:"%b %d",timeline:"%l:%M %p",timelineMidnight:"%l:%M %p"},selectors:{channelList:".epg-channel-list",showGrid:".epg-show-grid",timeline:".epg-timeline .epg-timeline-cells",timelineRight:".epg-timeline-pager.right",dateLabel:".epg-timeline-date .label"},metrics:{showGridOffset:null,footerOffset:null,timelinePagerWidth:null,currentViewport:null,targetViewport:null,currentScrollTop:0,headerHeight:24},tweens:{timeline:null,showGrid:null},transitions:{shown:{props:["opacity"]}},dragging:{initialPos:null,lastPos:null,wasDragged:!1},timeline:null,channelList:null,showGrid:null,events:null,gridLoader:null,gridCellController:null,filterbar:null,headers:null,dateLabel:null,overlay:null,isFiltered:!1,initialFilter:null,timelinePagerLeft:null,timelinePagerRight:null,filter:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._setupElements(),this._setupMetrics(),this._setInitialTimezone(),this._generateTimes(),this._parseUrl(),this._setupHeaders(),this._setupViewports(),this._setupEvents(),this._setupGridCellController(),this._setupCalendar(),this._setupTimeline(),this._setupTweens(),this._setupFilterBar(),this._determinePrimetimeHour()},_setupElements:function(){this.grid=this.el.getElement(".epg-grid"),this.timeline=this.el.getElement(this.selectors.timeline),this.channelList=this.el.getElement(this.selectors.channelList),this.showGrid=this.el.getElement(this.selectors.showGrid),this.dateLabel=this.el.getElement(this.selectors.dateLabel),this.overlay=this.el.getElement(".epg-overlay"),this.emptyGridMessage=this.el.getElement(".epg-empty-grid"),this.timelinePagerLeft=this.el.getElement(".epg-timeline-pager.left"),this.timelinePagerRight=this.el.getElement(".epg-timeline-pager.right")},_setupMetrics:function(){this.metrics.showGridOffset=this.showGrid.getOffsets(),this.metrics.footerOffset=$("mastfooter").getOffsets(),this.metrics.timelinePagerWidth=this.timelinePagerLeft.getWidth()},_setInitialTimezone:function(){this.timeZoneInfo=this.options.initialChannelsList.timeZoneInfo},_generateTimes:function(){var a=new Date(this.options.nowTime),b=new Date(a).increment("hour",336).getMidnight(this.timeZoneInfo).increment("second",-1);for(this.options.times=[];b>a;){var c=a.isMidnight(this.timeZoneInfo);this.options.times.push({date:new Date(a),display:a.format(this.dateFormats[c?"timelineMidnight":"timeline"],this.timeZoneInfo)}),a.increment("second",this.options.timelineCellSeconds)}this.headers&&this.headers.setTimes(this.options.times)},_determinePrimetimeHour:function(){var a;if(this.timeZoneInfo.offset)a=this.timeZoneInfo.offset/60,this.timeZoneInfo.dst&&a--;else{var b=(new Date).setExact("month",0);a=b.getGMTOffset()/100}this.options.primetimeHour=this.primetimeHours[a]||this.defaultPrimetimeHour},_parseUrl:function(){var a=window.location,b=a.hash.substring(1),c=String.parseQueryString(b);c.channel&&(this.currentScrollChannel=+c.channel)},_onChannelsListLoading:function(){window.scrollTo(0,0),this._showOverlay()},_onChannelsListLoaded:function(a){if(0===a.channels.length)return this.emptyGridMessage.removeClass("hidden"),this._hideOverlay(),void this.grid.addClass("hidden");this.emptyGridMessage.addClass("hidden"),this.grid.removeClass("hidden"),this.timeZoneInfo=a.timeZoneInfo,this._generateTimes(),this._determinePrimetimeHour(),this.todaysDate=this.options.nowTime.format(this.dateFormats.todayLabel,this.timeZoneInfo),this.tomorrowsDate=this.options.nowTime.clone().increment("hour",24).format(this.dateFormats.todayLabel,this.timeZoneInfo);var b=a.channels.length*this.headers.getChannelCellSize().y+this.headers.getTimelineCellSize().y;if(this.grid.setStyle("height",b),this.headers.updateChannelList(a),this._updateViewport(!0),this._hideOverlay(),this.currentScrollChannel){var c=this.headers.getChannelIndexByNumber(this.currentScrollChannel);this._scrollToChannel(c),this.currentScrollChannel=null}},_onCellBlockRendered:function(){this.overlay.hasClass("shown")&&this._hideOverlay()},_onTimelineLeftClick:function(a){if(a.control){var b=new Date(this.metrics.targetViewport.timeStart).decrement("hour",24);this._moveToDay(b)}else{var c=this.metrics.targetViewport.gridOffset.x,d=c+this._getTimelineScrollAmount(c),e=this.metrics.showGridOffset.x;this._moveGridToPos(d,!0)}Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Date/Time Header",addAction:"Back Arrow",addLabel:Uverse.page.isLoggedIn()?"Logged In":"Logged Out"})},_onTimelineRightClick:function(a){if(a.control){var b=new Date(this.metrics.targetViewport.timeStart).increment("hour",24);this._moveToDay(b)}else if(a.shift)this._moveToPrimetime();else{var c=this.metrics.targetViewport.gridOffset.x,d=c-this._getTimelineScrollAmount(c),e=this.grid.offsetWidth-this.showGrid.offsetWidth;this._moveGridToPos(d,!0)}Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Date/Time Header",addAction:"Forward Arrow",addLabel:Uverse.page.isLoggedIn()?"Logged In":"Logged Out"})},_getTimelineScrollAmount:function(a){var b=this._getFirstVisibleTimeIndex(a),c=this._getLastVisibleTimeIndex(b),d=c-b,e=Math.ceil(d/2),f=this.headers.getTimelineCellSize().x;return e*f},_onTimelineCellClick:function(a){var b=a.target,c=this.headers.getTimelineCellSize().x,d=b.offsetLeft/c,e=this.options.times[d].date;this._moveToTime(e),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Date/Time Header",addAction:"Time",addLabel:b.get("text")+" - "+(Uverse.page.isLoggedIn()?"Logged In":"Logged Out")})},_onCalendarDayClick:function(a){var b=a.dateObj;this._moveToDay(b)},_moveGridToPos:function(a,b){var c=this.grid.offsetWidth,d=this.showGrid.offsetWidth;a=Math.min(a,this.metrics.showGridOffset.x),a=Math.max(a,c-d);var e=this.metrics.targetViewport;this.metrics.targetViewport=this._getViewport(a,e),this._updateViewport(),b?(this.tweens.timeline.start(a),this.tweens.showGrid.start(a)):(this.showGrid.setStyle("left",a),this.timeline.setStyle("left",a),this.metrics.currentViewport=this._getViewport())},_moveToTime:function(a){var b=this.headers.getTimelineCellSize().x,c=this.options.timelineCellSeconds,d=(a-this.options.nowTime)/1e3,e=this.metrics.showGridOffset.x,f=e-b*d/c;this._moveGridToPos(f,!0)},_moveToDay:function(a){this._showOverlay();var b=a.clone(),c=this._getFirstVisibleTime();b.set("hours",c.getHours()).set("minutes",c.getMinutes()).set("seconds",c.getSeconds()),this._moveToTime(b)},_moveToNow:function(){var a=(new Date).setExact("minutes",0);this._moveToTime(a)},_moveToPrimetime:function(){var a=this._getFirstVisibleTime().setExact("hours",this.options.primetimeHour,this.timeZoneInfo);this._moveToTime(a)},_scrollToChannel:function(a){var b=this.headers.getChannelCellSize().y;window.scrollTo(0,b*a+this.metrics.headerHeight)},_getFirstVisibleChannelIndex:function(){var a=this.headers.getChannelCellSize().y,b=this.metrics.currentScrollTop-this.metrics.showGridOffset.y,c=this.timeline.getOffsetTop();return c>0&&(b+=c+this.timeline.offsetHeight),0>b&&(b=0),Math.floor(b/a)},_getLastVisibleChannelIndex:function(a){var b=this.headers.getChannelCellSize().y,c=this.metrics.showGridOffset.y-this.metrics.currentScrollTop,d=this.timeline.getOffsetTop();d>0&&(c=d+this.timeline.offsetHeight);var e=this.metrics.footerOffset.y-c,f=Math.ceil(e/b);return a+f},_getFirstVisibleTimeIndex:function(a){var b=this.headers.getTimelineCellSize().x,c=-((a||this.showGrid.offsetLeft)-this.metrics.showGridOffset.x);return Math.max(0,Math.floor(c/b))},_getLastVisibleTimeIndex:function(a){var b=this.headers.getTimelineCellSize().x,c=window.getSize().x-(this.metrics.showGridOffset.x+this.metrics.timelinePagerWidth),d=Math.ceil(c/b),e=a+d-1;return e=Math.min(e,this.options.times.length-1)},_getFirstVisibleTime:function(){var a=this.headers.getTimelineCellSize().x,b=new Date(this.metrics.targetViewport.timeStart),c=-(this.metrics.targetViewport.gridOffset.x-this.metrics.showGridOffset.x)%a,d=this.options.timelineCellSeconds/a;return b.increment("second",c*d),b},_getViewport:function(a,b){var c=this._getFirstVisibleChannelIndex(),d=this._getLastVisibleChannelIndex(c),e=this._getFirstVisibleTimeIndex(a),f=this.options.times[e].date,g=this._getLastVisibleTimeIndex(e),h=this.options.times[g].date,i=(a||this.showGrid.offsetLeft)<this.metrics.showGridOffset.x,j=g<this.options.times.length,k={channelIndexStart:c,channelIndexEnd:d,channelIndexDelta:0,timeStart:f,timeEnd:h,timeDelta:0,timeIndexStart:e,timeIndexEnd:g,timeCanMoveLeft:i,timeCanMoveRight:j,gridOffset:{x:a||this.showGrid.offsetLeft,y:0}};return b&&(k.channelIndexDelta=k.channelIndexStart-b.channelIndexStart,k.timeDelta=k.timeStart-b.timeStart),k},_updateViewport:function(a){var b=this.metrics.targetViewport;this.gridCellController.updateViewport(b),this.headers.updateViewport(b,a),this._updateDateLabels(b.timeStart),this.calendar.activeDate=b.timeStart,this._updatePagerArrows(b)},_updatePagerArrows:function(a){this.timelinePagerLeft.toggleClass("disabled",!a.timeCanMoveLeft),this.timelinePagerRight.toggleClass("disabled",!a.timeCanMoveRight)},_refreshTimeline:function(){this.headers.updateViewport(this.metrics.currentViewport)},_updateDateLabels:function(a){var b=a.format(this.dateFormats.todayLabel,this.timeZoneInfo),c=a.format(this.dateFormats.calendarLabel,this.timeZoneInfo);b!==this.lastDateLabelValue&&(this.lastDateLabelValue=b,b===this.todaysDate?b=this.options.todayText:b===this.tomorrowsDate&&(b=this.options.tomorrowText),this.dateLabel.set("text",b),this.calendar.setDateLabel(c))},_setupGridCellController:function(){var a=this.options.gridCellControllerOptions;a.gridCellsOptions={nowTime:this.options.nowTime,timelineCellSeconds:this.options.timelineCellSeconds,leftOffset:this.metrics.timelinePagerWidth};var b={channelsListLoading:this._onChannelsListLoading,channelsListLoaded:this._onChannelsListLoaded,cellBlockRendered:this._onCellBlockRendered};this.gridCellController=new Uverse.widgets.epg.GridCellController(this.grid,a,b);var c=this.options.initialChannelsList;this.filter=this.initialFilter=String.parseQueryString(this.options.initialFilterString),this.gridCellController.setInitialChannelsList(c,this.initialFilter)},_setupHeaders:function(){var a={channelList:this.channelList,timeline:this.timeline,showGrid:this.showGrid,times:this.options.times,timelineCellSeconds:this.options.timelineCellSeconds};this.headers=new Uverse.widgets.epg.GridHeaders(a)},_setupViewports:function(){this.metrics.currentViewport=this._getViewport(),this.metrics.targetViewport=this._getViewport()},_setupTimeline:function(){var a=this.options.times.length,b=this.headers.getTimelineCellSize().x,c=b*a;this.timeline.setStyle("width",c),this.showGrid.setStyle("width",c)},_setupFilterBar:function(){var a={zipCodeFlyout:this.el.getElement(".epg-zipcode-flyout"),zipCodeLink:this.el.getElement(".epg-zipcode-link"),initialFilter:this.initialFilter},b={filterChanged:this._onFilterChanged},c=this.el.getElement(".epg-filter-bar");this.epgFilterBar=new Uverse.widgets.epg.GridFilterBar(c,a,b)},_onFilterChanged:function(a){Uverse.console.log("[Grid]","New filter selected: ",Object.toQueryString(a)),this.filter=a,this.gridCellController.updateFilter(a)},_onUserData:function(a){var b=a.username;this.el.getElements(".current-user-name").set("html",b)},_setupCalendar:function(){var a=this.el.getElement(".filter-calendar-control"),b={nowTime:this.options.nowTime,timeZoneInfo:this.timeZoneInfo,calendarFlyout:this.el.getElement(".epg-timeline-date-flyout")},c={onClickDay:this._onCalendarDayClick.bind(this),moveToNow:this._moveToNow.bind(this),moveToPrimetime:this._moveToPrimetime.bind(this)};
this.calendar=new Uverse.widgets.epg.CalendarController(a,b,c)},_setupTweens:function(){this.tweens.timeline=new Fx.Tween(this.timeline,{property:"left"}),this.tweens.timeline.onFrame(this._onTimelineTweenFrame),this.tweens.showGrid=new Fx.Tween(this.showGrid,{property:"left"})},_onTimelineTweenFrame:function(){this.metrics.currentViewport=this._getViewport(),this._refreshTimeline()},_showOverlay:function(){this.overlay.removeClass("hidden").addClassWithTransition("shown",this.transitions.shown)},_hideOverlay:function(){this.overlay.removeClassWithTransition("shown",this.transitions.shown).morphChain(function(){this.overlay.addClass("hidden")}.bind(this))},_setupEvents:function(){window.addEvent("scroll:pace(100)",this._onWindowScroll),window.addEvent("resize:pace(100)",this._onWindowResize),this.grid.addEvent("mousedown",this._onGridMousedown),this.timeline.addEvent("click:relay(.epg-timeline-cell)",this._onTimelineCellClick),this.timelinePagerLeft.addEvent("click",this._onTimelineLeftClick),this.timelinePagerRight.addEvent("click",this._onTimelineRightClick),document.addEvent("keydown",this._onKeydown);var a=1e3/60;this._onDragPaced=this._onDragPaced.pace(a,this),this.showGrid.addEvent("mousedown",this._onMousedown),this.showGrid.addEvent("mouseup",this._onMouseup),this.showGrid.addEvent("click",this._onClick),document.addEvent("click:relay(.epg-show-link)",this._onShowLinkClick),document.addEvent("click:relay(.epg-channel-link)",this._onChannelLinkClick),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData)},_onGridMousedown:function(a){a.preventDefault()},_onKeydown:function(a){if("INPUT"!==document.activeElement.tagName)switch(a.key){case"home":a.control&&this._moveToNow.delay(100,this),a.shift&&(a.preventDefault(),this._moveToNow());break;case"left":this._onTimelineLeftClick(a);break;case"right":this._onTimelineRightClick(a)}},_onMousedown:function(a){a.preventDefault(),this.showGrid.addEvent("mousemove",this._onDrag),Browser.mouseMoveReportsWhichButton||window.addEvent("mouseout",this._onMouseout),this.dragging.wasDragged=!1,this.dragging.initialPos=this.dragging.lastPos=a.client},_onMouseup:function(a){this.showGrid.removeEvent("mousemove",this._onDrag),this.grid.addClass("not-dragging").removeClass("dragging"),Browser.mouseMoveReportsWhichButton||window.removeEvent("mouseout",this._onMouseout)},_onClick:function(a){this.dragging.wasDragged&&a.stop(),this.dragging.wasDragged=!1},_onMouseout:function(a){a.target.getClosest(".epg-show-grid")||this._onMouseup()},_onDrag:function(a){if(a.preventDefault(),Browser.mouseMoveReportsWhichButton&&!a.isMouseButtonPressed())return void this._onMouseup();if(this.dragging.wasDragged)this._onDragPaced(a.client);else{var b=Math.abs(this.dragging.initialPos.x-a.client.x),c=Math.abs(this.dragging.initialPos.y-a.client.y);Math.sqrt(Math.pow(b,2)+Math.pow(c,2))>this.options.dragMinimumDistance&&(this.dragging.wasDragged=!0,this.grid.addClass("dragging").removeClass("not-dragging"))}},_onDragPaced:function(a){var b=a.x-this.dragging.lastPos.x,c=a.y-this.dragging.lastPos.y;this._moveGridToPos(this.metrics.targetViewport.gridOffset.x+b,!1),window.scrollBy(0,-c),this.metrics.currentScrollTop=window.getScrollTop(),this.dragging.lastPos=a},_onWindowResize:function(){this._moveGridToPos(this.metrics.targetViewport.gridOffset.x,!1)},_onWindowScroll:function(){var a=window.getScrollTop();if(this.metrics.currentScrollTop!==a){this.metrics.currentScrollTop=a;var b=this.metrics.targetViewport;this.metrics.targetViewport=this._getViewport(null,b),this._updateViewport()}},_onShowLinkClick:function(a,b){if(!this.dragging.wasDragged){var c=b.get("data-series-id"),d=b.get("data-program-id"),e={title:b.getElement(".title").get("text"),showData:{programId:d,seriesId:c,internalId:b.get("data-internal-id")}};Object.merge(e,this.filter);var f={replaceHistory:!1},g="#show=detail&sid="+(c||"")+"&pid="+(d||"");Uverse.page.loadDeepLink(g,e,f),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Listings",addAction:"Program Detail",addLabel:e.title+" - "+(Uverse.page.isLoggedIn()?"Logged In":"Logged Out")})}},_onChannelLinkClick:function(a,b){a.preventDefault();var c=b.get("data-channel-number"),d=this.headers.getChannelIndexByNumber(c);-1==d?(this.currentScrollChannel=c,this.epgFilterBar.resetToDefault()):this._scrollToChannel(d)}}),Uverse.widgets.epg.GridCellController=new Class({Implements:[Callbacks,Options],options:{blockSize:{channels:5,time:144e5},renderZoneOffset:{channels:5,time:108e5},directionalOffset:{channels:6,time:144e5},gridCellsOptions:null},callbacks:{channelsListLoaded:null,channelsListLoading:null,cellBlockRendered:!1},gridLoader:null,gridCells:null,channelsList:null,currentBlocks:null,currentDirectionalOffset:{channelIndexStart:0,channelIndexEnd:0,timeStart:0,timeEnd:0},initialize:function(a,b,c){this.el=$(a),this.setOptions(b),this.setCallbacks(c),this._setupGridCells(),this._setupGridLoader(),this._setupDvrEvents()},_setupGridCells:function(){var a=this.el.getElement(".epg-show-grid"),b=this.options.gridCellsOptions;this.gridCells=new Uverse.widgets.epg.GridCells(a,b)},_setupGridLoader:function(){var a,b={channelsListLoaded:this._onChannelsListLoaded.bind(this),channelsListLoading:this._onChannelsListLoading.bind(this),onCellBlockDataReady:this._onCellBlockDataReady.bind(this)};this.gridLoader=new Uverse.widgets.epg.GridLoader(a,b)},_setupDvrEvents:function(){Uverse.page.dvr.addMemoryEvent("Dvr-dvrData",this._onDvrDataChanged.bind(this))},_onDvrDataChanged:function(){Object.each(this.currentBlocks,function(a){this.gridCells.refreshDvrDataForBlock(a)},this)},setInitialChannelsList:function(a,b){this.gridLoader.setInitialChannelsList(a,b)},updateFilter:function(a){this.gridLoader.updateFilter(a)},_onChannelsListLoading:function(){this.channelsList=null,this.callbacks.channelsListLoading()},_onChannelsListLoaded:function(a){this.channelsList=a;var b=this.currentBlocks;this._recycleOldBlocks(b),this.callbacks.channelsListLoaded(a)},updateViewport:function(a){if(!this._channelsListIsLoading()){var b=this._getRenderZoneFromViewport(a),c=this._determineBlocksInRange(b);if(this.currentBlocks){var d=this._determineNewAndOldBlocks(this.currentBlocks,c);this._recycleOldBlocks(d.oldBlocks),this._loadNewBlocks(d.newBlocks)}else this._loadNewBlocks(c)}},_channelsListIsLoading:function(){return null==this.channelsList},_getRenderZoneFromViewport:function(a){var b=this.options.renderZoneOffset,c=this.currentDirectionalOffset,d=this.options.directionalOffset;a.timeDelta<0?(c.timeStart=d.time,c.timeEnd=0):a.timeDelta>0&&(c.timeStart=0,c.timeEnd=d.time),a.channelIndexDelta<0?(c.channelIndexStart=d.channels,c.channelIndexEnd=0):a.channelIndexDelta>0&&(c.channelIndexStart=0,c.channelIndexEnd=d.channels);var e={channelIndexStart:a.channelIndexStart-b.channels-c.channelIndexStart,channelIndexEnd:a.channelIndexEnd+b.channels+c.channelIndexEnd,timeStart:a.timeStart.getTime()-b.time-c.timeStart,timeEnd:a.timeEnd.getTime()+b.time+c.timeEnd};return e},_determineNewAndOldBlocks:function(a,b){var c={diffNew:{},diffOld:{}};return Object.diff(a,b,{results:c}),{newBlocks:c.diffNew,oldBlocks:c.diffOld}},_determineBlocksInRange:function(a){for(var b=this.options.blockSize,c=this.channelsList.channels.length,d=Math.floor(Math.max(0,a.channelIndexStart)/b.channels),e=Math.ceil(Math.min(c,a.channelIndexEnd)/b.channels),f=Math.floor(a.timeStart/b.time),g=Math.ceil(a.timeEnd/b.time),h={},i=d;e>i;i++)for(var j=i*b.channels,k=j+b.channels,l=f;g>l;l++){var m=l*b.time,n={blockKey:l+"x"+i,gridRange:{channelIndexStart:j,channelIndexEnd:k,timeStart:m,timeEnd:m+b.time},epgRequest:null,cellBlockData:null,showCells:null};h[n.blockKey]=n}return h},_loadNewBlocks:function(a){if(Uverse.console.enabled){var b=Object.values(a).map(function(a){return a.blockKey});b.length&&Uverse.console.log("[GridCellController]","Adding ",b.length," blocks: ",b.join(", "))}null==this.currentBlocks&&(this.currentBlocks={}),Object.each(a,function(a){this.currentBlocks[a.blockKey]=a,this._startRequest(a)},this)},_startRequest:function(a){this.gridLoader.requestItemsForBlock(a)},_onCellBlockDataReady:function(a,b){a.cellBlockData=b,this.gridCells.renderBlock(a),this.callbacks.cellBlockRendered()},_recycleOldBlocks:function(a){if(Uverse.console.enabled){var b=Object.values(a).map(function(a){return a.blockKey});b.length&&Uverse.console.log("[GridCellController]","Recycling ",b.length," blocks: ",b.join(", "))}Object.each(a,function(a){this.gridCells.recycleBlock(a),this.gridLoader.recycleBlock(a),delete this.currentBlocks[a.blockKey]},this)}}),Uverse.widgets.epg.GridCells=new Class({Implements:[Options],Binds:["_createShowCell"],el:null,showCellSize:null,cellRecycler:null,cellTemplate:null,cellSelector:".epg-show-cell",options:{nowTime:new Date,timelineCellSeconds:1800,leftOffset:0,minShowCellWidth:50},natives:Uverse.utils.NativeUtils,initialize:function(a,b){this.el=$(a),this.setOptions(b),this._loadTemplate(),this.cellRecycler=new Uverse.utils.Recycler(this._createShowCell)},_loadTemplate:function(){var a=this.natives;this.cellTemplate=a.qs(this.cellSelector,this.el),a.removeClass(this.cellTemplate,"hidden"),this.showCellSize=a.getSize(this.cellTemplate),a.dispose(this.cellTemplate)},_createShowCell:function(){return Uverse.console.log("[GridCells]","Cloning new show cell"),this.natives.clone(this.cellTemplate)},renderBlock:function(a){Uverse.console.log("[GridCells]","Rendering block:",a.blockKey);var b=a.cellBlockData;if(null!=b){for(var c={pixelsPerSecond:this.showCellSize.x/this.options.timelineCellSeconds,nowTime:this.options.nowTime,channelTop:null,channelHeight:this.showCellSize.y},d=[],e=b.channelGuideItems.length,f=document.createDocumentFragment();e--;){var g=b.channelGuideItems[e],h=this._renderChannelData(g,d,c);f.appendChild(h)}this.el.appendChild(f),a.showCells=d}},_renderChannelData:function(a,b,c){c.channelTop=a.channelIndex*c.channelHeight;for(var d=a.guideItems.length,e=document.createDocumentFragment();d--;){var f=a.guideItems[d];f.channelNumber=a.channelNumber;var g=this._createShowCellFromGuideItem(f,c);f.renderedShowCell=g,null!==g&&(b.push(g),e.appendChild(g))}return e},_createShowCellFromGuideItem:function(a,b){var c=this.natives,d={top:b.channelTop},e=(a.startTime-b.nowTime)/1e3*b.pixelsPerSecond,f=a.duration*b.pixelsPerSecond;d.left=Math.round(e);var g=Math.round(e+f);if(d.width=g-d.left,d.left<0){var h=-this.options.leftOffset-d.left;if(d.width-=h,d.width<0)return null;d.left=-this.options.leftOffset}var i=this.cellRecycler.getObject();return c.setPxStyles(i,d),i.setAttribute("data-program-id",a.programId),i.setAttribute("data-series-id",a.seriesId),i.setAttribute("data-internal-id",a.internalId),c.toggleClass(i,"filtered",a.filtered||!1),c.toggleClass(i,"short-show",d.width<this.options.minShowCellWidth),c.setText(c.qs(".epg-show-title",i),a.programTitle),c.setText(c.qs(".epg-show-subtitle",i),a.episodeTitle||""),c.toggleClass(c.qs(".epg-show-tag.hd",i),"hidden",!a.hd),c.toggleClass(c.qs(".epg-show-tag.new",i),"hidden",!a.firstRun),this._updateShowCellDvrState(i,a),i},_updateShowCellDvrState:function(a,b){var c=this.natives,d=Uverse.page.dvr.getDvrStateForGuideItem(b),e=c.qs(".epg-show-tag.record",a);if(d){var f=!1;switch(d.recordingStatus){case Uverse.Enums.RecordingStatus.CONFLICTED:f=!0;break;case Uverse.Enums.RecordingStatus.RECORDED:case Uverse.Enums.RecordingStatus.SCHEDULED:case Uverse.Enums.RecordingStatus.NOW_RECORDING:case Uverse.Enums.RecordingStatus.UNKNOWN:}var g=!1;switch(d.recordingType){case Uverse.Enums.RecordingType.SERIES:g=!0;break;case Uverse.Enums.RecordingType.SINGLE:}c.removeClass(e,"hidden"),c.toggleClass(e,"record-conflict",f),c.toggleClass(e,"record-series",g)}else c.addClass(e,"hidden")},refreshDvrDataForBlock:function(a){a.cellBlockData&&a.showCells&&Array.each(a.cellBlockData.channelGuideItems,function(a){Array.each(a.guideItems,function(a){var b=a.renderedShowCell;b&&this._updateShowCellDvrState(b,a)},this)},this)},recycleBlock:function(a){a.showCells&&(Array.each(a.showCells,function(a){this.cellRecycler.recycle(this.natives.dispose(a))},this),a.showCells=null)}}),Uverse.widgets.epg.GridFilterBar=new Class({Extends:Uverse.widgets.FilterBar,options:{zipCodeFlyout:null,zipCodeLink:null},initialFilterSet:!1,epgInput:null,initialize:function(a,b,c){this.parent(a,b,c),this.epgInput=this.el.getElement(".epg-zipcode-input"),Uverse.page.isUverseUser()?Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this)):this._setupZipCodeWidget()},_setupZipCodeWidget:function(){if(null!=this.options.zipCodeFlyout){Uverse.page.isUserLoggedIn()&&this.el.getElement(".requires-not-logged-in").addClass("hidden");var a=this.options.zipCodeFlyout,b=this.options.zipCodeLink,c=null;this.zipCodeWidget=new Uverse.widgets.epg.ZipCode(b,a,c),Uverse.page.setupMemoryEvent("epg-zipcode",this._onZipCodeChanged.bind(this))}},_onZipCodeChanged:function(a){this.epgInput&&(this.epgInput.set("value",a),this.zipCodeWidget&&(this.options.initialFilter.zipcode=this.zipCodeWidget.zipcode)),this._setupFilter()},_onUserData:function(a){this._onZipCodeChanged(a.zip),Uverse.page.fireMemoryEvent("epg-zipcode",a.zip)},_setupFilter:function(){this.initialFilterSet?this.updateFilter():(this.initialFilterSet=!0,this.checkInitialFilter())}}),Uverse.widgets.epg.GridHeaders=new Class({Implements:[Options],Binds:["_createChannelCell","_createTimelineCell"],channelsList:null,options:{channelList:null,timeline:null,times:[],channelCellsBuffer:8,timelineCellsBuffer:5},recyclers:{channelCells:null,timelineCells:null},selectors:{channelCell:".epg-channel-cell",timelineCell:".epg-timeline-cell"},templates:{channelCell:null,timelineCell:null},metrics:{channelCellSize:null,timelineCellSize:null},natives:Uverse.utils.NativeUtils,initialize:function(a){this.setOptions(a),this._setupTemplates(),this._setupRecyclers()},updateChannelList:function(a){this.channelsList=a,this.recyclers.channelCells.recycleAll(this.options.channelList.getChildren(this.selectors.channelCell).dispose())},updateViewport:function(a,b){if(this.channelsList){var c=Math.max(0,a.channelIndexStart-this.options.channelCellsBuffer),d=Math.min(this.channelsList.channels.length,a.channelIndexEnd+this.options.channelCellsBuffer);b&&this._clearCells(this.options.channelList,this.recyclers.channelCells),this._populateCells(c,d,"offsetTop",this.metrics.channelCellSize.y,this.options.channelList,this._addChannelCell.bind(this),this.recyclers.channelCells)}var e=Math.max(0,a.timeIndexStart-this.options.timelineCellsBuffer),f=Math.min(this.options.times.length,a.timeIndexEnd+this.options.timelineCellsBuffer);b&&this._clearCells(this.options.timeline,this.recyclers.timelineCells),this._populateCells(e,f,"offsetLeft",this.metrics.timelineCellSize.x,this.options.timeline,this._addTimelineCell.bind(this),this.recyclers.timelineCells)},getChannelCellSize:function(){return this.metrics.channelCellSize},getTimelineCellSize:function(){return this.metrics.timelineCellSize},getChannelIndexByNumber:function(a){for(var b=this.channelsList.channels.length;b--;)if(this.channelsList.channels[b].channelNumber==a)return b;return-1},setTimes:function(a){this.options.times=a},_setupTemplates:function(){var a=this.natives,b=this.templates;b.channelCell=a.qs(this.selectors.channelCell,this.options.channelList),b.timelineCell=a.qs(this.selectors.timelineCell,this.options.timeline),a.removeClass(b.channelCell,"hidden"),a.removeClass(b.timelineCell,"hidden"),this.metrics.channelCellSize=a.getSize(b.channelCell),this.metrics.timelineCellSize=a.getSize(b.timelineCell),a.dispose(b.channelCell),a.dispose(b.timelineCell)},_setupRecyclers:function(){this.recyclers.channelCells=new Uverse.utils.Recycler(this._createChannelCell),this.recyclers.timelineCells=new Uverse.utils.Recycler(this._createTimelineCell)},_createChannelCell:function(){return this.natives.clone(this.templates.channelCell)},_addChannelCell:function(a){var b=this.metrics.channelCellSize.y,c=this.recyclers.channelCells.getObject(),d=this.channelsList.channels[a],e=this.natives;if(d){e.setText(e.qs(".epg-channel-number",c),d.channelNumber);var f=e.qs(".epg-channel-logo-image",c),g=e.qs(".epg-logo-missing-wrapper",c);d.channelLogo?(f.setAttribute("alt",d.channelName),f.src=d.channelLogo,e.removeClass(f,"hidden"),e.addClass(g,"hidden")):(e.addClass(f,"hidden"),e.setText(e.qs(".epg-channel-logo-missing",g),d.callLetters),e.removeClass(g,"hidden"));var h=e.qs(".tag",c);e.toggleClass(h,"hidden",!d.live),e.setPxStyles(c,{top:a*b}),c.setAttribute("data-channel-number",d.channelNumber),this.options.channelList.appendChild(c)}},_createTimelineCell:function(){return this.natives.clone(this.templates.timelineCell)},_addTimelineCell:function(a){var b=this.metrics.timelineCellSize.x,c=this.recyclers.timelineCells.getObject(),d=this.natives;d.setText(c,this.options.times[a].display),d.setPxStyles(c,{left:a*b}),this.options.timeline.appendChild(c)},_clearCells:function(a,b){var c=a.getChildren();b.recycleAll(c.dispose())},_populateCells:function(a,b,c,d,e,f,g){var h=this.natives,i=a*d,j=b*d,k=h.getChildren(e),l=0,m=0,n=k.length;for(n&&(l=m=k[0][c]);n--;){var o=k[n],p=o[c];i>p||p>j?(g.recycle(h.dispose(o)),k.splice(n,1)):(l>p&&(l=p),p>m&&(m=p))}var q,r;k.length?(q=l/d,r=m/d):(q=0,r=a-1);for(var s=a;b>s;s++)(q>s||s>r)&&f(s)}}),Uverse.widgets.epg.GridLoader=new Class({Implements:[Options,Callbacks],options:{channelsUrl:"/epg_channels.json",itemsUrl:"/epg_items.json"},callbacks:{channelsListLoaded:null,channelsListLoading:null,onCellBlockDataReady:null},channelsRequest:null,filter:null,range:null,itemsRequestRecycler:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this._setupRequests()},_setupRequests:function(){this.channelsRequest=new Request.JSON({url:this.options.channelsUrl,method:"get",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._onChannelsRequestSuccess.bind(this),autoRetry:!0}),this.itemsRequestRecycler=new Uverse.utils.Recycler(this._createItemsRequest.bind(this))},_createItemsRequest:function(){return new Request.JSON({url:this.options.itemsUrl,method:"get",headers:Uverse.config.refreshUserSessionHeaders,autoRetry:!0})},requestChannelsList:function(){this.channelsRequest.send({data:this.filter})},_onChannelsRequestSuccess:function(a){this.channelsList=a,this.callbacks.channelsListLoaded(this.channelsList)},requestItemsForBlock:function(a){var b=a.gridRange,c=this.channelsList.channels.slice(b.channelIndexStart,b.channelIndexEnd),d=c.map(function(a){return a.channelNumber}),e={channel_numbers:d,start_time:b.timeStart,end_time:b.timeEnd};Object.merge(e,this.filter),e=Object.toQueryStringFlat(e);var f=this.itemsRequestRecycler.getObject();f.addEvent("complete:once",function(b){this.itemsRequestRecycler.recycle(f),a.epgRequest=null,void 0===b?Uverse.console.error("[GridLoader]","JSON response was empty"):this._processBlockData(b),this.callbacks.onCellBlockDataReady(a,b)}.bind(this)),f.send({data:e}),a.epgRequest=f},recycleBlock:function(a){var b=a.epgRequest;b&&(Uverse.console.log("[GridLoader]","Cancelling epgRequest for block ",a.blockKey),b.cancel(),b.removeEvents("complete:once"),this.itemsRequestRecycler.recycle(b),a.epgRequest=null)},_processBlockData:function(a){this._addChannelIndexToChannelData(a)},_addChannelIndexToChannelData:function(a){var b=this.channelsList.channels.map(function(a){return a.channelNumber});a.channelGuideItems.each(function(a){a.channelIndex=b.indexOf(a.channelNumber)},this)},setInitialChannelsList:function(a,b){this.initialChannelsList=a,this.initialFilter=b},updateFilter:function(a){Uverse.console.log("[GridLoader]","Filter is being updated:",a),Object.areEqual(this.filter,a)||(this.callbacks.channelsListLoading(),Object.areEqual(this.initialFilter,a)?(this.filter=this.initialFilter,this._onChannelsRequestSuccess(this.initialChannelsList)):(this.filter=a,this.requestChannelsList()))}}),Uverse.widgets.epg.RecordingOptions=new Class({Implements:[Options,Callbacks],Binds:["_onRecordButtonClick","_onCancelButtonClick","_onEraseButtonClick"],el:null,callbacks:{eraseSuccess:!1,cancelSuccess:!1},options:{messages:{pageBlockerMessage:null,recordFail:null,recordEpisodeFail:null,updateFail:null,eraseFail:null,tryAgain:null},flyoutOptions:{parentEdge:{x:"left",y:"top"},flyoutEdge:{x:"right",y:"top"},flyoutOffset:{x:0,y:-24}}},contentEls:{seriesOptions:null,programOptions:null,eraseOptions:null,authenticatedFlyout:null},recordOptionDefaults:{series:{programInfoKeys:"",showTypeRecordingOption:"ANY",airtimeRecordingOption:"ANYTIME_ONCE_PER_DAY",endRecordingOption:"AT_SCHEDULED_TIME",keepRecordingOption:"SPACE_IS_NEEDED"},single:{endRecordingOption:"AT_SCHEDULED_TIME",keepRecordingOption:"SPACE_IS_NEEDED"}},initialize:function(a,b,c){this.el=a,this.setOptions(b),this.setCallbacks(c),this._setupElements(),this._setupEvents()},_setupElements:function(){this.contentEls.seriesOptions=this.el.getElement(".epg-record-series-options"),this.contentEls.seriesOptions&&this.contentEls.seriesOptions.dispose(),this.contentEls.programOptions=this.el.getElement(".epg-record-program-options"),this.contentEls.programOptions&&this.contentEls.programOptions.dispose(),this.contentEls.eraseOptions=this.el.getElement(".epg-erase-options"),this.contentEls.eraseOptions&&this.contentEls.eraseOptions.dispose(),this.contentEls.authenticatedFlyout=this.el.getElement(".authenticated-flyout-record-button"),this.contentEls.authenticatedFlyout&&this.contentEls.authenticatedFlyout.dispose(),this.confirmationModalTemplate=this.el.getElement(".epg-erase-series-confirmation-template"),this.confirmationModalTemplate&&this.confirmationModalTemplate.dispose().removeClass("hidden")},_setupEvents:function(){this.el.addEvent("click:relay(.program-details-button.record)",this._onRecordButtonClick),this.el.addEvent("click:relay(.program-details-button.options)",this._onRecordButtonClick),this.el.addEvent("click:relay(.control-epg-cancel)",this._onCancelButtonClick),this.el.addEvent("click:relay(.control-epg-erase:not(.disabled))",this._onEraseButtonClick)},_onRecordButtonClick:function(a,b){a.preventDefault();var c=b,d=c.retrieve("flyout")||this._createFlyout(c);d.toggle()},_onFlyoutLoading:function(a,b,c,d){var e=b.getClosest(".has-program-info"),f=e.get("data-program-info-keys");if(a.getValues().programInfoKeys||a.setValue("programInfoKeys",f),c){var g={},h,i=e.get("data-start-time"),j=e.get("data-end-time"),k={channelNumber:e.get("data-channel"),programId:e.get("data-program-id"),startTime:i};if(k.programId&&"0"!=k.programId)h=Uverse.page.dvr.getDvrStateForGuideItem(k);else{var l=e.get("data-group-ids");h=Uverse.page.dvr.getDvrStateForGroup(l)}h&&(g={showTypeRecordingOption:h.dvrGroup.showTypeRecordingOption,airtimeRecordingOption:h.dvrGroup.airtimeRecordingOption,endRecordingOption:h.dvrGroup.endRecordingOption,keepRecordingOption:h.dvrGroup.keepRecordingOption,programInfoKeys:f}),a.setValues(g);var m=(new Date).getTime();m>i&&j>m&&(d.getElements(".U-control").addClass("disabled"),b.addClass("now-recording"))}else b.hasClass("series")?(null==b.get("data-default-channels")&&b.set("data-default-channels",a.getValues().programInfoKeys),this.recordOptionDefaults.series.programInfoKeys=b.get("data-default-channels"),a.setValues(this.recordOptionDefaults.series)):a.setValues(this.recordOptionDefaults.single)},_onRecordSubmit:function(a,b,c){if(!a.hasClass("now-recording")){var d=a.hasClass("options"),e=Object.merge({scheduleIntention:d?Uverse.Enums.ScheduleIntention.MODIFY:Uverse.Enums.ScheduleIntention.NEW},c),f=a.retrieve("flyout");if(d){var g=a.getClosest(".has-program-info"),h=g.get("data-recording-id"),i=g.get("data-group-ids");"0"==h&&(e.groupId=i),this._updateProgram(e,f)}else this._recordProgram(e,f,a.hasClass("episode"));f.hide()}},_recordProgram:function(a,b,c){var d={recordSuccess:this._onRecordSuccess.bind(this,a,b),recordFailure:this._onRecordFailure.bind(this,a,b,c)};Uverse.page.dvr.recordProgram(a,d),Uverse.page.pageBlocker.show(this.options.messages.pageBlockerMessage,!1)},_onRecordSuccess:function(a,b){Uverse.page.pageBlocker.hide(),b.hide()},_onRecordFailure:function(a,b,c){Uverse.page.pageBlocker.hide();var d=c?this.options.messages.recordEpisodeFail:this.options.messages.recordFail;Uverse.page.showToast({message:d,button:{text:this.options.messages.tryAgain,action:this._recordProgram.bind(this,a,b,c)}})},_updateProgram:function(a,b){var c={recordSuccess:this._onUpdateSuccess.bind(this,a,b),recordFailure:this._onUpdateFailure.bind(this,a,b)};Uverse.page.dvr.recordProgram(a,c),Uverse.page.pageBlocker.show(this.options.messages.pageBlockerMessage,!1)},_onUpdateSuccess:function(a,b){Uverse.page.pageBlocker.hide(),b.hide()},_onUpdateFailure:function(a,b){Uverse.page.pageBlocker.hide(),Uverse.page.showToast({message:this.options.messages.updateFail,button:{text:this.options.messages.tryAgain,action:this._updateProgram.bind(this,a,b)}})},_onCancelButtonClick:function(a,b){a.preventDefault();var c=b,d=c.hasClass("series"),e=c.hasClass("has-flyout"),f=c.getClosest(".has-program-info"),g=f.get("data-recording-id"),h=f.get("data-group-ids"),i={eraseIntention:Uverse.Enums.EraseIntention.CANCEL,eraseSeries:!1,stopSeries:d};if(g&&"0"!=g?i.recordingIds=[g]:i.groupIds=h.split(","),e){var j=c.retrieve("flyout")||this._createFlyout(c);j.toggle()}else this._cancelProgram(i)},_cancelProgram:function(a){var b={eraseSuccess:this._onCancelSuccess.bind(this,a),eraseFailure:this._onCancelFailure.bind(this,a)};Uverse.page.dvr.eraseRecording(a,b),Uverse.page.pageBlocker.show(this.options.messages.pageBlockerMessage,!1)},_onCancelSuccess:function(a){Uverse.page.pageBlocker.hide(),this.callbacks.cancelSuccess&&this.callbacks.cancelSuccess()},_onCancelFailure:function(a){Uverse.page.pageBlocker.hide(),Uverse.page.showToast({message:this.options.messages.eraseFail,button:{text:this.options.messages.tryAgain,action:this._cancelProgram.bind(this,a)}})},_onEraseButtonClick:function(a,b){a.preventDefault();var c=b;this._setRecordingIds(c);var d=c.getClosest(".has-program-info"),e={eraseIntention:Uverse.Enums.EraseIntention.DELETE,eraseSeries:!1,stopSeries:!1,recordingIds:[d.get("data-recording-id")]};this._eraseProgram(e)},_setRecordingIds:function(a){if(!a.get("data-recording-ids")){var b=a.get("data-erase-type"),c;switch(b){case"group":c=a.getClosest(".epg-table-item").getElements(".epg-table-content-row").get("data-recording-id").join(",");break;case"group-single":c=a.getClosest(".epg-table-content-row").get("data-recording-id");break;case"single":c=a.getClosest(".has-program-info").get("data-recording-id")}a.set("data-recording-ids",c)}},_createFlyout:function(a){var b={relativeTo:a};Object.merge(b,this.options.flyoutOptions),(a.hasClass("control-epg-cancel")||a.hasClass("control-epg-erase"))&&(b.flyoutOffset.y=0,b.parentEdge.y=b.flyoutEdge.y="center");var c,d,e,f={},g={};if(Uverse.page.isUverseUser()){var h=a.hasClass("control-epg-erase");if(h)d=a.get("data-erase-type"),c=this._renderFlyout(d),g={submit:this._onEraseSubmit.bind(this,a)};else if(a.hasClass("control-epg-cancel"))d=a.get("data-erase-type"),c=this._renderFlyout(d),g={submit:this._onCancelSubmit.bind(this,a)};else{var i=a.hasClass("series"),j=a.getClosest(".has-program-info").getElement(".epg-record-series-options");c=j?j.clone():i?this.contentEls.seriesOptions.clone():this.contentEls.programOptions.clone(),a.hasClass("now-recording")&&c.getElements(".U-control").addClass("disabled"),g={submit:this._onRecordSubmit.bind(this,a)},e=a.hasClass("options"),c.getElements(".channel, .episode, .start-time").toggleClass("disabled",e),c.getElements(".schedule").toggleClass("hidden",e),c.getElements(".save").toggleClass("hidden",!e),c.getElements(".set-time").each(function(a){var b=new Date(a.get("data-time-value").toInt());a.set("text",b.format(a.get("data-time-format")))})}var k=new Uverse.controls.Form(c.getElement("form"),g);h||(f={flyoutLoading:this._onFlyoutLoading.bind(this,k,a,e)})}else c=this.contentEls.authenticatedFlyout.clone();a.getClosest(".epg-table-cell, .has-program-info").adopt(c);var l=new Uverse.widgets.Flyout(c,b,f);return a.store("flyout",l),l},_renderFlyout:function(a){var b=this.contentEls.eraseOptions.clone();switch(a){case"group":b.getElement(".flyoutType-group").removeClass("hidden").addClass("single-row");break;case"single":b.getElement(".flyoutType-single").removeClass("hidden");break;case"group-single":b.getElements(".flyoutType-single, .flyoutType-group").removeClass("hidden")}return b},_onEraseSubmit:function(a,b,c){var d=a.get("data-recording-ids").split(","),e=this._getGroupId(a),f=Object.merge({recordingIds:d,groupId:e,stopSeries:!1,eraseSeries:null,eraseIntention:null},c);if("true"===f.eraseSeries){var g=this._createConfirmationContent(a,f);this._showEraseConfirmation(g)}else this._eraseProgram(f);a.retrieve("flyout").hide()},_onCancelSubmit:function(a,b,c){var d=a.getClosest(".has-program-info").get("data-recording-id"),e=this._getGroupId(a),f=Object.merge({recordingIds:[d],groupId:e,stopSeries:!1,eraseSeries:null,eraseIntention:null},c);if("true"===f.eraseSeries){var g=this._createConfirmationContent(a,f);this._showEraseConfirmation(g)}else this._cancelProgram(f);a.retrieve("flyout").hide()},_getGroupId:function(a){var b=a.getClosest(".has-group-id").get("data-group-id"),c=a.get("data-erase-type");return b&&b.length&&"group"===c?b:null},_createConfirmationContent:function(a,b){var c=this.confirmationModalTemplate.clone(),d=c.getElement("form"),e={submit:this._onConfirmationSubmit.bind(this,b)},f=null,g=new Uverse.controls.Form(d,e,f),h=a.getClosest(".has-program-info")||a.getClosest(".has-group-id"),i=h.get("data-erase-count"),j=h.get("data-erase-title");return""===i||""===j?Uverse.console.error("[RecordingsTable]","Could not find the erase-count and erase-title"):(c.getElements(".erase-count").set("text",i),c.getElements(".erase-title").set("text",j),i>1?c.getElement(".message-multiple").removeClass("hidden"):c.getElement(".message-single").removeClass("hidden")),c},_showEraseConfirmation:function(a){var b=null,c={},d=new Uverse.widgets.Modal(a,b,c);Uverse.page.loadPlayerModal(d)},_onConfirmationSubmit:function(a,b,c){c.confirmButton&&(a.stopSeries=c.stopSeries,this._eraseProgram(a)),Uverse.page.closeCurrentModal()},_eraseProgram:function(a){var b={eraseSuccess:this._onEraseSuccess.bind(this,a),eraseFailure:this._onEraseFailure.bind(this,a)};Uverse.page.dvr.eraseRecording(a,b),Uverse.page.pageBlocker.show(this.options.messages.pageBlockerMessage)},_onEraseSuccess:function(a){Uverse.page.pageBlocker.hide(),this.callbacks.eraseSuccess()},_onEraseFailure:function(a){Uverse.page.pageBlocker.hide(),Uverse.page.showToast({message:this.options.messages.eraseFail,button:{text:this.options.messages.tryAgain,action:this._eraseProgram.bind(this,a)}})}}),Uverse.Enums.RecordingsViewType={RECORDED:"RECORDED",SCHEDULED:"SCHEDULED",SEARCH:"SEARCH"},Uverse.widgets.epg.RecordingsTable=new Class({Implements:[Options],Binds:["_onShowTitleClick","_onFilterChanged","_onUserData","_onDvrDataChanged"],options:{viewType:null,params:null,recordedUrl:"/dvr/recorded.html",scheduledUrl:"/dvr/scheduled.html",searchUrl:"/search/searchEPGTable.html",messages:{pageBlockerMessage:null,eraseFail:null,tryAgain:null}},elements:{contents:null,table:null,overlay:null},transitions:{shown:{props:["opacity"]}},el:null,filterBar:null,itemsUrl:null,tableRequest:null,errorMessage:null,restorePreviousIndex:null,initialize:function(a,b){this.el=a,this.setOptions(b),this._setupViewParams(),this._setupElements(),this._setupEvents(),this._setupTableRequest(),this._setupFilterBar(),this._setupRecordingOptions(),this._postInitialize()},_postInitialize:function(){var a=this.filterBar&&Uverse.page.isLoggedIn();a?this._showOverlay():this._onFilterChanged({})},_setupViewParams:function(){switch(this.options.viewType){case Uverse.Enums.RecordingsViewType.RECORDED:this.itemsUrl=this.options.recordedUrl;break;case Uverse.Enums.RecordingsViewType.SCHEDULED:this.itemsUrl=this.options.scheduledUrl;
break;case Uverse.Enums.RecordingsViewType.SEARCH:this.itemsUrl=this.options.searchUrl}},_setupElements:function(){this.elements.table=this.el.getElement(".recordings-table"),this.elements.contents=this.el.getElement(".recordings-table-contents"),this.elements.overlay=this.el.getElement(".epg-overlay")},_setupEvents:function(){document.addEvent("click:relay(.epg-show-link)",this._onShowTitleClick),Uverse.page.dvr.addMemoryEvent("Dvr-dvrData",this._onDvrDataChanged),Uverse.page.dvr.addMemoryEvent("Dvr-dvrDataFailure",this._onDvrDataChanged),Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData)},_setupRecordingOptions:function(){var a={messages:{pageBlockerMessage:this.options.messages.pageBlockerMessage,recordFail:this.options.messages.recordFail,updateFail:this.options.messages.updateFail,eraseFail:this.options.messages.eraseFail,tryAgain:this.options.messages.tryAgain}},b={eraseSuccess:this._onEraseSuccess.bind(this),cancelSuccess:this._onCancelSuccess.bind(this)};this.recordingOptions=new Uverse.widgets.epg.RecordingOptions(this.elements.table,a,b)},_onDvrDataChanged:function(){this.filterBar&&this.filterBar.checkInitialFilter()},_onEraseSuccess:function(){this._setRestoreIndex()},_onCancelSuccess:function(){this._setRestoreIndex()},_setRestoreIndex:function(){this.restorePreviousIndex=this.accordion&&!this.accordion.isCurrentIndexSingle()?this.accordion.getCurrentIndex():null},_onShowTitleClick:function(a,b){if(!a.target.getClosest(".no-modal")){var c=b.getClosest(".has-program-info");if(c){var d=c.get("data-series-id"),e=c.get("data-program-id"),f=c.get("data-internal-id"),g=c.getElement(".title").get("text"),h={title:g,showData:{programId:e,seriesId:d,internalId:f}},i={replaceHistory:!1},j="#show=detail&sid="+(d||"")+"&pid="+(e||"");Uverse.page.loadDeepLink(j,h,i)}}},_setupFilterBar:function(){var a={},b={filterChanged:this._onFilterChanged},c=this.el.getElement(".epg-filter-bar");c&&(this.filterBar=new Uverse.widgets.epg.GridFilterBar(c,a,b))},_onFilterChanged:function(a){Uverse.console.log("[RecordingsTable]","New filter selected: ",Object.toQueryString(a));var b=Object.merge({},this.options.params,a);this.tableRequest.send({data:b}),this._showOverlay()},_onUserData:function(a){var b=a.username;this.el.getElements(".current-user-name").set("html",b)},_setupTableRequest:function(){this.tableRequest=new Request({url:this.itemsUrl,method:"GET",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:this._onTableRequestSuccess.bind(this),onFailure:this._onTableRequestFailure.bind(this)})},_onTableRequestFailure:function(a){var b=a.responseText;this._onTableRequestSuccess(b)},_onTableRequestSuccess:function(a){Uverse.console.log("[RecordingsTable]","Table contents set");var b=this.el.getElement(".epg-user-search");this.elements.contents.set("html",a);var c=this.elements.contents.getElement(".epg-table");c&&this.options.viewType!==Uverse.Enums.RecordingsViewType.SCHEDULED?(this.accordion=new Uverse.widgets.Accordion(this.elements.contents.getElement(".epg-table"),{duration:400,contentSelector:".epg-table-content",subItemSelector:".epg-table-content-row",contentWrapSelector:".epg-table-content-wrap",offsetTop:100,firstOpen:!1,singleOpenOnly:!1,scrollToActive:!1,activeOpenIsCollapsible:!0}),null!==this.restorePreviousIndex&&this.accordion.setActive(this.restorePreviousIndex)):this.accordion=null,this.restorePreviousIndex=null;var d=this.elements.contents.getElement(".epg-user-search");if(d){var e=b.getParent();b.dispose(),e.adopt(d)}this._hideOverlay()},_showOverlay:function(){this.elements.overlay.removeClass("hidden").addClassWithTransition("shown",this.transitions.shown)},_hideOverlay:function(){this.elements.overlay.removeClassWithTransition("shown",this.transitions.shown).morphChain(function(){this.elements.overlay.addClass("hidden")}.bind(this))}}),Uverse.widgets.epg.ShowDetailsModal=new Class({Extends:Uverse.widgets.Modal,Implements:[Options],options:{url:"/epg-item-details.html",title:null,containerId:"programDetailsTemplate",programId:null,seriesId:null,zipcode:null,showData:{programId:null,seriesId:null,internalId:null}},container:null,loadingSpinner:null,errorMessage:null,initialize:function(a){this.setOptions(a),this.container=$(this.options.containerId).clone().removeClass("hidden").addClass("program-details-modal"),this.loadingSpinner=this.container.getElement(".program-details-loading-spinner"),this.errorMessage=this.container.getElement(".epg-details-error");var b=this._getModalOptions(),c={};this.parent(this.container,b,c),this.showTitle=this.options.title,this._onModalOpen(),this._setupModal()},_setupModal:function(){this.container.getElement(".program-details-title").set("text",this.showTitle)},_getModalOptions:function(){var a={className:"modal-container-for-program-details",requestOptions:{url:this.options.url,headers:Uverse.config.refreshUserSessionHeaders,method:"GET",data:{programId:this.options.showData.programId||this.options.programId,seriesId:this.options.showData.seriesId||this.options.seriesId,internalId:this.options.showData.internalId,zipcode:this.options.zipcode},onFailure:this._onRequestFailure.bind(this)}};return a},_onModalOpen:function(){this.loadingSpinner.removeClass("hidden"),this.errorMessage.addClass("hidden")},_onRequestFailure:function(){this.loadingSpinner.addClass("hidden"),this.errorMessage.removeClass("hidden").getElements(".error-show-title").set("text",this.showTitle)}}),Uverse.widgets.epg.ZipCode=new Class({Implements:[Options],options:{zipUrl:"/epg_validate_zip_code.json"},initialize:function(a,b,c){this.setOptions(c),this.zipCodeLink=a,this.zipCodeFlyout=b,this._setupFlyout(),this._setupZipCodeForm(),this._setupRequest(),this._setupKeyValidator(),Uverse.page.setupMemoryEvent("epg-zipcode",this._setInitialZipState.bind(this))},_setInitialZipState:function(a){this.zipcode=a,this.flyoutForm.setValue("zipcode",this.zipcode),this.zipCodeLink.set("text",this.zipcode)},_setupFlyout:function(){var a={relativeTo:this.zipCodeLink,parentEdge:{x:"center",y:"bottom"},flyoutEdge:{x:"center",y:"top"}},b={flyoutLoading:this._flyoutLoading.bind(this)};this.flyout=new Uverse.widgets.Flyout(this.zipCodeFlyout,a,b),this.zipCodeLink.addEvents({click:this._linkClicked.bind(this)})},_linkClicked:function(a){a.preventDefault(),this.flyout.toggle()},_flyoutLoading:function(){this.flyoutForm.focusFirst()},_setupZipCodeForm:function(){var a=this.zipCodeFlyout.getElement("form"),b={changing:this._onZipChanging.bind(this),submit:this._onZipSubmit.bind(this)};this.flyoutForm=new Uverse.controls.Form(a,b)},_setupKeyValidator:function(){this.zipCodeFlyout.getElement(".zipcode-textbox").addEvents({keydown:this._keyValidator})},_keyValidator:function(a){(isNaN(a.key)&&(1===a.key.length||"space"===a.key)||a.shift)&&a.preventDefault()},_onZipChanging:function(a,b,c,d){this.zipIsValid=!1,this.submitWasClicked=!1,this.zipcode=c,this._toggleError(!1),this._zipCodeLooksValid()?(this._enableButtonImage(),this._validateZip()):this._disableButtonImage()},_zipCodeLooksValid:function(){var a=/^\d{5}$/;return a.test(this.zipcode)},_onZipSubmit:function(a){this.submitWasClicked=!0,this._submitIfReady(),Uverse.page.clickTrack(a.target,{addCategory:"TV Listings",addSubcategory:"Toolbar",addAction:"Update Zip Code",addLabel:this.zipcode})},_setupRequest:function(){this.zipCodeRequest=new Request.JSON({url:this.options.zipUrl,method:"get",onSuccess:this._requestSuccess.bind(this),autoRetry:!0})},_validateZip:function(){var a={zipcode:this.zipcode};this.zipCodeRequest.send({data:a})},_requestSuccess:function(a){this.zipIsValid=a.hasEpgInfo,this.zipIsValid?(this._enableButtonImage(),this._toggleError(!1),this._submitIfReady()):(Uverse.console.warn("[ZipCode]","Zip code was invalid:",a),this._toggleError(!0,this.zipcode),this._disableButtonImage())},_submitIfReady:function(){this.zipIsValid&&this.submitWasClicked&&this._updateZipCode()},_updateZipCode:function(){Uverse.page.updateCustomZipCode(this.zipcode),this.zipCodeLink.set("text",this.zipcode),this.flyout.hide()},_enableButtonImage:function(){this.flyoutForm.getControlByName("submit").setState("disabled",!1)},_disableButtonImage:function(){this.flyoutForm.getControlByName("submit").setState("disabled",!0)},_toggleError:function(a,b){this.zipCodeFlyout.getElement(".invalid-zip").toggleClass("hidden",!a),this.zipCodeFlyout.getElement(".zipcode-textbox").toggleClass("control-invalid",a),b&&this.zipCodeFlyout.getElement(".invalid-zip-text").set("text",b)}}),Uverse.widgets.marketing.MarketingModule=new Class({Implements:[Options],options:{applyOwnBinding:!1},viewModel:null,initialize:function(a,b,c){this.el=a,this.setOptions(b),this.viewModel=c,this._setupViewModel(),this.options.applyOwnBinding||ko.applyBindingsToDescendants(this.viewModel,this.el)},_setupViewModel:function(){this.viewModel.getLinkTarget=function(a){return a?"_blank":!1}.bind(this),this.viewModel.doHeaderItemsExist=ko.computed(function(){return this.viewModel.promoLink?this.viewModel.title||this.viewModel.promoText||this.viewModel.promoLink.linkMetadata:!1},this)}}),Uverse.widgets.marketing.BannerModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,options:{endpoint:"/getBannerCampaign.json"},viewModel:null,initialize:function(a,b,c){this.parent(a,b,c),this.campaignId=c[0].value,this._setupBannerRequest()},_setupViewModel:function(){this.parent();var a={link:"",imageUrl:"",externalLink:!1};this.viewModel.banner=ko.observable(a)},_setupBannerRequest:function(){this.bannerRequest=new Request.JSON({url:this.options.endpoint,method:"get",onSuccess:this._bannerRequestSuccess.bind(this),autoRetry:!0}),this._sendRequest()},_sendRequest:function(){var a={campaignId:this.campaignId};this.bannerRequest.send({data:a})},_bannerRequestSuccess:function(a){var b=a.campaigns[0].banners;this.viewModel.banner(b[0])}}),Uverse.widgets.marketing.CardsModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,options:{displayCountdown:!1,applyOwnBinding:!0},viewModel:null,initialize:function(a,b,c){this.parent(a,b,c),this._setupCardController(),ko.applyBindingsToDescendants(this.viewModel,this.el)},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController({displayCountdown:this.options.displayCountdown}),this.viewModel.cardController=this.cardController}}),Uverse.widgets.marketing.DisclaimerModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,viewModel:null,initialize:function(a,b,c){this.parent(a,b,c)}}),Uverse.widgets.marketing.FooterModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,initialize:function(a,b,c){this.parent(a,b,c)}}),Uverse.widgets.marketing.HeroModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,options:{bgOpacity:".6",defaultBG:"transparent",regexHex:/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/},viewModel:null,initialize:function(a,b,c){this.parent(a,b,c)},_setupViewModel:function(){var a=this;this.viewModel.getRgbaColor=function(b){if(!a.options.regexHex.test(b))return a.options.defaultBG;var c=b.hexToRgb(!0),d=c.append([a.options.bgOpacity]);return"rgba("+d.join(",")+")"}}}),Uverse.widgets.marketing.IFrameModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,options:{},viewModel:null,initialize:function(a,b,c){this.parent(a,b,c)}}),Uverse.widgets.marketing.StandardModule=new Class({Extends:Uverse.widgets.marketing.MarketingModule,options:{endpoints:{validateZip:"/epg_validate_zip_code.json",channelsData:"/epg_channels.json"},liveChannelsMap:{byChannelName:{east:["(CBS)"],west:[]},byCallLetters:{east:["TNT","TNTHD","TBS","TBS HD","TRU","TRU HD"],west:["TNT-W","TNTHDW","TBS-W","TBSHDW","TRU-W"]}},liveChannelsGroups:["TBS","TRU","TNT","CBS"],defaultZipCode:30308},viewModel:null,zipInput:null,flyout:null,zipcode:null,initialize:function(a,b,c){this.parent(a,b,c),this._setupFlyout(),this._setupZipCodeForm(),this._setupZipCodeRequest(),this._setupValidateZipCodeRequest(),this.viewModel.isLoggedIn()?Uverse.page.addMemoryEvent("Personalization-userData",this._onUserData.bind(this)):Uverse.page.setupMemoryEvent("epg-zipcode",this._updateZipState.bind(this))},_updateZipState:function(a){this.viewModel.realZipCode(a),0===this.viewModel.zipCode().length&&this.viewModel.zipCode(a),this._onZipCodeChanged(a)},_onUserData:function(a){this.viewModel.username(a.username),this._updateZipState(a.zip)},_setupViewModel:function(){this.parent();var a=this;this.viewModel.getImageAlignmentClass=function(a){return"LEFT"===a?"image-left":"image-right"},this.viewModel.dataDashFriendly=function(b){return"string"!=typeof b?"":a._htmlencode(b.replace(">","::"))},this._setupObservables()},_setupObservables:function(){this.viewModel.zipCode=ko.observable(""),this.viewModel.realZipCode=ko.observable(""),this.viewModel.username=ko.observable(""),this.viewModel.channels=ko.observableArray([]),this.viewModel.isLoading=ko.observable(!0),this.viewModel.hasChannels=ko.observable(!0),this.viewModel.isLoggedIn=ko.observable(Uverse.page.isLoggedIn())},_htmlencode:function(a){return a.replace(/[&<>"']/g,function(a){return"&"+{"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#39"}[a]+";"})},_setupFlyout:function(){this.zipCodeFlyout=this.el.getElement(".zipcode-flyout"),this.zipCodeLink=this.el.getElement(".zipcode-link"),this.zipInput=this.el.getElement(".zipcode-input");var a={relativeTo:this.zipCodeLink,parentEdge:{x:"center",y:"bottom"},flyoutEdge:{x:"center",y:"top"}},b={flyoutLoading:this._flyoutLoading.bind(this)};this.flyout=new Uverse.widgets.Flyout(this.zipCodeFlyout,a,b),this.viewModel.linkClicked=this._toggleFlyout.bind(this)},_toggleFlyout:function(a,b){b.preventDefault(),this.flyout.relativeTo=this.el.getElement(".zipcode-link"),this.flyout.toggle()},_flyoutLoading:function(){this.flyoutForm.focusFirst()},_setupZipCodeForm:function(){var a=this.zipCodeFlyout.getElement("form"),b={changing:this._onZipChanging.bind(this),submit:this._onZipSubmit.bind(this)};this.flyoutForm=new Uverse.controls.Form(a,b),this._setupKeyValidator()},_setupKeyValidator:function(){this.zipCodeFlyout.getElement(".zipcode-textbox").addEvents({keydown:this._keyValidator})},_keyValidator:function(a){(isNaN(a.key)&&(1===a.key.length||"space"===a.key)||a.shift)&&a.preventDefault()},_onZipChanging:function(a,b,c,d){this.zipLooksValid=!1,this._toggleError(!1),this._zipCodeLooksValid(c)?(this.zipLooksValid=!0,this.zipcode=c,this._enableButtonImage()):this._disableButtonImage()},_zipCodeLooksValid:function(a){var b=/^\d{5}$/;return b.test(a)},_onZipSubmit:function(a){a.preventDefault(),this.viewModel.isLoading(!0),this.zipLooksValid&&this.viewModel.zipCode()!==this.viewModel.realZipCode()?this._sendValidateZipRequest():(this.viewModel.isLoading(!1),this.flyout.hide())},_sendValidateZipRequest:function(){this.viewModel.zipCode(this.zipcode);var a={zipcode:this.zipcode};this.zipValidateCodeRequest.send({data:a})},_validateZipCodeRequestSuccess:function(a){this.zipIsValid=a.hasEpgInfo,this.zipIsValid?this._updateZipCode():(Uverse.console.warn("[ZipCode]","Zip code was invalid:",a),this.viewModel.isLoading(!1),this._toggleError(!0,this.zipcode),this._disableButtonImage())},_updateZipCode:function(){this._updateZipState(this.zipcode)},_enableButtonImage:function(){this.flyoutForm.getControlByName("submit").setState("disabled",!1)},_disableButtonImage:function(){this.flyoutForm.getControlByName("submit").setState("disabled",!0)},_toggleError:function(a,b){this.zipCodeFlyout.getElement(".invalid-zip").toggleClass("hidden",!a),this.zipCodeFlyout.getElement(".zipcode-textbox").toggleClass("control-invalid",a),b&&this.zipCodeFlyout.getElement(".invalid-zip-text").set("text",b)},_onZipCodeChanged:function(a){this.zipcode=a;var b={zipcode:this.zipcode};this.zipCodeRequest.send({data:b})},_setupValidateZipCodeRequest:function(){this.zipValidateCodeRequest=new Request.JSON({url:this.options.endpoints.validateZip,method:"get",onSuccess:this._validateZipCodeRequestSuccess.bind(this),autoRetry:!0})},_setupZipCodeRequest:function(){this.zipCodeRequest=new Request.JSON({url:this.options.endpoints.channelsData,method:"get",onSuccess:this._zipCodeRequestSuccess.bind(this),autoRetry:!0})},_zipCodeRequestSuccess:function(a){var b=a.channels;this.viewModel.isLoading(!1),this.viewModel.hasChannels(this._filterChannels(b)),this.flyout.hide()},_filterChannels:function(a){var b=this;this.viewModel.channels().length>0&&this.viewModel.channels.removeAll();var c=[],d=[],e=!1,f=!1,g=this.options.liveChannelsMap,h=this.options.liveChannelsGroups;a.each(function(a,b){var h={callLetters:a.callLetters,channelLogo:a.channelLogo,channelNumber:a.channelNumber,channelName:a.channelName};e=g.byChannelName.east.some(function(a){return h.channelName.indexOf(a)>=0}),f=g.byChannelName.west.some(function(a){return h.channelName.indexOf(a)>=0}),-1!==g.byCallLetters.east.indexOf(h.callLetters)||e?c.push(h):(-1!==g.byCallLetters.west.indexOf(h.callLetters)||f)&&d.push(h)});var i=c.length>0?c:d;return h.each(function(a){var c=i.filter(function(b){return b.callLetters.indexOf(a)>=0||b.channelName.indexOf(a)>=0});if(c.length>0){var d={channelLogo:c[0].channelLogo,channelNumber:c[0].channelNumber,callLetters:c[0].callLetters,channelNumberHD:"",callLettersHD:""};c[1]&&(d.channelNumberHD=c[1].channelNumber,d.callLettersHD=c[1].callLetters),b.viewModel.channels.push(d)}}),this.viewModel.channels().length>0?!0:!1}}),Uverse.playerExtensions.ExtensionAware=new Class({Implements:[Options,Callbacks,Events],options:{},callbacks:{complete:null},playerLoading:function(a){this.callbacks.complete()},playerLoaded:function(a,b){},playerFinished:function(){},destroyExtension:function(){},updatePanelTitle:function(a,b){a.getElement(".player-extension-title").set("html",b)}}),Uverse.players.Player=new Class({Implements:[Options,Events],scriptLoaded:!1,options:{swfWidth:880,swfHeight:495,large:!1,playerConfig:null},AD_CLASS_LARGE:"large",AD_CLASS_SMALL:"small",AD_TYPE:{PRE:"preroll",MID:"midroll",POST:"postroll"},playerSizes:{height:496,smallWidth:560,largeWidth:880},swfObject:null,versionKey:null,videoPlaying:!1,adPlaying:!1,ready:!1,contentStarted:!1,companionAdIDOriginal:"companionAdContainer",companionAdID:"companionAdContainer",streamToken:null,playToken:null,heartbeat:null,currentSegment:null,totalSegments:null,initialize:function(a,b){this.el=$(a),this.setOptions(b),this.options.large&&this.el.addClass("large"),this.swiffOptions={width:this.options.swfWidth,height:this.options.swfHeight,vars:this.options.vars||{},params:Object.merge({allowFullscreen:!0,bgColor:"#000000"},this.options.swiffOptions),callBacks:{onInit:this.onPlayerReady.bind(this)}},this.adComponent=this.options.companionAdEl},getEnvironmentConfigValue:function(a){return this.options.playerConfig?this.options.playerConfig[a]:null},mergeEnvironmentConfigWithObject:function(a){Object.merge(a,this.options.playerConfig)},_addIDToCompanionAdEl:function(){this.adComponent&&this.companionAdID&&this._hasCompanionAdIDChanged()&&this.adComponent.set("id",this.companionAdID)},_hasCompanionAdIDChanged:function(){return this.companionAdID!==this.companionAdIDOriginal},build:function(a){this.buildContainer();var b=!1;if(this.options.swf&&(this.options.swf=this._getSwfWithVersion(),a+=this._getSubfolderToSwfPath(),this.buildSwf(a),b=!0),this.options.ignoreScript?(b=!0,this.onScriptLoaded()):this.options.script&&(this.buildScript(),b=!0),!b)throw Error("Invalid asset");this.updatePlayer("loading")},buildContainer:function(){this.container||(this.container=new Element("div",{id:this.options.containerId}).inject(this.el),this.swiffOptions.container=this.container)},buildScript:function(){this.onFlashLoading(),Asset.javascript(this.options.script,{id:this.options.scriptId,onload:this.onScriptLoadedProtected.bind(this)})},_getSwfWithVersion:function(){return this.versionKey?this.options.swf.substitute({version:"_v"+this.versionKey}):this.options.swf},_getSubfolderToSwfPath:function(){return this.options.swfSubFolder?this.options.swfSubFolder+"/":""},buildSwf:function(a){this.onFlashLoading();var b=new Swiff(a+this.options.swf,this.swiffOptions);this.swfObject=document.id(b),this.onSwfObjectLoaded(this.swfObject)},onFlashLoading:function(){Browser.ie&&(this.windowTitle=document.title)},onFlashLoaded:function(){Browser.ie&&this.windowTitle&&(document.title=this.windowTitle)},onFocus:function(){this.windowTitle&&(document.title=this.windowTitle)},onSwfObjectLoaded:function(a){a=a||this.swfObject,Browser.ie&&(a.onfocus=this.onFocus.bind(this))},isPlayerReady:function(){return this.ready||!1},onPlayerReady:function(){this.ready=!0,this.fireEvent("ready"),this.onFlashLoaded()},hasContentStarted:function(){return this.contentStarted},onScriptLoaded:function(){},onScriptLoadedProtected:function(){this.scriptLoaded||(this.scriptLoaded=!0,this.onScriptLoaded())},onPlayerError:function(a){Uverse.console.warn("[Player]","Player had an error: ",a),"stream.error.BLACKED_OUT"!==a&&this.fireEvent("playerError",a)},setAdStyleNeverSmall:function(){this.adComponent.setStyle("position","absolute")},updatePlayer:function(a){},largePlayer:function(){var a=this.el.getElement("object,embed");if(a){var b=(this.container.getSize().x-this.playerSizes.largeWidth)/2,c={"margin-left":b,width:this.playerSizes.largeWidth,height:this.playerSizes.height};Browser.ie8||Browser.ie7?(Object.each(c,function(b,c){Element.setStyle(a,c,b)}),this.onLargePlayerStart(),this.onLargePlayerComplete()):(Object.merge(c,{start:this.onLargePlayerStart.bind(this),complete:this.onLargePlayerComplete.bind(this)}),a.set("morph",{transition:"quint:in"}).morph(c))}},smallPlayer:function(){var a=this.el.getElement("object,embed");if(a){var b={"margin-left":0,width:this.playerSizes.smallWidth,height:this.playerSizes.height};Browser.ie8||Browser.ie7?(Object.each(b,function(b,c){Element.setStyle(a,c,b)}),this.onSmallPlayerStart(),this.onSmallPlayerComplete()):(Object.merge(b,{start:this.onSmallPlayerStart.bind(this),complete:this.onSmallPlayerComplete.bind(this)}),a.set("morph",{transition:"quint:out"}).morph(b))}},largeAd:function(){this.adComponent.hasClass("large-ad")?this.adComponent.removeClass("hidden"):(this.adComponent.fade("hide"),this._setTopValueForAdComponent(),this.adComponent.addClass("large-ad").removeClass("hidden"),this.adComponent.set("tween",{transition:"quint:in"}).fade("in"))},smallAd:function(){this.adComponent.hasClass("large-ad")?(this.adComponent.fade("hide"),this.adComponent.removeClass("large-ad").setStyles({top:null}).removeClass("hidden"),this.adComponent.set("tween",{transition:"quint:in"}).fade("in")):this.adComponent.removeClass("hidden")},noAd:function(){this.adComponent&&this.adComponent.addClass("hidden")},_setTopValueForAdComponent:function(){this.adComponent.setStyle("top",0),this.adComponent.removeClass("hidden");var a=this.el.getPosition().y-this.adComponent.getPosition().y;this.adComponent.setStyle("top",a)},onLargePlayerStart:function(){},onLargePlayerComplete:function(){},onSmallPlayerStart:function(){},onSmallPlayerComplete:function(){},onStreamReady:function(){Uverse.console.log("[Player]","Stream OK"),this.fireEvent("streamReady")},onContentStart:function(){Uverse.console.log("[Player]","Content Start"),this.videoPlaying=!0,this.contentStarted=!0,this.fireEvent("contentStart"),this.updatePlayer("content")},onContentEnd:function(){Uverse.console.log("[Player]","Content End"),this.videoPlaying=!1,this.fireEvent("contentEnd")},onAdStart:function(a){Uverse.console.log("[Player]","Ad Start"),this.adPlaying=!0,this.fireEvent("adStart",a),this.updatePlayer("ad")},onAdEnd:function(){Uverse.console.log("[Player]","Ad End"),this.adPlaying=!1,this.fireEvent("adEnd"),this.updatePlayer("content")},onVideoStart:function(){Uverse.console.log("[Player]","Video Start"),this.fireEvent("videoStart")},onVideoEnd:function(){Uverse.console.log("[Player]","Video End"),this.fireEvent("videoEnd"),this.updatePlayer("finished")},onSegmentStart:function(a){Uverse.console.log("[Player]","Video Segment Start"),this.currentSegment=a,this.fireEvent("segmentStart",this.currentSegment)},onSegmentEnd:function(){Uverse.console.log("[Player]","Video Segment End"),this.fireEvent("segmentEnd")},onStateChange:function(a){switch(this.fireEvent("stateChange",a),a){case"playing":this.videoPlaying=!0;break;default:this.videoPlaying=!1}},onBitrateChanged:function(a,b){this.fireEvent("bitrateChange",[a,b])},isVideoPlaying:function(){return this.videoPlaying},getPosition:function(){return null},getDuration:function(){return null},supportsBitrateEvents:function(){return!1},destroyPlayer:function(){this._destroyScript(),this.el.innerHTML=""},_destroyScript:function(){var a=$(this.options.scriptId);a&&a.destroy()},hidePlayer:function(){this.el.addClass("hidden")},showPlayer:function(){this.el.removeClass("hidden")},getPlayToken:function(){return null},getFallbackToken:function(){return null},getFallbackVideoKey:function(){return null},getStreamToken:function(){return this.streamToken},setStreamToken:function(a){this.streamToken=a},load:function(){},replay:function(){},pause:function(){},resume:function(){},seek:function(a){},stop:function(){}}),Uverse.playerExtensions.AgeRestrictionExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){var b=Uverse.page.isUserLoggedIn();if(b)this.callbacks.complete();else{var c=a.getElement(".ageRestriction-extension");c.removeClass("hidden")}}}),Uverse.playerExtensions.BandwidthReportExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{imageSize:null,imageURI:null},timers:{startTime:0,endTime:0},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(){this._requestImage(),this.callbacks.complete()},_requestImage:function(){var a=new Image;a.addEvent("load",this._onImageLoaded.bind(this)),this.timers.startTime=(new Date).getTime(),a.src=this.options.imageURI},_onImageLoaded:function(a){this.timers.endTime=(new Date).getTime();var b=this._calculateUserBandwidth();Uverse.page.setUserBandwidth(b),Uverse.console.log("[BandwidthReportExtension]","User Bandwidth (kilobits/sec): "+b)},_calculateUserBandwidth:function(){var a=(this.timers.endTime-this.timers.startTime)/1e3;return Math.round(this._convertBytesToKilobits(this.options.imageSize)/a)},_convertBytesToKilobits:function(a){return 8*a/1024}}),Uverse.playerExtensions.BlackoutExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,player:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.template=a.getElement(".blackout-extension"),this.callbacks.complete()},playerLoaded:function(a,b){this.player=a,this.player.addEvent("player-blackout",this._onChangePlayerBlackout.bind(this)),this.player.addEvent("playerError",this._onPlayerError.bind(this))},_onChangePlayerBlackout:function(a,b){Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalizationUverseData.bind(this,a,b))},_onPersonalizationUverseData:function(a,b,c){this._toggleBlackout(a,c.getLiveChannelMapping(b))},_toggleBlackout:function(a,b){if(null!==this.player)if("true"===a){try{this.player.pause(),Uverse.console.log("[BlackoutExtension]","Player is paused")}catch(c){Uverse.console.log("[BlackoutExtension]","Player is unabled to be paused")}this._updateChannelNumber(b),this._showTemplate()}else{try{this.player.resume(),Uverse.console.log("[BlackoutExtension]","Player is resumed")}catch(c){Uverse.console.log("[BlackoutExtension]","Player is unabled to be resumed")}this._hideTemplate()}else Uverse.console.log("[BlackoutExtension]","Player is not loaded yet!")},_updateChannelNumber:function(a){this.template.getElement(".channelNumber").set("text",a||"")},_showTemplate:function(){this.player.hidePlayer(),this.template.removeClass("hidden")},_hideTemplate:function(){this.player.showPlayer(),this.template.addClass("hidden")},_onPlayerError:function(){this.template.addClass("multiple-extension-overlay")}}),Uverse.playerExtensions.ClientSideStreamManagementExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{videoKey:null,heartbeaturl:"/heartbeat.html"},templateMaxStreams:null,templateLoading:null,tokenHandler:null,token:null,player:null,heartbeatRequest:null,heartbeatInterval:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoaded:function(a,b){return a.getHeartbeat?void(null==this.token&&(this.player=a,this.player.addEvent("contentStart",this._heartbeatCall.bind(this)))):void Uverse.console.log("[ClientSideStreamManagementExtension]","This player does not support heartbeats.")},_heartbeatCall:function(){if(null==this.token&&(this.token=this.player.getStreamToken(),null!=this.token)){var a={streamToken:this.player.getStreamToken(),playToken:this.player.getPlayToken(),videoKey:this.options.videoKey};this.heartbeatRequest=new Request({url:this.options.heartbeaturl,method:"get",headers:{Accept:"application/xml"},data:a,onSuccess:this._onHeartbeatSuccess.bind(this),onFailure:this._tokenError.bind(this)}).send()}},_heartbeatPeriodicalCall:function(){this.heartbeatRequest.send()},_onHeartbeatSuccess:function(){null==this.heartbeatInterval&&(this.heartbeatInterval=this._heartbeatPeriodicalCall.periodical(this.player.getHeartbeat(),this)),Uverse.console.log("[ClientSideStreamManagementExtension]","Calling Heartbeat...")},_tokenError:function(){Uverse.console.log("[ClientSideStreamManagementExtension]","Max Streams reached"),this.player.fireEvent("playerError","max-streams").bind(this),this._killHeartbeat()},_killHeartbeat:function(){null!==this.heartbeatInterval&&clearInterval(this.heartbeatInterval)},destroyExtension:function(){this._killHeartbeat()}}),Uverse.playerExtensions.ComscoreExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,player:null,eventMappings:null,c5ParamConstants:null,comscoreAPI:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this.c5ParamConstants=new Hash({LONG_FORM_PREMIUM:"03",PRE_ROLL:"09",MID_ROLL:"11",POST_ROLL:"10"}),this.eventMappings=new Hash({adStart:this._sendAdCall.bind(this),segmentStart:this._sendVideoCall.bind(this)}),this.comscoreAPI=new Uverse.utils.ComScoreAPI},playerLoaded:function(a,b){this.player=a,this.player&&(Uverse.console.log("[ComscoreExtension]","Comscore Enabled"),this.eventMappings.each(function(a,b){this.player.addEvent(b,a)},this))},destroyExtension:function(){this._cleanupEvents()},_sendAdCall:function(a){var b;switch(a){case this.player.AD_TYPE.PRE:b=this.c5ParamConstants.PRE_ROLL;break;case this.player.AD_TYPE.MID:b=this.c5ParamConstants.MID_ROLL;break;case this.player.AD_TYPE.POST:b=this.c5ParamConstants.POST_ROLL}var c={c1:this.options.c1,c2:this.options.c2,c4:this.options.c4,c5:b,c6:this.options.c6};this.comscoreAPI.sendTag(c),Uverse.console.log("[ComscoreExtension]","Calling ComScore for ADVs")},_sendVideoCall:function(){var a=this.c5ParamConstants.LONG_FORM_PREMIUM,b=this.player.currentSegment+"-"+this.player.totalSegments,c={c1:this.options.c1,c2:this.options.c2,c4:this.options.c4,c5:a,c6:this.options.c6,c10:b};this.comscoreAPI.sendTag(c),Uverse.console.log("[ComscoreExtension]","Calling ComScore for VIDEO segment: "+b)},_cleanupEvents:function(){this.player&&this.eventMappings.each(function(a,b){this.player.removeEvent(b,a)},this)}}),Uverse.playerExtensions.DeviceManagementExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,swfTimeout:null,hasCrashingBug:null,options:{swfPath:null,deviceType:null,swfMaxAttempts:100,swfAttempt:0,swfTimeoutInMs:15e3},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.template=a.getElement(".deviceManagement-extension"),this.templateExpire=a.getElement(".deviceManagementTimeout-extension"),this.template.getElement(".player-loading-icon-wrapper").removeClass("hidden"),Uverse.page.addMemoryEvent("Personalization-uverseData:once",this._onUserData.bind(this))},_hasCrashingBug:function(){if(null===this.hasCrashingBug){var a="SILVERLIGHT"==this.options.deviceType.toUpperCase()&&Browser.ie8,b=Browser.chrome;
this.hasCrashingBug=!(!a&&!b),this.hasCrashingBug&&Uverse.console.log("[DeviceManagementExtension]","This browser suffers from a bug where the existence of the DM swf and a silverlight or flash player will cause the browser or swf plugin to crash (even if the DM swf is removed from the page). A page refresh will be triggered on successful completion of the device management check.")}return this.hasCrashingBug},_onUserData:function(a){!Uverse.page.isUserLoggedIn()||this._hasCrashingBug()&&a.isDeviceRetreived()?(Uverse.console.log("[DeviceManagementExtension]","Device ID Retrieved"),this.template.destroy(),this.callbacks.complete()):(Uverse.console.log("[DeviceManagementExtension]","Device ID SWF Loading..."),this._createSWF(a.setDeviceRetreived.bind(a)),this._beginSWFTimeout())},_createSWF:function(a){window.onSwfContentLoaded=this._onSwfContentLoaded.bind(this),window.deviceRegistrationStatus=this._deviceRegistrationStatus.bind(this,a),this.swf=new Swiff(this.options.swfPath,{container:this.template})},_onSwfContentLoaded:function(){if(this.options.swfAttempt<this.options.swfMaxAttempts){var a=$(this.swf);this.swf&&a.registerDevice?(Uverse.console.log("[DeviceManagementExtension]","Device ID SWF loaded"),a.registerDevice()):(Uverse.console.log("[DeviceManagementExtension]","SWF loaded but not yet part of DOM..."),this.options.swfAttempt++,this._onSwfContentLoaded.delay(100,this))}else Uverse.console.error("[DeviceManagementExtension]","SWF did not load after "+this.options.swfAttempt+" attempts.")},_deviceRegistrationStatus:function(a,b){return b&&b.error?void Uverse.console.log("[DeviceManagementExtension]","Device ID registration error: "+b.error+" - "+b.message):void("success"==b.deviceRegistration&&(this._cancelSWFTimeout(),Uverse.console.log("[DeviceManagementExtension]","Device ID registration successful"),this.swf=null,a(!0),this._hasCrashingBug()?(Uverse.console.log("[DeviceManagementExtension]","Workaround for DeviceId + Silverlight bug"),window.location.reload()):(this.template.destroy(),this.callbacks.complete())))},_beginSWFTimeout:function(){this.swfTimeout=setTimeout(this._onSwfTimeoutExpired.bind(this),this.options.swfTimeoutInMs)},_cancelSWFTimeout:function(){clearTimeout(this.swfTimeout),this.templateExpire.addClass("hidden")},_onSwfTimeoutExpired:function(){this.templateExpire.removeClass("hidden")}}),Uverse.playerExtensions.DigitalSmithsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_onContentStart","_onWindowUnload","_onVideoEnd"],options:{videoKey:null,channel:void 0,isLive:!1},player:null,startTime:null,reported:!1,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoaded:function(a){this.player=a,this.player&&this.player.addEvent("contentStart",this._onContentStart)},_onContentStart:function(){this.player.removeEvent("contentStart",this._onContentStart),this.startTime=new Date,this.player.addEvent("videoEnd",this._onVideoEnd),window.addEvent("unload",this._onWindowUnload)},_removeEvents:function(){this.player.removeEvent("contentStart",this._onContentStart),this.player.removeEvent("videoEnd",this._onVideoEnd),window.removeEvent("unload",this._onWindowUnload)},_onVideoEnd:function(){this._reportView()},_onWindowUnload:function(){this._reportView()},destroyExtension:function(){this._reportView()},_reportView:function(){if(!this.reported&&this.startTime){this.reported=!0,this._removeEvents();var a=0;if(!this.options.isLive)try{a=this.player.getPosition()/this.player.getDuration()}catch(b){}var c={startTime:this.startTime,endTime:new Date,portionViewed:a,videoKey:this.options.videoKey,channel:this.options.channel,isLive:this.options.isLive};Uverse.page.getDigitalSmithsAPI().trackVideoWatch(c)}}}),Uverse.playerExtensions.EntitlementExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{upgradeMessage:null,isClip:null},entitlementHelper:new Uverse.utils.Entitlement,extensionPanel:null,entitlementState:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){return this.entitlementState=this.entitlementHelper.compareEntitlement(this.options.entitlement),this.extensionPanel=a.getElement(".entitlement-extension"),this.entitlementState==Uverse.Enums.Entitlement.ALLOWED||this.options.isClip?void this.callbacks.complete():(this._showButton(),void this._displayEntitlementMessage())},_displayEntitlementMessage:function(){this.extensionPanel.getElement(".player-extension-title").set("text",this.options.upgradeMessage),this.extensionPanel.removeClass("hidden")},_showButton:function(){this.extensionPanel.getElement("."+this.entitlementState+"-button").removeClass("hidden")}}),Uverse.playerExtensions.ExtensionManager=new Class({Implements:[Options],extensions:[],loadPlayerCallback:null,options:{displayPanelClassName:".extensionPanels"},currentActiveIndexes:{init:-1},extensionCallbacks:null,initializedExtensions:[],extensionPanels:null,player:null,initialize:function(a,b,c,d){this.setOptions(d),this.extensions=b,this.loadPlayerCallback=c,this.extensionPanels=a.getElement(this.options.displayPanelClassName)},runPlayerLoading:function(){this._runNextPlayerLoading()},_runNextPlayerLoading:function(){var a=this.extensions[++this.currentActiveIndexes.init];if(a){var b=a.name,c=a.options;this.extensionCallbacks||(this.extensionCallbacks={complete:this._runNextPlayerLoading.bind(this)});var d=Uverse.playerExtensions[b];if(d){var e=new d(c,this.extensionCallbacks);this.initializedExtensions.push(e),e.playerLoading(this.extensionPanels),e.addEvent("onPlayerError",this._onPlayerError.bind(this))}else Uverse.console.error("[ExtensionManager]","Could not find '",b,"'"),this._runNextPlayerLoading()}else this.loadPlayerCallback()},runPlayerLoaded:function(a,b){this.initializedExtensions.each(function(c){c.playerLoaded(a,b)})},runPlayerFinished:function(){this.initializedExtensions.each(function(a){a.playerFinished()})},destroyExtensions:function(a){a=a||this.initializedExtensions,a.each(function(a){try{a.destroyExtension()}catch(b){Uverse.console.error("[ExtensionManager]","Error destroying the extension:",a,b),Uverse.console.throwAway(b)}})},_onPlayerError:function(a){var b=this.initializedExtensions.filter(function(b){return a!=b});this.destroyExtensions(b)}}),Uverse.playerExtensions.FlashCheckExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{minVersion:null},template:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.template=a.getElement(".flashCheck-extension");var b=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g),c=parseFloat(b[0]||0)+"."+(b[1]||0);if(c<this.options.minVersion){var d;d=c>0?"upgrade":"install",this.updatePanelTitle(this.template,this.template.getElement(".flashTitleTemplate ."+d).get("html")),this.template.removeClass("hidden")}else this.callbacks.complete()}}),Uverse.playerExtensions.GoogleAnalyticsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){Uverse.console.log("[GoogleAnalyticsExtension]","Tracked Play Page Impression"),Uverse.page.googleAnalyticsPush("_trackEvent",[this.options.tracking_category,"Play page impression",this.options.tracking_label]),Uverse.page.googleAnalyticsPush("_trackPageview",[this.options.fullUrl]),this.callbacks.complete()},playerLoaded:function(a,b){Uverse.console.log("[GoogleAnalyticsExtension]","Tracked Video Player Impression"),Uverse.page.googleAnalyticsPush("_trackEvent",[this.options.tracking_category,"Video player impression",this.options.tracking_label])}}),Uverse.playerExtensions.InterruptionExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Implements:[Timers],Binds:["_onUserInteraction","_onButtonClick","_onResumeClick"],options:{timerOptions:{timeout:108e5},warningPeriod:9e5},els:{metaContainer:null,warningContent:null,warningTime:null,stillWatchingButton:null,resumeWatchingButton:null,template:null},timeLeft:0,lastTimerTime:null,player:null,playerContainer:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},_setupElements:function(){this.els.metaContainer=this.playerContainer.getElement(".modal-player-meta-container"),this.els.warningContent=this.playerContainer.getElement(".modal-player-interruption"),this.els.warningTime=this.els.warningContent.getElement(".counter"),this.els.stillWatchingButton=this.els.warningContent.getElement(".button"),this.els.resumeWatchingButton=this.playerContainer.getElement(".interruption-resume"),this.els.template=this.playerContainer.getElement(".interruption-extension")},_setupEvents:function(){this.els.stillWatchingButton.addEvent("click",this._onButtonClick),this.els.resumeWatchingButton.addEvent("click",this._onResumeClick),window.addEvent("mousemove",this._onUserInteraction),window.addEvent("keydown",this._onUserInteraction)},_onButtonClick:function(a){this.setTimer(this._showTimeoutWarning,this.options.timerOptions),this._hideTimeoutWarning()},_onResumeClick:function(a){a.preventDefault(),Uverse.page.reloadCurrentUrl()},_onUserInteraction:function(a){this.resetTimer(this._showTimeoutWarning)},_showTimeoutWarning:function(){Uverse.console.log("[Interruption Extension]","Showing the Interruption Warning"),this.els.metaContainer.toggleClass("interruption-active",!0),this.els.warningContent.removeClass("hidden"),this.timeleft=this.options.warningPeriod,this.lastTimerTime=(new Date).getTime(),this.setTimer(this._updateWarningTime,{interval:500}),this._updateWarningTime(),this.player.exitFullScreen&&this.player.exitFullScreen()},_hideTimeoutWarning:function(){Uverse.console.log("[Interruption Extension]","Hiding the Interruption Warning"),this.els.metaContainer.toggleClass("interruption-active",!1),this.els.warningContent.addClass("hidden"),this.clearTimer(this._updateWarningTime)},_updateWarningTime:function(){var a=(new Date).getTime(),b=a-this.lastTimerTime;this.lastTimerTime=a,this.timeleft-=b,this.timeleft<=0&&(this.timeleft=0,this.clearTimer(this._updateWarningTime),this.player.destroyPlayer(),this.els.template&&this.els.template.removeClass("hidden"),this._hideTimeoutWarning());var c=this.timeleft/1e3,d=Math.floor(c/60),e=Math.round(c%60);this.els.warningTime.set("text",d+":"+(""+e).pad(2,"0","left"))},playerLoaded:function(a,b){this.player=a,this.playerContainer=b,this._setupElements(),this._setupEvents(),this.setTimer(this._showTimeoutWarning,this.options.timerOptions),Uverse.console.log("[Interruption Extension]","Timer starting...")},destroyExtention:function(){this.clearTimers()}}),Uverse.playerExtensions.LiveExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_onRunStatusChanging"],options:{isInHomeContent:!1,entitlement:"",callLetters:"",channelName:"",channelCount:0,loginUrl:null,configureUrl:null},entitlementHelper:new Uverse.utils.Entitlement,extensionPanel:null,subscribeInHomeCallback:null,inHomeErrorDisplayed:!1,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.entitlementState=this.entitlementHelper.compareEntitlement(this.options.entitlement);var b=Uverse.page.isUserLoggedIn();if(this.options.isInHomeContent)b?Uverse.page.addMemoryEvent("Personalization-uverseData",this._onUverseData.bind(this,a)):(this.template=a.getElement(".in-home-sign-in-extension"),this._setupNotLoggedIn(),this.template.removeClass("hidden"));else{if(b)return this.entitlementState!==Uverse.Enums.Entitlement.ALLOWED?(this.template=a.getElement(".live-upgrade-tv-package-extension"),void this.template.removeClass("hidden")):void this.callbacks.complete();var c=this.options.loginUrl+this._getReturnUrl();this.template=a.getElement(".live-sign-in-extension"),this.template.getElement(".oval-link").set("href",c),this.template.removeClass("hidden")}},_onUverseData:function(a,b){var c=Uverse.page.getInHomeService(),d=c.applet;if(void 0===b.getLiveChannelMapping(this.options.callLetters))this.template=a.getElement(".geo-restricted-extension"),this.template.getElement(".channel-name").set("text",this.options.channelName),this.template.removeClass("hidden");else{if(this.entitlementState!==Uverse.Enums.Entitlement.ALLOWED)return this.template=a.getElement(".live-upgrade-tv-package-extension"),void this.template.removeClass("hidden");!c.usePlugin()||d.isInstalled()&&d.hasJavaMinVersion()?(c.usePlugin()?(this.template=a.getElement(".in-home-connection-extension"),window.addEvent("inHomeApplet-running",this._onRunStatusChanging),this._setupAppletOutOfHomeError()):this.template=a.getElement(".auto-auth-extension"),this.template.removeClass("hidden"),this.subscribeInHomeCallback=this._inHomeStatusUpdated.bind(this),c.checkInHomeStatus(),c.subscribe(this.subscribeInHomeCallback)):(this.template=a.getElement(".in-home-install-extension"),this._setupNotInstalled(d.isInstalled()),this.template.removeClass("hidden"))}},_getReturnUrl:function(){var a=window.location.href.split("/");return"uv"!==a[3].toLowerCase()&&a.splice(3,0,"uv"),a=a.join("/")},_setupNotLoggedIn:function(){var a=this.options.loginUrl+this._getReturnUrl();this.template.getElement(".signed-in").addClass("active"),this.template.getElement(".signed-in .oval-link").set("href",a),this.template.getElement(".install-plugin .oval-link").set("href",null),this.template.getElement(".channel-count").set("text",this.options.channelCount),this._setupLearnMore()},_setupNotInstalled:function(a){var b=this.options.configureUrl+encodeURIComponent(this._getReturnUrl());this.template.getElement(".signed-in").addClass("complete"),this.template.getElement(".install-plugin").addClass("active"),this.template.getElement(".install-plugin .oval-link").set("href",b),this.template.getElement(".signed-in .oval-link").set("href",null),this.template.getElement(".channel-count").set("text",this.options.channelCount),a&&this.template.getElement(".install-plugin").addClass("java-out-of-date"),this._setupLearnMore()},_setupAppletOutOfHomeError:function(){this.template.getElement(".signed-in").addClass("complete"),this.template.getElement(".install-plugin").addClass("complete"),this.template.getElement(".connect").addClass("active"),this.template.getElement(".channel-count").set("text",this.options.channelCount),this.template.getElement(".install-plugin .oval-link").set("href",null),this.template.getElement(".signed-in .oval-link").set("href",null),this.template.getElement(".connect .step-button").addEvent("click",this._recheckInHomeStatus),this._setupLearnMore()},_setupLearnMore:function(){this.template.getElement(".install-plugin .modal-link").addEvent("click",this._displayInstallHelp.bind(this)),this.template.getElement(".connect .modal-link").addEvent("click",this._displayNetworkHelp.bind(this))},_recheckInHomeStatus:function(){Uverse.page.recheckInHomeStatus()},_displayNetworkHelp:function(a){a.preventDefault(),Uverse.page.showNetworkConnectionHelp(!1)},_displayInstallHelp:function(a){a.preventDefault(),Uverse.page.showLivePluginHelp(!1)},_inHomeStatusUpdated:function(a){a===Uverse.Enums.InHomeStatus.IN_HOME&&(this.template.addClass("hidden"),window.removeEvent("inHomeApplet-running",this._onRunStatusChanging),Uverse.page.unsubscribeInHomeStatus(this.subscribeInHomeCallback),this._onRunStatusChanging=void 0,this.callbacks.complete())},_onRunStatusChanging:function(a){this.template.getElement(".loading-icon-container").toggleClass("hidden",!a),this.template.getElement(".connect .logo-area").toggleClass("hidden",a),this.template.getElement(".connect .step-button").toggleClass("hidden",a)},destroyExtension:function(){this.subscribeInHomeCallback&&Uverse.page.unsubscribeInHomeStatus(this.subscribeInHomeCallback),this._onRunStatusChanging&&window.removeEvent("inHomeApplet-running",this._onRunStatusChanging)}}),Uverse.playerExtensions.LogViewImpressionExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_logViewImpression"],options:{impressionUrl:null},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoaded:function(a,b){this.player=a,this.player.addEvent("videoStart",this._logViewImpression),this.player.addEvent("contentStart",this._logViewImpression)},_logViewImpression:function(){Uverse.console.log("[LogViewImpressionExtension]","Logging View Impression"),this.player.removeEvent("videoStart",this._logViewImpression),this.player.removeEvent("contentStart",this._logViewImpression),new Request({method:"post",url:this.options.impressionUrl,noCache:!0}).send()}}),Uverse.playerExtensions.MetadataExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{liveMetadataUrl:null,initialDelay:1e3,retryMax:3,retryDelay:6e4,timeZoneInfo:null},metadataContainer:null,player:null,liveMetadata:{request:null,results:null,retryCount:0,timerRequest:null,timerNext:null},childRearrangerOptions:{rearrangeType:null,elementIDs:[]},disableNewRequests:!1,clientTimeOffset:0,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},_setupLiveMetadata:function(){this.liveMetadata.request=new Request({method:"get",url:this.options.liveMetadataUrl,onSuccess:this._liveMetadataRequestSuccess.bind(this),onFailure:this._liveMetadataRequestRetry.bind(this)}),this.liveMetadata.timerRequest=this.liveMetadata.request.send.delay(this.options.initialDelay,this.liveMetadata.request)},_getNow:function(){return new Date((new Date).getTime()-this.clientTimeOffset)},_liveMetadataRequestRetry:function(){this.liveMetadata.retryCount>=this.options.retryMax||(this.liveMetadata.retryCount++,this.liveMetadata.timerRequest=this.liveMetadata.request.send.delay(this.options.retryDelay,this.liveMetadata.request))},_liveMetadataRequestSuccess:function(a){var b=Elements.from(a),c=b.filter(".live-metadata-container").map(function(a){return{timestamp:new Date(+a.get("data-timestamp")),endTime:new Date(+a.get("data-endtime")),videoRating:a.get("data-video-rating"),blackout:{isBlackout:a.get("data-isBlackout"),callLetters:a.get("data-callLetters")},contents:a.getElement(".modal-player-meta")}}),d=this.liveMetadata.results;if(d&&d.length>0){var e=c.peek().timestamp-d.peek().timestamp===0;e&&(Uverse.console.log("[MetadataExtension]","Channel is out of metadata."),this.disableNewRequests=!0)}return this.liveMetadata.results=c,0===this.liveMetadata.results.length?(Uverse.console.error("[MetadataExtension]","Failed to retrieve any updated metadata!  Retrying."),void this._liveMetadataRequestRetry()):(Uverse.console.log("[MetadataExtension]","Retrieved ",this.liveMetadata.results.length," metadata results"),this.liveMetadata.retryCount=0,void this._loadCurrentLiveMetadata())},_loadCurrentLiveMetadata:function(){var a=this._getNow(),b=this.liveMetadata.results,c=0,d=3e3;b.each(function(b,e){b.timestamp.getTime()<a.getTime()+d&&(c=e)});var e=b[c].contents,f=this.metadataContainer,g=new Uverse.playerExtensions.MetadataExtension.ChildRearranger(this.childRearrangerOptions),h=new Uverse.playerExtensions.MetadataExtension.ContentSwapper(e,f,g);h.swapContent(),this.metadataContainer=e;var i=this.metadataContainer.getElement(".show-title").get("html");i&&this.playerTitle.set("html",i);var j=this.metadataContainer.getElement(".time-range");if(j){var k=j.getElement(".has-times"),l=new Date(+k.get("data-start-date")),m=new Date(+k.get("data-end-date"));this.options.timeZoneInfo&&(l=l.getLocalTimeFromTimezone(this.options.timeZoneInfo),m=m.getLocalTimeFromTimezone(this.options.timeZoneInfo)),j.set("text",this._getTimeRangeText(l,m,!0))}Uverse.console.log("[MetadataExtension]","Updated Metadata"),this._configureBlackout(b[c]),this._alertParentalControlsToCheckRating(b[c]);var n=Math.round(b[c].endTime-a);if(c>=b.length-2&&!this.disableNewRequests){var o=Math.max(1e3,n-Number.random(2e4,6e5));return Uverse.console.log("[MetadataExtension]","Next call in about "+Math.round(o/1e3)+" secs"),void(this.liveMetadata.timerRequest=this.liveMetadata.request.send.delay(o,this.liveMetadata.request))}b.length-1>c&&(Uverse.console.log("[MetadataExtension]","Next call in about "+Math.round(n/1e3)+" secs"),this.liveMetadata.timerNext=this._loadCurrentLiveMetadata.delay(n-1e3,this))},_getTimeRangeText:function(a,b,c){var d=a.format("%p")!==b.format("%p"),e="%l:%M"+(c||d?"%p":"");return a.format(e)+" - "+b.format("%l:%M%p")},_configureBlackout:function(a){this.player.fireEvent("player-blackout",[a.blackout.isBlackout,a.blackout.callLetters])},_alertParentalControlsToCheckRating:function(a){this.player.fireEvent("player-check-parental-controls",a.videoRating)},playerLoaded:function(a,b){this.options.liveMetadataUrl&&(this.metadataContainer=b.getElement(".modal-player-meta"),this.player=a,this.playerTitle=b.getElement(".playerLoader-title"),this.childRearrangerOptions={rearrangeType:Uverse.Enums.ChildRearranger.rearrangeTypes.BLACKLIST,elementIDs:[this.player.companionAdID]},this._setupLiveMetadata())},destroyExtension:function(){this.liveMetadata.timerRequest&&clearTimeout(this.liveMetadata.timerRequest),this.liveMetadata.timerNext&&clearTimeout(this.liveMetadata.timerNext),this.liveMetadata.request&&this.liveMetadata.request.cancel()}}),Uverse.playerExtensions.MetadataExtension.ContentSwapper=new Class({content:{recent:null,old:null},initialize:function(a,b,c){this.content.recent=a,this.content.old=b,c&&c.rearrange(this.content.recent,this.content.old)},swapContent:function(){this.content.recent.replaces(this.content.old)}}),Uverse.Enums.ChildRearranger={rearrangeTypes:{BLACKLIST:0,WHITELIST:1}},Uverse.playerExtensions.MetadataExtension.ChildRearranger=new Class({Implements:[Options],options:{rearrangeType:Uverse.Enums.ChildRearranger.rearrangeTypes.BLACKLIST,elementIDs:[]},initialize:function(a){this.setOptions(a)},rearrange:function(a,b){switch(this.options.rearrangeType){case Uverse.Enums.ChildRearranger.rearrangeTypes.BLACKLIST:var c=this._getBlackListedItemsFromContent(b);this._replaceBlackListedItemsInContent(a,c);break;case Uverse.Enums.ChildRearranger.rearrangeTypes.WHITELIST:Uverse.console.error("Whitelist not implemented!")}},_getBlackListedItemsFromContent:function(a){var b=[];return Array.each(this.options.elementIDs,function(c){b.push({id:c,element:a.getElement("#"+c)})}),b},_replaceBlackListedItemsInContent:function(a,b){Array.each(b,function(b){var c=a.getElement("#"+b.id);b.element.replaces(c)})}}),Uverse.playerExtensions.NextVideoExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{nextVideoUrl:null,nextVideoInfo:null,nextVideoHistory:null},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerFinished:function(){Uverse.console.log("[NextVideoExtension]","Playing the next video:",this.options.nextVideoInfo);var a={windowTitle:this.options.nextVideoInfo.videoTitle,replaceHistory:!0};Uverse.page.loadDeepLink(this.options.nextVideoUrl,this.options.nextVideoInfo,a)},destroyExtension:function(){}}),Uverse.playerExtensions.ParentalControlsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{videoRating:"",isLive:!1},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),Uverse.page.addMemoryEvent("Personalization-uverseData",this._onPersonalization.bind(this))},_onPersonalization:function(a){this.userIsLoggedIn=a.isHouseholdAccount()||!1},playerLoading:function(a){this.template=a.getElement(".parental-controls-extension"),this.options.isLive?this.callbacks.complete():this._getUserRatingLevel()},playerLoaded:function(a,b){this.player=a,this.player.addEvent("player-check-parental-controls",this._toggleParentalControls.bind(this))},_toggleParentalControls:function(a){if(this.options.videoRating=a||"NR",null!==this.player){try{this.player.pause(),Uverse.console.log("[ParentalControlsExtension]","Player is paused")}catch(b){Uverse.console.log("[ParentalControlsExtension]","Player is unabled to be paused")}this._getUserRatingLevel()}else Uverse.console.log("[ParentalControlsExtension]","Player is not loaded yet!")},_getUserRatingLevel:function(){this.userIsLoggedIn?(this.getUserRatingLevelRequest=new Request.JSON({url:"/parentalControls/getUserRating.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:function(a){a.rating?(this.userRatingLevel=a.rating,this._getPlayableRatingList()):(this.userRatingLevel=null,this._skipParentalControls())}.bind(this),onError:function(){this.userRatingLevel=null,this._skipParentalControls()}.bind(this)}),this.getUserRatingLevelRequest.get()):(this.userRatingLevel=null,this._skipParentalControls())},_getPlayableRatingList:function(){this.getRatingListRequest=new Request.JSON({url:"/parentalControls/getRatingsList.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:function(a){if(a.ratings){var b=this.userRatingLevel;this.playableRatingList=this._findRatingsInLowerLevels(b,a.ratings),this._checkRatingsAndShowExtension()}else this.playableRatingList=null,this._skipParentalControls()}.bind(this)}),this.getRatingListRequest.get()},_findRatingsInLowerLevels:function(a,b){var c=_.findIndex(b,function(b){return b.name==a});return _.flatten(_.map(b,function(a){return a.additionalRatingKeys.replace(/\s/g,"").split(",")}).slice(c))},_checkRatingsAndShowExtension:function(){_.contains(this.playableRatingList,this.options.videoRating)?this._skipParentalControls():this._showExtension()},_showExtension:function(){this.template&&(this._showTemplate(),this.pcForm=this.template.getElement("form#parentalControlChallengeForm"),this.pinInputs=this.pcForm.getElements("input.parentalControlPinEntry"),this.pinInputWithAutofocus=this.pinInputs[0],this.submitButton=this.pcForm.getElement("button.submit"),this.forgetLink=this.template.getElement(".forgotPinLink"),this.messageEl=this.template.getElement(".player-extension-message"),this.messageContainer=this.messageEl.getElement("p"),this.messageCloseEl=this.messageEl.getElement("a.close"),this._setInputAutofocus(this.pinInputWithAutofocus),this.pinInputs.each(function(a){a.addEvent("keydown",this._bindMovementKeys.bind(this)),a.addEvent("keyup",this._validateInput.bind(this))}.bind(this)),this.pcForm.addEvent("submit",this._submitPIN.bind(this)),this.forgetLink.addEvent("click",this._requestPIN.bind(this)),this.messageCloseEl.addEvent("click",this._hideMessage.bind(this)))},_setInputAutofocus:function(a){a.focus()},_bindMovementKeys:function(a){var b=$(a.target);"left"==a.key?(this._moveLeft(b),a.preventDefault()):"right"==a.key?(this._moveRight(b),a.preventDefault()):8===a.code&&(b.value.length||this._moveLeft(b))},_validateInput:function(a){if("left"!=a.key&&"right"!=a.key&&8!=a.code){var b=$(a.target);if(b.value&&b.value.length>0)if(isNaN(b.value))b.value="";else{var c=this._moveRight(b);c||this._submitPIN(a)}}},_moveLeft:function(a){var b=a.getPrevious("input.parentalControlPinEntry");b&&(b.focus(),b.selectRange(0,b.value.length+1))},_moveRight:function(a){var b=a.getNext("input.parentalControlPinEntry");return b&&(b.focus(),b.selectRange(0,b.value.length+1)),b},_requestPIN:function(a){a.preventDefault(),this.pinRequest=new Request.JSON({url:"/parentalControls/reminder.json",headers:Uverse.config.refreshUserSessionHeaders,onSuccess:function(a,b){this.messageContainer.set("text",a.message),a.success?this.messageEl.removeClass("error"):this.messageEl.addClass("error"),this.messageEl.removeClass("hidden")}.bind(this),onFailure:function(a){this.messageContainer.set("text",Uverse.config.parentalControlsPlayerExtension.messages.errors.pinReminderFailure),this.messageEl.addClass("error"),this.messageEl.removeClass("hidden")}.bind(this)}).get()},_submitPIN:function(a){a.preventDefault();var b=!0;this.pinInputs.each(function(a){(0===a.value.length||isNaN(a.value))&&(b=!1)},this),b&&(Uverse.config.clickTracking.startTracking(a.target),this.pinValidation=new Request.JSON({url:this.pcForm.get("action"),data:this.pcForm.toQueryString(),onSuccess:function(b,c){if(b.success)this.messageEl.addClass("hidden"),this._isValidPIN();else{var d="data-clicktrack-label",e=a.target.getAttribute(d);a.target.setAttribute(d,b.message),Uverse.config.clickTracking.startTracking(a.target),a.target.setAttribute(d,e),this._clearPIN(),this.messageContainer.set("text",b.message),this.messageEl.addClass("error"),this.messageEl.removeClass("hidden")}}.bind(this),onFailure:function(a){this.messageContainer.set("text",Uverse.config.parentalControlsPlayerExtension.messages.errors.pinVerificationFailure),this.messageEl.addClass("error"),this.messageEl.removeClass("hidden")}.bind(this)}),this.pinValidation.get())},_skipParentalControls:function(){this.options.isLive||this.callbacks.complete()},_showTemplate:function(){this.template.removeClass("hidden"),this.player&&this.player.hidePlayer()},_hideTemplate:function(){this.template.addClass("hidden"),this.player&&this.player.showPlayer()},_hideMessage:function(a){a.preventDefault(),this.messageContainer.set("text",""),this.messageEl.removeClass("error"),this.messageEl.addClass("hidden")},_clearPIN:function(){this.pinInputs.each(function(a){a.value=""},this),this.pinInputs[0].focus()},_isValidPIN:function(){this._hideTemplate(),this._skipParentalControls()},destroyExtension:function(){this.template.destroy()}}),Uverse.playerExtensions.PlayDurationExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_onWindowUnload"],options:{videoKey:null,useAsyncOnModalClosed:!0},userDuration:0,videoDuration:0,interval:3e4,remainingUpdates:1,guid:null,startTime:null,player:null,updateTimer:null,eventMappings:null,playerState:null,currentState:null,firstTime:!0,playDurationReportingComplete:!0,initialRequest:null,updateRequest:null,finalRequest:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this.playerState=new Hash({playing:"playing",paused:"paused",killed:"killed"}),this.eventMappings=new Hash({contentStart:this._onContentStart.bind(this),contentEnd:this._onContentEnd.bind(this),videoEnd:this._onVideoEnd.bind(this),adStart:this._pauseCounting.bind(this),adEnd:this._startCounting.bind(this)}),this.initialRequest=new Request({url:"/handleInitialPlay.html",onSuccess:this._onInitialRequestSuccess.bind(this)}),this.updateRequest=new Request({url:"/handleUpdatePlay.html"})},playerLoaded:function(a,b){this.player=a,this.player&&(this.eventMappings.each(function(a,b){this.player.addEvent(b,a)},this),this.options.videoKey?this._initPlayDuration(this.options.videoKey):Uverse.console.error("[PlayDurationExtension]","No token found with player!"))},destroyExtension:function(){var a=this.options.useAsyncOnModalClosed;this._reportFinalDuration(a),this._cleanupEvents()},_initPlayDuration:function(a){this.guid=this._guidGenerator(),this.initialRequest.post({guid:this.guid,videoKey:a}),window.addEvent("unload",this._onWindowUnload)},_onWindowUnload:function(){this._reportFinalDuration(!1)},_onInitialRequestSuccess:function(a){Uverse.console.log("[PlayDurationExtension]","Initialized Play Count Reporting"),this.playDurationReportingComplete=!1},_onContentStart:function(){Uverse.console.log("[PlayDurationExtension]","Content started"),this.firstTime&&(this.updateTimer=this._reportUpdateDuration.periodical(this.interval,this),this._startCounting(),this.player.addEvent("stateChange",this._onStateChange.bind(this)),this.firstTime=!1,Uverse.console.log("[PlayDurationExtension]","Timer Started (interval: "+this.interval+"ms)"),this._setVideoDuration.delay(500,this))},_onContentEnd:function(){this._pauseCounting()},_onVideoEnd:function(){var a=this.options.useAsyncOnModalClosed;this._reportFinalDuration(a),this._cleanupEvents()},_pauseCounting:function(){this.currentState!=this.playerState.paused&&(this.currentState=this.playerState.paused,this._updateDuration(),this.startTime=null,Uverse.console.log("[PlayDurationExtension]","Paused Counting"))},_startCounting:function(){this.currentState!=this.playerState.playing&&(this.currentState=this.playerState.playing,this.startTime=(new Date).getTime(),Uverse.console.log("[PlayDurationExtension]","Started Counting, Start Time => "+this.startTime))
},_onStateChange:function(a){switch(this.remainingUpdates=1,a){case this.playerState.playing:this.player.adPlaying||this._startCounting();break;case this.playerState.paused:this._pauseCounting();break;case this.playerState.killed:Uverse.console.log("[PlayDurationExtension]","Player sent out kill state."),this._cleanupEvents()}},_updateDuration:function(){if(null!=this.startTime){var a=(new Date).getTime();this.userDuration+=a-this.startTime,this.startTime=a,Uverse.console.log("[PlayDurationExtension]","Play duration now "+this.userDuration)}this.userDuration>this.videoDuration&&this._setVideoDuration()},_reportUpdateDuration:function(){Uverse.console.log("[PlayDurationExtension]","Updating Duration!!!"),this._updateDuration(),null!=this.guid&&this.remainingUpdates>0?(Uverse.console.log("[PlayDurationExtension]","Updating Request!!!"),this.currentState==this.playerState.paused&&this.remainingUpdates--,this.updateRequest.post({guid:this.guid,duration:this.userDuration,assetlength:this.videoDuration})):Uverse.console.log("[PlayDurationExtension]","NOT Updating Request!!! GUID: "+this.guid+" | remainingUpdates: "+this.remainingUpdates)},_getFinalDuration:function(){Uverse.console.log("[PlayDurationExtension]","Get Final Duration"),this._pauseCounting(),this._updateDuration(),this.remainingUpdates=0},_reportFinalDuration:function(a){!this.playDurationReportingComplete&&this.guid&&(Uverse.console.log("[PlayDurationExtension]","Report Final Duration",a?"(asynchronously)":""),this.playDurationReportingComplete=!0,this._getFinalDuration(),a||Uverse.console.time("[PlayDurationExtension] Report Final Duration took"),this.finalRequest=new Request({url:"/handleFinalPlay.html",async:a}),this.finalRequest.post({"PlayDurationReporting-guid":this.guid,"PlayDurationReporting-duration":this.userDuration,"PlayDurationReporting-assetLength":this.videoDuration}),a||Uverse.console.timeEnd("[PlayDurationExtension] Report Final Duration took"))},_setVideoDuration:function(){var a=1e3*this.player.getDuration();a>this.videoDuration&&(this.videoDuration=a,Uverse.console.log("[PlayDurationExtension]","Video Duration Set ("+this.videoDuration+"ms)"))},_cleanupEvents:function(){clearInterval(this.updateTimer),window.removeEvent("unload",this._onWindowUnload),this.player&&this.eventMappings.each(function(a,b){this.player.removeEvent(b,a)},this),this.userDuration=0,this.playDurationReportingComplete=!0},_guidGenerator:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}),Uverse.playerExtensions.PlayerErrorExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,errorTemplate:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.errorTemplate=a.getElement(".playerError-extension"),this.callbacks.complete()},playerLoaded:function(a,b){a.addEvent("playerError",this._onPlayerError.bind(this)),this.playerContainer=b},_onPlayerError:function(a){var b=this.errorTemplate.getElement("."+a);null==b&&(b=this.errorTemplate.getElement(".unknown-error"));var c=b.getElement(".try-again");c&&c.addEvent("click",this._onTryAgain),b.removeClass("hidden"),this.errorTemplate.removeClass("hidden"),this.fireEvent("onPlayerError",this)},_onTryAgain:function(a){a.preventDefault(),Uverse.page.reloadCurrentUrl()},destroyExtension:function(){this.errorTemplate.destroy()}}),Uverse.playerExtensions.PostVideoPromotionsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,template:null,requestTimer:null,request:null,options:{videoKey:null,safeVideoKey:null,categoryPath:null,requestDelay:5e3,urls:{getPVP:"/getPVP.html"}},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){this.template=a.getElement(".post-video-promotions-extension"),this._startRequest(),this.callbacks.complete()},_startRequest:function(){this.request=new Request.HTMLDeferred({url:this.options.urls.getPVP,data:{videoId:this.options.videoKey,categoryPath:this.options.categoryPath},update:this.template.getElement(".post-video-promotions-extension-contents"),onSuccess:this._onRequestSuccess.bind(this),onFailure:this._onRequestFailure.bind(this)}),this.request.deferResults(!0),this.requestTimer=function(){this.request.send()}.delay(this.options.requestDelay,this)},_onRequestFailure:function(a){Uverse.console.error("[PostVideoPromotionExtension]","Request error")},playerFinished:function(){this.request.deferResults(!1)},_onRequestSuccess:function(a,b,c,d){this.template.removeClass("hidden"),this.loadedWidgets=Uverse.loader.processQueue({preventLazyLoad:!0}),this.loadedWidgets.load(),this._setupReplay(),this._setupPaging()},_setupReplay:function(){var a=this.template.getElement(".control-button-replay");a.addEvent("click:button(left)",this._onReplayClick.bindAndPassThis(this))},_onReplayClick:function(a,b){b.preventDefault(),Uverse.page.reloadCurrentUrl()},_setupPaging:function(){var a=this.template.getElement(".post-video-promotions-page-left"),b=this.template.getElement(".post-video-promotions-page-right");a.addEvent("click",function(a){this.pager.movePage(-1)}.bind(this)),b.addEvent("click",function(a){this.pager.movePage(1)}.bind(this));var c=null,d=this.template.getElement(".post-video-promotions-pager-wrapper"),e={sliderElementSelector:".post-video-promotions-tiles"},f={pageChanged:function(d,e){0===d?a.hide():a.show(),d==e?b.hide():b.show(),c.removeClass("bullet-active"),c[d].addClass("bullet-active")}};this.pager=new Uverse.utils.Pager(d,e,f);for(var g=this.template.getElement(".post-video-promotions-page-bullets-container"),h=this.template.getElement(".post-video-promotions-page-bullet"),i=1;i<this.pager.pageCount;i++)g.adopt(h.clone()),g.appendText(" ");c=g.getChildren(),c.addEvent("click",function(a,b){this.pager.setPage(c.indexOf(a))}.bindAndPassThis(this)),this.pager.pageCount<=1&&g.addClass("hidden"),this.pager.setPage(0)},destroyExtension:function(){this.requestTimer&&(clearInterval(this.requestTimer),this.requestTimer=null),this.request&&(this.request.cancel(),this.request=null),this.loadedWidgets&&(this.loadedWidgets.unload(),this.loadedWidgets.destroy(),this.loadedWidgets=null)}}),Uverse.playerExtensions.RecommendationsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{videoKey:null,cardControllerOptions:{reusableTemplates:!0}},cardController:null,recommendationsService:null,recommendationsContainer:null,initialize:function(a,b){this.setOptions(a),this.setCallbacks(b),this._setupCardController(),this._setupRecommendationsService(),this._setupViewModel()},_setupViewModel:function(){this.viewModel={recommendationCards:ko.observableArray([]),cardController:this.cardController,hasRecommendations:ko.observable(!1)}},_setupCardController:function(){this.cardController=new Uverse.widgets.cards.CardController(this.options.cardControllerOptions)},_setupRecommendationsService:function(){this.recommendationsService=new Uverse.services.RecommendationsService},playerLoaded:function(a,b){this.recommendationsContainer=b.getElement(".modal-player-recommendations-container"),this.recommendationsContainer&&(this.recommendationsContainer.removeClass("hidden"),ko.applyBindings(this.viewModel,this.recommendationsContainer),this.viewModel.hasRecommendations()&&this.recommendationsService.getPlayerRecommendations(5,this.options.videoKey,function(a){this.viewModel.recommendationCards(a)}.bind(this)))}}),Uverse.playerExtensions.StreamNotifierExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_onWindowUnload"],options:{videoKey:null,releaseUrl:"/releaseStream.html"},player:null,token:null,fallback:{token:null,videoKey:null},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoaded:function(a,b){null==this.token&&(this.player=a,this.player.addEvent("contentStart",this._obtainToken.bind(this)),this.player.addEvent("streamReady",this._obtainToken.bind(this)))},_obtainToken:function(){var a=this.player.getStreamToken();null!=a&&(null==this.token?(window.addEvent("unload",this._onWindowUnload),this.token=a,Uverse.console.log("[StreamNotifierExtension]","Obtained Stream Token: ",this.token)):this.token!=a&&(this.token=a,Uverse.console.log("[StreamNotifierExtension]","Obtained NEW Stream Token: ",this.token)),this.fallback.token=this.player.getFallbackToken(),this.fallback.videoKey=this.player.getFallbackVideoKey())},destroyExtension:function(){null!==this.token&&window.removeEvent("unload",this._onWindowUnload),this._releaseTokens(!0)},_onWindowUnload:function(){this._releaseTokens(!1)},_releaseTokens:function(a){null!=this.token&&(this._callRelease(this.token,this.options.videoKey,a),this.token=null),null!=this.fallback.token&&(this._callRelease(this.fallback.token,this.fallback.videoKey,a),this.fallback.token=null)},_callRelease:function(a,b,c){Uverse.console.log("[StreamNotifierExtension]","Releasing Stream",c?" (asynchronously)":""),c||Uverse.console.time("[StreamNotifierExtension] Releasing Stream took");var d=new Request({url:this.options.releaseUrl,async:c});d.post({token:a,videoKey:b}),c||Uverse.console.timeEnd("[StreamNotifierExtension] Releasing Stream took")}}),Uverse.playerExtensions.VideoBookmarksExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,Binds:["_onWindowBeforeUnload","_onBookmarksReady"],enabled:!0,player:null,startPosition:-1,template:null,removeRequest:null,setRequest:null,setRequestAsync:null,setWhenClosed:!1,options:{videoKey:null,safeVideoKey:null,urls:{setBookmark:"/bookmarks/set.html",removeBookmark:"/bookmarks/remove.html"},dontBookmarkWithin:{initialSeconds:10,finalSeconds:10}},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){return this.enabled=Uverse.page.isUserLoggedIn(),this.enabled?(this.template=a.getElement(".video-bookmarks-extension"),this._setupRequests(),void Uverse.page.addMemoryEvent("Bookmarks-ready:once",this._onBookmarksReady)):void this.callbacks.complete()},_onBookmarksReady:function(){var a=Uverse.page.getVideoBookmark(this.options.safeVideoKey);if(!a)return void this.callbacks.complete();var b=window.location.hash.contains("resume"),c=window.location.hash.contains("restart");b?this._chooseResume(a):c?this._chooseRestart():this._displayBookmark(a)},_displayBookmark:function(a){this._setupForm(a),this._updateTemplate(a),this.template.removeClass("hidden")},_setupForm:function(a){var b={submit:function(b,c){this._onButtonClicked(b,c,a)}.bind(this)},c=this.template.getElement("form");this.formWidget=new Uverse.controls.Form(c,b)},_updateTemplate:function(a){var b={percent:(100*(a.position/a.totalTime)).toFixed(0),position:this._formatDuration(a.position),totalTime:this._formatDuration(a.totalTime),dateWatched:new Date(a.dateWatched)},c=this.template.getElement(".player-extension-title"),d=this.template.getElement(".video-bookmarks-progress-text"),e=this.template.getElement(".progress-bar-complete");c.set("html",b.dateWatched.format(c.get("html"))),d.set("html",d.get("html").substitute(b)),e.setStyle("width",b.percent+"%")},_onButtonClicked:function(a,b,c){b.resume?this._chooseResume(c):b.restart&&this._chooseRestart(),this.template.addClass("hidden")},_chooseResume:function(a){this.startPosition=a.position,this.callbacks.complete()},_chooseRestart:function(){this._removeBookmark(),this.callbacks.complete()},playerLoaded:function(a,b){this.enabled&&(this._setupPlayer(a),this._setupEvents(),this.setWhenClosed=!0)},_setupRequests:function(){this.setRequest=new Request({url:this.options.urls.setBookmark,async:!1}),this.setRequestAsync=new Request({url:this.options.urls.setBookmark,async:!0}),this.removeRequest=new Request({url:this.options.urls.removeBookmark})},_setupPlayer:function(a){this.player=a,this.player.addEvent("stateChange",this._onPlayerStateChange.bind(this)),this.player.addEvent("contentStart",this._onContentStart.bind(this)),this.player.addEvent("contentEnd",this._onContentEnd.bind(this)),this.player.addEvent("videoEnd",this._onVideoEnd.bind(this))},_setupEvents:function(){window.addEvent("beforeunload",this._onWindowBeforeUnload)},_teardownEvents:function(){window.removeEvent("beforeunload",this._onWindowBeforeUnload)},_onWindowBeforeUnload:function(){var a=!1;this._setBookmark(a)},_formatDuration:function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":""+b+":")+(10>c&&b>0?"0"+c:""+c)+":"+(10>d?"0"+d:""+d)},_onContentStart:function(){if(this._removeBookmark(),this.startPosition>0){var a=this.startPosition;this.startPosition=-1,this.player.seek(a),this.player.videoPlaying=!0}},_onContentEnd:function(){this._removeBookmark()},_onVideoEnd:function(){this._removeBookmark(),this._teardownEvents(),this.setWhenClosed=!1},_onPlayerStateChange:function(a){if("paused"==a){var b=!0;this._setBookmark(b)}},_setBookmark:function(a){if(this.player.hasContentStarted()){var b=this.player.getPosition(),c=this.player.getDuration(),d=b<this.options.dontBookmarkWithin.initialSeconds||b>c-this.options.dontBookmarkWithin.finalSeconds;if(d)this._removeBookmark();else{var e=this.options.videoKey;Uverse.console.log("[VideoBookmarksExtension]","Setting the bookmark for",e," at ",b,a?"(asynchronously)":""),a||Uverse.console.time("[VideoBookmarksExtension] Setting bookmark took");var f=a?this.setRequestAsync:this.setRequest;f.get({videoKey:e,position:b,totalTime:c});var g={position:b,totalTime:c,dateWatched:new Date};Uverse.page.setVideoBookmark(this.options.safeVideoKey,g),a||Uverse.console.timeEnd("[VideoBookmarksExtension] Setting bookmark took")}}},_removeBookmark:function(){var a=this.options.videoKey;Uverse.console.log("[VideoBookmarksExtension]","Removing the bookmark for ",a),this.removeRequest.get({videoKey:a}),Uverse.page.setVideoBookmark(this.options.safeVideoKey,null)},destroyExtension:function(){if(this.setWhenClosed){this.setWhenClosed=!1;var a=!0;this._setBookmark(a)}this._teardownEvents()}}),Uverse.playerExtensions.WebtrendsExtension=new Class({Extends:Uverse.playerExtensions.ExtensionAware,options:{videoCategory:null,parentTitle:null,pageImpression:null,playerImpression:null},initialize:function(a,b){this.setOptions(a),this.setCallbacks(b)},playerLoading:function(a){var Webtrends=window.Webtrends;Webtrends&&(Webtrends.multiTrack({args:{"WT.dl":this.options.dl,"WT.clip_ev":this.options.eventName,"WT.clip_n":this.options.title,"WT.clip_id":this.options.videoId,"WT.z_Clip_Category":this.options.videoCategory,"WT.z_Clip_Series":this.options.parentTitle,"WT.z_pageImpression":this.options.pageImpression}}),Uverse.console.log("[WebtrendsExtension]","MultiTracked page impression"),Webtrends.multiTrack({args:{"WT.z_modalPageView":this.options.title}}),Uverse.console.log("[WebtrendsExtension]","MultiTracked page view")),this.callbacks.complete()},playerLoaded:function(a,b){var Webtrends=window.Webtrends;Webtrends&&(Webtrends.multiTrack({args:{"WT.dl":this.options.dl,"WT.clip_ev":this.options.eventName,"WT.clip_n":this.options.title,"WT.clip_id":this.options.videoId,"WT.z_Clip_Category":this.options.videoCategory,"WT.z_Clip_Series":this.options.parentTitle,"WT.z_playerImpression":this.options.playerImpression}}),Uverse.console.log("[WebtrendsExtension]","MultiTracked player impression"))}}),Uverse.players.BigTen=new Class({Extends:Uverse.players.Player,options:{script:"http://e1.cdnl3.neulion.com/fox/player/btn2go/scripts/swfobject.js",scriptId:"BigTen",containerId:"btn2goplayerdiv",large:!0,deviceOrStreamManagementEnabled:!0},swfurl:"http://e1.cdnl3.neulion.com/fox/player/btn2go/mvpd.swf",expressInstall:"http://e1.cdnl3.neulion.com/fox/player/btn2go/scripts/expressInstall.swf",playerProps:{flashVars:{server:"http://www.btn2go.com/btn2go/",mvpd:"att",epgrange:"3",bgcolor:"002B55",fgcolor:"00b4ED"},attributes:{id:"btn2goplayerdiv",name:"btn2goplayerdiv",align:"middle"},params:{quality:"high",bgcolor:"#000000",allowScriptAccess:"always",allowFullScreen:"true",wmode:"direct"}},initialize:function(a,b){window.iptvReadyCallback=this._iptvReadyCallback.bind(this),this.parent(a,b),this.mergeEnvironmentConfigWithObject(this.playerProps.flashVars),this._addIDToCompanionAdEl()},onScriptLoaded:function(){swfobject.embedSWF(this.swfurl,this.options.containerId,"100%","496","10.2.0",this.expressInstall,this.playerProps.flashVars,this.playerProps.params,this.playerProps.attributes)},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},_iptvReadyCallback:function(){$(this.options.containerId).playChannel(),this.fireEvent("ready")},_setupTokenHandler:function(){var a={tokenError:this.onPlayerError.bind(this),tokenRetrieved:this._tokenRetrieved.bind(this)};this.tokenHandler=new Uverse.utils.TokenHandler(a),this.tokenHandler.sendAuthenticationRequest(this.itemID)},_tokenRetrieved:function(a,b,c){this.streamToken=b,this.playToken=a.tokenString,this.heartbeat=c,this.onContentStart()},_isTokenCallRequired:function(){return this.options.deviceOrStreamManagementEnabled&&null===this.streamToken},load:function(a,b){this.key=a,this.itemID=b,this._isTokenCallRequired()?this._setupTokenHandler():this.onContentStart(),this.onSwfObjectLoaded($(this.options.containerId))},getStreamToken:function(){return this.streamToken},getPlayToken:function(){return this.playToken},getHeartbeat:function(){return this.heartbeat}}),Uverse.players.Cbs=new Class({Extends:Uverse.players.Player,options:{swf:"AttPlayer.swf",swfWidth:880,swfHeight:495,containerId:"cbsPlayer",large:!0,vars:{partner:"att"}},impressionContainerEl:null,initialize:function(a,b){this.parent(a,b)},_initializeGoogleTagServices:function(){Uverse.console.log("[CBS]","Google Tag Services Initializing"),Asset.javascript("//www.googletagservices.com/tag/js/gpt.js",{async:!0,onload:this._setupGoogleTagServices.bind(this)})},_setupGoogleTagServices:function(){Uverse.console.log("[CBS]","Google Tag Services Setup");var a=window.googletag.defineSlot("/8264/vaw-can/att",[300,60],"companionAdContainer");a.addService(window.googletag.pubads()),a.addService(window.googletag.companionAds()),window.googletag.pubads().enableVideoAds(),window.googletag.companionAds().setRefreshUnfilledSlots(!0),window.googletag.enableServices(),window.googletag.display("companionAdContainer")},onPlayerReady:function(){this.parent(),Uverse.config.players.callbacks.cbs[this.swfObject.id]={adStart:this._onAdStart.bind(this),adEnd:this._onAdEnd.bind(this),videoStart:this.onVideoStart.bind(this),videoEnd:this.onVideoEnd.bind(this),contentStart:this.onContentStart.bind(this),contentEnd:this.onContentEnd.bind(this),stateChange:this.onStateChange.bind(this)},this.swfObject.addListener("videoStart","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".videoStart"),this.swfObject.addListener("videoEnd","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".videoEnd"),this.swfObject.addListener("adStart","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".adStart"),this.swfObject.addListener("adEnd","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".adEnd"),this.swfObject.addListener("contentStart","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".contentStart"),this.swfObject.addListener("contentEnd","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".contentEnd"),this.swfObject.addListener("stateChange","Uverse.config.players.callbacks.cbs."+this.swfObject.id+".stateChange"),this._initializeGoogleTagServices()},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.smallAd();break;case"finished":}},_onAdStart:function(a){this.onAdStart()},_onAdEnd:function(a){this.onAdEnd()},load:function(a){this.key=a,this.swfObject.loadVideoById(a)},replay:function(){this.swfObject.loadVideoById(this.key)},pause:function(){this.swfObject.pauseVideo()},stop:function(){this.swfObject.loadVideoById("")},resume:function(){this.swfObject.resumeVideo()},isVideoPlaying:function(){return this.swfObject.isVideoPlaying()},getDuration:function(){return this.swfObject.getDuration()},getPosition:function(){return this.swfObject.getPosition()},seek:function(a){this.swfObject.pauseVideo(),this.swfObject.seekTo(a)}}),Uverse.players.Disney=new Class({Extends:Uverse.players.Player,options:{swf:"AttDisneyPlayer.swf",swfWidth:880,swfHeight:495,containerId:"disneyPlayer",large:!0,vars:{}},initialize:function(a,b){this.parent(a,b)},onPlayerReady:function(){this.parent(),Uverse.config.players.callbacks.disney[this.swfObject.id]={adStart:this._onAdStart.bind(this),adEnd:this._onAdEnd.bind(this),videoStart:this.onVideoStart.bind(this),videoEnd:this.onVideoEnd.bind(this),contentStart:this.onContentStart.bind(this),contentEnd:this.onContentEnd.bind(this),stateChange:this.onStateChange.bind(this),videoError:this.onPlayerError.bind(this),streamReady:this.onStreamReady.bind(this)},this.swfObject.addListener("videoStart","Uverse.config.players.callbacks.disney."+this.swfObject.id+".videoStart"),this.swfObject.addListener("videoEnd","Uverse.config.players.callbacks.disney."+this.swfObject.id+".videoEnd"),this.swfObject.addListener("adStart","Uverse.config.players.callbacks.disney."+this.swfObject.id+".adStart"),this.swfObject.addListener("adEnd","Uverse.config.players.callbacks.disney."+this.swfObject.id+".adEnd"),this.swfObject.addListener("contentStart","Uverse.config.players.callbacks.disney."+this.swfObject.id+".contentStart"),this.swfObject.addListener("contentEnd","Uverse.config.players.callbacks.disney."+this.swfObject.id+".contentEnd"),this.swfObject.addListener("stateChange","Uverse.config.players.callbacks.disney."+this.swfObject.id+".stateChange"),this.swfObject.addListener("displayableError","Uverse.config.players.callbacks.disney."+this.swfObject.id+".videoError"),this.swfObject.addListener("streamReady","Uverse.config.players.callbacks.disney."+this.swfObject.id+".streamReady")},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},_onAdStart:function(a){this.onAdStart()},_onAdEnd:function(a){this.onAdEnd()},load:function(a){this.key=a,this.swfObject.loadVideoById(a)},replay:function(){this.swfObject.loadVideoById(this.key)},pause:function(){this.swfObject.pauseVideo()},stop:function(){this.swfObject.loadVideoById("")},resume:function(){this.swfObject.resumeVideo()},isVideoPlaying:function(){return this.swfObject.isVideoPlaying()},getDuration:function(){return this.swfObject.getDuration()},getPosition:function(){return this.swfObject.getPosition()},seek:function(a){this.swfObject.pauseVideo(),this.swfObject.seekTo(a),this.swfObject.resumeVideo()},exitFullScreen:function(){try{this.swfObject.exitFullScreen()}catch(a){Uverse.console.warn("[Disney]","Failed to exit fullscreen."),Uverse.console.throwAway(a)}},getStreamToken:function(){return this.swfObject.GetStreamToken()}}),Uverse.players.ESPN=new Class({Extends:Uverse.players.Player,options:{swf:"AttESPNPlayer.swf",swfWidth:880,swfHeight:495,containerId:"ESPNPlayer",large:!0,vars:{}},initialize:function(a,b){this.parent(a,b)},onPlayerReady:function(){this.parent(),Uverse.config.players.callbacks.espn[this.swfObject.id]={adStart:this._onAdStart.bind(this),adEnd:this._onAdEnd.bind(this),videoStart:this.onVideoStart.bind(this),videoEnd:this.onVideoEnd.bind(this),contentStart:this.onContentStart.bind(this),contentEnd:this.onContentEnd.bind(this),stateChange:this.onStateChange.bind(this),videoError:this.onPlayerError.bind(this),streamReady:this.onStreamReady.bind(this)},this.swfObject.addListener("videoStart","Uverse.config.players.callbacks.espn."+this.swfObject.id+".videoStart"),this.swfObject.addListener("videoEnd","Uverse.config.players.callbacks.espn."+this.swfObject.id+".videoEnd"),this.swfObject.addListener("adStart","Uverse.config.players.callbacks.espn."+this.swfObject.id+".adStart"),this.swfObject.addListener("adEnd","Uverse.config.players.callbacks.espn."+this.swfObject.id+".adEnd"),this.swfObject.addListener("contentStart","Uverse.config.players.callbacks.espn."+this.swfObject.id+".contentStart"),this.swfObject.addListener("contentEnd","Uverse.config.players.callbacks.espn."+this.swfObject.id+".contentEnd"),this.swfObject.addListener("stateChange","Uverse.config.players.callbacks.espn."+this.swfObject.id+".stateChange"),this.swfObject.addListener("displayableError","Uverse.config.players.callbacks.espn."+this.swfObject.id+".videoError"),this.swfObject.addListener("streamReady","Uverse.config.players.callbacks.espn."+this.swfObject.id+".streamReady")},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},_onAdStart:function(a){this.onAdStart()},_onAdEnd:function(a){this.onAdEnd()},load:function(a){this.key=a,this.swfObject.loadVideoById(a)},replay:function(){this.swfObject.loadVideoById(this.key)},pause:function(){this.swfObject.pauseVideo()},stop:function(){this.swfObject.loadVideoById("")},resume:function(){this.swfObject.resumeVideo()},isVideoPlaying:function(){return this.swfObject.isVideoPlaying()},getDuration:function(){return this.swfObject.getDuration()},getPosition:function(){return this.swfObject.getPosition()},seek:function(a){this.swfObject.pauseVideo(),this.swfObject.seekTo(a)},exitFullScreen:function(){try{this.swfObject.exitFullScreen()}catch(a){Uverse.console.warn("[ESPN]","Failed to exit fullscreen."),Uverse.console.throwAway(a)}},getStreamToken:function(){return this.swfObject.GetStreamToken()}}),Uverse.players.Extend=new Class({Extends:Uverse.players.Player,options:{swf:"AttExtendPlayer.swf",swfWidth:880,swfHeight:496,large:!1,vars:{remoteUrl:null,layoutStandard:null,playerLocation:null,videoKey:null,videoNetwork:null}},videoStartFired:!1,contentEndFired:!1,initialize:function(a,b){this.setOptions(b),this.options.vars.remoteUrl&&"/"==this.options.vars.remoteUrl.charAt(this.options.vars.remoteUrl.length-1)&&(this.options.vars.remoteUrl=this.options.vars.remoteUrl.substr(0,this.options.vars.remoteUrl.length-1)),this.options.vars.layoutStandard=this.options.swfWidth+"x"+this.options.swfHeight,this.parent(a,this.options)},onPlayerReady:function(){this.parent(),Uverse.config.players.callbacks.extend[this.swfObject.id]={playlistEnd:this._onPlaylistEnd.bind(this),stateChange:this._onStateChange.bind(this),playlistItemStart:this._onPlaylistItemStart.bind(this),playlistItemEnd:this._onPlaylistItemEnd.bind(this),videoError:this._onVideoError.bind(this)},this.swfObject.registerEvent("StateChange","Uverse.config.players.callbacks.extend."+this.swfObject.id+".stateChange"),this.swfObject.registerEvent("PlaylistItemStartEvent","Uverse.config.players.callbacks.extend."+this.swfObject.id+".playlistItemStart"),this.swfObject.registerEvent("PlaylistItemEndEvent","Uverse.config.players.callbacks.extend."+this.swfObject.id+".playlistItemEnd"),this.swfObject.registerEvent("PlaylistEnd","Uverse.config.players.callbacks.extend."+this.swfObject.id+".playlistEnd"),this.swfObject.registerEvent("VideoError","Uverse.config.players.callbacks.extend."+this.swfObject.id+".videoError")},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},_onStateChange:function(a){this.videoStartFired||"playing"!=a||(this.onVideoStart(),this.videoStartFired=!0),"opening"==a&&this.hasContentStarted()&&(this.contentStarted=!1),"stopped"==a&&0===this.getDuration()&&this.onStateChange("killed"),this.onStateChange(a)},_onPlaylistItemStart:function(a){var b=a[0].Options.AdSlot;b>0?this.onAdStart():this.hasContentStarted()||(this.contentEndFired=!1,this.onContentStart())},_onPlaylistItemEnd:function(a){var b=a[0].Options.AdSlot;b>0?this.onAdEnd():Math.abs(this.getDuration()-this.getPosition())<5&&(this.contentEndFired||(this.contentEndFired=!0,this.onContentEnd()))},_onPlaylistEnd:function(){this.onVideoEnd()},onContentStart:function(){this.parent()},onContentEnd:function(){this.parent()},_onVideoError:function(a){this.onPlayerError(a)},load:function(a,b){this.fullKey=b,this.swfObject.LoadVideo(b)},replay:function(){this.swfObject.LoadVideo(this.fullKey)},pause:function(){this.swfObject.Pause()},stop:function(){this.swfObject.PlayerStop()},resume:function(){this.swfObject.PlayerPlay()},isVideoPlaying:function(){return this.swfObject.IsVideoPlaying()},getPosition:function(){return Math.round(this.swfObject.GetPlaybackPosition()/1e3)},getDuration:function(){return this.swfObject.GetPlaybackDuration()},seek:function(a){this.swfObject.Seek(1e3*a)},getPlayToken:function(){return this.swfObject.GetPlayToken()},getStreamToken:function(){return this.swfObject.GetStreamToken()}}),Uverse.players.ExtendAds=new Class({Extends:Uverse.players.Extend,companionAdID:"adComponent",options:{large:!1},initialize:function(a,b){this.parent(a,b),this._addIDToCompanionAdEl(),this._createAdHtml()},updatePlayer:function(a){switch(a){case"content":this.largePlayer(),this.smallAd();break;case"ad":this.smallPlayer(),this.largeAd();break;case"loading":this.smallAd();break;case"finished":this.smallAd()}},largePlayer:function(){this.parent(),this._setSize(this.playerSizes.largeWidth,this.playerSizes.height)},smallPlayer:function(){this.parent(),this._setSize(this.playerSizes.smallWidth,this.playerSizes.height)},largeAd:function(){this.parent(),this._hasBannerAd()&&(this.adWrapper.removeClass("hidden"),this.bannerWrapper.addClass("hidden"))},smallAd:function(){this.parent(),this._hasBannerAd()&&(this.adWrapper.addClass("hidden"),this.bannerWrapper.removeClass("hidden"))},_setSize:function(a,b){this.swfObject&&(this.swfObject.width=a,this.swfObject.height=b,this.swfObject.SetSize(a,b))},_hasBannerAd:function(){return!!this.bannerWrapper},_createAdHtml:function(){var a="external_sidebar";this.adWrapper=new Element("div",{"class":"adWrapper"}).inject(this.adComponent),this.adWrapper.adopt(new Element("span",{id:a,name:a,"class":"_fwph"}).adopt(new Element("form",{id:"_fw_form_"+a,styles:{display:"none"}}).adopt(new Element("input",{type:"hidden",name:"_fw_input_"+a,id:"_fw_input_"+a,value:"w=300&h=250&ptgt=p"})),new Element("span",{id:"_fw_container_"+a,"class":"_fwac"})));var b="external_banner";this.bannerWrapper=new Element("div",{"class":"bannerWrapper"}).inject(this.adComponent),this.bannerWrapper.adopt(new Element("span",{id:b,name:b,"class":"_fwph"}).adopt(new Element("form",{id:"_fw_form_"+b,styles:{display:"none"}}).adopt(new Element("input",{type:"hidden",name:"_fw_input_"+b,id:"_fw_input_"+b,value:"w=300&h=60&ptgt=p"})),new Element("span",{id:"_fw_container_"+b,"class":"_fwac"})))}}),Uverse.players.FoxLive=new Class({Extends:Uverse.players.Player,options:{playerApi:null},el:null,playerID:"videoPlayerComponent",key:null,remoteUrl:null,itemId:null,iframe:{markup:'<iframe id="video-player" src="http://video.foxnews.com/v/video-embed.html?{parameters}{location}" width="{width}" height="{height}" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe>',parameters:{video_id:"{key}",w:"{width}",h:"{height}",autoplay:"true",token_service:null,share:"false",email:"false"}},initialize:function(a,b){this.el=a,this.parent(this.el,Object.merge({containerId:this.playerID},b)),this.iframe.parameters.token_service=Uverse.config.token.urls.tokenFoxLive},build:function(){this.buildContainer(),this.onPlayerReady()},load:function(a,b){this.key=a,this.itemId=b,this.hasContentStarted()||this._executeFoxScriptManually()},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},_executeFoxScriptManually:function(){var a;if(a=document.location.hostname,void 0!==window.top.location)try{a=window.top.location.hostname}catch(b){}a=a.replace("www.",""),$("videoPlayerComponent").set("html",this._getVhtml(a)),this._injectFoxScript(),this.onContentStart()},_getVhtml:function(a){var b=this.iframe.markup.substitute({parameters:this._toQueryString(this.iframe.parameters),height:this.playerSizes.height,width:this.playerSizes.largeWidth});
return b.substitute({key:this.key,itemId:this.options.itemId,remoteUrl:this.options.remoteUrl,height:this.playerSizes.height,width:this.playerSizes.largeWidth,location:"&amp;loc="+a})},_toQueryString:function(a){var b=[];return $H(a).each(function(a,c){b.push(c+"="+a)}),b.join("&")},_injectFoxScript:function(){Asset.javascript(this.options.playerApi)}}),Uverse.players.FoxOnDemand=new Class({Extends:Uverse.players.Player,options:{swfWidth:880,swfHeight:495},playerContainerID:"videoPlayerComponent",companionAdID:"adComponent",iframe:{markup:'<iframe id="video-player" src="/staticcontent/foxPlayerIframe.html?id={playerContainerID}&releaseURL={releaseURL}&width={width}&height={height}&fb=false&playerIndex=1&debug=undefined&suppliedId={playerContainerID}&iframePlayerId=js-player-1&iframeHeight={height}&iframeWidth={width}" width="{width}" height="{height}" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe>'},tokenHandler:null,tokenError:null,initialize:function(a,b){this.parent(a,Object.merge({containerId:this.playerContainerID,large:!1},b))},build:function(){this.buildContainer(),this.onPlayerReady()},_getFinalIframeMarkup:function(){return this.iframe.markup.substitute({playerContainerID:this.playerContainerID,releaseURL:this.options.vars.sourceLink,width:this.options.swfWidth,height:this.options.swfHeight})},_setupTokenHandler:function(){var a={tokenError:this.onPlayerError.bind(this),tokenRetrieved:this._tokenRetrieved.bind(this)};this.tokenHandler=new Uverse.utils.TokenHandler(a),this.tokenHandler.sendAuthenticationRequest(this.itemID)},_tokenRetrieved:function(a,b){this.playToken=a.tokenString,this.streamToken=b,this.onContentStart()},_isTokenCallRequired:function(){return this.options.deviceOrStreamManagementEnabled&&null===this.streamToken},load:function(a,b){this.key=a,this.itemID=b,this._isTokenCallRequired()?this._setupTokenHandler():this.onContentStart(),this.onSwfObjectLoaded($(this.playerContainerID)),$("videoPlayerComponent").set("html",this._getFinalIframeMarkup())},getStreamToken:function(){return this.streamToken},getPlayToken:function(){return this.playToken}}),Uverse.players.Hbo=new Class({Extends:Uverse.players.Player,activeVideoKey:null,playerID:"videoPlayerComponent",iframe:{markup:'<iframe id="hbo_iframe" src="{path}?key={videoKey}&aff={affiliate}" frameborder="0" scrolling="no" height="496" width="882"></iframe>',parameters:{affiliate:"ATT"}},initialize:function(a,b){this.el=a,this.parent(this.el,Object.merge({containerId:this.playerID},b))},build:function(){this.buildContainer(),this.onPlayerReady()},load:function(a,b){this.iframe.parameters.videoKey=a,this.iframe.parameters.path=this.getEnvironmentConfigValue("iframeSrc"),$(this.playerID).set("html",this.iframe.markup.substitute(this.iframe.parameters))}}),Uverse.players.Hulu=new Class({Extends:Uverse.players.Player,advertPlayed:!1,anythingPlayed:!1,companionAdID:"adComponent",options:{script:null,scriptTemplate:"http://config.hulu.com/js/hulu_global.js?guid=0B1CEA04-DCCB-40cf-AD0E-5222EF66D519&partner=ATT&width={smallWidth}&height={height}&wmode=transparent",scriptId:"NS_GUID_JS",containerId:"videoPlayerComponent"},initialize:function(a,b){this.parent(a,b),this.options.script=String.substitute(this.options.scriptTemplate,{smallWidth:this.playerSizes.smallWidth,height:this.playerSizes.height}),"undefined"!=typeof NewSite&&(NewSite=void 0),this._addIDToCompanionAdEl()},onScriptLoaded:function(){var a={newsiteReady:this.onPlayerReady.bind(this),videoAdBegin:this.onAdStart.bind(this),videoAdEnd:this.onAdEnd.bind(this),videoStart:this._onContentStart.bind(this),videoComplete:this._onContentEnd.bind(this),theEnd:this.onVideoEnd.bind(this),videoStateChange:this.onStateChange.bind(this)};NewSite.addListener("newsiteReady",a),NewSite.addListener("videoAdBegin",a),NewSite.addListener("videoAdEnd",a),NewSite.addListener("videoStart",a),NewSite.addListener("videoComplete",a),NewSite.addListener("theEnd",a),NewSite.addListener("videoStateChange",a)},updatePlayer:function(a){switch(a){case"content":this.largePlayer(),this.smallAd();break;case"ad":this.smallPlayer(),this.largeAd();break;case"loading":this.smallAd();break;case"finished":this.smallAd()}},onAdStart:function(){this.parent(),this.advertPlayed=!0},onAdEnd:function(){this.parent()},onLargePlayerStart:function(){NewSite.videoPlayerComponent.setSize(this.playerSizes.largeWidth,this.playerSizes.height)},onSmallPlayerComplete:function(){NewSite.videoPlayerComponent.setSize(this.playerSizes.smallWidth,this.playerSizes.height)},_onContentStart:function(a){this.videoPlaying=!0,this.anythingPlayed||(this.onVideoStart(),this.anythingPlayed=!0);var b="clip"===a;b&&this.onContentStart()},_onContentEnd:function(a){var b="clip"===a;b&&this.onContentEnd()},load:function(a){this.key=a,NewSite.videoPlayerComponent.playVideo(a),this.onSwfObjectLoaded(NewSite.videoPlayerComponent.getInstance())},replay:function(){NewSite.videoPlayerComponent.playVideo(this.key)},pause:function(){this.videoPlaying=!1,NewSite.videoPlayerComponent.pauseVideo()},resume:function(){this.videoPlaying=!0,NewSite.videoPlayerComponent.resumeVideo()},seek:function(a){NewSite.videoPlayerComponent.seek(a)},stop:function(){this.videoPlaying=!1,NewSite.videoPlayerComponent.stopVideo()},getPosition:function(){return Math.round(NewSite.videoPlayerComponent.getCurrentTime())},getDuration:function(){return Math.round(NewSite.videoPlayerComponent.getProperty("duration"))}}),Uverse.players.Mtv=new Class({Extends:Uverse.players.Player,playStates:["playing","playstates.playing"],duration:0,initialize:function(a,b){this.parent(a,Object.merge({containerId:"mtvPlayer",large:!0,swfWidth:880,swfHeight:495,vars:{autoPlay:"true",orig:"att"}},b)),window.mtvnPlayerLoaded=function(){Uverse.config.players.callbacks.mtv[this.swfObject.id]={onMetadata:this._onMetadata.bind(this),onPlaylistComplete:this.onVideoEnd.bind(this),onStateChange:this._onStateChange.bind(this),onMediaEnded:this.onContentEnd.bind(this)},this.swfObject.addEventListener("METADATA","Uverse.config.players.callbacks.mtv."+this.swfObject.id+".onMetadata"),this.swfObject.addEventListener("PLAYLIST_COMPLETE","Uverse.config.players.callbacks.mtv."+this.swfObject.id+".onPlaylistComplete"),this.swfObject.addEventListener("STATE_CHANGE","Uverse.config.players.callbacks.mtv."+this.swfObject.id+".onStateChange"),this.swfObject.addEventListener("MEDIA_ENDED","Uverse.config.players.callbacks.mtv."+this.swfObject.id+".onMediaEnded")}.bind(this)},build:function(){this.buildContainer(),this.updatePlayer("loading"),this.onPlayerReady()},_onMetadata:function(a){a.duration&&a.duration>0&&(this.duration=Math.round(a.duration))},onVideoStart:function(){this.parent()},_onStateChange:function(a){!this.contentStarted&&this.playStates.contains(a)&&this.duration>0&&(this.onVideoStart(),this.onContentStart()),this.onStateChange(a)},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},load:function(a){this.key=a;var b="http://media.mtvnservices.com/"+a,c=new Swiff(b,Object.merge({container:this.container},this.swiffOptions));this.swfObject=$(c)},replay:function(){this.load(this.key)},pause:function(){this.swfObject.pause()},stop:function(){this.swfObject.stopPlayer()},resume:function(){this.swfObject.unpause()},getDuration:function(){return this.duration},getPosition:function(){return Math.round(this.swfObject.getPlayheadTime())},seek:function(a){this.swfObject.setPlayheadTime(a)}}),Uverse.players.NBCU=new Class({Extends:Uverse.players.Player,options:{swfWidth:960,swfHeight:360},playerContainerID:"videoPlayerComponent",iframe:{markup:'<iframe id="nbcu-video-player"src="/staticcontent/nbcuPlayerIframe.html?&releaseUrl={releaseUrl}&playerUrl={playerUrl}&iframeHeight={height}&iframeWidth={width}&isSpecialUrl={isSpecialUrl}"width="{width}"height="{height}"marginwidth="0"marginheight="0"frameborder="0"></iframe>'},initialize:function(a,b){this.parent(a,Object.merge({containerId:this.playerContainerID,large:!1},b)),this._isSpecialPlayerUrl()&&(this.options.swfHeight=540)},build:function(){this.buildContainer(),this.onPlayerReady()},_getFinalIframeMarkup:function(){return this.iframe.markup.substitute({playerContainerID:this.playerContainerID,playerUrl:encodeURIComponent(this._getPlayerUrl()),releaseUrl:encodeURIComponent(this.options.vars.sourceLink),width:this.options.swfWidth,height:this.options.swfHeight,isSpecialUrl:this._isSpecialPlayerUrl()})},load:function(a,b){var c=$(this.playerContainerID);this.key=a,this.itemID=b,this._isTokenCallRequired()?this._setupTokenHandler():this.onContentStart(),this.onSwfObjectLoaded(c);var d=this._getFinalIframeMarkup();c.set("html",d)},_getPlayerUrl:function(){var a="?MVPDid="+Uverse.config.nbcuPlayerMvpd+"&FWsiteSection="+this.options.playerConfig.siteSection,b=this.options.playerConfig.urls,c;return this.options.isLive?this._isSpecialPlayerUrl()?c=b.specialLive[this.options.videoNetwork]:(c=b.live,a=encodeURIComponent(a)):(c=b.vod,a=encodeURIComponent(a)),c+=a},_isSpecialPlayerUrl:function(){return this.options.isLive&&!!this.options.playerConfig.urls.specialLive[this.options.videoNetwork]},_setupTokenHandler:function(){var a={tokenError:this.onPlayerError.bind(this),tokenRetrieved:this._tokenRetrieved.bind(this)};this.tokenHandler=new Uverse.utils.TokenHandler(a),this.tokenHandler.sendAuthenticationRequest(this.itemID)},_tokenRetrieved:function(a,b,c){this.streamToken=b,this.playToken=a.tokenString,this.heartbeat=c,this.onContentStart()},_isTokenCallRequired:function(){return this.options.deviceOrStreamManagementEnabled&&null===this.streamToken},getStreamToken:function(){return this.streamToken},getPlayToken:function(){return this.playToken},getHeartbeat:function(){return this.heartbeat}}),Uverse.players.NFL=new Class({Extends:Uverse.players.Player,options:{containerId:"nflPlayerContainer",script:"http://e1.cdnl3.neulion.com/nfl/player2013-v2/nflno/scripts/swfobject.js",scriptId:"NFL"},swfurl:"http://e1.cdnl3.neulion.com/nfl/player2013-v2/nflno/norze.swf",expressInstall:"http://e1.cdnl3.neulion.com/nfl/player2013-v2/nflno/scripts/expressInstall.swf",playerProps:{flashVars:{server:"http://nflnonline.nfl.com/nflno/",locqos:"http://nlqosdrecv01.neulion.com/nfldrecvx/ProxyBean",mvpd:"ATT",readyCallback:"nflReadyCallback"},flashVarsForNFL:{norz:"true"},flashVarsForRedZone:{hasrz:"true",nonfln:"true"},attributes:{id:"nflPlayerContainer",name:"nflPlayerContainer",align:"middle"},params:{quality:"high",bgcolor:"#000000",allowScriptAccess:"always",allowFullScreen:"true",wmode:"direct"}},initialize:function(a,b){window.nflReadyCallback=this._nflReadyCallback.bind(this),this.parent(a,b),this._setupFlashVarsForNFLOrRedZone(),this.mergeEnvironmentConfigWithObject(this.playerProps.flashVars)},_setupFlashVarsForNFLOrRedZone:function(){var a=this.options.itemId,b=this.playerProps;switch(a){case"nfl:redzone":Object.merge(b.flashVars,b.flashVarsForRedZone);break;case"nfl:nfl":default:Object.merge(b.flashVars,b.flashVarsForNFL)}},_setupTokenHandler:function(){var a={tokenError:this.onPlayerError.bind(this),tokenRetrieved:this._tokenRetrieved.bind(this)};this.tokenHandler=new Uverse.utils.TokenHandler(a),this.tokenHandler.sendAuthenticationRequest(this.options.itemId)},_tokenRetrieved:function(a,b){this.playToken=a.tokenString,this.streamToken=b,this.onContentStart()},onScriptLoaded:function(){swfobject.embedSWF(this.swfurl,this.options.containerId,"100%","496","10.2.0",this.expressInstall,this.playerProps.flashVars,this.playerProps.params,this.playerProps.attributes)},_nflReadyCallback:function(){delete window.nflReadyCallback;var a=$(this.options.containerId);try{a.playGame()}catch(b){Uverse.console.error("[NFL]","Failure calling playGame (can be caused by not being on the WhiteList)"),Uverse.console.throwAway(b)}this.fireEvent("ready")},load:function(){var a=$(this.options.containerId);this._setupTokenHandler(),this.onSwfObjectLoaded(a)}}),Uverse.players.OSMF=new Class({Extends:Uverse.players.Player,options:{swf:"osmfnextgenplayer{version}.swf",swfSubFolder:"osmf",swfWidth:880,swfHeight:496,large:!1,vars:{remoteUrl:null,layoutStandard:null,playerLocation:null,videoKey:null,videoNetwork:null,akamaiPluginURL:null,autoPlay:!0},swiffOptions:{wmode:"direct"}},companionAdID:"adComponent",versionKey:Uverse.config.players.versions.osmf,videoStartFired:!1,contentEndFired:!1,initialize:function(a,b){this.setOptions(b),this.options.vars.remoteUrl&&"/"==this.options.vars.remoteUrl.charAt(this.options.vars.remoteUrl.length-1)&&(this.options.vars.remoteUrl=this.options.vars.remoteUrl.substr(0,this.options.vars.remoteUrl.length-1)),this.options.vars.layoutStandard=this.options.swfWidth+"x"+this.options.swfHeight,this.options.vars.akamaiPluginURL=Uverse.config.players.options.vars.osmfAkamaiPluginUrl,this.parent(a,this.options),this._addIDToCompanionAdEl(),this.adComponent&&this._createAdHtml()},onPlayerReady:function(){var a=Uverse.config.players.callbacks.osmf[this.swfObject.id]={StateChange:this.onStateChange.bind(this),AdStart:this.onAdStart.bind(this),AdEnd:this.onAdEnd.bind(this),ContentStart:this.onContentStart.bind(this),ContentEnd:this.onContentEnd.bind(this),VideoError:this.onPlayerError.bind(this),PlaybackComplete:this.onVideoEnd.bind(this),CaptionMarkerReached:this._onCaptionMarkerReached.bind(this),CaptionState:this._onCaptionState.bind(this),CuePoint:this._onCuePoint.bind(this)},b="Uverse.config.players.callbacks.osmf."+this.swfObject.id;Object.each(a,function(a,c){this.swfObject.registerEvent(c,b+"."+c)},this),this.parent()},_createAdHtml:function(){var a="external_sidebar";this.adWrapper=new Element("div",{"class":"adWrapper"}).inject(this.adComponent),this.adWrapper.adopt(new Element("span",{id:a,name:a,"class":"_fwph"}).adopt(new Element("form",{id:"_fw_form_"+a,styles:{display:"none"}}).adopt(new Element("input",{type:"hidden",name:"_fw_input_"+a,id:"_fw_input_"+a,value:"w=300&h=250&ptgt=p"})),new Element("span",{id:"_fw_container_"+a,"class":"_fwac"})));var b="external_banner";this.bannerWrapper=new Element("div",{"class":"bannerWrapper"}).inject(this.adComponent),this.bannerWrapper.adopt(new Element("span",{id:b,name:b,"class":"_fwph"}).adopt(new Element("form",{id:"_fw_form_"+b,styles:{display:"none"}}).adopt(new Element("input",{type:"hidden",name:"_fw_input_"+b,id:"_fw_input_"+b,value:"w=300&h=60&ptgt=p"})),new Element("span",{id:"_fw_container_"+b,"class":"_fwac"})))},updatePlayer:function(a){if(this.adComponent)switch(a){case"content":this.largePlayer(),this.smallAd();break;case"ad":this.smallPlayer(),this.largeAd();break;case"loading":this.smallAd();break;case"finished":this.smallAd()}},largePlayer:function(){this.parent(),this._setSize(this.playerSizes.largeWidth,this.playerSizes.height)},smallPlayer:function(){this.parent(),this._setSize(this.playerSizes.smallWidth,this.playerSizes.height)},largeAd:function(){this.parent(),this._hasBannerAd()&&(this.adWrapper.removeClass("hidden"),this.bannerWrapper.addClass("hidden"))},smallAd:function(){this.parent(),this._hasBannerAd()&&(this.adWrapper.addClass("hidden"),this.bannerWrapper.removeClass("hidden"))},_setSize:function(a,b){this.swfObject&&(this.swfObject.width=a,this.swfObject.height=b)},_hasBannerAd:function(){return!!this.bannerWrapper},onStateChange:function(a){"playing"==a&&this.onVideoStart(),"opening"==a&&this.hasContentStarted()&&(this.contentStarted=!1),"stopped"==a&&0===this.getDuration()&&this.parent("killed"),this.parent(a)},onVideoStart:function(){this.videoStartFired||(this.videoStartFired=!0,this.parent())},_onCaptionMarkerReached:function(a){},_onCaptionState:function(a){},_onCuePoint:function(){},load:function(a,b){},replay:function(){this.swfObject.LoadVideo(this.fullKey)},pause:function(){this.swfObject.Pause()},stop:function(){this.swfObject.PlayerStop()},resume:function(){this.swfObject.PlayerPlay()},isVideoPlaying:function(){return this.swfObject.IsVideoPlaying()},getPosition:function(){return Math.round(this.swfObject.GetPlaybackPosition()/1e3)},getDuration:function(){return Math.round(this.swfObject.GetPlaybackDuration()/1e3)},seek:function(a){this.swfObject.Seek(1e3*a)},getPlayToken:function(){return this.swfObject.GetPlayToken()},getStreamToken:function(){return this.swfObject.GetStreamToken()}}),Uverse.players.Silverlight=new Class({Extends:Uverse.players.Player,attPlayerBridge:null,smfPlayerBridge:null,silverlightElID:null,silverlightPlayer:null,xapLocation:"AttSilverlightPlayer.xap",remoteUrl:null,disableControls:null,additionalContentCategoryPath:null,noSilverlightPanelClass:"no-silverlight-wrapper",noSilverlightClass:"noSilverlight",hasError:!1,userBandwidth:null,currentSegment:null,totalSegments:null,PLAYER_AD_TYPES:null,initialize:function(a,b){this.parent(a,Object.merge({large:void 0!==b.large?b.large:!0,script:Uverse.config.jsLibPath+"silverlight/silverlight-5.1.20125.min.js?cache=true",scriptId:"silverlight",containerId:"videoPlayerComponent"},b)),this.xapLocation=b.playerLocation+this.xapLocation,this.silverlightElID="silverlightPlayer_"+b.uid,this.remoteUrl=b.remoteUrl,this.disableControls=b.disableControls||!1,this.additionalContentCategoryPath=b.additionalContentCategoryPath,this.asStart=!1,this.PLAYER_AD_TYPES={preroll:this.AD_TYPE.PRE,midroll:this.AD_TYPE.MID,postroll:this.AD_TYPE.POST}},onScriptLoaded:function(){this.options.requiresBandwidthReport?Uverse.page.addMemoryEvent("userBandwidth-ready",this._onUserBandwidthReportReady.bind(this)):this._onReadyToStartSilverlight()},_onUserBandwidthReportReady:function(a){this.userBandwidth=a,this._onReadyToStartSilverlight()},_onReadyToStartSilverlight:function(){this.silverlightPlayer=Silverlight.createObjectEx({source:this.xapLocation,parentElement:this.container,id:this.silverlightElID,properties:{width:this.playerSizes.largeWidth,height:this.playerSizes.height,background:"black",enableHtmlAccess:"true",windowless:"true",alt:this.getNoFlashContainerHTML()},events:{onError:this.silverlightPlayerError.bind(this),onLoad:this.silverlightPlayerReady.bind(this)},initParams:"remoteUrl="+this.remoteUrl+",disableControls="+this.disableControls+",additionalContentCategoryPath="+this.additionalContentCategoryPath+this._getBandwidthInitParam()})},_getBandwidthInitParam:function(){return this.userBandwidth?(Uverse.console.log("[Silverlight]","Adding 'bandwidth' to initParams with value of: "+this.userBandwidth),",bandwidth="+this.userBandwidth):""},getNoFlashContainerHTML:function(){var a=$$("."+this.noSilverlightPanelClass)[0].clone();return a.getFirst().removeClass("hidden"),a.get("html")},silverlightPlayerReady:function(){var a=$(this.silverlightElID);this.attPlayerBridge=a.Content.AttPlayer,this.smfPlayerBridge=a.Content.SmfPlayer,this.smfPlayerBridge.PlayStateChanged=this.onStateChange.bind(this),this.smfPlayerBridge.MediaOpened=this.onContentStart.bind(this),this.smfPlayerBridge.MediaEnded=this.onContentEnd.bind(this),this.attPlayerBridge.BitrateChanged=this.onBitrateChanged.bind(this),this.attPlayerBridge.StreamReady=this.onStreamReady.bind(this),this.attPlayerBridge.AdEvent=this.onAdEvent.bind(this),this.attPlayerBridge.VideoSegmentEvent=this.onVideoSegmentEvent.bind(this),this.attPlayerBridge.DefaultCaptionSettingsChanged=this.onPersonalizedCaptionSettingsChanged.bind(this),this.loadPersonalizedCaptionSettings(),this.onPlayerReady()},silverlightPlayerError:function(a,b){var c=b.ErrorType;this.onPlayerError("ManagedRuntimeError"==c?b.ErrorMessage:b)},onStateChange:function(a,b){this.hasError||(Uverse.console.log("[Silverlight]","State Changed: "+b.Result.toLowerCase()),"stopped"==b.Result.toLowerCase()&&(this.hasError=!0)),this.parent(b.Result.toLowerCase())},onBitrateChanged:function(a,b){this.parent(b.CurrentBitrate,b.MaximumBitrate)},onAdEvent:function(a,b){b.IsAdStart?this.onAdStart(this.PLAYER_AD_TYPES[b.AdType]):this.onAdEnd()},onVideoSegmentEvent:function(a,b){b.IsSegmentStart?(this.totalSegments=b.TotalSegments,this.onSegmentStart(b.SegmentNumber)):this.onSegmentEnd()},onContentEnd:function(){Uverse.console.log("[Silverlight]","On Content End"),this.onVideoEnd(),this.parent()},onContentStart:function(){Uverse.console.log("[Silverlight]","On Content Start"),this.onVideoStart(),this.parent()},onStreamReady:function(){Uverse.console.log("[Silverlight]","On Stream Ready"),this.parent()},onPersonalizedCaptionSettingsChanged:function(a,b){Uverse.page.storeToCache("personalizedCaptionSettings",this.attPlayerBridge.PersonalizedCaptionSettings,!1)},supportsBitrateEvents:function(){return!0},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.largePlayer(),this.noAd();break;case"finished":}},load:function(a,b){this.itemId=b,this.attPlayerBridge.LoadVideo(b)},replay:function(){this.attPlayerBridge.LoadVideo(this.itemId)},pause:function(){this.smfPlayerBridge.Pause()},resume:function(){this.smfPlayerBridge.Play()},stop:function(){this.smfPlayerBridge.Stop()},getPosition:function(){try{return Math.round(this.attPlayerBridge.PlaybackPositionSeconds)}catch(a){Uverse.console.log("[Silverlight]","Unable to retrieve Playback Position")}},getDuration:function(){try{return Math.round(this.attPlayerBridge.EndPositionSeconds)}catch(a){Uverse.console.log("[Silverlight]","Unable to retrieve Duration")}},seek:function(a){try{this.smfPlayerBridge.SeekToPosition(a)}catch(b){Uverse.console.log("[Silverlight]","Unable to seek to the specified position")}},getPlayToken:function(){return this.attPlayerBridge.GetPlayToken()},getStreamToken:function(){return this.getPlayToken()},getFallbackToken:function(){return this.attPlayerBridge.GetFallbackToken()},getFallbackVideoKey:function(){return this.attPlayerBridge.GetFallbackVideoKey()},isEmpty:function(a){var b;for(b in a)return!1;return!0},loadPersonalizedCaptionSettings:function(){var a=Uverse.page.retrieveFromCache("personalizedCaptionSettings",!1);if(a&&!this.isEmpty(a))try{this.attPlayerBridge.PersonalizedCaptionSettings=a}catch(b){Uverse.console.log("[Silverlight]","Error loading personalized caption settings.")}}}),Uverse.players.Turner=new Class({Extends:Uverse.players.Player,playerID:"videoPlayerComponent",cvpCallbacks:{},cvpInstance:null,key:null,itemID:null,metaDataExists:!1,envConfigName:"turner",tokenHandler:null,isSimulcast:!1,provider:null,environment:null,sid:null,callbackUrl:null,x:null,t:null,initialize:function(a,b){this.cvpCallbacks={onPlayerReady:this.onPlayerReady.bind(this),onContentBegin:this.onVideoStart.bind(this),onContentComplete:this.onVideoEnd.bind(this),onContentPlay:this._onContentStart.bind(this),onContentEnd:this.onContentEnd.bind(this),onAdPlay:this.onAdStart.bind(this),onAdEnd:this.onAdEnd.bind(this),onContentMetadata:this.onContentMetaData.bind(this),onContentPause:this._onStateChange.bind(this)},this.parent(a,Object.merge({script:b.playerApi,scriptId:this.provider,containerId:this.playerID,large:!1},b)),this.provider=this._getTurnerNetworkNameFromNetwork(b.videoNetwork),this.environment=this.getEnvironmentConfigValue("env"),this._addIDToCompanionAdEl(),"undefined"!=typeof CVPPartner?(this.options.ignoreScript=!0,this.onScriptLoaded()):this._consoleWorkaroundSave()},_consoleWorkaroundSave:function(){Browser.ie8&&window.console&&(this.consoleWorkaround=window.console,window.console=void 0)},_consoleWorkaroundRestore:function(){Browser.ie8&&this.consoleWorkaround&&(window.console=this.consoleWorkaround,this.consoleWorkaround=null)},onScriptLoaded:function(){this._consoleWorkaroundRestore(),CVPPartner.init(this._cvpInitSuccess.bind(this),this._cvpInitFailure.bind(this),!0)},_cvpInitSuccess:function(){this.cvpInstance=CVPPartner.createTVEInstance(this.playerSizes.smallWidth,this.playerSizes.height,this.playerID,this.cvpCallbacks,this.provider,Array({adWidth:300,adHeight:250,adDomID:this.companionAdID}),{wmode:"opaque"},this.environment,this.isSimulcast)},_cvpInitFailure:function(){Uverse.console.error("[Turner]","CVP Init Failure"),this.onPlayerError("CVP Init Failure")},_getTurnerNetworkNameFromNetwork:function(a){var b=(a+"").toLowerCase();switch(b){case"tru":return"trutv";case"ctn":case"cn":return"cartoonnetwork";case"as":return"adultswim";case"hln":return"cnn";case"cartoonnetwork":case"adultswim":case"trutv":case"tnt":case"tbs":case"cnn":case"tcm":return b;default:throw Error("Invalid network provider specified: "+b)}},_setupTokenHandler:function(){var a={tokenError:this.onPlayerError.bind(this),tokenRetrieved:this._tokenRetrieved.bind(this)};this.tokenHandler=new Uverse.utils.TokenHandler(a),this.tokenHandler.sendAuthenticationRequest(this.itemID)},_tokenRetrieved:function(a,b){this._playVideoWithToken(a.tokenString),this.streamToken=b},_playVideoWithToken:function(a){this.cvpInstance.resize(this.playerSizes.smallWidth,this.playerSizes.height),this.cvpInstance.play(this.key,{accessToken:a,accessTokenType:"xmlsig"}),this.videoPlaying=!0},updatePlayer:function(a){switch(a){case"content":this.largePlayer(),this.noAd();break;case"ad":this.smallPlayer(),this.largeAd();break;case"loading":this.setAdStyleNeverSmall(),this.noAd();break;case"finished":this.noAd()}},onAdStart:function(){this.parent()},onAdEnd:function(){this.parent()},onLargePlayerStart:function(){},onLargePlayerComplete:function(){this.cvpInstance.resize(this.playerSizes.largeWidth,this.playerSizes.height)},onSmallPlayerComplete:function(){this.cvpInstance.resize(this.playerSizes.smallWidth,this.playerSizes.height)},_onStateChange:function(a,b){var c=b?"paused":"playing";this.onStateChange(c)},onVideoEnd:function(){this.parent()},onVideoStart:function(){this.parent()},_onContentStart:function(){this.onVideoStart(),this.onContentStart()},onContentMetaData:function(a,b){this.metaDataExists=!0},load:function(a,b){this.key=a,this.itemID=b,this._setupTokenHandler(),this.onSwfObjectLoaded(this.cvpInstance.getDOMPlayer())},replay:function(){this.load(this.key,this.itemID)},pause:function(){this.cvpInstance.pause(),this.videoPlaying=!1},resume:function(){this.cvpInstance.resume(),this.videoPlaying=!0},stop:function(){this.cvpInstance.pause(),this.cvpInstance.seek(0),this.videoPlaying=!1},getPosition:function(){return Math.round(this.cvpInstance.getPlayhead())},getDuration:function(){return this.metaDataExists?this.cvpInstance.getDuration():0},seek:function(a){this.cvpInstance.seek(a),this.videoPlaying=!0},getStreamToken:function(){return this.streamToken}}),Uverse.players.TurnerSimulcast=new Class({Extends:Uverse.players.Turner,isSimulcast:!0}),Uverse.players.Vevo=new Class({Extends:Uverse.players.Player,playerContainerID:"videoPlayerComponent",vevoEmbedDirectory:"",envConfigName:"vevo",vevoObjectParms:{flashVars:{playerType:"embedded",videoId:null,playlist:"false",enableDomScan:"true",siteSection:"ATandT_ATandT.com",playerId:"62FF0A5C-0D9E-4AC1-AF04-1D9E97EE3961",autoplay:"1",endScreen:"play",cc:"US",cultureName:"en-US",cultureIsRTL:"False",sbId:"05c1ca10-5260-4799-b332-eb23ee59fc59"},parms:{bgcolor:"#000000",allowFullScreen:"true",allowScriptAccess:"always",wmode:"transparent"},attributes:{id:"vevoPlayer"}},initialize:function(a,b){this.parent(a,Object.merge({script:b.playerApi,scriptId:"vevoJS",containerId:this.playerContainerID,large:!1},b)),this._addIDToCompanionAdEl(),this.vevoEmbedDirectory=this.getEnvironmentConfigValue("swfLocation")},onScriptLoaded:function(){this.onPlayerReady()},updatePlayer:function(a){switch(a){case"content":break;case"ad":break;case"loading":this.setAdStyleNeverSmall(),this.smallPlayer(),this.largeAd();break;case"finished":this.noAd()}},_generateSWFAndPlay:function(){swfobject.embedSWF(this.vevoEmbedDirectory,this.playerContainerID,this.playerSizes.smallWidth,this.playerSizes.height,"10.1.53",!1,this.vevoObjectParms.flashVars,this.vevoObjectParms.parms,this.vevoObjectParms.attributes),window.vevoVideoComplete=this._vevoVideoComplete.bind(this),this.adComponent.set("html",this._getVevoAdHTML()),this.onContentStart()},_vevoVideoComplete:function(){this.onVideoEnd()},_getVevoAdHTML:function(){return'<span id="comp_300x250" class="_fwph"><form id="_fw_form_comp_300x250" style="display:none" ><input type="hidden" name="_fw_input_comp_300x250" id="_fw_input_comp_300x250" value="ptgt=p&envp=g_iframe_js&slau=300x250_Companion1|300x60_Companion1|300x250|300x60&slid=comp_300x250&cd=300,250|300,60&flag=+fcai+niic" /></form><span id="_fw_container_comp_300x250" class="_fwac"></span></span>'},_addKeyToFlashVars:function(){this.vevoObjectParms.flashVars.videoId=this.key},load:function(a){this.key=a,this._addKeyToFlashVars(),this._generateSWFAndPlay(),this.onSwfObjectLoaded(swfobject.getObjectById("vevoPlayer"))},pause:function(){this.videoPlaying=!1,swfobject.getObjectById("vevoPlayer")._pause()},resume:function(){this.videoPlaying=!0,swfobject.getObjectById("vevoPlayer")._play()}}),Uverse.services.AutoAuthService=new Class({initialize:function(){},request:function(a){a(!1)}}),Uverse.services.InHomeService=new Class({cookies:{usePlugin:"usePlugin",dismissedNewAutoAuth:"dismissedNewAutoAuth"},initialize:function(){this.newAutoAuth=ko.observable(!0),this.usePlugin=ko.observable(!Uverse.config.autoAuth.enabled),this.autoLoggedIn=ko.observable(!1),this.inHome=ko.observable(!1),this.applet=Uverse.page.getInHomeApplet(),this.autoAuth=new Uverse.services.AutoAuthService,this._readCookies(),this._bindCookies(),this._bindInHome(),this.checkInHomeStatus()},checkInHomeStatus:function(){this.usePlugin()?this.checkAppletStatus():this.checkAutoAuthStatus()},checkAppletStatus:function(){this.applet.recheckInHomeStatus()},checkAutoAuthStatus:function(){this.autoAuth.request(function(a){this.autoLoggedIn(a)}.bind(this))},subscribe:function(a){this.applet.setupApplet(),a(this.inHome()),this.inHome.subscribe(a)},_readCookies:function(){var a=Cookie.read(this.cookies.usePlugin),b=Cookie.read(this.cookies.dismissedNewAutoAuth);null!==a&&this.usePlugin("true"===a),null!==b&&this.newAutoAuth("true"!==b)},_bindCookies:function(){this.usePlugin.subscribe(function(a){Cookie.write(this.cookies.usePlugin,a)}.bind(this)),this.newAutoAuth.subscribe(function(a){Cookie.write(this.cookies.dismissedNewAutoAuth,!a)}.bind(this))},_bindInHome:function(){this.autoLoggedIn.subscribe(function(a){this.inHome(a)}.bind(this)),this.applet.subscribe(function(a){this.inHome(a)}.bind(this))}}),Uverse.services.RecommendationsService=new Class({cache:[],currentIndex:0,cacheIndex:0,options:{landingPageUrl:"/rest/recommendations/landingPages/HOME",categoryPageUrl:"/rest/recommendations/categoryPage",playerPageUrl:"/rest/recommendations/playerPage"},initialize:function(){},_setupRequest:function(a,b){return new Request.JSON({url:a,method:"get",onSuccess:this._onRequestSuccess.bind(this,b),onFailure:this._onRequestFailure.bind(this,b),autoRetry:!0})},_makePageBatchRequest:function(a){Uverse.console.log("[RecommendationsService] Loading "+a.batchSize+" recommendations");var b={startTile:a.firstTileIndex,count:a.batchSize,isLoggedIn:Uverse.page.isLoggedIn()};this._setupRequest(this.options.landingPageUrl,a).send({data:b})},_makeCategoryPageRequest:function(a){Uverse.console.log("[RecommendationsService] Loading recommendations for "+a.categoryPath);var b={count:a.batchSize,categoryPath:a.categoryPath,isLoggedIn:Uverse.page.isLoggedIn()};this._setupRequest(this.options.categoryPageUrl,a).send({data:b})},_makePlayerRequest:function(a){Uverse.console.log("[RecommendationsService] Loading recommendations for "+a.videoKey);var b={count:a.batchSize,videoId:a.videoKey,isLoggedIn:Uverse.page.isLoggedIn()};this._setupRequest(this.options.playerPageUrl,a).send({data:b})},_onRequestSuccess:function(a,b){var c=b.cards;this.cache=this.cache.concat(c),c.length!==a.batchSize&&a.fillFromCache&&(Uverse.console.warn("[RecommendationsService] There are no more recommendations, starting over"),c=this._fillCardsWithCache(c,a.batchSize)),a.callback(c)},_onRequestFailure:function(a){Uverse.console.error("[RecommendationsService] Request failed!");var b=this._fillCardsWithCache([],a.batchSize);a.callback(b)},_fillCardsWithCache:function(a,b){for(var c=a.length;b>c;++c)a.push(this.cache[this.cacheIndex]),++this.cacheIndex;
return a},getPageBatch:function(a,b,c){var d={batchSize:a,firstTileIndex:b,callback:c,fillFromCache:!0};this._makePageBatchRequest(d),this.currentIndex+=d.batchSize},getCategoryRecommendations:function(a,b,c){var d={batchSize:a,callback:c,fillFromCache:!1,categoryPath:b};this._makeCategoryPageRequest(d)},getPlayerRecommendations:function(a,b,c){var d={batchSize:a,callback:c,fillFromCache:!1,videoKey:b};this._makePlayerRequest(d)}});
//# sourceMappingURL=Uverse.combined.min.map.js