(function (j) {
    var w = '<div id="siBar-wrapper" class="v3"><!--[if lte IE 8]><div class="ie8"><![endif]--><ul class="inner"><li id="siBar-sicom" class="nav-item sicom si-logo"></li><li id="siBar-social-facebook" class="nav-item facebook"><div class="icon"><a target="_blank"></a></div></li><li id="siBar-social-twitter" class="nav-item twitter"><div class="icon"><a href="#" target="_blank"></a></div></li><li id="siBar-top-stories" class="nav-item"><a href="#" target="_self"><span>Top Stories</span></a></li><li id="siBar-blogs" class="nav-item"><a href="http://tracking.si.com/?sct=nbar_blogs" target="_self"><span>Blogs</span></a><div id="siBar-blogs-drop" class="story-drop dropdown"><div class="blog-index col-left"></div><div class="middle"></div><div class="blog-stories col-right"></div><div class="lip"></div></div></li><li id="siBar-extramustard" class="nav-item"><a href="#" target="_self"><span>Extra Mustard</span></a></li><li id="siBar-edge" class="nav-item"><a href="#" target="_blank"><span>Edge</span></a></li><li id="siBar-swim" class="nav-item"><a href="#" target="_self"><span>Swimsuit</span></a></li><li id="siBar-more" class="nav-item more"><span>Partners</span></li><li id="siBar-newsletter" class="nav-item newsletter"><span>Newsletter</span></li><li id="siBar-magazine" class="nav-item magazine"><a href="#" target="_blank"><span>Magazine</span></a></li></ul><!--[if IE]></div><![endif]--></div>',
        x = (window.location.hostname.match(/turner\.com|siblogs\.com/i)) ? "dev" : "prod",
        s = /Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent),
        f = (x === "dev") ? "http://sipreview.turner.com:84" : "http://sportsillustrated.cnn.com",
        t = (x === "dev") ? "/.element/ssi/sibar/siBar.json.html" : "/.element/ssi/sibar/siBar.json.html",
        h = "",
        y = "nbar_si",
        o = "nbar_top_dd",
        n = "nbar_blogs_dd",
        A = "nbar_em_dd",
        r = "nbar_fn_dd",
        a = "nbar_swim_dd",
        e = "",
        u = (function () {
            if (typeof j().on === "function") {
                return "on"
            } else {
                if (typeof j().live === "function") {
                    return "live"
                } else {
                    if (typeof j().bind === "function") {
                        return "bind"
                    }
                }
            }
        }()),
        d, z, g, b, m, q, p, c, k, v, l;
    v = function () {
        j("body").prepend(w);
        var ref = document.referrer;
        if (ref.match(/^https?:\/\/([^\/]+\.)?aol\.com(\/|$)/i)) {
            var aolBar = '<div id="aol" style="top:0px"><a href="' + ref + '"><img src="http://i.cdn.turner.com/si/.element/img/4.2/global/back-to-aol.png" alt="Back to AOL"></a></div>';
            $('body').prepend(aolBar);
            $('#siBar-wrapper').css('top', 32);
            $('#aol').css('top', 0);
            $('#aol').css('position', 'absolute');
            $('.cnnPage').css('margin-top', 64);
            $('#wrapper-content').css('margin-top', 32);
        }
        j.getScript(f + t)
    };
    window.siBar_loadData = function (D) {
        var C, F, E, B;
        z(D.more);
        g(D.blogs);
        b();
        p(D.subscribe);
        c(D.sicom);
        k(D.topstories, "top-stories");
        m(D.extramustard, "extramustard");
        m(D.swimDaily, "swimdaily");
        k(D.fannation, "fannation");
        d(D.swimModels, D.swimDaily);
        F = j("#siBar-newsletter-submit");
        E = j("#siBar-newsletter-input");
        B = j("#siBar-newsletter-validation");
        F[u]("click", function (G) {
            var H = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
            B.css("visibility", "hidden");
            if (!E.val().match(H)) {
                B.css("visibility", "visible");
                G.preventDefault()
            }
            return true
        })
    };

    function i(B) {
        if ((B.indexOf("sportsillustrated.cnn.com") !== -1) || (B.indexOf("si.com") !== -1)) {
            h = "?sct="
        } else {
            h = "?xid="
        }
    }
    l = function () {
        var B = window.location.host,
            C = {
                extramustard: /siextramustard\.wordpress\.com|extramustard\.si\.com|local\.siblogs\.com/
            };
        j.each(C, function (D, E) {
            if (B.match(E)) {
                j("#siBar-" + D).addClass("active");
                return false
            }
        })
    };
    c = function (D) {
        var B = j("#siBar-sicom-drop"),
            C, E;
        D.image = "img/sibar-logo-v2.png";
        E = '<a href="' + D.url + '" title="' + D.title + "?sct=" + y + '" target="_self" class="si-logo"></a>';
        j("#siBar-sicom").prepend(E);
        C = '<ul class="drop-nav">';
        j.each(D.navigation, function (F, G) {
            C += '<li><a href="' + G.url + '" target="_self">' + G.title + "</a></li>"
        });
        C += "</ul>";
        B.prepend(C)
    };
    p = function (B) {
        j("#siBar-subscribe-link").attr("href", B.url)
    };
    k = function (F, D) {
        var B, E, C;
        C = (D === "fannation") ? "_blank" : "_self";
        B = j("#siBar-" + D + "-drop");
        if (D === "fannation") {
            e = r
        } else {
            e = o
        }
        E = '<ul class="drop-nav">';
        j.each(F, function (G, H) {
            i(H.link);
            if (G === 0) {
                E += '<li class="topstory story"><a href="' + H.link + h + e + '" target="' + C + '"><div class="thumb"><img src="' + H.image + '"/></div><div class="story"><div class="timestamp">' + H.date + '</div><h2 class="headline">' + H.title + "</h2></div></a><li>"
            } else {
                E += ((G === (F.length - 1)) ? '<li class="story last">' : '<li class="story">') + '<a href="' + H.link + h + e + '" target="' + C + '"><div class="timestamp">' + H.date + '</div><h3 class="headline">' + H.title + "</h3></a></li>"
            }
        });
        E += "</ul>";
        B.prepend(E)
    };
    m = function (D, G, F) {
        var B, C, E;
        F = F || false;
        if (D.length === 0) {
            return
        }
        B = j("#siBar-" + G + "-drop");
        if (G === "swim" || G === "swimdaily") {
            e = a
        } else {
            if (G === "extramustard") {
                e = A
            }
        }
        C = '<ul class="drop-nav">';
        j.each(D, function (H, I) {
            E = (typeof I.images === "object" && typeof I.images["the-image"] !== "undefined" && typeof I.images["the-image"].url === "string") ? I.images["the-image"].url : false;
            if (H > 4) {
                return
            }
            i(I.url);
            if (H === 0 && E) {
                C += '<li class="topstory story"><a href="' + I.url + h + e + '" target="_self"><div class="thumb"><img src="' + E + '"/></div><div class="story"><div class="timestamp">' + I.firstPublished + '</div><h2 class="headline">' + I.headline + "</h2></div></a><li>"
            } else {
                C += ((H === 4) ? '<li class="story last">' : '<li class="story">') + '<a href="' + I.url + h + e + '" target="_self"><div class="timestamp">' + I.firstPublished + '</div><h3 class="headline">' + I.headline + "</h3></a></li>"
            }
        });
        C += "</ul>";
        if (!F) {
            B.prepend(C)
        } else {
            return C
        }
    };
    d = function (E, C) {
        var B, D;
        B = j("#siBar-swim-drop");
        D = '<div class="models col-left"><a href="http://sportsillustrated.cnn.com/swimsuit" target="_self"><div class="swimsuit-logo"></div></a><div class="clear"></div>';
        D += q(E);
        D += '</div><div class="middle"></div>';
        D += '<div class="stories col-right"><a href="http://swimdaily.si.com" target="_self"><div class="swimdaily-logo"></div></a><div class="clear"></div>';
        D += m(C, "swim", true);
        D += "</div>";
        B.prepend(D)
    };
    q = function (G) {
        var C = function (K, J) {
                return Math.floor(Math.random() * (J - K + 1)) + K
            },
            E = [],
            I = [],
            H = G,
            B = 4,
            F = "",
            D;
        while (E.length < B) {
            D = C(0, (H.length - 1));
            if (j.inArray(D, I) === -1) {
                E.push(H[D]);
                I.push(D)
            }
        }
        j.each(E, function (J, K) {
            F += '<div class="model-wrapper"><a href="http://sportsillustrated.cnn.com' + K.uri + "?sct=" + a + '" title="' + K.name + '" target="_self"><div class="model"><img class="image" src="' + K.image + '"/><span class="name">' + K.name + "</span></div></a></div>"
        });
        return F
    };
    b = function () {
        var B = j("#siBar-blogs-drop DIV.col-left"),
            F = ["SI Wire", "Audibles", "Campus Union", "The Strike Zone", "The Point Forward", "Home Ice", "Counterpunch", "One And One", "Beyond The Baseline"],
            G = {
                "SI Wire": {
                    pattern: /tracking\.si\.com/i,
                    link: "http://tracking.si.com/?sct=" + n,
                    sport: "NEWS"
                },
                "Beyond The Baseline": {
                    pattern: /tennis\.si\.com/i,
                    link: "http://tennis.si.com/?sct=" + n,
                    sport: "Tennis"
                },
                "The Point Forward": {
                    pattern: /nba\.si\.com/i,
                    link: "http://nba.si.com/?sct=" + n,
                    sport: "NBA"
                },
                "Home Ice": {
                    pattern: /nhl\.si\.com/i,
                    link: "http://nhl.si.com/?sct=" + n,
                    sport: "NHL"
                },
                Audibles: {
                    pattern: /nfl\.si\.com/i,
                    link: "http://nfl.si.com/?sct=" + n,
                    sport: "NFL"
                },
                "Campus Union": {
                    pattern: /college\-football\.si\.com/i,
                    link: "http://college-football.si.com/?sct=" + n,
                    sport: "NCAAF"
                },
                Counterpunch: {
                    pattern: /mma\-boxing\.si\.com/i,
                    link: "http://mma-boxing.si.com/?sct=" + n,
                    sport: "MMA"
                },
                "The Strike Zone": {
                    pattern: /mlb\.si\.com/i,
                    link: "http://mlb.si.com/?sct=" + n,
                    sport: "MLB"
                },
                "One And One": {
                    pattern: /college\-basketball\.si\.com/i,
                    link: "http://college-basketball.si.com/?sct=" + n,
                    sport: "NCAAB"
                }
            },
            C, E, D, H;
        C = '<ul class="blog-index">';
        for (E = 0; E < F.length; E += 1) {
            D = F[E];
            H = G[D];
            C += '<li><a href="' + H.link + '"><strong>' + H.sport + ":</strong> " + D + "</a></li>"
        }
        C += "</ul>";
        B.prepend(C)
    };
    g = function (F) {
        var B = j("#siBar-blogs-drop DIV.col-right"),
            E, H, G, C, D;
        E = '<ul class="drop-nav">';
        j.each(F, function (I, J) {
            J.sourceName = J.sourceName || "";
            if (I > 3) {
                return false
            }
            if (I === 0) {
                J.image = (function (K) {
                    var L = false;
                    j.each(K, function (N, M) {
                        if (M.url) {
                            L = M.url;
                            return false
                        }
                    });
                    return L
                }(J.images))
            }
            i(J.url);
            E += ((I === 3) ? '<li class="story last">' : '<li class="story">') + ((I === 0 && typeof J.image === "string") ? '<div class="thumb"><img src="' + J.image + '"/></div>' : "") + '<div class="timestamp">' + J.firstPublished + '</div><a href="' + J.url + h + n + '" target="_self"><h3 class="headline">' + J.headline + "</h3></a></li>"
        });
        B.prepend(E)
    };
    z = function (D) {
        var B = j("#siBar-more-drop"),
            C;
        C = '<ul class="drop-nav">';
        j.each(D, function (E, F) {
            C += '<li><a href="' + F.url + '" target="_blank">' + F.name + "</a></li>"
        });
        C += "</ul>";
        B.prepend(C)
    };
    if (typeof j !== "function" || (j() === null || typeof j().jquery === "undefined")) {
        throw new Error("SI Network Bar requires jQuery v1.0 or higher")
    }
    j(document).ready(function () {
        if (s && window.location.hostname.match(/college\-basketball\.si\.com/)) {
            return
        }
        v()
    })
}(jQuery));
