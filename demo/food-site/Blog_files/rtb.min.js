/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],a)}else{a(jQuery)}}(function(e){var a=/\+/g;function d(g){return g}function b(g){return decodeURIComponent(g.replace(a," "))}function f(g){if(g.indexOf('"')===0){g=g.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{return c.json?JSON.parse(g):g}catch(h){}}var c=e.cookie=function(p,o,u){if(o!==undefined){u=e.extend({},c.defaults,u);if(typeof u.expires==="number"){var q=u.expires,s=u.expires=new Date();s.setDate(s.getDate()+q)}o=c.json?JSON.stringify(o):String(o);return(document.cookie=[encodeURIComponent(p),"=",c.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join(""))}var g=c.raw?d:b;var r=document.cookie.split("; ");var v=p?undefined:{};for(var n=0,k=r.length;n<k;n++){var m=r[n].split("=");var h=g(m.shift());var j=g(m.join("="));if(p&&p===h){v=f(j);break}if(!p){v[h]=f(j)}}return v};c.defaults={};e.removeCookie=function(h,g){if(e.cookie(h)!==undefined){e.cookie(h,"",e.extend(g,{expires:-1}));return true}return false}}));
(function(a){var b={init:function(){b.initializePlugin();if(!window.atob){window.atob=base64.decode}},initializePlugin:function(){if(b.getCookieDetails("jit_cookie")===null){b.createjitCookie()}b.initializeBackplane();b.cookies=b.getAllCookieDetails();b.EchoUser=new Echo.User({appkey:SNI_COMMUNITY_ECHO_APP.APP_KEY});b.EchoUser.init(function(){if(b.EchoUser.logged()){b.isLogged=true}else{b.isLogged=false}});b.postCookieTimer=window.setInterval(function(){b.cookies=b.getAllCookieDetails();b.EchoUser.init(function(){if(b.EchoUser.logged()){if(b.cookies.smsession===null){b.checkSmsessionDetails()}}else{if(b.cookies.smsession!==null){if(typeof(b.cookies.aiminfo)!="undefined"&&b.cookies.aiminfo!==null){b.postCookieDetails(b.postCookieTimer)}}}})},2500)},getAllCookieDetails:function(){var h={};var f=b.getCookieDetails("aimInfo");if(typeof(f)!="undefined"&&f){try{f=decodeURIComponent(atob(f)).split("||||")}catch(g){if(typeof console!=="undefined"){console.log(g)}}var c=f.length;for(var e=0;e<c;e++){if(typeof f[e]!="undefined"&&f[e]&&f[e].toLowerCase().indexOf("roles")!=-1){RealTidbits.userRoles=f[e].split("=")[1].split(",")}}}else{f=null}var d=b.getCookieDetails("backplane-channel");var j=b.getCookieDetails("SMSESSION");if(j==="LOGGEDOFF"){j=null}return{aiminfo:b.getCookieDetails("aimInfo"),backplane:d,smsession:j}},postCookieDetails:function(d){window.clearInterval(d);if(b.cookies.smsession!==null){var c=SNI_COMMUNITY_ECHO_APP.BUS_NAME+":"+Backplane.getChannelName();a.ajax({url:SNI_COMMUNITY_ECHO_APP.ECHO_FEDERAION_SERVLET_URL+"?personna="+escape(SNI_COMMUNITY_ECHO_ASSET.ASSET_CATEGORY)+"&aiminfo="+escape(b.cookies.aiminfo)+"&backplane="+encodeURIComponent(c),dataType:"jsonp",type:"GET",success:function(e,f){b.checkSmsessionDetails()},error:function(e){b.initializePlugin()}})}else{if(b.isLogged){b.EchoUser.logout();a.cookie("jit_cookie",null,{path:"/",domain:"."+b.upperleveldomain,expires:-1});b.initializePlugin()}}},checkSmsessionDetails:function(){b.EchoUser.init(function(){if(b.EchoUser.logged()){b.isLogged=true}else{b.isLogged=false}});b.smsessionTimer=window.setInterval(function(){var c=b.getCookieDetails("SMSESSION");b.EchoUser.init(function(){if(b.EchoUser.logged()){if(c===null||c==="LOGGEDOFF"){window.clearInterval(b.smsessionTimer);b.EchoUser.logout();a.cookie("jit_cookie",null,{path:"/",domain:"."+b.upperleveldomain,expires:-1});setTimeout(function(){b.initializePlugin()},3500)}}else{b.isLogged=false}})},2500)},getCookieDetails:function(c){var g="=([^;]*).*$";var f=new RegExp(c+g);var d;try{d=document.cookie.match(f)[1].replace(/^"|"$/g,"")}catch(h){d=null}return d},printMessages:function(c){if("console" in self&&"log" in console){console.log(c)}},generateRandomNumber:function(){return(b.S4()+b.S4()+"-"+b.S4()+"-"+b.S4()+"-"+b.S4()+"-"+b.S4()+b.S4()+b.S4())},S4:function(c){return(((1+Math.random())*65536)|0).toString(16).substring(1)},setUserStatus:function(){b.EchoUser.init(function(){if(b.EchoUser.logged()){b.isLogged=true}else{b.isLogged=false}})},sleep:function(c){var e=new Date().getTime();for(var d=0;d<10000000;d++){if((new Date().getTime()-e)>c){break}}},initializeBackplane:function(){jitCookie=b.getCookieDetails("jit_cookie");Backplane.init({serverBaseURL:"http://api.echoenabled.com/v1",busName:SNI_COMMUNITY_ECHO_APP.BUS_NAME,channelName:jitCookie});Backplane.expectMessagesWithin(60);Backplane.expectMessages(["identity/ack"])},createjitCookie:function(){var d=b.generateRandomNumber();var f=location.hostname.split(".");var e=f.shift();var c=f.join(".");b.upperleveldomain=c;a.cookie("jit_cookie",SNI_COMMUNITY_ECHO_ASSET.ASSET_SITE_NAME+"-"+d,{path:"/",domain:"."+b.upperleveldomain})},trim:function(c){if(c!=null&&c!=undefined&&c!="undefined"){return c.replace(/^\s*|\s*$/g,"")}else{return c}}};b.init()})(jQuery);
(function(b){var a=Echo.createPlugin({name:"UpdateSort",applications:["Stream"],init:function(g,c){var h=c.config.get(g.config("target"));var f=c.config.get(g.config("options"));var d=b(g.template).html("<span>"+g.label("sortLabel")+"&nbsp;</span>");if(isSeo){if(typeof h=="string"){h=b(h)}h.append(d)}else{setTimeout(function(){if(typeof h=="string"){h=b(h)}h.append(d)},500)}var e=b("<select>").appendTo(d);b.each(f,function(j,l){var k=l.sortby+"|"+(l.after?l.after:"");e.append(b("<option>").val(k).text(l.label))});e.change(function(){var p=b(this).val();var k=p.split("|");var n=k[0];var i=k[1];var m=c.config.get("query");var o=m;var j=o.split(/ children\b|children:/gi);o=j[0];if(o.match(/sortOrder:/gi)){o=o.replace(/sortOrder:.+?\b/i,"sortOrder:"+n)}else{o=o+" sortOrder:"+n}if(i==null||i==""){o=o.replace(/after:'.+?'/i,"")}else{if(o.match(/after:/gi)){o=o.replace(/after:'.+?'/i,"after:"+i)}else{var q="sortOrder:"+n;var l=o.indexOf(q);l=l+q.length;o=o.substr(0,l)+" after:"+i+" "+o.substr(l)}}if(j.length>1){o=o+" children"+j[1]}o=o.replace(/\s{2,}/g," ");c.config.set("query",o);c.refresh()})}});a.addLabels({sortLabel:"Sort By:"});a.template='<div class="echo-update-sort-container"></div>'})(jQuery);
(function(b){var a=Echo.createPlugin({name:"sanitize",applications:["Submit","Stream"],init:function(d,c){if(c instanceof Echo.Submit){c.subscribe("Submit.onPostInit",function(e,g){if(d.config.get(c,"stripHtml")==true){var h=g.postData.content;var f=b("<span>"+h+"<span>");g.postData.content=f.text()}else{}})}else{if(c instanceof Echo.Stream){d.extendRenderer("Item","body",d.bodyRenderer)}}}});a.bodyRenderer=function(g,f){var n=this;this.parentRenderer("body",arguments);var e=a.config.get(this,"settings");if(!e){e={}}if(a.config.get(this,"stripHtml")==true){b(g).find(".echo-item-text [style]").each(function(r){b(this).removeAttr("style")})}var h=["script","style","form","applet"];var q=e.tags;if(typeof q!="undefined"){for(i=0;i<q.length;i++){b(g).find(q[i]).each(function(){var r=b(this).text();b(this).replaceWith(r)})}}for(i=0;i<h.length;i++){b(g).find(h[i]).each(function(){b(this).remove()})}var l=e.tagWhitelist;if(typeof l!="undefined"){for(i=0;i<l.length;i++){b(g).find(q[i]).remove()}}var o=e.externalLinks;var j=e.validDomains;if(typeof o!="undefined"&&o==true){b(g).find("a").each(function(){var r=b(this).attr("href");if(!r){return}if(b(this).find("img").length>0){return}var s=true;for(i=0;i<j.length;i++){if(r.indexOf(j[i])>=0){s=false}}if(s){b(this).remove()}})}var k=b(g).html();var m=b(g).text();var c=e.types;if(typeof c!="undefined"&&c.length){for(i=0;i<c.length;i++){switch(c[i]){case"email":var d=new RegExp("[A-Z0-9._%+-]+@[A-Z0-9.-]+[a-zA-Z]{2,}","gi");var p;while((p=d.exec(m))!==null){k=k.replace(p[0],a.asterix(p[0].length))}break;case"phone":var d=new RegExp("[0-9.+-]{10,}","gi");var p;while((p=d.exec(m))!==null){k=k.replace(p[0],a.asterix(p[0].length))}var d=new RegExp("[0-9]{3}-?\\.? ?[0-9]{3}-?\\.? ?[0-9]{4}","gi");var p;while((p=d.exec(m))!==null){k=k.replace(p[0],a.asterix(p[0].length))}var d=new RegExp("(((\\+|00)3[12] ?(\\(0\\))?)|0)([0-9]{2}-? ?[0-9]{7})|([0-9]{3}-? ?[0-9]{6})|([0-9]{1}-? ?[0-9]{8})","gi");var p;while((p=d.exec(m))!==null){k=k.replace(p[0],a.asterix(p[0].length))}break}}}b(g).html(k)};a.asterix=function(d){var c="";for(i=0;i<d;i++){c+="*"}return c}})(jQuery);
if(!Echo){Echo={}}if(!Echo.Localization){Echo.Localization={labels:{}}}Echo.Localization.extend({commentsTitle:"Comments",moderation:"Moderation Mode",streamSortRecent:"Most Recent",streamSortPopular:"Popular Now",streamSortOldest:"Oldest First",streamSortRating:"Most Likes",adminToggleModeration:"Toggle Moderation",flashMsgModertation:"Comment awaiting moderation.",flagFeedback:"Thanks for the feedback. We've noted it.",maxChars:"Maximum message limit is {LIMIT} characters."},"RealTidbitsComments");Echo.Localization.extend({attachPhoto:"+ Photo",actionString:"Include a note here...",noPhotosUploaded:"No files were uploaded!",uploadNotComplete:"Please wait until all files have been uploaded."},"Plugins.FileUpload");Echo.Localization.extend({attachWebVideo:"+ Video",titleRecord:"Record Your Comment:",titlePlayback:"Comment Playback:",buttonCancel:"Cancel",buttonDelete:"Delete Recording"},"Plugins.Tokbox");Echo.Localization.extend({sortLabel:"Sort By:"},"Plugins.UpdateSort");Echo.Localization.extend({link:" "},"Plugins.RSSFeed");Echo.Localization.extend({sharePrompt:"Share your comment:",shareLabel:"Share"},"Plugins.JanrainSharingv2");Echo.Localization.extend({submitSubscribe:"Follow Conversation",link:" ",subscribeButton:"Subscribe",cancelButton:"Cancel",enterEmail:"Enter your email to follow this conversation:",noEmail:"No email available to subscribe you to replies to this comment.",success:"Your are now subscribed to new replies.",notValid:"Email address is not valid."},"Plugins.LMKSubscription");Echo.Localization.extend({edit:"Edit",editSource:"Edit Source",editControl:"Edit",updating:"Updating..."},"Plugins.EditForum");Echo.Localization.extend({youMustBeLoggedIn:"You must be logged in to comment"},"Plugins.FormAuth");Echo.Localization.extend({replyControl:"Reply"},"Plugins.Reply");Echo.Localization.extend({defaultModeSwitchTitle:"Switch to metadata view",guest:"Guest",today:"Today",yesterday:"Yesterday",lastWeek:"Last Week",lastMonth:"Last Month",secondAgo:"Second Ago",secondsAgo:"Seconds Ago",minuteAgo:"Minute Ago",minutesAgo:"Minutes Ago",hourAgo:"Hour Ago",hoursAgo:"Hours Ago",dayAgo:"Day Ago",daysAgo:"Days Ago",weekAgo:"Week Ago",weeksAgo:"Weeks Ago",metadataModeSwitchTitle:"Return to default view",monthAgo:"Month Ago",monthsAgo:"Months Ago",sharedThisOn:"I shared this on {service}...",userID:"User ID:",fromLabel:"from",viaLabel:"via"},"Item");Echo.Localization.extend({guest:"Guest",live:"Live",paused:"Paused",more:"More",loading:"Loading...",emptyStream:"No items at this time...",waiting:"Building view (This may take a moment)...","new":"new"},"Stream");Echo.Localization.extend({createdBy:"Created by",loading:"Loading...",markers:"Markers:",markersHint:"Marker1, marker2, marker3, ...",on:"on",post:"Post",posting:"Posting...",tagsHint:"Tag1, tag2, tag3, ...",tags:"Tags:",update:"Update",updating:"Updating...",yourName:"Your Name (required)",yourWebsiteOptional:"Your website (optional)"},"Submit");Echo.Localization.extend({edit:"Edit",loading:"Loading...",login:"Login",logout:"Logout",loggingOut:"Logging out...",or:"or",signup:"signup"},"Plugins.Auth");
if(typeof window.RealTidbits!=="object"){window.RealTidbits={}}if(typeof window.RealTidbits.settings!=="object"){window.RealTidbits.settings={}}if(typeof window.RealTidbits.Comments!=="object"){window.RealTidbits.Comments={}}if(typeof window.RealTidbits.applications!=="object"){window.RealTidbits.applications={}}(function(d){RealTidbits.Comments=function(j){var h=this;var g=this.getIdentityUrl(j);var m={apiBaseURL:window.location.protocol+"//api.echoenabled.com",appkey:null,backplane:{busName:"3ones.com",serverBaseURL:window.location.protocol+"//api.echoenabled.com/v1",channelName:null,rpx:null},targetURL:null,queryUrl:null,streamQuery:null,querySources:null,itemsPerPage:25,cssDefault:(window.location.protocol=="https:"?"https://ssl.":"http://cdn.")+"realtidbits.com/libs/v1/comments/comments.css",defaultAvatar:"//c0.echoenabled.com/images/avatar-default.png",plugins:{},sanitize:{},bozoFilter:false,submitPermissions:"forceLogin",richTextEditor:true,cleditorConfig:{height:"125px"},identityManagerLogin:g,identityManagerEdit:null,moderationControls:true,postTags:false,emailSubscribe:true,rssFeed:true,initBackplane:true,user:null,fileUploadServer:"http://storage.realtidbits.com.s3.amazonaws.com/comments_photos/",showReply:true,showMedia:false,socialSharing:false,readOnly:false,guestComments:false,hideLogin:false,preModeration:false,defaultSubscribeChecked:false,itemButtonHover:false,CommunityFlag:true,enableEditPlugin:true,streamStateToggleBy:"mouseover",inlineMedia:{imageMaxHeight:150,shortenUrls:true},scrollToNewComment:false,enableNotifications:false,enableInlineMedia:true,localization:null,loginPrompt:null,enableTokbox:false,tokboxApiKey:14576382,tokboxApiSecret:"679c6689be6e3105c82cfa878a8dc691ccd58364",tokboxTimeLimit:30000,ads:false,updatesort:true,events:{},enableMarkersTags:false,textLimit:2500,childrenItemsPerPage:5,childrenSortOrder:"reverseChronological",submitClientParams:{},streamClientParams:{},safeHTML:"permissive",analytics:true,enableLike:true,doUserInvalidate:false,renderCounter:true};m.targetURL=d("head").find("link[rel='canonical']").attr("href")||location.href.split("#")[0];if(!this.utils.isUrl(m.targetURL)){m.targetURL="http://"+document.domain+m.targetURL}j.backplane=d.extend({},m.backplane,j.backplane);this.config=d.extend({},m,j);if(this.config.queryUrl!=null){this.config.targetURL=this.config.queryUrl}if(this.config.guestComments==true){this.config.submitPermissions="anonymous"}this.config.fileUploadPlugin={name:"FileUpload",thumbnailRes:[98,98],previewRes:[250,250],webRes:[800,600],filesMax:4,fileSizeMax:0,fileSizeMin:0,storageServer:this.config.fileUploadServer};if(this.config.initBackplane==true){var f={serverBaseURL:this.config.backplane.serverBaseURL,busName:this.config.backplane.busName};if(this.config.backplane.channelName){Backplane.resetCookieChannel();f.channelName=this.config.backplane.channelName}Backplane.init(f)}if(this.config.target===undefined||!this.config.target||this.config.target==""){var l=(new Date).getTime();document.writeln('<div id="'+l+'"></div>');this.config.target=document.getElementById(l)}if(typeof(this.config.target)=="string"){this.config.target=d("#"+this.config.target)}this.target=d(this.config.target);this.target.addClass("realtidbits-comments");this.submitClient=null;this.streamClient=null;this.utils.appendCSS("realtidbits-comments-css",this.config.cssDefault);if(this.config.css){if(typeof this.config.css=="object"&&this.config.css.length){for(var k=0;k<this.config.css.length;k++){this.utils.appendCSS("realtidbits-comments-css-custom"+k,this.config.css[k])}}else{if(this.config.css){this.utils.appendCSS("realtidbits-comments-css2",this.config.css)}}}if(this.config.enableNotifications==true&&typeof RealTidbits.Notifications!="undefined"){new RealTidbits.Notifications({appkey:this.config.appkey})}if(this.config.analytics==true){if(typeof window.RealTidbits.applications!=="object"){window.RealTidbits.applications={}}if(typeof window.RealTidbits.applications.analytics=="undefined"){if(typeof RealTidbits.Analytics!="undefined"){window.RealTidbits.applications.analytics=new RealTidbits.Analytics({appkey:this.config.appkey})}}}Echo.Broadcast.subscribe("User.onInvalidate",function(i,n){if(h.config.doUserInvalidate==true){h.streamClient.stopLiveUpdates();setTimeout(function(){h.initStream()},500);if(h.config.renderCounter==true){h.updateCounter()}}});Echo.Broadcast.subscribe("Stream.Plugins.CommunityFlag.onFlagComplete",function(i,n){d.fancybox({modal:false,hideOnOverlayClick:true,hideOnContentClick:false,enableEscapeButton:true,showCloseButton:false,autoDimensions:true,centerOnScroll:true,content:"Thanks for the feedback. We've noted it."})});this.config.user=new Echo.User({appkey:this.config.appkey,apiBaseURL:this.config.apiBaseURL,contextId:(new Date()).valueOf()+Math.random()});this.config.user.init(function(){setTimeout(function(){h.loadContent()},100)})};RealTidbits.Comments.prototype.label=function(g){var h="RealTidbitsComments";var f=Echo.Localization.labels[Echo.Localization.key(g,h)]||g;return f};RealTidbits.Comments.prototype.getIdentityUrl=function(g){if(g.identityManager){return g.identityManager}else{var f={url:g.backplane.rpx+"openid/embed?flags=stay_in_window,no_immediate&token_url=http%3A%2F%2Fapps.echoenabled.com%2Fv2%2Fjanrain%2Fwaiting.html&bp_channel=",width:420,height:260}}return f};RealTidbits.Comments.prototype.loadContent=function(){var f=this;this.target.append(d(RealTidbits.Comments.template.core));this.initNavBar();var h='<div class="realtidbits-comments-title">'+this.label("commentsTitle")+' (<span class="comment-count"></span>)</div>';var g=d(h);this.refreshContent();if(this.config.renderCounter==true){this.updateCounter()}};RealTidbits.Comments.prototype.updateCounter=function(){var h=this;var g=this.getDefaultState();var j=this.getDefaultChildrenState();var i="";if(this.config.bozoFilter&&this.config.user.account&&this.config.preModeration==false){i+="(user.id:"+this.config.user.account.id+" childrenof:"+this.config.targetURL+" "+g+") OR "}i+=this.config.streamQuery||this.generateQuery();var f=new Echo.Counter({target:d("<div></div>"),appkey:this.config.appkey,query:i,liveUpdates:true,liveUpdatesTimeout:60});f.subscribe("Counter.onUpdate",function(l,k){var m=h.config.header?h.config.header:function(n){return h.label("commentsTitle")+' (<span class="comment-count">'+(typeof n.count!="undefined"?n.count:"5000+")+"</span>)"};d(h.target).find(".realtidbits-comments-header").html('<div class="realtidbits-comments-title">'+m(k.data)+"</div>")})};RealTidbits.Comments.prototype.refreshContent=function(){this.submitClients=[];this.streamClient=[];this.init()};RealTidbits.Comments.prototype.initNavBar=function(){var f=this};RealTidbits.Comments.prototype.getAvatar=function(g){var f=null;if(typeof g.avatar!="undefined"){f=g.avatar}if(g.account&&g.account.accounts&&g.account.accounts[0]&&g.account.accounts[0].photos){var j=g.account.accounts[0].photos||[];for(var h=0;h<j.length;h++){if(j[h].type=="avatar"){f=j[h].value}}}if(d.trim(f)==""||f==null){f=this.config.defaultAvatar}return f};RealTidbits.Comments.prototype.init=function(){var f=this;var g=d(this.config.target).find(".realtidbits-comments-submit");this.submitClient=this.initSubmitClient(g);if(this.config.readOnly==true){d(this.target).find(".echo-submit-body").hide();d(this.target).find(".echo-submit-controls").hide()}this.initStream()};RealTidbits.Comments.prototype.initStream=function(g){var f=this;var i={};i.targetURL=this.config.targetURL;i.updatesort=true;i.rssFeed=true;i.emailSubscribe=true;Echo.Broadcast.subscribe("Stream.Plugins.CommunityFlag.onFlagComplete",function(k,l){var j=d("<div>"+f.getLabel("flagFeedback")+"</div>");d.fancybox({modal:false,hideOnOverlayClick:true,hideOnContentClick:true,enableEscapeButton:true,showCloseButton:false,autoDimensions:true,centerOnScroll:true,content:j})});d(this.config.target).find(".realtidbits-comments-stream-header").empty();var h=d(this.config.target).find(".realtidbits-comments-stream");h.empty();this.streamClient=this.initStreamClient(h,i)};RealTidbits.Comments.prototype.initParticipants=function(g){var f=this;d(this.config.target).find(".realtidbits-comments-stream-header").empty();var h=d(this.config.target).find(".realtidbits-comments-stream");h.empty();new RealTidbits.Facepile({appkey:this.config.appkey,target:h,max:100,showOnline:false,doKeepAlive:false,justItems:true,query:"childrenof:"+location.href.split("#")[0]+" -state:ModeratorDeleted safeHTML:permissive sortOrder:repliesDescending itemsPerPage:100 children:1",hovercard:function(j,i){var k=new RealTidbits.HoverCard({appkey:f.config.appkey,markers:[],onrender:function(m,l){}});k.initHoverCard(j,i)},callback:function(i){}})};RealTidbits.Comments.prototype.getItems=function(h,i){var f=("https:"===window.location.protocol?"https:":"http:")+"//api.echoenabled.com/v1/search";var g={appkey:this.config.appkey,q:h};d.ajax({url:f,dataType:"jsonp",data:g,success:function(k){var j=k.entries;if(j&&j.length>0){i(j)}else{i(null)}}})};RealTidbits.Comments.prototype.truncate=function(h,i,f){var g=h.length>i;s_=g?h.substr(0,i-1):h;s_=f&&g?s_.substr(0,s_.lastIndexOf(" ")):s_;return g?s_+"...":s_};RealTidbits.Comments.prototype.getLabel=function(g){var h="RealTidbitsComments";var f=Echo.Localization.labels[Echo.Localization.key(g,h)]||g;return f};RealTidbits.Comments.prototype.isModerator=function(){return this.isRole(["administrator","moderator"])};RealTidbits.Comments.prototype.isRole=function(f){for(var g=0;g<f.length;g++){if(this.submitClient.user.data.roles[f[g]]==true){return true}}return false};RealTidbits.Comments.prototype.initSubmitClient=function(j){if(typeof this.config.plugins.formAuthTop!="undefined"){var i=this.config.plugins.formAuthTop}else{var i={name:"FormAuth",submitPermissions:this.config.submitPermissions||"forceLogin"}}i.apiBaseURL=this.config.apiBaseURL;i.nestedPlugins=[];if(this.config.plugins.formAuth){i.nestedPlugins=this.config.plugins.formAuth}if(this.config.identityManagerLogin){i.identityManagerLogin=this.config.identityManagerLogin}if(this.config.identityManagerEdit){i.identityManagerEdit=this.config.identityManagerEdit}if(this.config.submitPermissions){i.submitPermissions=this.config.submitPermissions}if(this.config.hideLogin==true){i.identityManagerLogin=null;i.identityManagerEdit=null;i.identityManagerLogout=null}if(typeof this.config.plugins.formAuthTop!=undefined){this.config.plugins.formAuthTop=i}var g=[i,{name:"CommentsSubmit",appWrapper:this},{name:"LoginPrompt",appWrapper:this}];g.push({name:"sanitize",stripHtml:false});if(this.config.fileUploadServer){g.push(this.config.fileUploadPlugin)}if(this.config.enableTokbox){g.push({name:"Tokbox",recordTimeLimit:this.config.tokboxTimeLimit,apikey:this.config.tokboxApiKey,apisecret:this.config.tokboxApiSecret})}if(this.config.richTextEditor==true){g.push({name:"RichTextEditor",cleditorConfig:this.config.cleditorConfig})}if(this.config.emailSubscribe){g.push({name:"EMBSubscription",defaultChecked:this.config.defaultSubscribeChecked})}g.push({name:"RTBAnalytics",product:"comments"});g.push({name:"SubmitTextCounter",limit:this.config.textLimit});g.push({name:"rtbSubmitPlugin",appWrapper:this});if(this.config.plugins.submit){d.merge(g,this.config.plugins.submit)}var h={target:j,appkey:this.config.appkey,targetURL:this.config.targetURL,plugins:g};var h=d.extend({},h,this.config.submitClientParams);var f=new Echo.Submit(h);this.config.user=f.user;return f};RealTidbits.Comments.prototype.isModerator=function(){if(!this.config.user.data.roles){return false}if(this.config.user.data.roles.administrator==true){return true}if(this.config.user.data.roles.moderator==true){return true}return false};RealTidbits.Comments.prototype.getDefaultState=function(){if(this.isModerator()){var f="-state:ModeratorDeleted,UserDeleted -user.state:ModeratorBanned,ModeratorDeleted"}else{var f="-state:ModeratorDeleted,UserDeleted,SystemFlagged,CommunityFlagged,ModeratorFlagged -user.state:ModeratorBanned,ModeratorDeleted"}if(this.config.preModeration){f="state:ModeratorApproved "+f}return f};RealTidbits.Comments.prototype.getDefaultChildrenState=function(){if(this.isModerator()){var f="-state:ModeratorDeleted,UserDeleted -user.state:ModeratorBanned,ModeratorDeleted"}else{var f="-state:ModeratorDeleted,UserDeleted,SystemFlagged -user.state:ModeratorBanned,ModeratorDeleted"}if(this.config.preModeration){f="state:ModeratorApproved "+f}return f};RealTidbits.Comments.prototype.generateQuery=function(w){w=w||{};var s=w.sortBy;var i=w.after||"";var o=w.isSticky||false;var f=w.showFlagged||false;var q=w.showDeleted||"";var p=w.showModeration||"";var u=w.markers||[];var t=w.markersOR||[];var h=w.nomarkers||[];var r=w.tags||[];var j=w.children||"children";var g=w.scope||"childrenof";var v=w.targetURL||this.config.targetURL;var x=w.user?"user.id:'"+w.user+"' ":"";var n=this.config.itemsPerPage||100;var l=this.getDefaultState();var m=this.getDefaultChildrenState();var k="";if(this.config.bozoFilter&&this.config.user.account&&this.config.preModeration==false){k+="(user.id:"+this.config.user.account.id+" childrenof:'"+this.config.targetURL+"' "+l+") OR "}k+=x+g+":'"+v+"'"+(this.config.querySources?" "+this.config.querySources:"")+(u.length?" "+this.utils.encodeJoinArray(u,"markers:"):"")+(t.length?" ("+this.utils.encodeJoinArray(t,"markers:"," OR ")+")":"")+(r.length?" "+this.utils.encodeJoinArray(r,"tags:"):"")+(i?" after:'"+i+"' ":"")+(h.length?" "+this.utils.encodeJoinArray(h,"-markers:"):"")+" itemsPerPage:"+n+(s?" sortOrder:"+s:" sortOrder:reverseChronological")+(f?" state:CommunityFlagged,ModeratorFlagged,SystemFlagged ":"")+(q?" state:ModeratorDeleted ":"")+(p?" state:CommunityFlagged,ModeratorFlagged,SystemFlagged,ModeratorDeleted ":"")+(!f&&!q&&!p?" "+l+" ":"")+" safeHTML:"+this.config.safeHTML+" "+j+" "+m+" childrenItemsPerPage: "+this.config.childrenItemsPerPage+" childrenSortOrder: "+this.config.childrenSortOrder+" ";return k};RealTidbits.Comments.prototype.initStreamClient=function(m,j){var t=this;j=j||{};var g=typeof j.streamType=="undefined"?null:j.streamType;var q=typeof j.childrenSortOrder=="undefined"?null:j.childrenSortOrder;var p=typeof j.liveUpdatesTimeout=="undefined"?10:j.liveUpdatesTimeout;var l=typeof j.liveUpdates=="undefined"?true:j.liveUpdates;var s={};var n=this.config.streamQuery||this.generateQuery(j);var i=[];i.push({name:"TwitterIntents"});i.push({name:"sanitize",settings:this.config.sanitize});i.push({name:"CommentsStream",appWrapper:this});if(this.config.richTextEditor==true){i.push({name:"RichTextEditor",textarea:null,cleditorConfig:this.config.cleditorConfig})}if(this.config.showReply==true&&this.config.readOnly!=true){var h=[this.config.plugins.formAuthTop];h.push({name:"InlineMedia",settings:this.config.inlineMedia});if(this.config.emailSubscribe){h.push({name:"EMBSubscription",defaultChecked:this.config.defaultSubscribeChecked})}if(this.config.fileUploadServer){}h.push({name:"LoginPrompt",appWrapper:this},{name:"rtbSubmitPlugin",appWrapper:this});if(this.config.richTextEditor==true){h.push({name:"RichTextEditor",cleditorConfig:this.config.cleditorConfig,isReplyPlugin:true})}if(typeof this.config.plugins.reply!="undefined"){d.merge(h,this.config.plugins.reply)}i.push({name:"Reply",actionString:"Write reply here...",nestedPlugins:h})}if(this.config.enableLike){if(typeof this.config.plugins.like!="undefined"){i.push({name:"Like",nestedPlugins:this.config.plugins.like})}else{i.push({name:"Like"})}}if(this.config.enableInlineMedia==true){i.push({name:"InlineMedia",settings:this.config.inlineMedia})}if(this.config.socialSharing!=false){var r=typeof this.config.socialSharing.appUrl!="undefined"?this.config.socialSharing.appUrl:this.config.backplane.rpx;if(!r){r="https://3ones.rpx.com"}i.push({name:"JanrainSharingv2",appUrl:r,activity:{sharePrompt:null,shareContent:"{content}",itemURL:this.config.targetURL}})}if(this.config.enableEditPlugin==true){i.push({name:"EditComments",layout:"inline",richTextEditor:this.config.richTextEditor,cleditorConfig:{}})}if(this.config.CommunityFlag==true){i.push({name:"CommunityFlag"})}if(this.config.emailSubscribe){i.push({name:"EMBSubscription",itemControls:false,target:d(this.config.target).find(".realtidbits-comments-stream-header"),defaultChecked:this.config.defaultSubscribeChecked})}if(this.config.rssFeed){i.push({name:"RSSFeed",itemControls:false,target:d(this.config.target).find(".realtidbits-comments-stream-header")})}if(this.config.plugins.stream){d.merge(i,this.config.plugins.stream)}if(j.updatesort==true&&this.config.updatesort==true){var k={name:"UpdateSort",target:d(this.config.target).find(".realtidbits-comments-stream-header"),options:[{label:this.getLabel("streamSortRecent"),sortby:"reverseChronological",after:null},{label:this.getLabel("streamSortPopular"),sortby:"repliesDescending",after:"'1 day ago'"},{label:this.getLabel("streamSortRating"),sortby:"likesDescending",after:null},{label:this.getLabel("streamSortOldest"),sortby:"chronological",after:null}]};if(this.config.sortPlugin){if(this.config.sortPlugin.target){k.target=this.config.sortPlugin.target}k.options=this.config.sortPlugin.options}i.push(k)}if(this.config.enableTokbox){i.push({name:"Tokbox",apikey:this.config.tokboxApiKey,apisecret:this.config.tokboxApiSecret})}if(this.config.moderationControls==true){i.push({name:"Curation",removePersonalItemsAllowed:true},{name:"UserBan"},{name:"UserPrivileges"})}i.push({name:"RTBAnalytics",product:"comments"});var f={target:m,appkey:this.config.appkey,query:n,params:j,liveUpdates:l,liveUpdatesTimeout:p,streamStateToggleBy:"mouseover",reTag:false,viaLabel:{icon:true,text:false},streamStateLabel:{icon:false,text:false},contentTransformations:{text:["smileys","urls","newlines"],html:["smileys","urls","newlines"],xhtml:["smileys","urls"]},plugins:i};var f=d.extend({},f,this.config.streamClientParams);var o=new Echo.Stream(f);return o};RealTidbits.Comments.template={};RealTidbits.Comments.template.core='<div class="realtidbits-comments-header clearfix"></div><div class="realtidbits-comments-submit clearfix"></div><div class="realtidbits-comments-content clearfix"><div class="realtidbits-comments-stream-header clearfix"></div><div class="realtidbits-comments-stream-media clearfix"></div><div class="realtidbits-comments-stream"></div></div><div class="realtidbits-comments-footer clearfix"></div>';RealTidbits.Comments.prototype.utils={};RealTidbits.Comments.prototype.utils.isUrl=function(f){var g=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return g.test(f)};RealTidbits.Comments.prototype.utils.ajax=function(f,g,h){d.ajax({url:f,dataType:"jsonp",data:g,success:function(i){h(i)}})};RealTidbits.Comments.prototype.utils.appendCSS=function(h,f){if(!document.getElementById(h)){var g=document.createElement("link");g.rel="stylesheet";g.type="text/css";g.href=f;g.id=h;document.getElementsByTagName("head")[0].appendChild(g)}};RealTidbits.Comments.prototype.utils.encodeJoinArray=function(g,j,f){var h=[];for(var k=0;k<g.length;k++){h[k]=(j?j:"")+"'"+g[k]+"'"}return h.join((f?f:" "))};RealTidbits.Comments.prototype.utils.parseMarker=function(g,m,j){for(var f=0;f<m.length;f++){var l=m[f].split(":");var h=l.shift();var k=l.join(":");var k=(isNaN(k)||k.length>10?k:parseFloat(k));if(h.toLowerCase()==g.toLowerCase()){if(j){return k.toLowerCase()}return k}}return null};RealTidbits.Comments.prototype.utils.truncate=function(h,i,f){var g=h.length>i;s_=g?h.substr(0,i-1):h;s_=f&&g?s_.substr(0,s_.lastIndexOf(" ")):s_;return g?s_+"...":s_};RealTidbits.Comments.prototype.utils.removeByElement=function(h,f){for(var g=0;g<h.length;g++){if(h[g]==f){h.splice(g,1)}}};RealTidbits.Comments.prototype.utils.getParam=function(g){g=g.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var f="[\\?&]"+g+"=([^&#]*)";var i=new RegExp(f);var h=i.exec(window.location.href);if(h==null){return""}else{return decodeURIComponent(h[1].replace(/\+/g," "))}};var c=Echo.createPlugin({name:"rtbSubmitPlugin",applications:["Submit"],dependencies:[],init:function(h,g){var f=g.config.get(h.config("appWrapper"));c.extendRenderer("Submit","container",function(j,k,i){this.parentRenderer("container",arguments);if(f.config.hideLogin==true){d(j).find(".echo-auth-login, .echo-auth-edit, .echo-auth-logout").hide()}});g.subscribe("Submit.onPostInit",function(j,l){var o=0;if(l.inReplyTo.object){o=1;if(l.inReplyTo.object.markers){var n=RealTidbits.Comments.prototype.utils.parseMarker("depth",l.inReplyTo.object.markers,false);if(n!=null){var n=parseInt(n);o=n+1}}}var m=["depth:"+o];var i=l.postData.markers;i=i.replace(/depth:.*?,/gi,"");var k=i.split(",");var m=m.concat(k);l.postData.markers=m.join(",")})}});var b=Echo.createPlugin({name:"CommentsSubmit",applications:["Submit"],dependencies:[],init:function(h,g){var f=g.config.get(h.config("appWrapper"));h.appWrapper=f;h.extendRenderer("Submit","postButton",function(i,l){var k=this;var j=h.get(g,"postButtonHandler");if(!j){j=function(m){if(g.user.logged()){}else{if(g.config.get("mode")!="edit"&&f.config.submitPermissions=="forceLogin"){if(typeof f.config.events.onPostNotLogged!="undefined"){f.config.events.onPostNotLogged()}}}var n=l.get("text").val();if(n.length>f.config.textLimit){alert(f.label("maxChars").replace("{LIMIT}",f.config.textLimit));m.stopImmediatePropagation();return false}};h.set(g,"postButtonHandler",j)}i.unbind("click",j).bind("click",j);k.parentRenderer("postButton",arguments)});if(f.config.postTags==true){h.extendRenderer("Submit","metadata",h.metadataRenderer)}h.extendRenderer("Submit","text",function(j,k,i){this.parentRenderer("text",arguments)});h.extendRenderer("Submit","markersContainer",function(j,k,i){this.parentRenderer("markersContainer",arguments);if(f.config.enableMarkersTags==false){j.hide()}});h.extendRenderer("Submit","container",function(j,k,i){this.parentRenderer("container",arguments);if(f.config.hideLogin==true){d(j).find(".echo-auth-login, .echo-auth-edit, .echo-auth-logout").hide()}});h.extendRenderer("Submit","markersContainer",function(j,k,i){this.parentRenderer("markersContainer",arguments);if(f.config.enableMarkersTags==false){j.hide()}});h.listenEvents(h,g)}});b.listenEvents=function(h,g){var f=g.config.get(h.config("appWrapper"));g.subscribe("Submit.onRender",function(i,j){});g.subscribe("Submit.onPostInit",function(i,j){});g.subscribe("Submit.onPostComplete",function(j,l){if(f.config.preModeration){var k=d('<div class="realtidbits-comments-flash-message">'+f.getLabel("flashMsgModertation")+"</div>").hide();d(f.config.target).find(".realtidbits-comments-submit").append(k);k.show()}else{if(f.config.scrollToNewComment){var i=d(f.config.target).find(".realtidbits-comments-content").offset().top-100;d("html:not(:animated),body:not(:animated)").animate({scrollTop:i},1500,function(){})}}})};b.metadataRenderer=function(g,j,f){this.parentRenderer("metadata",arguments);var h=f.type;if(h=="tags"){var i=this.config.get("data.object."+h,this.config.get(h));j.get(h).iHint({text:this.label(h+"Hint"),className:"echo-secondaryColor"}).val(d.trim(d.stripTags(i.join(", ")))).blur();g.show()}};var e=Echo.createPlugin({name:"LoginPrompt",applications:["Submit"],dependencies:[],init:function(h,g){var f=g.config.get(h.config("appWrapper"));h.appWrapper=f;h.extendRenderer("Submit","auth",function(j,l){var i=this;this.parentRenderer("auth",arguments);if(h.appWrapper.config.loginPrompt!=null){var m=d(j).find(".echo-auth-login");var k=m.clone(false);m.hide();m.parent().prepend(k);k.click(function(p){if(typeof h.appWrapper.config.events.onLoginPromptInit!="undefined"){h.appWrapper.config.events.onLoginPromptInit()}if(h.appWrapper.config.loginPrompt!=null){var q=d("<div><p>"+h.appWrapper.config.loginPrompt.text+"</p></div>");var o=d("<button>"+h.appWrapper.config.loginPrompt.button1+"</button>");o.click(function(){Echo.Broadcast.publish("Submit.Plugins.Auth.TermsAccepted",{data:{},appkey:i.config.data.appkey},i.config.data.contextId);m.show();k.hide();m.trigger("click")});var n=d("<button>"+h.appWrapper.config.loginPrompt.button2+"</button>");n.click(function(){d.fancybox.close()});q.append(o);q.append(n);d.fancybox({modal:false,hideOnOverlayClick:true,hideOnContentClick:false,enableEscapeButton:true,showCloseButton:false,autoDimensions:true,centerOnScroll:true,content:q});return false}})}})}});var a=Echo.createPlugin({name:"CommentsStream",applications:["Stream"],dependencies:[],init:function(f,h){var g=h.config.get(f.config("appWrapper"));f.appWrapper=g;b.addCss(".echo-item-avatar {height: auto !important;max-height: 48px !important;overflow: hidden !important;width: 48px;}.echo-item-avatar img {height: auto !important;}.echo-auth-avatar img {width: auto !important;}","EchoAvatarHeightFix");f.addCss(".echo-stream-toggleModerationControls { float: right; margin-left: 15px; cursor: pointer; font-family: Arial; font-size: 11px; }.echo-stream-toggleModerationControls-label {color: #777;}");if(g.isModerator()==true){f.extendRenderer("Stream","toggleModerationControls",f.renderers.Stream.toggleModerationControls);f.extendTemplate("Stream",f.toggleModerationControlsTemplate,"insertAsFirstChild","echo-stream-header")}else{setTimeout(function(){d(g.target).find(".echo-stream-toggleModerationControls").remove()},500)}f.extendRenderer("Stream","more",function(i,j){this.parentRenderer("more",arguments);i.click(function(){if(typeof f.appWrapper.config.events.streamOnMore!="undefined"){f.appWrapper.config.events.streamOnMore()}})});f.extendRenderer("Item","date",f.dateRenderer);f.extendRenderer("Item","container",f.containerRenderer);f.extendRenderer("Item","body",f.bodyRenderer);f.extendRenderer("Item","sourceIcon",f.sourceIconRenderer);f.extendRenderer("Item","controls",f.controlsRenderer);f.extendRenderer("Item","control",f.controlRenderer);f.extendRenderer("Item","authorName",f.authorNameRenderer);f.extendRenderer("Item","avatar",function(j,k){var i=this.parentRenderer("avatar",arguments);if(i&&i.attr("src")){i.attr("src",i.attr("src").replace("http:",""))}return i});f.listenEvents(f,h)}});a.addLabels({moderationShow:"Show moderation controls",moderationHide:"Hide moderation controls"});a.listenEvents=function(f,g){g.subscribe("Stream.onRender",function(h,i){});g.subscribe("Stream.onReady",function(j,k){var i=location.href.split("#")[1];var h=d(g.config.data.target).find("a[name='"+i+"']");if(h.length){var h=h.offset().top;d("html:not(:animated),body:not(:animated)").animate({scrollTop:h},1500,function(){})}});g.subscribe("Stream.onRerender",function(h,i){});g.subscribe("Stream.Item.onRender",function(h,i){if(typeof f.appWrapper.config.events.itemOnRender!="undefined"){f.appWrapper.config.events.itemOnRender()}})};a.renderers={};a.renderers.Stream={};a.renderers.Stream.adminExtraStuff=function(h,k){var g=this;var f=a.appWrapper;var j=h.find(".toggleDeleteItems");var i=(f.config.showDeleted==true?false:true);j.html(i?f.getLabel("adminToggleModeration"):f.getLabel("adminToggleModeration"));j.click(function(){a.appWrapper.config.showDeleted=i;var m=g.config.get("params");m.showModeration=a.appWrapper.config.showDeleted;var l=a.appWrapper.generateQuery(m);a.applyQuery(g,l)})};a.renderers.Stream.toggleModerationControls=function(g,h){var f=a.appWrapper;g.empty().append('<span class="echo-stream-toggleModerationControls-label">'+a.label("moderationHide")+"</span>").show().data("status","show").click(function(){var l=d(this),i=l.data("status"),k;if(i=="show"){k=a.label("moderationShow");l.data("status","hide")}else{k=a.label("moderationHide");l.data("status","show")}l.children().first().html(k);var j=d(f.streamClient.dom.content);j.find("a.echo-item-control-moderation").toggle();j.find("input.echo-item-statusCheckbox").parent().toggle()})};a.applyQuery=function(f,g){f.config.set("query",g);f.refresh()};a.dateRenderer=function(i,k){var j=this;this.parentRenderer("date",arguments);var h=i.text();h=d("<a>"+h+"</a>");h.attr("title","Permanent link to this comment");var g=(this.data.object.id).split("/");var f="#comment-"+g[g.length-1];h.attr("href",f);i.html(h)};a.authorNameRenderer=function(j,k){var g=d("<span>"+this.parentRenderer("authorName",arguments)+"</span>");var f=this.data.actor.roles||[];for(var h=0;h<f.length;h++){d(j).addClass(f[h]);g.append(d('<span class="echo-author-role">'+f[h]+"</span>"))}return g.html()};a.controlRenderer=function(h,k,f){var j=this.parentRenderer("control",arguments);if(typeof a.appWrapper.streamClient.dom!="undefined"){var g=a.appWrapper.streamClient.dom.content.find(".echo-stream-toggleModerationControls").data("status")}else{var g="show"}if(f.plugin&&f.plugin in {Curation:1,UserBan:1,UserPrivileges:1}){var i=d(j);i.addClass("echo-item-control-moderation");if(g=="hide"){i.hide()}}return j};a.controlsRenderer=function(f,g){this.parentRenderer("controls",arguments);if(a.appWrapper.config.itemButtonHover==true){d(f).hide()}};a.sourceIconRenderer=function(f,h){this.parentRenderer("sourceIcon",arguments);var g=d(f);if(g.css("background-image").indexOf("cdn.js-kit.com/images/echo.png")!=-1){}};a.bodyRenderer=function(g,h){var f=this;this.parentRenderer("body",arguments);g.find("a").attr("target","_blank")};a.containerRenderer=function(h,j){var f=this;this.parentRenderer("container",arguments);var g=(this.data.object.id).split("/");var i=d('<a name="comment-'+g[g.length-1]+'" />');h.prepend(i);if(a.appWrapper.config.itemButtonHover==true){d(h).hover(function(){d(this).find(".echo-item-controls").first().show()},function(){d(this).find(".echo-item-controls").first().hide()})}else{d(this).find(".echo-item-controls").first().show()}};a.templateAdminStuff='<div class="echo-stream-curate realtidbits-comments-stream-admin-stuff echo-stream-adminExtraStuff">&nbsp;<span class="echo-item-control-delim"> &middot; </span><a href="javascript:void(0);" class="toggleDeleteItems echo-linkColor"></a></div>';a.toggleModerationControlsTemplate='<div class="echo-stream-toggleModerationControls echo-linkColor"></div>';RealTidbits.TrackIP=function(g){var f=this;f.appkey=g;Echo.Broadcast.subscribe("User.onInvalidate",function(i,h){});Echo.Broadcast.subscribe("User.onInit",function(j,i){var h=new Echo.User({appkey:f.appkey});h.init(function(){if(h.logged()){var k=h.get("id");d.ajax({url:"http://api.realtidbits.com/iptrack_track",dataType:"jsonp",data:{appkey:f.appkey,user_id:k},success:function(l){}})}})})}})(jQuery);
