(function(){var b={minReviews:0};
var a={};
a.config={};
a.init=function(d){var e=$("[data-review-filters]");
a.initialLoad=true;
var c=a.config;
c.settings=$.extend({},b,d);
c.loading=e.find(".loading");
c.global_overlay_visible=false;
c.global_container=e;
c.global_review_template=$(document.getElementById("global_review_template")).html();
c.global_filter_template=$(document.getElementById("global_filter_template")).html();
c.global_trylist_template=$(document.getElementById("global_tryout_template")).html();
c.global_id=e.attr("data-review-filters");
c.base_url=(SNI.Config.env==="prod")?"http://api.reviews.foodnetwork.com/api/external/":"http://recipe-qa.psddev.com/api/external/";
$(".filters").on("click","a",function(f){f.preventDefault();
var g=$(this);
if(g.parent().hasClass("disabled")){return false
}if(this.id==="filter_allReviews"){$("html, body").animate({scrollTop:$("#comments").offset().top},400)
}else{a.Pagination.goTo(g.data("index"))
}});
$(".content").on("click",".btn.prev, .btn.next",function(f){f.preventDefault();
var g=$(this);
if(g.hasClass("disabled")){return false
}if(g.hasClass("prev")){a.Pagination.prev()
}else{a.Pagination.next()
}});
a.Overlay.getFilters()
};
SNI.Food.RecipeReviews=a
})();
(function(l){var c=20;
var e=l.config;
var d=[];
var i=[];
var b;
var k;
var j=function(r){e.global_container.parent().hide();
if(window.console){console.log(r)
}};
var o=function(){j("getFitlers service did not complete and resulted in error.")
};
var f=function(){j("getReview service did not complete and resulted in error.")
};
var p=function(){var r=$.trim($('[itemprop="reviewCount"]').text());
if(r){if(!isNaN(r)){r-=0
}}else{r=-1
}return r
};
var h=function(t){if(t.status!="success"){return j("getFilters failed : "+t.statusMsg)
}var r=t.items.length;
if(r==0){return j("There are no filters for this recipe.")
}if(r>=c){r=c-1;
t.items=t.items.splice(0,r)
}try{t.items[0]["try"]=0;
t.items[1]["try"]=1;
t.items[2]["try"]=2
}catch(x){}t.items.sort(function(A,z){if(A.name.toLowerCase()>z.name.toLowerCase()){return 1
}if(A.name.toLowerCase()<z.name.toLowerCase()){return -1
}return 0
});
var u,w;
for(u=0;
u<r;
u++){w=t.items[u];
w.index=u;
var s=new l.Filter(w);
d.push(s);
if(w["try"]>=0){i[w["try"]]=u
}}var v=p();
if(v>=0&&v<e.settings.minReviews){e.global_container.parent().hide();
return
}w.index=u;
w.name="all reviews";
w.count=v;
w.allReviews=true;
w.id="allReviews";
var s=new l.Filter(w);
d.push(s);
g(e.global_container.find(".filters ul.stack"));
SNI.Food.Ellipsis({bindTo:".stack [rel=ellipsis]"});
k=e.global_container.find(".filters li");
e.flist=k;
e.global_filters=d;
var y=k.eq(0).addClass("current disabled").find("a");
l.Pagination.goTo(y.data("index"))
};
var n=function(r){if(r.status!=="success"){return j("getReviews failed : "+r.statusMsg)
}e.global_review=new l.Review({index:b.query.offset,filter:b,review:r.reviews[0],title:r.recipeTitle,user:r.reviews[0].userInfo});
m()
};
var g=function(u){var t,r,s="";
r=d.length;
for(t=0;
t<r;
t++){s+=d[t].markup
}u.append(s);
u.makeacolumnlists({cols:4,equalHeight:true,colWidth:145})
};
var m=function(){var s=e.global_container,w=s.find(".content");
w.empty();
w.append(e.global_review.markup);
if(l.initialLoad){var v=s.find(".wrapper");
var r=v.html();
var u=e.global_trylist_template;
v.html(u);
var t=$("#try-now-links .tryouts");
try{t.append(k.eq(i[0]).clone().click(function(){l.Pagination.goTo(i[0],0,1);
return false
}));
t.append(k.eq(i[1]).clone().click(function(){l.Pagination.goTo(i[1],0,1);
return false
}));
t.append(k.eq(i[2]).clone().click(function(){l.Pagination.goTo(i[2],0,1);
return false
}));
t.find("li").removeClass("disabled").addClass("try-now")
}catch(x){}v.click(function(){v.html(r);
s.find(".count").show()
});
l.initialLoad=false
}else{s.find(".count").show()
}q()
};
var q=function(){var r=e.global_container;
var u=e.global_review.index+1;
var s=e.global_review.filter.count;
if(u==1){var w=r.find(".btn.prev");
w.addClass("disabled")
}else{if(u==s){var v=r.find(".btn.next");
v.addClass("disabled")
}}e.flist.removeClass("current disabled").eq(l.Pagination.index).addClass("current disabled");
e.loading.hide()
};
var a={getFilters:function(){var t,s;
t=$.param({ffid:e.global_id});
s=e.base_url+"getFilters.jsp?"+t;
if(document.attachEvent){var r=new XDomainRequest();
r.CacheControl="no-cache";
r.open("get",s);
r.onload=function(){var u=JSON.parse(r.responseText);
h(u)
};
r.onerror=function(){return o()
};
r.ontimeout=function(){return o()
};
r.onprogress=function(){};
r.send(null)
}else{$.ajax({url:s,success:h,error:o})
}},getReviews:function(u,s){var t,v;
b=d[u];
b.query.offset=s||0;
v=$.param(b.query);
t=e.base_url+"getReviews.jsp?"+v;
if(document.attachEvent){var r=new XDomainRequest();
r.CacheControl="no-cache";
r.open("get",t);
r.onload=function(){var w=JSON.parse(r.responseText);
n(w)
};
r.onerror=function(){return f()
};
r.ontimeout=function(){return f()
};
r.onprogress=function(){};
r.send(null)
}else{$.ajax({url:t,cache:true,success:n,error:f})
}}};
l.Overlay=a
})(SNI.Food.RecipeReviews);
(function(c){var b=c.config;
var d=function(e){if(typeof e!=="undefined"){$.each(e,function(f,g){mdManager.setParameter(f,g)
})
}};
var a={index:-1,goTo:function(g,h,e){b.loading.show();
if(typeof h==="undefined"||e){var f=g+1;
d({Filter:"Recipe Reviews Filter - "+b.global_filters[f].name,Review:"Recipe Reviews Index - "+f+" of "+b.global_filters.length})
}a.index=g;
c.Overlay.getReviews(g,h)
},next:function(){var f=b.global_review.index+1,e=b.global_review.filter.count;
d({Filter:"Recipe Reviews Filter - "+b.global_review.filter.name});
if(f===e){return false
}a.goTo(a.index,f);
return true
},prev:function(){var e=b.global_review.index;
d({Filter:"Recipe Reviews Filter - "+b.global_review.filter.name});
if(e===0){return false
}a.goTo(a.index,e-1);
return true
}};
c.Pagination=a
})(SNI.Food.RecipeReviews);
(function(a){a.Review=function(d){this["index"]=d.index;
this.filter=d.filter;
this.review=d.review;
this.title=d.title;
this.user=d.user;
var b;
switch(this.review.ratingCount){case"0.5":b='<i class="ss-star half"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"1":b='<i class="ss-star"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"1.5":b='<i class="ss-star"></i><i class="ss-star half"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"2":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"2.5":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star half"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"3":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>';
break;
case"3.5":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star half"></i><i class="ss-star dis"></i>';
break;
case"4":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star dis"></i>';
break;
case"4.5":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star half"></i>';
break;
case"5":b='<i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i><i class="ss-star"></i>';
break;
default:b='<i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i><i class="ss-star dis"></i>'
}var c=a.config.global_review_template;
c=c.replace(/{{body}}/g,decodeURIComponent(this.review.text).replace(/\+/g," "));
c=c.replace(/{{rating}}/g,b);
c=c.replace(/{{helpful}}/g,this.review.helpfulCount);
c=c.replace(/{{displayName}}/g,this.user.displayName);
c=c.replace(/{{location}}/g,this.user.location);
c=c.replace(/{{reviewDate}}/g,this.user.reviewDate);
c=c.replace(/{{avatar}}/g,this.user.avatar);
c=c.replace(/{{userUrl}}/g,this.user.userUrl);
c=c.replace(/{{current}}/g,this["index"]+1);
c=c.replace(/{{total}}/g,this.filter.count);
c=c.replace(/{{name}}/g,this.filter.name);
this.markup=c
}
})(SNI.Food.RecipeReviews);
(function(a){a.Filter=function(c){this.name=c.name;
this.id=c.id;
this.count=c.count;
this["index"]=c.index;
this.title=c.title;
this.url=c.url;
this.last=c.last||false;
this.first=c.first||false;
this.allReviews=c.allReviews||false;
var b=a.config.global_filter_template;
b=b.replace(/{{name}}/g,this.name);
b=b.replace(/{{count}}/g,this.count<0?"":"("+this.count+")");
b=b.replace(/{{id}}/g,this.id);
b=b.replace(/{{index}}/g,this["index"]);
this.markup=b;
this.query={};
this.query.ffid=a.config.global_id;
this.query.filterid=this.id;
this.query.sort="timestamp";
this.query.markup=true
}
})(SNI.Food.RecipeReviews);
SNI.Food.MediaEnlarge=function(b){var d={size:0,enlarge:function(){},reset:function(){},show:function(g,c){g.css({width:643});
c.enlarge.apply(this,arguments)
},hide:function(g,c){c.reset.apply(this,arguments)
}};
for(var e in b){var f=b[e];
var a=$.extend({},d,f);
a.bindTo=e;
SNI.Food.Lightbox(a)
}};
(function(b,a){b(function(){a.Food.RecipeReviews.init({minReviews:40});
a.Food.PackageOverlay({bindTo:".package-overlay",anchorTop:"a[rel=package-overlay-top]",anchorBottom:"a[rel=package-overlay-bottom]",vpBottom:"vpBottom"});
window.onload=function(){var c;
function e(i,h){b(".pic.collapsed").css({height:h.size});
var g=b(".tabs");
c=b(g.length?g:"<hr>").prependTo(".enlarged");
b(".enlarged").show()
}function d(){var g=b(".tabs");
b(".pic.collapsed").css({height:"auto"});
if(g.length){b(g).appendTo(".pic")
}else{c.remove()
}c=null;
b(".enlarged").hide()
}function f(){var g=b(".lead-overview figure").offset();
return{top:g.top,left:g.left-14}
}a.Food.MediaEnlarge({'[href="#lightbox-recipe-image"]':{size:564,backdrop:false,mode:"hidden",preserve:true,enlarge:e,reset:d,offset:f},'[href="#lightbox-recipe-video"]':{size:650,backdrop:false,mode:"hidden",preserve:true,enlarge:e,reset:d,offset:f,init:function(i,h){a.Food.Ellipsis({bindTo:i.find("[rel=ellipsis]")});
if(a.Food.Player.channel){var g=new a.Food.Player.FullSize("vlp-player",a.Food.recipeFirstVideoPath)
}else{i.addClass("no-channel");
h.size=480;
var g=new a.Food.Player.FullSizeNoPlaylist("vlp-player",a.Food.recipeFirstVideoPath)
}}}});
b(".tabs").delegate("a","click",function(g){g.preventDefault();
if(c){var h=b(this).attr("id");
if(h==="tab-video"){b("#lightbox-recipe-image").modal("hide");
b("#lightbox-recipe-video").modal("show")
}else{b("#lightbox-recipe-video").modal("hide");
b("#lightbox-recipe-image").modal("show")
}}});
b('.enlarged span[data-popover="categories"]').attr("data-pos","bottom");
b('.enlarged span[data-popover="nutrition"]').attr("data-pos","bottom");
setTimeout(function(){b("[href*=\\/videos\\/].crosslink").each(function(){var g=b(this);
var h=g.attr("href").replace(/www.foodterms.com/i,location.host);
g.attr("href",h);
g.after('<i class="ss-video"></i>&nbsp;')
});
b("[href*=\\/photos\\/].crosslink").each(function(){var g=b(this);
var h=g.attr("href").replace(/www.foodterms.com/i,location.host);
g.attr("href",h);
g.after('<i class="ss-layers"></i>&nbsp;')
})
},1000)
}
})
})(jQuery,SNI);